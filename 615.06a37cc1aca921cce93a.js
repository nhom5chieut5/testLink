(self.webpackChunk_fuse_demo=self.webpackChunk_fuse_demo||[]).push([[615],{39958:(e,t,n)=>{"use strict";n.d(t,{hO:()=>f,xv:()=>d,Dh:()=>u,GT:()=>l,on:()=>h,pX:()=>a});var i=n(37716),r=n(54486);r.Z.registerVersion("firebase","9.0.0","app-compat");var s=n(39126);e=n.hmd(e);const o=["ngOnDestroy"],a=(e,t,n,i={})=>new Proxy(e,{get:(r,s)=>n.runOutsideAngular(()=>{var r;if(e[s])return(null===(r=null==i?void 0:i.spy)||void 0===r?void 0:r.get)&&i.spy.get(s,e[s]),e[s];if(o.indexOf(s)>-1)return()=>{};const a=t.toPromise().then(e=>{const t=e&&e[s];return"function"==typeof t?t.bind(e):t&&t.then?t.then(e=>n.run(()=>e)):n.run(()=>t)});return new Proxy(()=>{},{get:(e,t)=>a[t],apply:(e,t,n)=>a.then(e=>{var t;const r=e&&e(...n);return(null===(t=null==i?void 0:i.spy)||void 0===t?void 0:t.apply)&&i.spy.apply(s,n,r),r})})})}),l=(e,t)=>{t.forEach(t=>{Object.getOwnPropertyNames(t.prototype||t).forEach(n=>{Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t.prototype||t,n))})})};class c{constructor(e){return e}}const u=new i.OlP("angularfire2.app.options"),d=new i.OlP("angularfire2.app.name");function h(t,n,i){const s="object"==typeof i&&i||{};s.name=s.name||"string"==typeof i&&i||"[DEFAULT]";const o=r.Z.apps.filter(e=>e&&e.name===s.name)[0]||n.runOutsideAngular(()=>r.Z.initializeApp(t,s));try{JSON.stringify(t)!==JSON.stringify(o.options)&&p("error",`${o.name} Firebase App already initialized with different options${e.hot?", you may need to reload as Firebase is not HMR aware.":"."}`)}catch(a){}return new c(o)}const p=(e,...t)=>{(0,i.X6Q)()&&"undefined"!=typeof console&&console[e](...t)},m={provide:c,useFactory:h,deps:[u,i.R0b,[new i.FiY,d]]};let f=(()=>{class e{constructor(e){r.Z.registerVersion("angularfire",s.q4.full,`compat-${e.toString()}`),r.Z.registerVersion("angular",i.q4F.full)}static initializeApp(t,n){return{ngModule:e,providers:[{provide:u,useValue:t},{provide:d,useValue:n}]}}}return e.\u0275fac=function(t){return new(t||e)(i.LFG(i.Lbi))},e.\u0275mod=i.oAB({type:e}),e.\u0275inj=i.cJS({providers:[m]}),e})()},39126:(e,t,n)=>{"use strict";n.d(t,{q4:()=>c,iC:()=>_,f6:()=>y,HU:()=>g,cc:()=>h});var i=n(37716);(0,n(55452).registerVersion)("firebase","9.0.0","app");var r=n(57771),s=n(33637),o=n(93342),a=n(59746),l=n(49673);e=n.hmd(e);const c=new i.GfV("7.0.0"),u=!!e.hot,d=(e,...t)=>{(0,i.X6Q)()&&"undefined"!=typeof console&&console[e](...t)};function h(e,t,n,i,r){const[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(t=>t[0]===e)||[];if(s)return function(e,t){try{return e.toString()===t.toString()}catch(n){return e===t}}(r,o)||(d("error",`${t} was already initialized on the ${n} Firebase App with different settings.${u?" You may need to reload as Firebase is not HMR aware.":""}`),d("warn",{is:r,was:o})),s;{const t=i();return globalThis.\u0275AngularfireInstanceCache.push([e,t,r]),t}}function p(){}globalThis.\u0275AngularfireInstanceCache||(globalThis.\u0275AngularfireInstanceCache=[]);class m{constructor(e,t=r.N){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){const i=this.zone;return this.delegate.schedule(function(t){i.runGuarded(()=>{e.apply(this,[t])})},t,n)}}class f{constructor(e){this.zone=e,this.task=null}call(e,t){const n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",p,{},p,p)),t.pipe((0,o.b)({next:n,complete:n,error:n})).subscribe(e).add(n)}unscheduleTask(){setTimeout(()=>{null!=this.task&&"scheduled"===this.task.state&&(this.task.invoke(),this.task=null)},10)}}let g=(()=>{class e{constructor(e){this.ngZone=e,this.outsideAngular=e.runOutsideAngular(()=>new m(Zone.current)),this.insideAngular=e.run(()=>new m(Zone.current,s.z)),globalThis.\u0275AngularFireScheduler||(globalThis.\u0275AngularFireScheduler=this)}}return e.\u0275fac=function(t){return new(t||e)(i.LFG(i.R0b))},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function v(){const e=globalThis.\u0275AngularFireScheduler;if(!e)throw new Error("AngularFireModule has not been provided");return e}function y(e){return e.pipe((0,a.QV)(v().insideAngular))}function _(e){return v(),(t=v(),function(e){return(e=e.lift(new f(t.ngZone))).pipe((0,l.R)(t.outsideAngular),(0,a.QV)(t.insideAngular))})(e);var t}},54486:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var i=n(64685),r=n(16034),s=n(55452),o=n(60300);class a{constructor(e,t){this._delegate=e,this.firebase=t,(0,s._addComponent)(e,new r.wA("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),(0,s.deleteApp)(this._delegate)))}_getService(e,t=s._DEFAULT_ENTRY_NAME){var n;this._delegate.checkDestroyed();const i=this._delegate.container.getProvider(e);return i.isInitialized()||"EXPLICIT"!==(null===(n=i.getComponent())||void 0===n?void 0:n.instantiationMode)||i.initialize(),i.getImmediate({identifier:t})}_removeServiceInstance(e,t=s._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){(0,s._addComponent)(this._delegate,e)}_addOrOverwriteComponent(e){(0,s._addOrOverwriteComponent)(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const l=new i.LL("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),c=function e(){const t=function(e){const t={},n={__esModule:!0,initializeApp:function(r,o={}){const a=s.initializeApp(r,o);if((0,i.r3)(t,a.name))return t[a.name];const l=new e(a,n);return t[a.name]=l,l},app:r,registerVersion:s.registerVersion,setLogLevel:s.setLogLevel,onLog:s.onLog,apps:null,SDK_VERSION:s.SDK_VERSION,INTERNAL:{registerComponent:function(t){const o=t.name,a=o.replace("-compat","");if(s._registerComponent(t)&&"PUBLIC"===t.type){const s=(e=r())=>{if("function"!=typeof e[a])throw l.create("invalid-app-argument",{appName:o});return e[a]()};void 0!==t.serviceProps&&(0,i.ZB)(s,t.serviceProps),n[a]=s,e.prototype[a]=function(...e){return this._getService.bind(this,o).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?n[a]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:s}};function r(e){if(!(0,i.r3)(t,e=e||s._DEFAULT_ENTRY_NAME))throw l.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map(e=>t[e])}}),r.App=e,n}(a);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){(0,i.ZB)(t,e)},createSubscribe:i.ne,ErrorFactory:i.LL,deepExtend:i.ZB}),t}(),u=new o.Yd("@firebase/app-compat");if((0,i.jU)()&&void 0!==self.firebase){u.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&u.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const d=c;(0,s.registerVersion)("@firebase/app-compat","0.1.0",void 0);const h=d},55452:(e,t,n)=>{"use strict";n.r(t),n.d(t,{FirebaseError:()=>o.ZR,SDK_VERSION:()=>w,_DEFAULT_ENTRY_NAME:()=>u,_addComponent:()=>m,_addOrOverwriteComponent:()=>f,_apps:()=>h,_clearComponents:()=>_,_components:()=>p,_getProvider:()=>v,_registerComponent:()=>g,_removeServiceInstance:()=>y,deleteApp:()=>I,getApp:()=>Z,getApps:()=>A,initializeApp:()=>b,onLog:()=>q,registerVersion:()=>E,setLogLevel:()=>N});var i=n(21611),r=n(16034),s=n(60300),o=n(64685);class a{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const l="@firebase/app",c=new s.Yd("@firebase/app"),u="[DEFAULT]",d={[l]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},h=new Map,p=new Map;function m(e,t){try{e.container.addComponent(t)}catch(n){c.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function f(e,t){e.container.addOrOverwriteComponent(t)}function g(e){const t=e.name;if(p.has(t))return c.debug(`There were multiple attempts to register component ${t}.`),!1;p.set(t,e);for(const n of h.values())m(n,e);return!0}function v(e,t){return e.container.getProvider(t)}function y(e,t,n=u){v(e,t).clearInstance(n)}function _(){p.clear()}const T=new o.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});class x{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.wA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw T.create("app-deleted",{appName:this._name})}}const w="9.0.0";function b(e,t={}){"object"!=typeof t&&(t={name:t});const n=Object.assign({name:u,automaticDataCollectionEnabled:!1},t),i=n.name;if("string"!=typeof i||!i)throw T.create("bad-app-name",{appName:String(i)});const s=h.get(i);if(s){if((0,o.vZ)(e,s.options)&&(0,o.vZ)(n,s.config))return s;throw T.create("duplicate-app",{appName:i})}const a=new r.H0(i);for(const r of p.values())a.addComponent(r);const l=new x(e,n,a);return h.set(i,l),l}function Z(e=u){const t=h.get(e);if(!t)throw T.create("no-app",{appName:e});return t}function A(){return Array.from(h.values())}function I(e){return S.apply(this,arguments)}function S(){return(S=(0,i.Z)(function*(e){const t=e.name;h.has(t)&&(h.delete(t),yield Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)})).apply(this,arguments)}function E(e,t,n){var i;let s=null!==(i=d[e])&&void 0!==i?i:e;n&&(s+=`-${n}`);const o=s.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=[`Unable to register library "${s}" with version "${t}":`];return o&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void c.warn(e.join(" "))}g(new r.wA(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}function q(e,t){if(null!==e&&"function"!=typeof e)throw T.create("invalid-log-argument");(0,s.Am)(e,t)}function N(e){(0,s.Ub)(e)}g(new r.wA("platform-logger",e=>new a(e),"PRIVATE")),E(l,"0.7.0",void 0),E("fire-js","")},16034:(e,t,n)=>{"use strict";n.d(t,{wA:()=>s,H0:()=>l});var i=n(64762),r=n(64685),s=function(){function e(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return e.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},e.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},e.prototype.setServiceProps=function(e){return this.serviceProps=e,this},e.prototype.setInstanceCreatedCallback=function(e){return this.onInstanceCreated=e,this},e}(),o="[DEFAULT]",a=function(){function e(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return e.prototype.get=function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new r.BH;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{var i=this.getOrInitializeService({instanceIdentifier:t});i&&n.resolve(i)}catch(s){}}return this.instancesDeferred.get(t).promise},e.prototype.getImmediate=function(e){var t,n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(r){if(i)return null;throw r}},e.prototype.getComponent=function(){return this.component},e.prototype.setComponent=function(e){var t,n;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:o})}catch(d){}try{for(var r=(0,i.XA)(this.instancesDeferred.entries()),s=r.next();!s.done;s=r.next()){var a=(0,i.CR)(s.value,2),l=a[1],c=this.normalizeInstanceIdentifier(a[0]);try{var u=this.getOrInitializeService({instanceIdentifier:c});l.resolve(u)}catch(d){}}}catch(h){t={error:h}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}},e.prototype.clearInstance=function(e){void 0===e&&(e=o),this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)},e.prototype.delete=function(){return(0,i.mG)(this,void 0,void 0,function(){var e;return(0,i.Jh)(this,function(t){switch(t.label){case 0:return e=Array.from(this.instances.values()),[4,Promise.all((0,i.ev)((0,i.ev)([],(0,i.CR)(e.filter(function(e){return"INTERNAL"in e}).map(function(e){return e.INTERNAL.delete()}))),(0,i.CR)(e.filter(function(e){return"_delete"in e}).map(function(e){return e._delete()}))))];case 1:return t.sent(),[2]}})})},e.prototype.isComponentSet=function(){return null!=this.component},e.prototype.isInitialized=function(e){return void 0===e&&(e=o),this.instances.has(e)},e.prototype.getOptions=function(e){return void 0===e&&(e=o),this.instancesOptions.get(e)||{}},e.prototype.initialize=function(e){var t,n;void 0===e&&(e={});var r=e.options,s=void 0===r?{}:r,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(this.name+"("+o+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var a=this.getOrInitializeService({instanceIdentifier:o,options:s});try{for(var l=(0,i.XA)(this.instancesDeferred.entries()),c=l.next();!c.done;c=l.next()){var u=(0,i.CR)(c.value,2),d=u[1];o===this.normalizeInstanceIdentifier(u[0])&&d.resolve(a)}}catch(h){t={error:h}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return a},e.prototype.onInit=function(e,t){var n,i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);var s=this.instances.get(i);return s&&e(s,i),function(){r.delete(e)}},e.prototype.invokeOnInitCallbacks=function(e,t){var n,r,s=this.onInitCallbacks.get(t);if(s)try{for(var o=(0,i.XA)(s),a=o.next();!a.done;a=o.next()){var l=a.value;try{l(e,t)}catch(c){}}}catch(u){n={error:u}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},e.prototype.getOrInitializeService=function(e){var t,n=e.instanceIdentifier,i=e.options,r=void 0===i?{}:i,s=this.instances.get(n);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:(t=n,t===o?void 0:t),options:r}),this.instances.set(n,s),this.instancesOptions.set(n,r),this.invokeOnInitCallbacks(s,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,s)}catch(a){}return s||null},e.prototype.normalizeInstanceIdentifier=function(e){return void 0===e&&(e=o),this.component?this.component.multipleInstances?e:o:e},e.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},e}(),l=function(){function e(e){this.name=e,this.providers=new Map}return e.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},e.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},e.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new a(e,this);return this.providers.set(e,t),t},e.prototype.getProviders=function(){return Array.from(this.providers.values())},e}()},60300:(e,t,n)=>{"use strict";function i(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,r++)i[r]=s[o];return i}var r;n.d(t,{in:()=>o,Yd:()=>d,Ub:()=>h,Am:()=>p});var s=[],o=(()=>(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(o||(o={})),o))(),a={debug:o.DEBUG,verbose:o.VERBOSE,info:o.INFO,warn:o.WARN,error:o.ERROR,silent:o.SILENT},l=o.INFO,c=((r={})[o.DEBUG]="log",r[o.VERBOSE]="log",r[o.INFO]="info",r[o.WARN]="warn",r[o.ERROR]="error",r),u=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var s=(new Date).toISOString(),o=c[t];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[o].apply(console,i(["["+s+"]  "+e.name+":"],n))}},d=function(){function e(e){this.name=e,this._logLevel=l,this._logHandler=u,this._userLogHandler=null,s.push(this)}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in o))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),e.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?a[e]:e},Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,i([this,o.DEBUG],e)),this._logHandler.apply(this,i([this,o.DEBUG],e))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,i([this,o.VERBOSE],e)),this._logHandler.apply(this,i([this,o.VERBOSE],e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,i([this,o.INFO],e)),this._logHandler.apply(this,i([this,o.INFO],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,i([this,o.WARN],e)),this._logHandler.apply(this,i([this,o.WARN],e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,i([this,o.ERROR],e)),this._logHandler.apply(this,i([this,o.ERROR],e))},e}();function h(e){s.forEach(function(t){t.setLogLevel(e)})}function p(e,t){for(var n=function(n){var i=null;t&&t.level&&(i=a[t.level]),n.userLogHandler=null===e?null:function(t,n){for(var r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];var a=r.map(function(e){if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}}).filter(function(e){return e}).join(" ");n>=(null!=i?i:t.logLevel)&&e({level:o[n].toLowerCase(),message:a,args:r,type:t.name})}},i=0,r=s;i<r.length;i++)n(r[i])}},64685:(e,t,n)=>{"use strict";n.d(t,{BH:()=>c,LL:()=>b,ZR:()=>w,tV:()=>a,r3:()=>I,Sg:()=>u,ne:()=>R,vZ:()=>E,ZB:()=>l,pd:()=>D,m9:()=>M,z$:()=>d,jU:()=>m,ru:()=>f,d:()=>v,xb:()=>S,w1:()=>y,hl:()=>x,uI:()=>h,UG:()=>p,b$:()=>g,G6:()=>T,Mn:()=>_,xO:()=>N,zd:()=>C});var i=n(64762),r=function(e){for(var t=[],n=0,i=0;i<e.length;i++){var r=e.charCodeAt(i);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[],r=0;r<e.length;r+=3){var s=e[r],o=r+1<e.length,a=o?e[r+1]:0,l=r+2<e.length,c=l?e[r+2]:0,u=(15&a)<<2|c>>6,d=63&c;l||(d=64,o||(u=64)),i.push(n[s>>2],n[(3&s)<<4|a>>4],n[u],n[d])}return i.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,i=0;n<e.length;){var r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){var s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){var o=((7&r)<<18|(63&(s=e[n++]))<<12|(63&(a=e[n++]))<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(o>>10)),t[i++]=String.fromCharCode(56320+(1023&o))}else{s=e[n++];var a=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[],r=0;r<e.length;){var s=n[e.charAt(r++)],o=r<e.length?n[e.charAt(r)]:0,a=++r<e.length?n[e.charAt(r)]:64,l=++r<e.length?n[e.charAt(r)]:64;if(++r,null==s||null==o||null==a||null==l)throw Error();i.push(s<<2|o>>4),64!==a&&(i.push(o<<4&240|a>>2),64!==l&&i.push(a<<6&192|l))}return i},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},o=function(e){return function(e){var t=r(e);return s.encodeByteArray(t,!0)}(e).replace(/\./g,"")},a=function(e){try{return s.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function l(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=l(e[n],t[n]));return e}var c=function(){function e(){var e=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(t,n){e.resolve=t,e.reject=n})}return e.prototype.wrapCallback=function(e){var t=this;return function(n,i){n?t.reject(n):t.resolve(i),"function"==typeof e&&(t.promise.catch(function(){}),1===e.length?e(n):e(n,i))}},e}();function u(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var a=(0,i.pi)({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(a)),""].join(".")}function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function h(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())}function p(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function m(){return"object"==typeof self&&self.self===self}function f(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function g(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function v(){return d().indexOf("Electron/")>=0}function y(){var e=d();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function _(){return d().indexOf("MSAppHost/")>=0}function T(){return!p()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function x(){return"indexedDB"in self&&null!=indexedDB}var w=function(e){function t(n,i,r){var s=e.call(this,i)||this;return s.code=n,s.customData=r,s.name="FirebaseError",Object.setPrototypeOf(s,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(s,b.prototype.create),s}return(0,i.ZT)(t,e),t}(Error),b=function(){function e(e,t,n){this.service=e,this.serviceName=t,this.errors=n}return e.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=t[0]||{},r=this.service+"/"+e,s=this.errors[e],o=s?Z(s,i):"Error",a=this.serviceName+": "+o+" ("+r+").",l=new w(r,a,i);return l},e}();function Z(e,t){return e.replace(A,function(e,n){var i=t[n];return null!=i?String(i):"<"+n+"?>"})}var A=/\{\$([^}]+)}/g;function I(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function S(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function E(e,t){if(e===t)return!0;for(var n=Object.keys(e),i=Object.keys(t),r=0,s=n;r<s.length;r++){if(!i.includes(u=s[r]))return!1;var o=e[u],a=t[u];if(q(o)&&q(a)){if(!E(o,a))return!1}else if(o!==a)return!1}for(var l=0,c=i;l<c.length;l++){var u;if(!n.includes(u=c[l]))return!1}return!0}function q(e){return null!==e&&"object"==typeof e}function N(e){for(var t=[],n=function(e,n){Array.isArray(n)?n.forEach(function(n){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))},i=0,r=Object.entries(e);i<r.length;i++){var s=r[i];n(s[0],s[1])}return t.length?"&"+t.join("&"):""}function C(e){var t={};return e.replace(/^\?/,"").split("&").forEach(function(e){if(e){var n=e.split("="),i=n[1];t[decodeURIComponent(n[0])]=decodeURIComponent(i)}}),t}function D(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function R(e,t){var n=new O(e,t);return n.subscribe.bind(n)}!function(){function e(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(e,t){t||(t=0);var n=this.W_;if("string"==typeof e)for(var i=0;i<16;i++)n[i]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(i=16;i<80;i++)n[i]=4294967295&((d=n[i-3]^n[i-8]^n[i-14]^n[i-16])<<1|d>>>31);var r,s,o=this.chain_[0],a=this.chain_[1],l=this.chain_[2],c=this.chain_[3],u=this.chain_[4];for(i=0;i<80;i++){i<40?i<20?(r=c^a&(l^c),s=1518500249):(r=a^l^c,s=1859775393):i<60?(r=a&l|c&(a|l),s=2400959708):(r=a^l^c,s=3395469782);var d=(o<<5|o>>>27)+r+u+s+n[i]&4294967295;u=c,c=l,l=4294967295&(a<<30|a>>>2),a=o,o=d}this.chain_[0]=this.chain_[0]+o&4294967295,this.chain_[1]=this.chain_[1]+a&4294967295,this.chain_[2]=this.chain_[2]+l&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295},e.prototype.update=function(e,t){if(null!=e){void 0===t&&(t=e.length);for(var n=t-this.blockSize,i=0,r=this.buf_,s=this.inbuf_;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++i,++s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++i,++s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}},e.prototype.digest=function(){var e=[],t=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);var i=0;for(n=0;n<5;n++)for(var r=24;r>=0;r-=8)e[i]=this.chain_[n]>>r&255,++i;return e}}();var O=function(){function e(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(function(){e(n)}).catch(function(e){n.error(e)})}return e.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})},e.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)}),this.close(e)},e.prototype.complete=function(){this.forEachObserver(function(e){e.complete()}),this.close()},e.prototype.subscribe=function(e,t,n){var i,r=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(i=function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=0,i=["next","error","complete"];n<i.length;n++){var r=i[n];if(r in e&&"function"==typeof e[r])return!0}return!1}(e)?e:{next:e,error:t,complete:n}).next&&(i.next=k),void 0===i.error&&(i.error=k),void 0===i.complete&&(i.complete=k);var s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{r.finalError?i.error(r.finalError):i.complete()}catch(e){}}),this.observers.push(i),s},e.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},e.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},e.prototype.sendOne=function(e,t){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(i){"undefined"!=typeof console&&console.error&&console.error(i)}})},e.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(function(){t.observers=void 0,t.onNoObservers=void 0}))},e}();function k(){}function M(e){return e&&e._delegate?e._delegate:e}},26300:(e,t,n)=>{"use strict";n.r(t);var i=n(21611),r=n(54486),s=n(64685),o=n(55452),a=n(64762),l=n(60300),c=n(16034);const u=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},d=new s.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),h=new l.Yd("@firebase/auth");function p(e,...t){h.logLevel<=l.in.ERROR&&h.error(`Auth (${o.SDK_VERSION}): ${e}`,...t)}function m(e,...t){throw g(e,...t)}function f(e,...t){return g(e,...t)}function g(e,...t){if("string"!=typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return d.create(e,...t)}function v(e,t,...n){if(!e)throw g(t,...n)}function y(e){const t="INTERNAL ASSERTION FAILED: "+e;throw p(t),new Error(t)}function _(e,t){e||y(t)}const T=new Map;function x(e){_(e instanceof Function,"Expected a class definition");let t=T.get(e);return t?(_(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,T.set(e,t),t)}function w(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function b(){return"http:"===Z()||"https:"===Z()}function Z(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class A{constructor(e,t){this.shortDelay=e,this.longDelay=t,_(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,s.uI)()||(0,s.b$)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(b()||(0,s.ru)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function I(e,t){_(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class S{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void y("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void y("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void y("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const E={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded"},q=new A(3e4,6e4);function N(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}function C(e,t,n,i){return D.apply(this,arguments)}function D(){return(D=(0,i.Z)(function*(e,t,n,i,r={}){return R(e,r,()=>{let r={},o={};i&&("GET"===t?o=i:r={body:JSON.stringify(i)});const a=(0,s.xO)(Object.assign({key:e.config.apiKey},o)).slice(1),l=new(S.headers());return l.set("Content-Type","application/json"),l.set("X-Client-Version",e._getSdkClientVersion()),e.languageCode&&l.set("X-Firebase-Locale",e.languageCode),S.fetch()(U(e,e.config.apiHost,n,a),Object.assign({method:t,headers:l,referrerPolicy:"no-referrer"},r))})})).apply(this,arguments)}function R(e,t,n){return O.apply(this,arguments)}function O(){return(O=(0,i.Z)(function*(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},E),t);try{const t=new P(e),r=yield Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=yield r.json();if("needConfirmation"in s)throw F(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{const t=(r.ok?s.errorMessage:s.error.message).split(" : ")[0];if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw F(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw F(e,"email-already-in-use",s);m(e,i[t]||t.toLowerCase().replace(/[_\s]+/g,"-"))}}catch(r){if(r instanceof s.ZR)throw r;m(e,"network-request-failed")}})).apply(this,arguments)}function k(e,t,n,i){return M.apply(this,arguments)}function M(){return(M=(0,i.Z)(function*(e,t,n,i,r={}){const s=yield C(e,t,n,i,r);return"mfaPendingCredential"in s&&m(e,"multi-factor-auth-required",{serverResponse:s}),s})).apply(this,arguments)}function U(e,t,n,i){const r=`${t}${n}?${i}`;return e.config.emulator?I(e.config,r):`${e.config.apiScheme}://${r}`}class P{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(f(this.auth,"timeout")),q.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function F(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const r=f(e,t,i);return r.customData._tokenResponse=n,r}function L(){return(L=(0,i.Z)(function*(e,t){return C(e,"POST","/v1/accounts:delete",t)})).apply(this,arguments)}function J(e,t){return Y.apply(this,arguments)}function Y(){return(Y=(0,i.Z)(function*(e,t){return C(e,"POST","/v1/accounts:update",t)})).apply(this,arguments)}function Q(e,t){return V.apply(this,arguments)}function V(){return(V=(0,i.Z)(function*(e,t){return C(e,"POST","/v1/accounts:lookup",t)})).apply(this,arguments)}function j(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function H(){return(H=(0,i.Z)(function*(e,t=!1){const n=(0,s.m9)(e),i=yield n.getIdToken(t),r=B(i);v(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const o="object"==typeof r.firebase?r.firebase:void 0,a=null==o?void 0:o.sign_in_provider;return{claims:r,token:i,authTime:j($(r.auth_time)),issuedAtTime:j($(r.iat)),expirationTime:j($(r.exp)),signInProvider:a||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}})).apply(this,arguments)}function $(e){return 1e3*Number(e)}function B(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return p("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,s.tV)(n);return e?JSON.parse(e):(p("Failed to decode base64 JWT payload"),null)}catch(r){return p("Caught error parsing JWT payload as JSON",r),null}}function z(e,t){return G.apply(this,arguments)}function G(){return(G=(0,i.Z)(function*(e,t,n=!1){if(n)return t;try{return yield t}catch(i){throw i instanceof s.ZR&&W(i)&&e.auth.currentUser===e&&(yield e.auth.signOut()),i}})).apply(this,arguments)}function W({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}class K{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){var t=this;if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout((0,i.Z)(function*(){yield t.iteration()}),n)}iteration(){var e=this;return(0,i.Z)(function*(){try{yield e.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===t.code&&e.schedule(!0))}e.schedule()})()}}class X{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=j(this.lastLoginAt),this.creationTime=j(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function ee(e){return te.apply(this,arguments)}function te(){return(te=(0,i.Z)(function*(e){var t;const n=e.auth,i=yield e.getIdToken(),r=yield z(e,Q(n,{idToken:i}));v(null==r?void 0:r.users.length,n,"internal-error");const s=r.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?re(s.providerUserInfo):[],a=ie(e.providerData,o),l=!!e.isAnonymous&&!(e.email&&s.passwordHash||(null==a?void 0:a.length)),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new X(s.createdAt,s.lastLoginAt),isAnonymous:l};Object.assign(e,c)})).apply(this,arguments)}function ne(){return(ne=(0,i.Z)(function*(e){const t=(0,s.m9)(e);yield ee(t),yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})).apply(this,arguments)}function ie(e,t){return[...e.filter(e=>!t.some(t=>t.providerId===e.providerId)),...t]}function re(e){return e.map(e=>{var{providerId:t}=e,n=(0,a._T)(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}function se(){return(se=(0,i.Z)(function*(e,t){const n=yield R(e,{},()=>{const n=(0,s.xO)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,o=U(e,i,"/v1/token",`key=${r}`);return S.fetch()(o,{method:"POST",headers:{"X-Client-Version":e._getSdkClientVersion(),"Content-Type":"application/x-www-form-urlencoded"},body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}})).apply(this,arguments)}class oe{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){v(e.idToken,"internal-error"),v(void 0!==e.idToken,"internal-error"),v(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=B(e);return v(t,"internal-error"),v(void 0!==t.exp,"internal-error"),v(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}getToken(e,t=!1){var n=this;return(0,i.Z)(function*(){return v(!n.accessToken||n.refreshToken,e,"user-token-expired"),t||!n.accessToken||n.isExpired?n.refreshToken?(yield n.refresh(e,n.refreshToken),n.accessToken):null:n.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(e,t){var n=this;return(0,i.Z)(function*(){const{accessToken:i,refreshToken:r,expiresIn:s}=yield function(e,t){return se.apply(this,arguments)}(e,t);n.updateTokensAndExpiration(i,r,Number(s))})()}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new oe;return n&&(v("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(v("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(v("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new oe,this.toJSON())}_performRefresh(){return y("not implemented")}}function ae(e,t){v("string"==typeof e||void 0===e,"internal-error",{appName:t})}class le{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,r=(0,a._T)(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.emailVerified=!1,this.isAnonymous=!1,this.tenantId=null,this.providerData=[],this.proactiveRefresh=new K(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.metadata=new X(r.createdAt||void 0,r.lastLoginAt||void 0)}getIdToken(e){var t=this;return(0,i.Z)(function*(){const n=yield z(t,t.stsTokenManager.getToken(t.auth,e));return v(n,t.auth,"internal-error"),t.accessToken!==n&&(t.accessToken=n,yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)),n})()}getIdTokenResult(e){return function(e){return H.apply(this,arguments)}(this,e)}reload(){return function(e){return ne.apply(this,arguments)}(this)}_assign(e){this!==e&&(v(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new le(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){v(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){var n=this;return(0,i.Z)(function*(){let i=!1;e.idToken&&e.idToken!==n.stsTokenManager.accessToken&&(n.stsTokenManager.updateFromServerResponse(e),i=!0),t&&(yield ee(n)),yield n.auth._persistUserIfCurrent(n),i&&n.auth._notifyListenersIfCurrent(n)})()}delete(){var e=this;return(0,i.Z)(function*(){const t=yield e.getIdToken();return yield z(e,function(e,t){return L.apply(this,arguments)}(e.auth,{idToken:t})),e.stsTokenManager.clearRefreshToken(),e.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,s,o,a,l,c;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,d=null!==(i=t.email)&&void 0!==i?i:void 0,h=null!==(r=t.phoneNumber)&&void 0!==r?r:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,m=null!==(o=t.tenantId)&&void 0!==o?o:void 0,f=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(l=t.createdAt)&&void 0!==l?l:void 0,y=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:_,emailVerified:T,isAnonymous:x,providerData:w,stsTokenManager:b}=t;v(_&&b,e,"internal-error");const Z=oe.fromJSON(this.name,b);v("string"==typeof _,e,"internal-error"),ae(u,e.name),ae(d,e.name),v("boolean"==typeof T,e,"internal-error"),v("boolean"==typeof x,e,"internal-error"),ae(h,e.name),ae(p,e.name),ae(m,e.name),ae(f,e.name),ae(g,e.name),ae(y,e.name);const A=new le({uid:_,auth:e,email:d,emailVerified:T,displayName:u,isAnonymous:x,photoURL:p,phoneNumber:h,tenantId:m,stsTokenManager:Z,createdAt:g,lastLoginAt:y});return w&&Array.isArray(w)&&(A.providerData=w.map(e=>Object.assign({},e))),f&&(A._redirectEventId=f),A}static _fromIdTokenResponse(e,t,n=!1){return(0,i.Z)(function*(){const i=new oe;i.updateFromServerResponse(t);const r=new le({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return yield ee(r),r})()}}const ce=(()=>{class e{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,i.Z)(function*(){return!0})()}_set(e,t){var n=this;return(0,i.Z)(function*(){n.storage[e]=t})()}_get(e){var t=this;return(0,i.Z)(function*(){const n=t.storage[e];return void 0===n?null:n})()}_remove(e){var t=this;return(0,i.Z)(function*(){delete t.storage[e]})()}_addListener(e,t){}_removeListener(e,t){}}return e.type="NONE",e})();function ue(e,t,n){return`firebase:${e}:${t}:${n}`}class de{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=ue(this.userKey,i.apiKey,r),this.fullPersistenceKey=ue("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){var e=this;return(0,i.Z)(function*(){const t=yield e.persistence._get(e.fullUserKey);return t?le._fromJSON(e.auth,t):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){var t=this;return(0,i.Z)(function*(){if(t.persistence===e)return;const n=yield t.getCurrentUser();return yield t.removeCurrentUser(),t.persistence=e,n?t.setCurrentUser(n):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,n="authUser"){return(0,i.Z)(function*(){if(!t.length)return new de(x(ce),e,n);const r=(yield Promise.all(t.map(function(){var e=(0,i.Z)(function*(e){if(yield e._isAvailable())return e});return function(t){return e.apply(this,arguments)}}()))).filter(e=>e);let s=r[0]||x(ce);const o=ue(n,e.config.apiKey,e.name);let a=null;for(const n of t)try{const t=yield n._get(o);if(t){const i=le._fromJSON(e,t);n!==s&&(a=i),s=n;break}}catch(c){}const l=r.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&l.length?(s=l[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(t.map(function(){var e=(0,i.Z)(function*(e){if(e!==s)try{yield e._remove(o)}catch(c){}});return function(t){return e.apply(this,arguments)}}())),new de(s,e,n)):new de(s,e,n)})()}}function he(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ge(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(pe(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ye(t))return"Blackberry";if(_e(t))return"Webos";if(me(t))return"Safari";if((t.includes("chrome/")||fe(t))&&!t.includes("edge/"))return"Chrome";if(ve(t))return"Android";{const t=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==t?void 0:t.length))return t[1]}return"Other"}function pe(e=(0,s.z$)()){return/firefox\//i.test(e)}function me(e=(0,s.z$)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function fe(e=(0,s.z$)()){return/crios\//i.test(e)}function ge(e=(0,s.z$)()){return/iemobile/i.test(e)}function ve(e=(0,s.z$)()){return/android/i.test(e)}function ye(e=(0,s.z$)()){return/blackberry/i.test(e)}function _e(e=(0,s.z$)()){return/webos/i.test(e)}function Te(e=(0,s.z$)()){return/iphone|ipad|ipod/i.test(e)}function xe(e=(0,s.z$)()){return Te(e)||ve(e)||_e(e)||ye(e)||/windows phone/i.test(e)||ge(e)}function we(e,t=[]){let n;switch(e){case"Browser":n=he((0,s.z$)());break;case"Worker":n=`${he((0,s.z$)())}-${e}`;break;default:n=e}const i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${o.SDK_VERSION}/${i}`}class be{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ae(this),this.idTokenSubscription=new Ae(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=d,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(e,t){var n=this;return t&&(this._popupRedirectResolver=x(t)),this._initializationPromise=this.queue((0,i.Z)(function*(){var i;n._deleted||(n.persistenceManager=yield de.create(n,e),n._deleted||((null===(i=n._popupRedirectResolver)||void 0===i?void 0:i._shouldInitProactively)&&(yield n._popupRedirectResolver._initialize(n)),yield n.initializeCurrentUser(t),n._deleted||(n._isInitialized=!0)))})),this._initializationPromise}_onStorageEvent(){var e=this;return(0,i.Z)(function*(){if(e._deleted)return;const t=yield e.assertedPersistence.getCurrentUser();return e.currentUser||t?e.currentUser&&t&&e.currentUser.uid===t.uid?(e._currentUser._assign(t),void(yield e.currentUser.getIdToken())):void(yield e._updateCurrentUser(t)):void 0})()}initializeCurrentUser(e){var t=this;return(0,i.Z)(function*(){var n;let i=yield t.assertedPersistence.getCurrentUser();if(e&&t.config.authDomain){yield t.getOrInitRedirectPersistenceManager();const r=null===(n=t.redirectUser)||void 0===n?void 0:n._redirectEventId,s=null==i?void 0:i._redirectEventId,o=yield t.tryRedirectSignIn(e);r&&r!==s||!(null==o?void 0:o.user)||(i=o.user)}return i?i._redirectEventId?(v(t._popupRedirectResolver,t,"argument-error"),yield t.getOrInitRedirectPersistenceManager(),t.redirectUser&&t.redirectUser._redirectEventId===i._redirectEventId?t.directlySetCurrentUser(i):t.reloadAndSetCurrentUserOrClear(i)):t.reloadAndSetCurrentUserOrClear(i):t.directlySetCurrentUser(null)})()}tryRedirectSignIn(e){var t=this;return(0,i.Z)(function*(){let n=null;try{n=yield t._popupRedirectResolver._completeRedirectFn(t,e,!0)}catch(i){yield t._setRedirectUser(null)}return n})()}reloadAndSetCurrentUserOrClear(e){var t=this;return(0,i.Z)(function*(){try{yield ee(e)}catch(n){if("auth/network-request-failed"!==n.code)return t.directlySetCurrentUser(null)}return t.directlySetCurrentUser(e)})()}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}_delete(){var e=this;return(0,i.Z)(function*(){e._deleted=!0})()}updateCurrentUser(e){var t=this;return(0,i.Z)(function*(){const n=e?(0,s.m9)(e):null;return n&&v(n.auth.config.apiKey===t.config.apiKey,t,"invalid-user-token"),t._updateCurrentUser(n&&n._clone(t))})()}_updateCurrentUser(e){var t=this;return(0,i.Z)(function*(){if(!t._deleted)return e&&v(t.tenantId===e.tenantId,t,"tenant-id-mismatch"),t.queue((0,i.Z)(function*(){yield t.directlySetCurrentUser(e),t.notifyAuthListeners()}))})()}signOut(){var e=this;return(0,i.Z)(function*(){return(e.redirectPersistenceManager||e._popupRedirectResolver)&&(yield e._setRedirectUser(null)),e._updateCurrentUser(null)})()}setPersistence(e){var t=this;return this.queue((0,i.Z)(function*(){yield t.assertedPersistence.setPersistence(x(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new s.LL("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}_setRedirectUser(e,t){var n=this;return(0,i.Z)(function*(){const i=yield n.getOrInitRedirectPersistenceManager(t);return null===e?i.removeCurrentUser():i.setCurrentUser(e)})()}getOrInitRedirectPersistenceManager(e){var t=this;return(0,i.Z)(function*(){if(!t.redirectPersistenceManager){const n=e&&x(e)||t._popupRedirectResolver;v(n,t,"argument-error"),t.redirectPersistenceManager=yield de.create(t,[x(n._redirectPersistence)],"redirectUser"),t.redirectUser=yield t.redirectPersistenceManager.getCurrentUser()}return t.redirectPersistenceManager})()}_redirectUserForId(e){var t=this;return(0,i.Z)(function*(){var n,r;return t._isInitialized&&(yield t.queue((0,i.Z)(function*(){}))),(null===(n=t._currentUser)||void 0===n?void 0:n._redirectEventId)===e?t._currentUser:(null===(r=t.redirectUser)||void 0===r?void 0:r._redirectEventId)===e?t.redirectUser:null})()}_persistUserIfCurrent(e){var t=this;return(0,i.Z)(function*(){if(e===t.currentUser)return t.queue((0,i.Z)(function*(){return t.directlySetCurrentUser(e)}))})()}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const r="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return v(s,this,"internal-error"),s.then(()=>r(this.currentUser)),"function"==typeof t?e.addObserver(t,n,i):e.addObserver(t)}directlySetCurrentUser(e){var t=this;return(0,i.Z)(function*(){t.currentUser&&t.currentUser!==e&&(t._currentUser._stopProactiveRefresh(),e&&t.isProactiveRefreshEnabled&&e._startProactiveRefresh()),t.currentUser=e,e?yield t.assertedPersistence.setCurrentUser(e):yield t.assertedPersistence.removeCurrentUser()})()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return v(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=we(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getSdkClientVersion(){return this.clientVersion}}function Ze(e){return(0,s.m9)(e)}class Ae{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,s.ne)(e=>this.observer=e)}get next(){return v(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Ie(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Se(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Ee{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return y("not implemented")}_getIdTokenResponse(e){return y("not implemented")}_linkToIdToken(e,t){return y("not implemented")}_getReauthenticationResolver(e){return y("not implemented")}}function qe(e,t){return Ne.apply(this,arguments)}function Ne(){return(Ne=(0,i.Z)(function*(e,t){return C(e,"POST","/v1/accounts:resetPassword",N(e,t))})).apply(this,arguments)}function Ce(e,t){return De.apply(this,arguments)}function De(){return(De=(0,i.Z)(function*(e,t){return C(e,"POST","/v1/accounts:update",t)})).apply(this,arguments)}function Re(e,t){return Oe.apply(this,arguments)}function Oe(){return(Oe=(0,i.Z)(function*(e,t){return C(e,"POST","/v1/accounts:update",N(e,t))})).apply(this,arguments)}function ke(){return(ke=(0,i.Z)(function*(e,t){return k(e,"POST","/v1/accounts:signInWithPassword",N(e,t))})).apply(this,arguments)}function Me(e,t){return Ue.apply(this,arguments)}function Ue(){return(Ue=(0,i.Z)(function*(e,t){return C(e,"POST","/v1/accounts:sendOobCode",N(e,t))})).apply(this,arguments)}function Pe(e,t){return Fe.apply(this,arguments)}function Fe(){return(Fe=(0,i.Z)(function*(e,t){return Me(e,t)})).apply(this,arguments)}function Le(e,t){return Je.apply(this,arguments)}function Je(){return(Je=(0,i.Z)(function*(e,t){return Me(e,t)})).apply(this,arguments)}function Ye(e,t){return Qe.apply(this,arguments)}function Qe(){return(Qe=(0,i.Z)(function*(e,t){return Me(e,t)})).apply(this,arguments)}function Ve(e,t){return je.apply(this,arguments)}function je(){return(je=(0,i.Z)(function*(e,t){return Me(e,t)})).apply(this,arguments)}function He(){return(He=(0,i.Z)(function*(e,t){return k(e,"POST","/v1/accounts:signInWithEmailLink",N(e,t))})).apply(this,arguments)}function $e(){return($e=(0,i.Z)(function*(e,t){return k(e,"POST","/v1/accounts:signInWithEmailLink",N(e,t))})).apply(this,arguments)}class Be extends Ee{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new Be(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Be(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){var t=this;return(0,i.Z)(function*(){switch(t.signInMethod){case"password":return function(e,t){return ke.apply(this,arguments)}(e,{returnSecureToken:!0,email:t._email,password:t._password});case"emailLink":return function(e,t){return He.apply(this,arguments)}(e,{email:t._email,oobCode:t._password});default:m(e,"internal-error")}})()}_linkToIdToken(e,t){var n=this;return(0,i.Z)(function*(){switch(n.signInMethod){case"password":return Ce(e,{idToken:t,returnSecureToken:!0,email:n._email,password:n._password});case"emailLink":return function(e,t){return $e.apply(this,arguments)}(e,{idToken:t,email:n._email,oobCode:n._password});default:m(e,"internal-error")}})()}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}function ze(e,t){return Ge.apply(this,arguments)}function Ge(){return(Ge=(0,i.Z)(function*(e,t){return k(e,"POST","/v1/accounts:signInWithIdp",N(e,t))})).apply(this,arguments)}class We extends Ee{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new We(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):m("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,r=(0,a._T)(t,["providerId","signInMethod"]);if(!n||!i)return null;const s=new We(n,i);return Object.assign(s,r),s}_getIdTokenResponse(e){return ze(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,ze(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ze(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,s.xO)(t)}return e}}function Ke(e,t){return Xe.apply(this,arguments)}function Xe(){return(Xe=(0,i.Z)(function*(e,t){return C(e,"POST","/v1/accounts:sendVerificationCode",N(e,t))})).apply(this,arguments)}function et(){return(et=(0,i.Z)(function*(e,t){return k(e,"POST","/v1/accounts:signInWithPhoneNumber",N(e,t))})).apply(this,arguments)}function tt(){return(tt=(0,i.Z)(function*(e,t){const n=yield k(e,"POST","/v1/accounts:signInWithPhoneNumber",N(e,t));if(n.temporaryProof)throw F(e,"account-exists-with-different-credential",n);return n})).apply(this,arguments)}const nt={USER_NOT_FOUND:"user-not-found"};function it(){return(it=(0,i.Z)(function*(e,t){return k(e,"POST","/v1/accounts:signInWithPhoneNumber",N(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),nt)})).apply(this,arguments)}class rt extends Ee{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new rt({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new rt({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return function(e,t){return et.apply(this,arguments)}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return function(e,t){return tt.apply(this,arguments)}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return function(e,t){return it.apply(this,arguments)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new rt({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class st{constructor(e){var t,n,i,r,o,a;const l=(0,s.zd)((0,s.pd)(e)),c=null!==(t=l.apiKey)&&void 0!==t?t:null,u=null!==(n=l.oobCode)&&void 0!==n?n:null,d=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=l.mode)&&void 0!==i?i:null);v(c&&u&&d,"argument-error"),this.apiKey=c,this.operation=d,this.code=u,this.continueUrl=null!==(r=l.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(o=l.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=l.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=(0,s.zd)((0,s.pd)(e)).link,n=t?(0,s.zd)((0,s.pd)(t)).deep_link_id:null,i=(0,s.zd)((0,s.pd)(e)).deep_link_id;return(i?(0,s.zd)((0,s.pd)(i)).link:null)||i||n||t||e}(e);try{return new st(t)}catch(n){return null}}}let ot=(()=>{class e{constructor(){this.providerId=e.PROVIDER_ID}static credential(e,t){return Be._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=st.parseLink(t);return v(n,"argument-error"),Be._fromEmailAndCode(e,n.code,n.tenantId)}}return e.PROVIDER_ID="password",e.EMAIL_PASSWORD_SIGN_IN_METHOD="password",e.EMAIL_LINK_SIGN_IN_METHOD="emailLink",e})();class at{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class lt extends at{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ct extends lt{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return v("providerId"in t&&"signInMethod"in t,"argument-error"),We._fromParams(t)}credential(e){return this._credential(e)}_credential(e){return v(e.idToken||e.accessToken,"argument-error"),We._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return ct.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return ct.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:i,pendingToken:r,nonce:s,providerId:o}=e;if(!(n||i||t||r))return null;if(!o)return null;try{return new ct(o)._credential({idToken:t,accessToken:n,rawNonce:s,pendingToken:r})}catch(a){return null}}}let ut=(()=>{class e extends lt{constructor(){super("facebook.com")}static credential(t){return We._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return e.credential(t.oauthAccessToken)}catch(n){return null}}}return e.FACEBOOK_SIGN_IN_METHOD="facebook.com",e.PROVIDER_ID="facebook.com",e})(),dt=(()=>{class e extends lt{constructor(){super("google.com"),this.addScope("profile")}static credential(t,n){return We._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:n})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:n,oauthAccessToken:i}=t;if(!n&&!i)return null;try{return e.credential(n,i)}catch(r){return null}}}return e.GOOGLE_SIGN_IN_METHOD="google.com",e.PROVIDER_ID="google.com",e})(),ht=(()=>{class e extends lt{constructor(){super("github.com")}static credential(t){return We._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return e.credential(t.oauthAccessToken)}catch(n){return null}}}return e.GITHUB_SIGN_IN_METHOD="github.com",e.PROVIDER_ID="github.com",e})();class pt extends Ee{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return ze(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,ze(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ze(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i,pendingToken:r}=t;return n&&i&&r&&n===i?new pt(n,r):null}static _create(e,t){return new pt(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}let mt=(()=>{class e extends lt{constructor(){super("twitter.com")}static credential(t,n){return We._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:n})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:i}=t;if(!n||!i)return null;try{return e.credential(n,i)}catch(r){return null}}}return e.TWITTER_SIGN_IN_METHOD="twitter.com",e.PROVIDER_ID="twitter.com",e})();function ft(e,t){return gt.apply(this,arguments)}function gt(){return(gt=(0,i.Z)(function*(e,t){return k(e,"POST","/v1/accounts:signUp",N(e,t))})).apply(this,arguments)}class vt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,n,r=!1){return(0,i.Z)(function*(){const i=yield le._fromIdTokenResponse(e,n,r),s=yt(n);return new vt({user:i,providerId:s,_tokenResponse:n,operationType:t})})()}static _forOperation(e,t,n){return(0,i.Z)(function*(){yield e._updateTokensIfNecessary(n,!0);const i=yt(n);return new vt({user:e,providerId:i,_tokenResponse:n,operationType:t})})()}}function yt(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}function _t(){return(_t=(0,i.Z)(function*(e){var t;const n=Ze(e);if(yield n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new vt({user:n.currentUser,providerId:null,operationType:"signIn"});const i=yield ft(n,{returnSecureToken:!0}),r=yield vt._fromIdTokenResponse(n,"signIn",i,!0);return yield n._updateCurrentUser(r.user),r})).apply(this,arguments)}class Tt extends s.ZR{constructor(e,t,n,i){var r;super(t.code,t.message),this.operationType=n,this.user=i,this.name="FirebaseError",Object.setPrototypeOf(this,Tt.prototype),this.appName=e.name,this.code=t.code,this.tenantId=null!==(r=e.tenantId)&&void 0!==r?r:void 0,this.serverResponse=t.customData.serverResponse}static _fromErrorAndOperation(e,t,n,i){return new Tt(e,t,n,i)}}function xt(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw Tt._fromErrorAndOperation(e,n,t,i);throw n})}function wt(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}function bt(){return(bt=(0,i.Z)(function*(e,t){const n=(0,s.m9)(e);yield It(!0,n,t);const{providerUserInfo:i}=yield J(n.auth,{idToken:yield n.getIdToken(),deleteProvider:[t]}),r=wt(i||[]);return n.providerData=n.providerData.filter(e=>r.has(e.providerId)),r.has("phone")||(n.phoneNumber=null),yield n.auth._persistUserIfCurrent(n),n})).apply(this,arguments)}function Zt(e,t){return At.apply(this,arguments)}function At(){return(At=(0,i.Z)(function*(e,t,n=!1){const i=yield z(e,t._linkToIdToken(e.auth,yield e.getIdToken()),n);return vt._forOperation(e,"link",i)})).apply(this,arguments)}function It(e,t,n){return St.apply(this,arguments)}function St(){return(St=(0,i.Z)(function*(e,t,n){yield ee(t);const i=!1===e?"provider-already-linked":"no-such-provider";v(wt(t.providerData).has(n)===e,t.auth,i)})).apply(this,arguments)}function Et(e,t){return qt.apply(this,arguments)}function qt(){return(qt=(0,i.Z)(function*(e,t,n=!1){const{auth:i}=e,r="reauthenticate";try{const s=yield z(e,xt(i,r,t,e),n);v(s.idToken,i,"internal-error");const o=B(s.idToken);v(o,i,"internal-error");const{sub:a}=o;return v(e.uid===a,i,"user-mismatch"),vt._forOperation(e,r,s)}catch(s){throw"auth/user-not-found"===(null==s?void 0:s.code)&&m(i,"user-mismatch"),s}})).apply(this,arguments)}function Nt(e,t){return Ct.apply(this,arguments)}function Ct(){return(Ct=(0,i.Z)(function*(e,t,n=!1){const i="signIn",r=yield xt(e,i,t),s=yield vt._fromIdTokenResponse(e,i,r);return n||(yield e._updateCurrentUser(s.user)),s})).apply(this,arguments)}function Dt(e,t){return Rt.apply(this,arguments)}function Rt(){return(Rt=(0,i.Z)(function*(e,t){return Nt(Ze(e),t)})).apply(this,arguments)}function Ot(e,t){return kt.apply(this,arguments)}function kt(){return(kt=(0,i.Z)(function*(e,t){const n=(0,s.m9)(e);return yield It(!1,n,t.providerId),Zt(n,t)})).apply(this,arguments)}function Mt(e,t){return Ut.apply(this,arguments)}function Ut(){return(Ut=(0,i.Z)(function*(e,t){return Et((0,s.m9)(e),t)})).apply(this,arguments)}function Pt(e,t){return Ft.apply(this,arguments)}function Ft(){return(Ft=(0,i.Z)(function*(e,t){return k(e,"POST","/v1/accounts:signInWithCustomToken",N(e,t))})).apply(this,arguments)}function Lt(){return(Lt=(0,i.Z)(function*(e,t){const n=Ze(e),i=yield Pt(n,{token:t,returnSecureToken:!0}),r=yield vt._fromIdTokenResponse(n,"signIn",i);return yield n._updateCurrentUser(r.user),r})).apply(this,arguments)}class Jt{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Yt._fromServerResponse(e,t):m(e,"internal-error")}}class Yt extends Jt{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Yt(t)}}function Qt(e,t,n){var i;v((null===(i=n.url)||void 0===i?void 0:i.length)>0,e,"invalid-continue-uri"),v(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(v(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iosBundleId=n.iOS.bundleId),n.android&&(v(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}function Vt(){return(Vt=(0,i.Z)(function*(e,t,n){const i=(0,s.m9)(e),r={requestType:"PASSWORD_RESET",email:t};n&&Qt(i,r,n),yield Le(i,r)})).apply(this,arguments)}function jt(){return(jt=(0,i.Z)(function*(e,t,n){yield qe((0,s.m9)(e),{oobCode:t,newPassword:n})})).apply(this,arguments)}function Ht(){return(Ht=(0,i.Z)(function*(e,t){yield Re((0,s.m9)(e),{oobCode:t})})).apply(this,arguments)}function $t(e,t){return Bt.apply(this,arguments)}function Bt(){return(Bt=(0,i.Z)(function*(e,t){const n=(0,s.m9)(e),i=yield qe(n,{oobCode:t}),r=i.requestType;switch(v(r,n,"internal-error"),r){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":v(i.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":v(i.mfaInfo,n,"internal-error");default:v(i.email,n,"internal-error")}let o=null;return i.mfaInfo&&(o=Jt._fromServerResponse(Ze(n),i.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===i.requestType?i.newEmail:i.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===i.requestType?i.email:i.newEmail)||null,multiFactorInfo:o},operation:r}})).apply(this,arguments)}function zt(){return(zt=(0,i.Z)(function*(e,t){const{data:n}=yield $t((0,s.m9)(e),t);return n.email})).apply(this,arguments)}function Gt(){return(Gt=(0,i.Z)(function*(e,t,n){const i=Ze(e),r=yield ft(i,{returnSecureToken:!0,email:t,password:n}),s=yield vt._fromIdTokenResponse(i,"signIn",r);return yield i._updateCurrentUser(s.user),s})).apply(this,arguments)}function Wt(){return(Wt=(0,i.Z)(function*(e,t,n){const i=(0,s.m9)(e),r={requestType:"EMAIL_SIGNIN",email:t};v(n.handleCodeInApp,i,"argument-error"),n&&Qt(i,r,n),yield Ye(i,r)})).apply(this,arguments)}function Kt(){return(Kt=(0,i.Z)(function*(e,t,n){const i=(0,s.m9)(e),r=ot.credentialWithLink(t,n||w());return v(r._tenantId===(i.tenantId||null),i,"tenant-id-mismatch"),Dt(i,r)})).apply(this,arguments)}function Xt(e,t){return en.apply(this,arguments)}function en(){return(en=(0,i.Z)(function*(e,t){return C(e,"POST","/v1/accounts:createAuthUri",N(e,t))})).apply(this,arguments)}function tn(){return(tn=(0,i.Z)(function*(e,t){const n={identifier:t,continueUri:b()?w():"http://localhost"},{signinMethods:i}=yield Xt((0,s.m9)(e),n);return i||[]})).apply(this,arguments)}function nn(){return(nn=(0,i.Z)(function*(e,t){const n=(0,s.m9)(e),i={requestType:"VERIFY_EMAIL",idToken:yield e.getIdToken()};t&&Qt(n.auth,i,t);const{email:r}=yield Pe(n.auth,i);r!==e.email&&(yield e.reload())})).apply(this,arguments)}function rn(){return(rn=(0,i.Z)(function*(e,t,n){const i=(0,s.m9)(e),r={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield e.getIdToken(),newEmail:t};n&&Qt(i.auth,r,n);const{email:o}=yield Ve(i.auth,r);o!==e.email&&(yield e.reload())})).apply(this,arguments)}function sn(e,t){return on.apply(this,arguments)}function on(){return(on=(0,i.Z)(function*(e,t){return C(e,"POST","/v1/accounts:update",t)})).apply(this,arguments)}function an(){return(an=(0,i.Z)(function*(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const i=(0,s.m9)(e),r={idToken:yield i.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},o=yield z(i,sn(i.auth,r));i.displayName=o.displayName||null,i.photoURL=o.photoUrl||null;const a=i.providerData.find(({providerId:e})=>"password"===e);a&&(a.displayName=i.displayName,a.photoURL=i.photoURL),yield i._updateTokensIfNecessary(o)})).apply(this,arguments)}function ln(e,t,n){return cn.apply(this,arguments)}function cn(){return(cn=(0,i.Z)(function*(e,t,n){const{auth:i}=e,r={idToken:yield e.getIdToken(),returnSecureToken:!0};t&&(r.email=t),n&&(r.password=n);const s=yield z(e,Ce(i,r));yield e._updateTokensIfNecessary(s,!0)})).apply(this,arguments)}class un{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class dn extends un{constructor(e,t,n,i){super(e,t,n),this.username=i}}class hn extends un{constructor(e,t){super(e,"facebook.com",t)}}class pn extends dn{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class mn extends un{constructor(e,t){super(e,"google.com",t)}}class fn extends dn{constructor(e,t,n){super(e,"twitter.com",t,n)}}function gn(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:i}=e,r=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!i&&(null==e?void 0:e.idToken)){const i=null===(n=null===(t=B(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(i)return new un(s,"anonymous"!==i&&"custom"!==i?i:null)}if(!i)return null;switch(i){case"facebook.com":return new hn(s,r);case"github.com":return new pn(s,r);case"google.com":return new mn(s,r);case"twitter.com":return new fn(s,r,e.screenName||null);case"custom":case"anonymous":return new un(s,null);default:return new un(s,i,r)}}(n)}class vn{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new vn("enroll",e)}static _fromMfaPendingCredential(e){return new vn("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return vn._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return vn._fromIdtoken(e.multiFactorSession.idToken)}return null}}class yn{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=Ze(e),r=(t.serverResponse.mfaInfo||[]).map(e=>Jt._fromServerResponse(n,e));v(t.serverResponse.mfaPendingCredential,n,"internal-error");const s=vn._fromMfaPendingCredential(t.serverResponse.mfaPendingCredential);return new yn(s,r,function(){var e=(0,i.Z)(function*(e){const i=yield e._process(n,s);delete t.serverResponse.mfaInfo,delete t.serverResponse.mfaPendingCredential;const r=Object.assign(Object.assign({},t.serverResponse),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":const e=yield vt._fromIdTokenResponse(n,t.operationType,r);return yield n._updateCurrentUser(e.user),e;case"reauthenticate":return v(t.user,n,"internal-error"),vt._forOperation(t.user,t.operationType,r);default:m(n,"internal-error")}});return function(t){return e.apply(this,arguments)}}())}resolveSignIn(e){var t=this;return(0,i.Z)(function*(){return t.signInResolver(e)})()}}function _n(e,t){return C(e,"POST","/v2/accounts/mfaEnrollment:start",Object.assign({tenantId:e.tenantId},t))}class Tn{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>Jt._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new Tn(e)}getSession(){var e=this;return(0,i.Z)(function*(){return vn._fromIdtoken(yield e.user.getIdToken())})()}enroll(e,t){var n=this;return(0,i.Z)(function*(){const i=e,r=yield n.getSession(),s=yield z(n.user,i._process(n.user.auth,r,t));return yield n.user._updateTokensIfNecessary(s),n.user.reload()})()}unenroll(e){var t=this;return(0,i.Z)(function*(){const n="string"==typeof e?e:e.uid,i=yield t.user.getIdToken(),r=yield z(t.user,(s=t.user.auth,o={idToken:i,mfaEnrollmentId:n},C(s,"POST","/v2/accounts/mfaEnrollment:withdraw",Object.assign({tenantId:s.tenantId},o))));var s,o;t.enrolledFactors=t.enrolledFactors.filter(({uid:e})=>e!==n),yield t.user._updateTokensIfNecessary(r);try{yield t.user.reload()}catch(a){if("auth/user-token-expired"!==a.code)throw a}})()}}const xn=new WeakMap,wn="__sak";class bn{constructor(e,t){this.storage=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(wn,"1"),this.storage.removeItem(wn),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}}const Zn=(()=>{class e extends bn{constructor(){super(window.localStorage,"LOCAL"),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=(0,s.z$)();return me(e)||Te(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=xe(),this._shouldAllowMigration=!0,this.boundEventHandler=this.onStorageEvent.bind(this)}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);(0,s.w1)()&&10===document.documentMode&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(e,t){var n=()=>super._set,r=this;return(0,i.Z)(function*(){yield n().call(r,e,t),r.localCache[e]=JSON.stringify(t)})()}_get(e){var t=()=>super._get,n=this;return(0,i.Z)(function*(){const i=yield t().call(n,e);return n.localCache[e]=JSON.stringify(i),i})()}_remove(e){var t=()=>super._remove,n=this;return(0,i.Z)(function*(){yield t().call(n,e),delete n.localCache[e]})()}}return e.type="LOCAL",e})(),An=(()=>{class e extends bn{constructor(){super(window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}return e.type="SESSION",e})();let In=(()=>{class e{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const n=this.receivers.find(e=>e.isListeningto(t));if(n)return n;const i=new e(t);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}handleEvent(e){var t=this;return(0,i.Z)(function*(){const n=e,{eventId:r,eventType:s,data:o}=n.data,a=t.handlersMap[s];if(!(null==a?void 0:a.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(function(){var e=(0,i.Z)(function*(e){return e(n.origin,o)});return function(t){return e.apply(this,arguments)}}()),c=yield function(e){return Promise.all(e.map(function(){var e=(0,i.Z)(function*(e){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}});return function(t){return e.apply(this,arguments)}}()))}(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})})()}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return e.receivers=[],e})();function Sn(e="",t=10){let n="";for(let i=0;i<t;i++)n+=Math.floor(10*Math.random());return e+n}class En{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,n=50){var r=this;return(0,i.Z)(function*(){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,l)=>{const c=Sn("",20);i.port1.start();const u=setTimeout(()=>{l(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(t.data.response);break;default:clearTimeout(u),clearTimeout(s),l(new Error("invalid_response"))}}},r.handlers.add(o),i.port1.addEventListener("message",o.onMessage),r.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])}).finally(()=>{o&&r.removeMessageHandler(o)})})()}}function qn(){return window}function Nn(){return void 0!==qn().WorkerGlobalScope&&"function"==typeof qn().importScripts}function Cn(){return(Cn=(0,i.Z)(function*(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(e){return null}})).apply(this,arguments)}const Dn="firebaseLocalStorageDb",Rn="firebaseLocalStorage",On="fbase_key";class kn{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Mn(e,t){return e.transaction([Rn],t?"readwrite":"readonly").objectStore(Rn)}function Un(){const e=indexedDB.open(Dn,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(Rn,{keyPath:On})}catch(i){n(i)}}),e.addEventListener("success",(0,i.Z)(function*(){const n=e.result;n.objectStoreNames.contains(Rn)?t(n):(n.close(),yield function(){const e=indexedDB.deleteDatabase(Dn);return new kn(e).toPromise()}(),t(yield Un()))}))})}function Pn(e,t,n){return Fn.apply(this,arguments)}function Fn(){return(Fn=(0,i.Z)(function*(e,t,n){const i=Mn(e,!0).put({[On]:t,value:n});return new kn(i).toPromise()})).apply(this,arguments)}function Ln(){return(Ln=(0,i.Z)(function*(e,t){const n=Mn(e,!1).get(t),i=yield new kn(n).toPromise();return void 0===i?null:i.value})).apply(this,arguments)}function Jn(e,t){const n=Mn(e,!0).delete(t);return new kn(n).toPromise()}const Yn=(()=>{class e{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var e=this;return(0,i.Z)(function*(){return e.db||(e.db=yield Un()),e.db})()}_withRetries(e){var t=this;return(0,i.Z)(function*(){let n=0;for(;;)try{const n=yield t._openDb();return yield e(n)}catch(i){if(n++>3)throw i;t.db&&(t.db.close(),t.db=void 0)}})()}initializeServiceWorkerMessaging(){var e=this;return(0,i.Z)(function*(){return Nn()?e.initializeReceiver():e.initializeSender()})()}initializeReceiver(){var e=this;return(0,i.Z)(function*(){e.receiver=In._getInstance(Nn()?self:null),e.receiver._subscribe("keyChanged",function(){var t=(0,i.Z)(function*(t,n){return{keyProcessed:(yield e._poll()).includes(n.key)}});return function(e,n){return t.apply(this,arguments)}}()),e.receiver._subscribe("ping",function(){var e=(0,i.Z)(function*(e,t){return["keyChanged"]});return function(t,n){return e.apply(this,arguments)}}())})()}initializeSender(){var e=this;return(0,i.Z)(function*(){var t,n;if(e.activeServiceWorker=yield function(){return Cn.apply(this,arguments)}(),!e.activeServiceWorker)return;e.sender=new En(e.activeServiceWorker);const i=yield e.sender._send("ping",{},800);i&&(null===(t=i[0])||void 0===t?void 0:t.fulfilled)&&(null===(n=i[0])||void 0===n?void 0:n.value.includes("keyChanged"))&&(e.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(e){var t=this;return(0,i.Z)(function*(){var n;if(t.sender&&t.activeServiceWorker&&((null===(n=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===n?void 0:n.controller)||null)===t.activeServiceWorker)try{yield t.sender._send("keyChanged",{key:e},t.serviceWorkerReceiverAvailable?800:50)}catch(n){}})()}_isAvailable(){return(0,i.Z)(function*(){try{if(!indexedDB)return!1;const e=yield Un();return yield Pn(e,wn,"1"),yield Jn(e,wn),!0}catch(e){}return!1})()}_withPendingWrite(e){var t=this;return(0,i.Z)(function*(){t.pendingWrites++;try{yield e()}finally{t.pendingWrites--}})()}_set(e,t){var n=this;return(0,i.Z)(function*(){return n._withPendingWrite((0,i.Z)(function*(){return yield n._withRetries(n=>Pn(n,e,t)),n.localCache[e]=t,n.notifyServiceWorker(e)}))})()}_get(e){var t=this;return(0,i.Z)(function*(){const n=yield t._withRetries(t=>function(e,t){return Ln.apply(this,arguments)}(t,e));return t.localCache[e]=n,n})()}_remove(e){var t=this;return(0,i.Z)(function*(){return t._withPendingWrite((0,i.Z)(function*(){return yield t._withRetries(t=>Jn(t,e)),delete t.localCache[e],t.notifyServiceWorker(e)}))})()}_poll(){var e=this;return(0,i.Z)(function*(){const t=yield e._withRetries(e=>{const t=Mn(e,!1).getAll();return new kn(t).toPromise()});if(!t)return[];if(0!==e.pendingWrites)return[];const n=[],i=new Set;for(const{fbase_key:r,value:s}of t)i.add(r),JSON.stringify(e.localCache[r])!==JSON.stringify(s)&&(e.notifyListeners(r,s),n.push(r));for(const r of Object.keys(e.localCache))e.localCache[r]&&!i.has(r)&&(e.notifyListeners(r,null),n.push(r));return n})()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t)}startPolling(){var e=this;this.stopPolling(),this.pollTimer=setInterval((0,i.Z)(function*(){return e._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return e.type="LOCAL",e})();function Qn(e,t){return C(e,"POST","/v2/accounts/mfaSignIn:start",Object.assign({tenantId:e.tenantId},t))}function Vn(){return(Vn=(0,i.Z)(function*(e){return(yield C(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function jn(e){return new Promise((t,n)=>{const i=document.createElement("script");var r,s;i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=f("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(null!==(s=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==s?s:document).appendChild(i)})}function Hn(e){return`__${e}${Math.floor(1e6*Math.random())}`}const $n=1e12;class Bn{constructor(e){this.auth=e,this.counter=$n,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new zn(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||$n;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;return(null===(t=this._widgets.get(e||$n))||void 0===t?void 0:t.getResponse())||""}execute(e){var t=this;return(0,i.Z)(function*(){var n;return null===(n=t._widgets.get(e||$n))||void 0===n||n.execute(),""})()}}class zn{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const i="string"==typeof e?document.getElementById(e):e;v(i,"argument-error",{appName:t}),this.container=i,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let i=0;i<50;i++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}();const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(n){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(n){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Gn=Hn("rcb"),Wn=new A(3e4,6e4);class Kn{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!qn().grecaptcha}load(e,t=""){return v(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(qn().grecaptcha):new Promise((n,i)=>{const r=qn().setTimeout(()=>{i(f(e,"network-request-failed"))},Wn.get());qn()[Gn]=()=>{qn().clearTimeout(r),delete qn()[Gn];const s=qn().grecaptcha;if(!s)return void i(f(e,"internal-error"));const o=s.render;s.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(s)},jn(`https://www.google.com/recaptcha/api.js??${(0,s.xO)({onload:Gn,render:"explicit",hl:t})}`).catch(()=>{clearTimeout(r),i(f(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!qn().grecaptcha&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Xn{load(e){return(0,i.Z)(function*(){return new Bn(e)})()}clearedOneInstance(){}}const ei="recaptcha",ti={theme:"light",type:"image"};class ni{constructor(e,t=Object.assign({},ti),n){this.parameters=t,this.type=ei,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Ze(n),this.isInvisible="invisible"===this.parameters.size,v("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const i="string"==typeof e?document.getElementById(e):e;v(i,this.auth,"argument-error"),this.container=i,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Xn:new Kn,this.validateStartingState()}verify(){var e=this;return(0,i.Z)(function*(){e.assertNotDestroyed();const t=yield e.render(),n=e.getAssertedRecaptcha();return n.getResponse(t)||new Promise(i=>{const r=t=>{t&&(e.tokenChangeListeners.delete(r),i(t))};e.tokenChangeListeners.add(r),e.isInvisible&&n.execute(t)})})()}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){v(!this.parameters.sitekey,this.auth,"argument-error"),v(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),v("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof e)e(t);else if("string"==typeof e){const n=qn()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){v(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var e=this;return(0,i.Z)(function*(){if(yield e.init(),!e.widgetId){let t=e.container;if(!e.isInvisible){const e=document.createElement("div");t.appendChild(e),t=e}e.widgetId=e.getAssertedRecaptcha().render(t,e.parameters)}return e.widgetId})()}init(){var e=this;return(0,i.Z)(function*(){v(b()&&!Nn(),e.auth,"internal-error"),yield function(){let e=null;return new Promise(t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()}).catch(t=>{throw e&&window.removeEventListener("load",e),t})}(),e.recaptcha=yield e._recaptchaLoader.load(e.auth,e.auth.languageCode||void 0);const t=yield function(e){return Vn.apply(this,arguments)}(e.auth);v(t,e.auth,"internal-error"),e.parameters.sitekey=t})()}getAssertedRecaptcha(){return v(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class ii{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=rt._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}function ri(){return(ri=(0,i.Z)(function*(e,t,n){const i=Ze(e),r=yield ai(i,t,(0,s.m9)(n));return new ii(r,e=>Dt(i,e))})).apply(this,arguments)}function si(){return(si=(0,i.Z)(function*(e,t,n){const i=(0,s.m9)(e);yield It(!1,i,"phone");const r=yield ai(i.auth,t,(0,s.m9)(n));return new ii(r,e=>Ot(i,e))})).apply(this,arguments)}function oi(){return(oi=(0,i.Z)(function*(e,t,n){const i=(0,s.m9)(e),r=yield ai(i.auth,t,(0,s.m9)(n));return new ii(r,e=>Mt(i,e))})).apply(this,arguments)}function ai(e,t,n){return li.apply(this,arguments)}function li(){return(li=(0,i.Z)(function*(e,t,n){var i;const r=yield n.verify();try{let s;if(v("string"==typeof r,e,"argument-error"),v(n.type===ei,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s)return v("enroll"===t.type,e,"internal-error"),(yield _n(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:r}})).phoneSessionInfo.sessionInfo;{v("signin"===t.type,e,"internal-error");const n=(null===(i=s.multiFactorHint)||void 0===i?void 0:i.uid)||s.multiFactorUid;return v(n,e,"missing-multi-factor-info"),(yield Qn(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:r}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=yield Ke(e,{phoneNumber:s.phoneNumber,recaptchaToken:r});return t}}finally{n._reset()}})).apply(this,arguments)}function ci(){return(ci=(0,i.Z)(function*(e,t){yield Zt((0,s.m9)(e),t)})).apply(this,arguments)}let ui=(()=>{class e{constructor(t){this.providerId=e.PROVIDER_ID,this.auth=Ze(t)}verifyPhoneNumber(e,t){return ai(this.auth,e,(0,s.m9)(t))}static credential(e,t){return rt._fromVerification(e,t)}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?rt._fromTokenResponse(t,n):null}}return e.PROVIDER_ID="phone",e.PHONE_SIGN_IN_METHOD="phone",e})();function di(e,t){return t?x(t):(v(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}class hi extends Ee{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ze(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ze(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ze(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function pi(e){return Nt(e.auth,new hi(e),e.bypassAuthState)}function mi(e){const{auth:t,user:n}=e;return v(n,t,"internal-error"),Et(n,new hi(e),e.bypassAuthState)}function fi(e){return gi.apply(this,arguments)}function gi(){return(gi=(0,i.Z)(function*(e){const{auth:t,user:n}=e;return v(n,t,"internal-error"),Zt(n,new hi(e),e.bypassAuthState)})).apply(this,arguments)}class vi{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){var e=this;return new Promise(function(){var t=(0,i.Z)(function*(t,n){e.pendingPromise={resolve:t,reject:n};try{e.eventManager=yield e.resolver._initialize(e.auth),yield e.onExecution(),e.eventManager.registerConsumer(e)}catch(i){e.reject(i)}});return function(e,n){return t.apply(this,arguments)}}())}onAuthEvent(e){var t=this;return(0,i.Z)(function*(){const{urlResponse:n,sessionId:i,postBody:r,tenantId:s,error:o,type:a}=e;if(o)return void t.reject(o);const l={auth:t.auth,requestUri:n,sessionId:i,tenantId:s||void 0,postBody:r||void 0,user:t.user,bypassAuthState:t.bypassAuthState};try{t.resolve(yield t.getIdpTask(a)(l))}catch(c){t.reject(c)}})()}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return pi;case"linkViaPopup":case"linkViaRedirect":return fi;case"reauthViaPopup":case"reauthViaRedirect":return mi;default:m(this.auth,"internal-error")}}resolve(e){_(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){_(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const yi=new A(2e3,1e4);function _i(){return(_i=(0,i.Z)(function*(e,t,n){const i=Ze(e);v(t instanceof at,e,"argument-error");const r=di(i,n);return new wi(i,"signInViaPopup",t,r).executeNotNull()})).apply(this,arguments)}function Ti(){return(Ti=(0,i.Z)(function*(e,t,n){const i=(0,s.m9)(e);v(t instanceof at,i.auth,"argument-error");const r=di(i.auth,n);return new wi(i.auth,"reauthViaPopup",t,r,i).executeNotNull()})).apply(this,arguments)}function xi(){return(xi=(0,i.Z)(function*(e,t,n){const i=(0,s.m9)(e);v(t instanceof at,i.auth,"argument-error");const r=di(i.auth,n);return new wi(i.auth,"linkViaPopup",t,r,i).executeNotNull()})).apply(this,arguments)}let wi=(()=>{class e extends vi{constructor(t,n,i,r,s){super(t,n,r,s),this.provider=i,this.authWindow=null,this.pollId=null,e.currentPopupAction&&e.currentPopupAction.cancel(),e.currentPopupAction=this}executeNotNull(){var e=this;return(0,i.Z)(function*(){const t=yield e.execute();return v(t,e.auth,"internal-error"),t})()}onExecution(){var e=this;return(0,i.Z)(function*(){_(1===e.filter.length,"Popup operations only handle one event");const t=Sn();e.authWindow=yield e.resolver._openPopup(e.auth,e.provider,e.filter[0],t),e.authWindow.associatedEvent=t,e.resolver._originValidation(e.auth).catch(t=>{e.reject(t)}),e.resolver._isIframeWebStorageSupported(e.auth,t=>{t||e.reject(f(e.auth,"web-storage-unsupported"))}),e.pollUserCancellation()})()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(f(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,e.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;this.pollId=(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(f(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(e,yi.get())};e()}}return e.currentPopupAction=null,e})();const bi=new Map;class Zi extends vi{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}execute(){var e=()=>super.execute,t=this;return(0,i.Z)(function*(){let n=bi.get(t.auth._key());if(!n){try{const i=(yield function(e,t){return Ai.apply(this,arguments)}(t.resolver,t.auth))?yield e().call(t):null;n=()=>Promise.resolve(i)}catch(i){n=()=>Promise.reject(i)}bi.set(t.auth._key(),n)}return n()})()}onAuthEvent(e){var t=()=>super.onAuthEvent,n=this;return(0,i.Z)(function*(){if("signInViaRedirect"===e.type)return t().call(n,e);if("unknown"!==e.type){if(e.eventId){const i=yield n.auth._redirectUserForId(e.eventId);if(i)return n.user=i,t().call(n,e);n.resolve(null)}}else n.resolve(null)})()}onExecution(){return(0,i.Z)(function*(){})()}cleanUp(){}}function Ai(){return(Ai=(0,i.Z)(function*(e,t){const n=qi(t),i="true"===(yield Ei(e)._get(n));return yield Ei(e)._remove(n),i})).apply(this,arguments)}function Ii(e,t){return Si.apply(this,arguments)}function Si(){return(Si=(0,i.Z)(function*(e,t){return Ei(e)._set(qi(t),"true")})).apply(this,arguments)}function Ei(e){return x(e._redirectPersistence)}function qi(e){return ue("pendingRedirect",e.config.apiKey,e.name)}function Ni(){return(Ni=(0,i.Z)(function*(e,t,n){const i=Ze(e);v(t instanceof at,e,"argument-error");const r=di(i,n);return yield Ii(r,i),r._openRedirect(i,t,"signInViaRedirect")})).apply(this,arguments)}function Ci(){return(Ci=(0,i.Z)(function*(e,t,n){const i=(0,s.m9)(e);v(t instanceof at,i.auth,"argument-error");const r=di(i.auth,n);yield Ii(r,i.auth);const o=yield Mi(i);return r._openRedirect(i.auth,t,"reauthViaRedirect",o)})).apply(this,arguments)}function Di(){return(Di=(0,i.Z)(function*(e,t,n){const i=(0,s.m9)(e);v(t instanceof at,i.auth,"argument-error");const r=di(i.auth,n);yield It(!1,i,t.providerId),yield Ii(r,i.auth);const o=yield Mi(i);return r._openRedirect(i.auth,t,"linkViaRedirect",o)})).apply(this,arguments)}function Ri(){return(Ri=(0,i.Z)(function*(e,t){return yield Ze(e)._initializationPromise,Oi(e,t,!1)})).apply(this,arguments)}function Oi(e,t){return ki.apply(this,arguments)}function ki(){return(ki=(0,i.Z)(function*(e,t,n=!1){const i=Ze(e),r=di(i,t),s=new Zi(i,r,n),o=yield s.execute();return o&&!n&&(delete o.user._redirectEventId,yield i._persistUserIfCurrent(o.user),yield i._setRedirectUser(null,t)),o})).apply(this,arguments)}function Mi(e){return Ui.apply(this,arguments)}function Ui(){return(Ui=(0,i.Z)(function*(e){const t=Sn(`${e.uid}:::`);return e._redirectEventId=t,yield e.auth._setRedirectUser(e),yield e.auth._persistUserIfCurrent(e),t})).apply(this,arguments)}class Pi{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Li(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Li(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(f(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Fi(e))}saveEventToCache(e){this.cachedEventUids.add(Fi(e)),this.lastProcessedEventTime=Date.now()}}function Fi(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Li({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}function Ji(e){return Yi.apply(this,arguments)}function Yi(){return(Yi=(0,i.Z)(function*(e,t={}){return C(e,"GET","/v1/projects",t)})).apply(this,arguments)}const Qi=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Vi=/^https?/;function ji(){return(ji=(0,i.Z)(function*(e){if(e.config.emulator)return;const{authorizedDomains:t}=yield Ji(e);for(const i of t)try{if(Hi(i))return}catch(n){}m(e,"unauthorized-domain")})).apply(this,arguments)}function Hi(e){const t=w(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!Vi.test(n))return!1;if(Qi.test(e))return i===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const $i=new A(3e4,6e4);function Bi(){const e=qn().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let zi=null;function Gi(e){return zi=zi||function(e){return new Promise((t,n)=>{var i,r,s;function o(){Bi(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Bi(),n(f(e,"network-request-failed"))},timeout:$i.get()})}if(null===(r=null===(i=qn().gapi)||void 0===i?void 0:i.iframes)||void 0===r?void 0:r.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=qn().gapi)||void 0===s?void 0:s.load)){const t=Hn("iframefcb");return qn()[t]=()=>{gapi.load?o():n(f(e,"network-request-failed"))},jn(`https://apis.google.com/js/api.js?onload=${t}`)}o()}}).catch(e=>{throw zi=null,e})}(e),zi}const Wi=new A(5e3,15e3),Ki={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},Xi=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function er(e){const t=e.config;v(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?I(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:o.SDK_VERSION},r=Xi.get(e.config.apiHost);r&&(i.eid=r);const a=e._getFrameworks();return a.length&&(i.fw=a.join(",")),`${n}?${(0,s.xO)(i).slice(1)}`}function tr(){return(tr=(0,i.Z)(function*(e){const t=yield Gi(e),n=qn().gapi;return v(n,e,"internal-error"),t.open({where:document.body,url:er(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ki,dontclear:!0},t=>new Promise(function(){var n=(0,i.Z)(function*(n,i){yield t.restyle({setHideOnLeave:!1});const r=f(e,"network-request-failed"),s=qn().setTimeout(()=>{i(r)},Wi.get());function o(){qn().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{i(r)})});return function(e,t){return n.apply(this,arguments)}}()))})).apply(this,arguments)}const nr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ir{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function rr(e,t,n,i,r,a){v(e.config.authDomain,e,"auth-domain-config-required"),v(e.config.apiKey,e,"invalid-api-key");const l={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:o.SDK_VERSION,eventId:r};if(t instanceof at){t.setDefaultLanguage(e.languageCode),l.providerId=t.providerId||"",(0,s.xb)(t.getCustomParameters())||(l.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))l[e]=t}if(t instanceof lt){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(l.scopes=e.join(","))}e.tenantId&&(l.tid=e.tenantId);const c=l;for(const s of Object.keys(c))void 0===c[s]&&delete c[s];return`${function({config:e}){return e.emulator?I(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${(0,s.xO)(c).slice(1)}`}const sr="webStorageSupport";class or extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return y("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new or(e)}_finalizeEnroll(e,t,n){return function(e,t){return C(e,"POST","/v2/accounts/mfaEnrollment:finalize",Object.assign({tenantId:e.tenantId},t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return C(e,"POST","/v2/accounts/mfaSignIn:finalize",Object.assign({tenantId:e.tenantId},t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}var ar;class lr{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}getToken(e){var t=this;return(0,i.Z)(function*(){return t.assertAuthConfigured(),yield t.auth._initializationPromise,t.auth.currentUser?{accessToken:yield t.auth.currentUser.getIdToken(e)}:null})()}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){v(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function cr(){return window}function ur(){return(ur=(0,i.Z)(function*(e,t,n){var i;const{BuildInfo:r}=cr();_(t.sessionId,"AuthEvent did not contain a session ID");const s=yield pr(t.sessionId),o={};return Te()?o.ibi=r.packageName:ve()?o.apn=r.packageName:m(e,"operation-not-supported-in-this-environment"),r.displayName&&(o.appDisplayName=r.displayName),o.sessionId=s,rr(e,n,t.type,void 0,null!==(i=t.eventId)&&void 0!==i?i:void 0,o)})).apply(this,arguments)}function dr(){return(dr=(0,i.Z)(function*(e){const{BuildInfo:t}=cr(),n={};Te()?n.iosBundleId=t.packageName:ve()?n.androidPackageName=t.packageName:m(e,"operation-not-supported-in-this-environment"),yield Ji(e,n)})).apply(this,arguments)}function hr(){return(hr=(0,i.Z)(function*(e,t,n){const{cordova:i}=cr();let r=()=>{};try{yield new Promise((s,o)=>{let a=null;function l(){var e;s();const t=null===(e=i.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function c(){a||(a=window.setTimeout(()=>{o(f(e,"redirect-cancelled-by-user"))},2e3))}function u(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&c()}t.addPassiveListener(l),document.addEventListener("resume",c,!1),ve()&&document.addEventListener("visibilitychange",u,!1),r=()=>{t.removePassiveListener(l),document.removeEventListener("resume",c,!1),document.removeEventListener("visibilitychange",u,!1),a&&window.clearTimeout(a)}})}finally{r()}})).apply(this,arguments)}function pr(e){return mr.apply(this,arguments)}function mr(){return(mr=(0,i.Z)(function*(e){const t=fr(e),n=yield crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}function fr(e){if(_(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n}ar="Browser",(0,o._registerComponent)(new c.wA("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),{apiKey:i,authDomain:r}=n.options;return(e=>{v(i&&!i.includes(":"),"invalid-api-key",{appName:e.name}),v(!(null==r?void 0:r.includes(":")),"argument-error",{appName:e.name});const n={apiKey:i,authDomain:r,clientPlatform:ar,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:we(ar)},s=new be(e,n);return function(e,t){const n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(x);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}(s,t),s})(n)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),(0,o._registerComponent)(new c.wA("auth-internal",e=>{return t=Ze(e.getProvider("auth").getImmediate()),new lr(t);var t},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,o.registerVersion)("@firebase/auth","0.17.0",void 0);class gr extends Pi{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}initialized(){var e=this;return(0,i.Z)(function*(){yield e.initPromise})()}}function vr(e){return yr.apply(this,arguments)}function yr(){return(yr=(0,i.Z)(function*(e){const t=yield Tr()._get(xr(e));return t&&(yield Tr()._remove(xr(e))),t})).apply(this,arguments)}function _r(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<20;n++){const n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}function Tr(){return x(Zn)}function xr(e){return ue("authEvent",e.config.apiKey,e.name)}function wr(e){if(!(null==e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return(0,s.zd)(n.join("?"))}function br(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:f("no-auth-event")}}function Zr(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Ar(e=(0,s.z$)()){return!("file:"!==Zr()&&"ionic:"!==Zr()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Ir(){try{const e=self.localStorage,t=Sn();if(e)return e.setItem(t,"1"),e.removeItem(t),!function(e=(0,s.z$)()){return(0,s.w1)()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=(0,s.z$)()){return/Edge\/\d+/.test(e)}(e)}()||(0,s.hl)()}catch(e){return Sr()&&(0,s.hl)()}return!1}function Sr(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function Er(){return("http:"===Zr()||"https:"===Zr()||(0,s.ru)()||Ar())&&!((0,s.b$)()||(0,s.UG)())&&Ir()&&!Sr()}function qr(){return Ar()&&"undefined"!=typeof document}function Nr(){return(Nr=(0,i.Z)(function*(){return!!qr()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})})).apply(this,arguments)}const Cr={LOCAL:"local",NONE:"none",SESSION:"session"},Dr=v,Rr="persistence";function Or(e){return kr.apply(this,arguments)}function kr(){return(kr=(0,i.Z)(function*(e){yield e._initializationPromise;const t=Mr(),n=ue(Rr,e.config.apiKey,e.name);(null==t?void 0:t.sessionStorage)&&t.sessionStorage.setItem(n,e._getPersistence())})).apply(this,arguments)}function Mr(){return"undefined"!=typeof window?window:null}const Ur=v;class Pr{constructor(){this.browserResolver=x(class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=An,this._completeRedirectFn=Oi}_openPopup(e,t,n,r){var o=this;return(0,i.Z)(function*(){var i;_(null===(i=o.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");const a=rr(e,t,n,w(),r);return function(e,t,n,i=500,r=600){const o=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let l="";const c=Object.assign(Object.assign({},nr),{width:i.toString(),height:r.toString(),top:o,left:a}),u=(0,s.z$)().toLowerCase();n&&(l=fe(u)?"_blank":n),pe(u)&&(t=t||"http://localhost",c.scrollbars="yes");const d=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=(0,s.z$)()){var t;return Te(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==l)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",l),new ir(null);const h=window.open(t||"",l,d);v(h,e,"popup-blocked");try{h.focus()}catch(p){}return new ir(h)}(e,a,Sn())})()}_openRedirect(e,t,n,r){var s=this;return(0,i.Z)(function*(){var i;return yield s._originValidation(e),i=rr(e,t,n,w(),r),qn().location.href=i,new Promise(()=>{})})()}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(_(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n}initAndGetManager(e){var t=this;return(0,i.Z)(function*(){const n=yield function(e){return tr.apply(this,arguments)}(e),i=new Pi(e);return n.register("authEvent",t=>(v(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:i.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),t.eventManagers[e._key()]={manager:i},t.iframes[e._key()]=n,i})()}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(sr,{type:sr},n=>{var i;const r=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i.webStorageSupport;void 0!==r&&t(!!r),m(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function(e){return ji.apply(this,arguments)}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return xe()||me()||Te()}}),this.cordovaResolver=x(class{constructor(){this._redirectPersistence=An,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Oi}_initialize(e){var t=this;return(0,i.Z)(function*(){const n=e._key();let i=t.eventManagers.get(n);return i||(i=new gr(e),t.eventManagers.set(n,i),t.attachCallbackListeners(e,i)),i})()}_openPopup(e){m(e,"operation-not-supported-in-this-environment")}_openRedirect(e,t,n,r){var o=this;return(0,i.Z)(function*(){!function(e){var t,n,i,r,s,o,a,l,c,u;const d=cr();v("function"==typeof(null===(t=null==d?void 0:d.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),v(void 0!==(null===(n=null==d?void 0:d.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),v("function"==typeof(null===(s=null===(r=null===(i=null==d?void 0:d.cordova)||void 0===i?void 0:i.plugins)||void 0===r?void 0:r.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),v("function"==typeof(null===(l=null===(a=null===(o=null==d?void 0:d.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===l?void 0:l.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),v("function"==typeof(null===(u=null===(c=null==d?void 0:d.cordova)||void 0===c?void 0:c.InAppBrowser)||void 0===u?void 0:u.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const i=yield o._initialize(e);yield i.initialized(),i.resetRedirect(),bi.clear(),yield o._originValidation(e);const a=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:_r(),postBody:null,tenantId:e.tenantId,error:f(e,"no-auth-event")}}(e,n,r);yield function(e,t){return Tr()._set(xr(e),t)}(e,a);const l=yield function(e,t,n){return ur.apply(this,arguments)}(e,a,t),c=yield function(e){const{cordova:t}=cr();return new Promise(n=>{t.plugins.browsertab.isAvailable(i=>{let r=null;i?t.plugins.browsertab.openUrl(e):r=t.InAppBrowser.open(e,function(e=(0,s.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(r)})})}(l);return function(e,t,n){return hr.apply(this,arguments)}(e,i,c)})()}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function(e){return dr.apply(this,arguments)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:s}=cr(),o=setTimeout((0,i.Z)(function*(){yield vr(e),t.onEvent(br())}),500),a=function(){var n=(0,i.Z)(function*(n){clearTimeout(o);const i=yield vr(e);let r=null;i&&(null==n?void 0:n.url)&&(r=function(e,t){var n,i;const r=function(e){const t=wr(e),n=t.link?decodeURIComponent(t.link):void 0,i=wr(n).link,r=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return wr(r).link||r||i||n||e}(t);if(r.includes("/__/auth/callback")){const t=wr(r),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(t){return null}}(decodeURIComponent(t.firebaseError)):null,o=null===(i=null===(n=null==s?void 0:s.code)||void 0===n?void 0:n.split("auth/"))||void 0===i?void 0:i[1],a=o?f(o):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:r,postBody:null}}return null}(i,n.url)),t.onEvent(r||br())});return function(e){return n.apply(this,arguments)}}();void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,a);const l=r,c=`${s.packageName.toLowerCase()}://`;cr().handleOpenURL=function(){var e=(0,i.Z)(function*(e){if(e.toLowerCase().startsWith(c)&&a({url:e}),"function"==typeof l)try{l(e)}catch(t){console.error(t)}});return function(t){return e.apply(this,arguments)}}()}}),this.underlyingResolver=null,this._redirectPersistence=An,this._completeRedirectFn=Oi}_initialize(e){var t=this;return(0,i.Z)(function*(){return yield t.selectUnderlyingResolver(),t.assertedUnderlyingResolver._initialize(e)})()}_openPopup(e,t,n,r){var s=this;return(0,i.Z)(function*(){return yield s.selectUnderlyingResolver(),s.assertedUnderlyingResolver._openPopup(e,t,n,r)})()}_openRedirect(e,t,n,r){var s=this;return(0,i.Z)(function*(){return yield s.selectUnderlyingResolver(),s.assertedUnderlyingResolver._openRedirect(e,t,n,r)})()}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return qr()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Ur(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var e=this;return(0,i.Z)(function*(){if(e.underlyingResolver)return;const t=yield function(){return Nr.apply(this,arguments)}();e.underlyingResolver=t?e.cordovaResolver:e.browserResolver})()}}function Fr(e){return e.unwrap()}function Lr(e){return Yr(e)}function Jr(e,t){var n;const i=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===t.code)t.resolver=new $r(e,function(e,t){var n;const i=(0,s.m9)(e),r=t;return v(t.operationType,i,"argument-error"),v(null===(n=r.serverResponse)||void 0===n?void 0:n.mfaPendingCredential,i,"argument-error"),yn._fromError(i,r)}(e,t));else if(i){const e=Yr(t),n=t;e&&(n.credential=e,n.tenantId=i.tenantId||void 0,n.email=i.email||void 0,n.phoneNumber=i.phoneNumber||void 0)}}function Yr(e){const{_tokenResponse:t}=e instanceof s.ZR?e.customData:e;if(!t)return null;if(!(e instanceof s.ZR)&&"temporaryProof"in t&&"phoneNumber"in t)return ui.credentialFromResult(e);const n=t.providerId;if(!n||"password"===n)return null;let i;switch(n){case"google.com":i=dt;break;case"facebook.com":i=ut;break;case"github.com":i=ht;break;case"twitter.com":i=mt;break;default:const{oauthIdToken:e,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:o,nonce:a}=t;return r||s||e||o?o?n.startsWith("saml.")?pt._create(n,o):We._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:e,accessToken:r}):new ct(n).credential({idToken:e,accessToken:r,rawNonce:a}):null}return e instanceof s.ZR?i.credentialFromError(e):i.credentialFromResult(e)}function Qr(e,t){return Vr.apply(this,arguments)}function Vr(){return(Vr=(0,i.Z)(function*(e,t){let n;try{n=yield t}catch(o){throw o instanceof s.ZR&&Jr(e,o),o}const{operationType:i,user:r}=n;return{operationType:i,credential:Lr(n),additionalUserInfo:gn(n),user:Br.getOrCreate(r)}})).apply(this,arguments)}function jr(e,t){return Hr.apply(this,arguments)}function Hr(){return(Hr=(0,i.Z)(function*(e,t){const n=yield t;return{verificationId:n.verificationId,confirm:t=>Qr(e,n.confirm(t))}})).apply(this,arguments)}class $r{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Qr(Fr(this.auth),this.resolver.resolveSignIn(e))}}class Br{constructor(e){this._delegate=e,this.multiFactor=function(e){const t=(0,s.m9)(e);return xn.has(t)||xn.set(t,Tn._fromUser(t)),xn.get(t)}(e)}static getOrCreate(e){return Br.USER_MAP.has(e)||Br.USER_MAP.set(e,new Br(e)),Br.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}linkWithCredential(e){var t=this;return(0,i.Z)(function*(){return Qr(t.auth,Ot(t._delegate,e))})()}linkWithPhoneNumber(e,t){var n=this;return(0,i.Z)(function*(){return jr(n.auth,function(e,t,n){return si.apply(this,arguments)}(n._delegate,e,t))})()}linkWithPopup(e){var t=this;return(0,i.Z)(function*(){return Qr(t.auth,function(e,t,n){return xi.apply(this,arguments)}(t._delegate,e,Pr))})()}linkWithRedirect(e){var t=this;return(0,i.Z)(function*(){return yield Or(Ze(t.auth)),function(e,t,n){return function(e,t,n){return Di.apply(this,arguments)}(e,t,n)}(t._delegate,e,Pr)})()}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}reauthenticateWithCredential(e){var t=this;return(0,i.Z)(function*(){return Qr(t.auth,Mt(t._delegate,e))})()}reauthenticateWithPhoneNumber(e,t){return jr(this.auth,function(e,t,n){return oi.apply(this,arguments)}(this._delegate,e,t))}reauthenticateWithPopup(e){return Qr(this.auth,function(e,t,n){return Ti.apply(this,arguments)}(this._delegate,e,Pr))}reauthenticateWithRedirect(e){var t=this;return(0,i.Z)(function*(){return yield Or(Ze(t.auth)),function(e,t,n){return function(e,t,n){return Ci.apply(this,arguments)}(e,t,n)}(t._delegate,e,Pr)})()}sendEmailVerification(e){return function(e,t){return nn.apply(this,arguments)}(this._delegate,e)}unlink(e){var t=this;return(0,i.Z)(function*(){return yield function(e,t){return bt.apply(this,arguments)}(t._delegate,e),t})()}updateEmail(e){return function(e,t){return ln((0,s.m9)(e),t,null)}(this._delegate,e)}updatePassword(e){return function(e,t){return ln((0,s.m9)(e),null,t)}(this._delegate,e)}updatePhoneNumber(e){return function(e,t){return ci.apply(this,arguments)}(this._delegate,e)}updateProfile(e){return function(e,t){return an.apply(this,arguments)}(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return function(e,t,n){return rn.apply(this,arguments)}(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Br.USER_MAP=new WeakMap;const zr=v;let Gr=(()=>{class e{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;zr(n,"invalid-api-key",{appName:e.name});let i=[ce];if("undefined"!=typeof window){i=function(e,t){const n=Mr();if(!(null==n?void 0:n.sessionStorage))return[];const i=ue(Rr,e,t);switch(n.sessionStorage.getItem(i)){case Cr.NONE:return[ce];case Cr.LOCAL:return[Yn,An];case Cr.SESSION:return[An];default:return[]}}(n,e.name);for(const e of[Yn,Zn,An])i.includes(e)||i.push(e)}zr(n,"invalid-api-key",{appName:e.name});const r="undefined"!=typeof window?Pr:void 0;this._delegate=t.initialize({options:{persistence:i,popupRedirectResolver:r}}),this._delegate._updateErrorMap(u),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Br.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){!function(e,t,n){const i=Ze(e);v(i._canInitEmulator,i,"emulator-config-failed"),v(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const r=!!(null==n?void 0:n.disableWarnings),s=Ie(t),{host:o,port:a}=function(e){const t=Ie(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const e=r[1];return{host:e,port:Se(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:Se(t)}}}(t);i.config.emulator={url:`${s}//${o}${null===a?"":`:${a}`}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})}),function(e){function t(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"==typeof window||"undefined"==typeof document||e||("loading"===document.readyState?window.addEventListener("DOMContentLoaded",t):t())}(r)}(this._delegate,e,t)}applyActionCode(e){return function(e,t){return Ht.apply(this,arguments)}(this._delegate,e)}checkActionCode(e){return $t(this._delegate,e)}confirmPasswordReset(e,t){return function(e,t,n){return jt.apply(this,arguments)}(this._delegate,e,t)}createUserWithEmailAndPassword(e,t){var n=this;return(0,i.Z)(function*(){return Qr(n._delegate,function(e,t,n){return Gt.apply(this,arguments)}(n._delegate,e,t))})()}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return function(e,t){return tn.apply(this,arguments)}(this._delegate,e)}isSignInWithEmailLink(e){return function(e,t){const n=st.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)}(0,e)}getRedirectResult(){var e=this;return(0,i.Z)(function*(){zr(Er(),e._delegate,"operation-not-supported-in-this-environment");const t=yield function(e,t){return Ri.apply(this,arguments)}(e._delegate,Pr);return t?Qr(e._delegate,Promise.resolve(t)):{credential:null,user:null}})()}addFrameworkForLogging(e){!function(e,t){Ze(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:i,error:r,complete:s}=Wr(e,t,n);return this._delegate.onAuthStateChanged(i,r,s)}onIdTokenChanged(e,t,n){const{next:i,error:r,complete:s}=Wr(e,t,n);return this._delegate.onIdTokenChanged(i,r,s)}sendSignInLinkToEmail(e,t){return function(e,t,n){return Wt.apply(this,arguments)}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return function(e,t,n){return Vt.apply(this,arguments)}(this._delegate,e,t||void 0)}setPersistence(e){var t=this;return(0,i.Z)(function*(){let n;switch(function(e,t){Dr(Object.values(Cr).includes(t),e,"invalid-persistence-type"),(0,s.b$)()?Dr(t!==Cr.SESSION,e,"unsupported-persistence-type"):(0,s.UG)()?Dr(t===Cr.NONE,e,"unsupported-persistence-type"):Sr()?Dr(t===Cr.NONE||t===Cr.LOCAL&&(0,s.hl)(),e,"unsupported-persistence-type"):Dr(t===Cr.NONE||Ir(),e,"unsupported-persistence-type")}(t._delegate,e),e){case Cr.SESSION:n=An;break;case Cr.LOCAL:n=(yield x(Yn)._isAvailable())?Yn:Zn;break;case Cr.NONE:n=ce;break;default:return m("argument-error",{appName:t._delegate.name})}return t._delegate.setPersistence(n)})()}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Qr(this._delegate,function(e){return _t.apply(this,arguments)}(this._delegate))}signInWithCredential(e){return Qr(this._delegate,Dt(this._delegate,e))}signInWithCustomToken(e){return Qr(this._delegate,function(e,t){return Lt.apply(this,arguments)}(this._delegate,e))}signInWithEmailAndPassword(e,t){return Qr(this._delegate,function(e,t,n){return Dt((0,s.m9)(e),ot.credential(t,n))}(this._delegate,e,t))}signInWithEmailLink(e,t){return Qr(this._delegate,function(e,t,n){return Kt.apply(this,arguments)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return jr(this._delegate,function(e,t,n){return ri.apply(this,arguments)}(this._delegate,e,t))}signInWithPopup(e){var t=this;return(0,i.Z)(function*(){return zr(Er(),t._delegate,"operation-not-supported-in-this-environment"),Qr(t._delegate,function(e,t,n){return _i.apply(this,arguments)}(t._delegate,e,Pr))})()}signInWithRedirect(e){var t=this;return(0,i.Z)(function*(){return zr(Er(),t._delegate,"operation-not-supported-in-this-environment"),yield Or(t._delegate),function(e,t,n){return function(e,t,n){return Ni.apply(this,arguments)}(e,t,n)}(t._delegate,e,Pr)})()}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return function(e,t){return zt.apply(this,arguments)}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return e.Persistence=Cr,e})();function Wr(e,t,n){let i=e;"function"!=typeof e&&({next:i,error:t,complete:n}=e);const r=i;return{next:e=>r(e&&Br.getOrCreate(e)),error:t,complete:n}}class Kr{constructor(){this.providerId="phone",this._delegate=new ui(Fr(r.Z.auth()))}static credential(e,t){return ui.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Kr.PHONE_SIGN_IN_METHOD=ui.PHONE_SIGN_IN_METHOD,Kr.PROVIDER_ID=ui.PROVIDER_ID;const Xr=v;var es;(es=r.Z).INTERNAL.registerComponent(new c.wA("auth-compat",e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new Gr(t,n)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:ot,FacebookAuthProvider:ut,GithubAuthProvider:ht,GoogleAuthProvider:dt,OAuthProvider:ct,PhoneAuthProvider:Kr,PhoneMultiFactorGenerator:class{constructor(){}static assertion(e){return or._fromCredential(e)}},RecaptchaVerifier:class{constructor(e,t,n=r.Z.app()){var i;Xr(null===(i=n.options)||void 0===i?void 0:i.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new ni(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:mt,Auth:Gr,AuthCredential:Ee,Error:s.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),es.registerVersion("@firebase/auth-compat","0.1.0")},49673:(e,t,n)=>{"use strict";n.d(t,{R:()=>a});var i=n(67574),r=n(64581),s=n(26561);class o extends i.y{constructor(e,t=0,n=r.e){super(),this.source=e,this.delayTime=t,this.scheduler=n,(!(0,s.k)(t)||t<0)&&(this.delayTime=0),n&&"function"==typeof n.schedule||(this.scheduler=r.e)}static create(e,t=0,n=r.e){return new o(e,t,n)}static dispatch(e){const{source:t,subscriber:n}=e;return this.add(t.subscribe(n))}_subscribe(e){return this.scheduler.schedule(o.dispatch,this.delayTime,{source:this.source,subscriber:e})}}function a(e,t=0){return function(n){return n.lift(new l(e,t))}}class l{constructor(e,t){this.scheduler=e,this.delay=t}call(e,t){return new o(t,this.delay,this.scheduler).subscribe(e)}}},87615:(e,t,n)=>{"use strict";n.r(t),n.d(t,{PondModule:()=>cw});var i=n(38583),r=n(95987),s=n(21611),o=n(3679),a=n(5396),l=n(16738),c=n.n(l),u=n(25917),d=n(22238),h=n(54395),p=n(37716),m=n(48682),f=n(40704),g=n(8394),v=n(51095),y=n(76627),_=n(98295),T=n(49983),x=n(43220),w=n(21554),b=n(58341),Z=n(67441),A=n(72458),I=n(12178);function S(e,t){1&e&&p._UZ(0,"mat-progress-bar",41)}function E(e,t){1&e&&p._UZ(0,"mat-progress-bar",41)}function q(e,t){if(1&e&&(p.TgZ(0,"p"),p._uU(1),p.qZA()),2&e){const e=t.$implicit,n=p.oxw().$implicit;p.xp6(1),p.AsE(" ",n("TREATED")," ",e.name," ")}}function N(e,t){if(1&e&&(p.TgZ(0,"p"),p._uU(1),p.qZA()),2&e){const e=t.$implicit,n=p.oxw().$implicit;p.xp6(1),p.AsE(" ",n("CURRENT_DISEASE")," ",e.name," ")}}function C(e,t){if(1&e&&(p.TgZ(0,"mat-option",42),p._uU(1),p.qZA()),2&e){const e=t.$implicit;p.Q6J("value",e.name),p.xp6(1),p.hij(" ",e.name," ")}}function D(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"mat-chip",43),p.NdJ("removed",function(){const t=p.CHM(e).index;return p.oxw(2).removeDisease(t)}),p._uU(1),p.TgZ(2,"mat-icon",44),p._uU(3,"cancel"),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.oxw(2);p.Q6J("selectable",n.selectable),p.xp6(1),p.hij(" ",e.name," ")}}function R(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"mat-form-field",19),p.TgZ(1,"mat-label"),p._uU(2),p.qZA(),p.TgZ(3,"input",45),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw(2).validateNo(t)})("change",function(){return p.CHM(e),p.oxw(2).convertLoss()}),p.qZA(),p.qZA()}if(2&e){const e=p.oxw().$implicit;p.xp6(2),p.AsE("",e("LOSS"),"(",e("ANIMALS"),")"),p.xp6(1),p.Q6J("placeholder",e("ENTER_LOSS"))}}function O(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"mat-form-field",19),p.TgZ(1,"mat-label"),p._uU(2),p.qZA(),p.TgZ(3,"input",46),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw(2).validateNo(t)})("change",function(){return p.CHM(e),p.oxw(2).convertLoss()}),p.qZA(),p.qZA()}if(2&e){const e=p.oxw().$implicit;p.xp6(2),p.hij("",e("LOSS"),"(kg)"),p.xp6(1),p.Q6J("placeholder",e("ENTER_LOSS"))}}function k(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.YNc(8,S,1,0,"mat-progress-bar",7),p.YNc(9,E,1,0,"mat-progress-bar",7),p.TgZ(10,"div",8),p.TgZ(11,"mat-form-field",9),p.TgZ(12,"mat-label"),p._uU(13),p.qZA(),p.TgZ(14,"input",10),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw().dateRangeSelected=t})("dateChange",function(t){return p.CHM(e),p.oxw().onChangeDate(t)}),p.qZA(),p._UZ(15,"mat-datepicker-toggle",11),p._UZ(16,"mat-datepicker",null,12),p.qZA(),p.TgZ(18,"div",13),p.TgZ(19,"div",14),p.YNc(20,q,2,2,"p",15),p.qZA(),p.TgZ(21,"div",16),p.YNc(22,N,2,2,"p",15),p.qZA(),p.TgZ(23,"button",17),p.NdJ("click",function(){return p.CHM(e),p.MAs(35).focus()}),p._uU(24),p.qZA(),p.qZA(),p.qZA(),p.TgZ(25,"div",18),p.TgZ(26,"div",8),p.TgZ(27,"mat-form-field",19),p.TgZ(28,"mat-label"),p._uU(29),p.qZA(),p.TgZ(30,"input",20),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw().validateNo(t)}),p.qZA(),p.qZA(),p.TgZ(31,"mat-form-field",21),p.TgZ(32,"mat-label"),p._uU(33),p.qZA(),p._UZ(34,"input",22,23),p.TgZ(36,"mat-autocomplete",24,25),p.NdJ("optionSelected",function(t){return p.CHM(e),p.oxw().onSelectDisease(t.option.value)}),p.YNc(38,C,2,2,"mat-option",26),p.ALo(39,"async"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(40,"div",27),p.TgZ(41,"mat-chip-list",28,29),p.YNc(43,D,4,2,"mat-chip",30),p.qZA(),p.qZA(),p.TgZ(44,"div",8),p.YNc(45,R,4,3,"mat-form-field",31),p.YNc(46,O,4,2,"mat-form-field",31),p.TgZ(47,"mat-form-field",32),p.TgZ(48,"mat-label"),p._uU(49),p.qZA(),p.TgZ(50,"mat-select",33),p.TgZ(51,"mat-option",34),p._uU(52),p.qZA(),p.TgZ(53,"mat-option",35),p._uU(54,"Kg"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(55,"div",36),p.TgZ(56,"mat-form-field",32),p.TgZ(57,"mat-label"),p._uU(58),p.qZA(),p._UZ(59,"textarea",37),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(60,"div",38),p.TgZ(61,"button",39),p.NdJ("click",function(){return p.CHM(e),p.oxw().save()}),p._uU(62),p.qZA(),p.TgZ(63,"button",40),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(64),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(17),i=p.MAs(37),r=p.oxw();p.xp6(4),p.Oqu(e("TITLE")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(2),p.Q6J("ngIf",r.loadingFlag.pending),p.xp6(1),p.Q6J("ngIf",r.savingFlag.pending),p.xp6(4),p.Oqu(e("DATE")),p.xp6(1),p.Q6J("max",r.maxDate.toDate())("matDatepicker",n)("ngModel",r.dateRangeSelected),p.xp6(1),p.Q6J("for",n),p.xp6(5),p.Q6J("ngForOf",r.object_filter.arr_disease_current_done),p.xp6(2),p.Q6J("ngForOf",r.object_filter.arr_disease_current),p.xp6(2),p.Oqu(e("HEALTH_NOTE")),p.xp6(1),p.Q6J("formGroup",r.form),p.xp6(4),p.hij("",e("WEIGHT"),"(g)"),p.xp6(1),p.Q6J("placeholder",e("ENTER_WEIGHT")),p.xp6(3),p.Oqu(e("HEALTH_NOTE")),p.xp6(1),p.Q6J("placeholder",e("SEARCH_DISEASE"))("aria-label",e("SEARCH_DISEASE"))("matAutocomplete",i),p.xp6(4),p.Q6J("ngForOf",p.lcZ(39,32,r.listDisease)),p.xp6(5),p.Q6J("ngForOf",r.object_filter.arr_disease_new),p.xp6(2),p.Q6J("ngIf","con"==r.form.value.unit),p.xp6(1),p.Q6J("ngIf","kg"==r.form.value.unit),p.xp6(3),p.Oqu(e("UNIT")),p.xp6(1),p.Q6J("placeholder",e("ENTER_UNIT")),p.xp6(2),p.Oqu(e("PIECES")),p.xp6(6),p.Oqu(e("STATUS")),p.xp6(1),p.Q6J("placeholder",e("ENTER_STATUS")),p.xp6(2),p.Q6J("disabled",r.form.invalid),p.xp6(1),p.hij(" ",e("SAVE")," "),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let M=(()=>{class e{constructor(e,t,n,i,r,s){this.pondService=e,this._fb=t,this.alertService=n,this.dialogRef=i,this.data=r,this._translate=s,this.loadingFlag=new a.E,this.savingFlag=new a.E,this.dateRangeSelected=c()().format("YYYY-MM-DD"),this.maxDate=c()(),this.minDate=c()().subtract(180,"days"),this.dataRaw=[],this.invalid=!0,this.showDisease=!1,this.listSynonym=[],this.form=new o.cw({weight:new o.NI("",[o.kI.required,o.kI.min(0)]),loss:new o.NI("",[o.kI.min(0)]),lossKg:new o.NI("",[o.kI.min(0)]),desease:new o.NI(""),unit:new o.NI("kg"),textSearch:new o.NI("")}),this.object_filter={arr_disease_current:[],arr_disease_current_done:[],arr_disease_new:[],arr_sub_new:[]}}ngOnInit(){console.log(this.data),this.item=this.data.bigData,this.disease=this.data.bigData.disease,this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.item.date==this.dateRangeSelected&&(this.itemSelected=this.item),this.form.patchValue({weight:this.data.bigData.weight,loss:this.data.bigData.loss,lossKg:this.data.bigData.loss,desease:"Ao dang b\u1ec7nh @"+this.data.name,unit:"kg"}),this.processData(),console.log("selected",this.itemSelected),this.form.controls.textSearch.valueChanges.pipe((0,h.b)(300)).subscribe(e=>{this.getListDisease(e),console.log(e),this.object_filter.arr_disease_current.filter(t=>{e==t.name&&this.alertService.error(this._translate.translate("REPEAT_ERROR"))})})}getListDisease(e){e.length>=2&&(this.listDisease=this.pondService.getListDisease(e).pipe(e=>e))}validateNo(e){const t=e.which?e.which:e.keyCode;return!(t>31&&(t<48||t>57))}delay(e){return new Promise(t=>setTimeout(t,e))}onChangeDate(e){this.dateRangeSelected=e.value;let t=c()(this.dateRangeSelected);if(this.object_filter.arr_disease_current=[],this.object_filter.arr_disease_current_done=[],this.object_filter.arr_disease_new=[],this.dataRaw.length>0){let e=this.dataRaw[this.dataRaw.findIndex(e=>e.date==t.format("YYYY-MM-DD"))];void 0!==e&&(this.itemSelected=e,this.disease=this.itemSelected.disease,this.processData()),(t<c()(this.dataRaw[this.dataRaw.length-1].date)||t>c()(this.dataRaw[0].date))&&this.getData()}else this.getData()}changeDate(e){let t=c()(this.dateRangeSelected).add(e,"days");if(t<this.minDate||t>this.maxDate)return!1;this.dateRangeSelected=t.format("YYYY-MM-DD")}getData(){this.loadingFlag.setStart(!0);let e=c()(this.dateRangeSelected).format("YYYY-MM-DD");this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},e).subscribe(t=>{if(t.data){this.dataRaw=t.data;let n=this.dataRaw[this.dataRaw.findIndex(t=>t.date==e)];void 0!==n&&(this.itemSelected=n,console.log(this.itemSelected.disease),this.disease=this.itemSelected.disease?this.itemSelected.disease:[],this.processData()),this.loadingFlag.setResult(!0)}else this.loadingFlag.setResult(!1)},e=>{this.loadingFlag.setResult(!1),this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}save(){this.savingFlag.setPending(!0);let e=c()(this.dateRangeSelected).format("YYYY-MM-DD"),t=this.form.value;t.disease=this.object_filter.arr_disease_new,this.pondService.updateHealth({date:e,heath:t}).subscribe(n=>{"success"==n.status?(this.alertService.success(this._translate.translate("UPDATE_SUCCESS")),this.savingFlag.setResult(!0),e==this.maxDate.format("YYYY-MM-DD")?(t.disease=t.disease.concat(this.object_filter.arr_disease_current),this.dialogRef.close(t)):this.dialogRef.close()):(this.alertService.error(n.message),this.savingFlag.setResult(!1))},()=>{this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}processData(){void 0!==this.itemSelected&&this.itemSelected&&this.form.patchValue({weight:this.data.bigData.weight,loss:this.data.bigData.loss,lossKg:(this.itemSelected.weight>0?this.itemSelected.weight:"")*this.itemSelected.loss/1e3,desease:"Ao \u0111ang b\u1ec7nh @"+this.data.name,unit:"kg"}),this.invalid=this.form.invalid,this.object_filter.arr_disease_current=[],this.object_filter.arr_disease_current_done=[],this.disease.forEach(e=>{1==parseInt(e.processed)?this.object_filter.arr_disease_current_done.push({id:e.disease_id,name:e.disease_name}):this.object_filter.arr_disease_current.push({id:e.disease_id,name:e.disease_name})})}getListSynonym(){this.pondService.getListSynonym().subscribe(e=>{1==e.status?(this.listSynonym=e.data,console.log(this.listSynonym)):this.alertService.error(e.message)},()=>{this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}convertLoss(){if(this.form.value.weight>0){if("kg"==this.form.value.unit){let e=Math.ceil(this.form.value.lossKg/(this.form.value.weight/1e3));this.form.patchValue({loss:e})}else{let e=Math.ceil(this.form.value.loss*this.form.value.weight/1e3);this.form.patchValue({lossKg:e})}this.form.get("weight").clearValidators()}else 0!=this.form.value.loss||0!=this.form.value.lossKg?(this.form.get("weight").setValidators([o.kI.required,o.kI.min(.01)]),this.form.get("weight").updateValueAndValidity()):this.form.get("weight").clearValidators();this.invalid=this.form.invalid}onSelectDisease(e){this.listDisease.subscribe(e=>{})}removeDisease(e){this.object_filter.arr_disease_new.splice(e,1)}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(o.qu),p.Y36(f.c),p.Y36(d.so),p.Y36(d.WI),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-process-disease"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto"],["mode","indeterminate",4,"ngIf"],[1,"grid","grid-cols-2"],[1,"w-full","p-2"],["matInput","",3,"max","matDatepicker","ngModel","ngModelChange","dateChange"],["matSuffix","",3,"for"],["picker",""],[1,"flex","justify-center","items-center","flex-col"],[1,"text-center","text-green-400"],[4,"ngFor","ngForOf"],[1,"text-center","text-red-400"],["mat-raised-button","","color","warn",1,"w-40",3,"click"],[3,"formGroup"],[1,"w-full","pr-2"],["matInput","","formControlName","weight","required","",3,"placeholder","keypress"],["appearance","fill",1,"example-full-width"],["type","text","matInput","","formControlName","textSearch",3,"placeholder","aria-label","matAutocomplete"],["input",""],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"flex","justify-end"],[1,"mb-4"],["chipList",""],["removable","true","color","warn","selected","",3,"selectable","removed",4,"ngFor","ngForOf"],["class","w-full pr-2",4,"ngIf"],[1,"w-full"],["formControlName","unit",3,"placeholder"],["value","con"],["value","kg"],[1,"grid","grid-cols-1"],["matInput","","formControlName","desease","required","",3,"placeholder"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",3,"click"],["mode","indeterminate"],[3,"value"],["removable","true","color","warn","selected","",3,"selectable","removed"],["matChipRemove",""],["matInput","","formControlName","loss","required","",3,"placeholder","keypress","change"],["matInput","","formControlName","lossKg","required","",3,"placeholder","keypress","change"]],template:function(e,t){1&e&&p.YNc(0,k,65,34,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.HEALTH_UPDATE")},directives:[g.KI,v.lW,d.ZT,y.Hw,i.O5,_.KE,_.hX,T.Nt,x.hl,o.Fj,o.JJ,o.On,x.nW,_.R9,x.Mq,i.sg,o.JL,o.sg,o.u,o.Q7,w.ZL,w.XC,b.qn,Z.gD,A.ey,I.pW,b.HS,b.qH],pipes:[i.Ov],styles:[""]}),e})();var U=n(95352),P=n(1400),F=n(47101),L=n(90171),J=n(77746),Y=n(11436);function Q(e,t){1&e&&p._UZ(0,"mat-progress-bar",7)}function V(e,t){if(1&e&&(p.TgZ(0,"span"),p._uU(1),p.qZA()),2&e){const e=p.oxw(2).$implicit;p.xp6(1),p.hij("(",e("TODAY"),")")}}function j(e,t){if(1&e&&(p.TgZ(0,"span"),p._uU(1),p.qZA()),2&e){const e=p.oxw(2).$implicit,t=p.oxw();p.xp6(1),p.AsE("(",t.dateAgo," ",e("DAY_AGO"),")")}}function H(e,t){if(1&e&&(p.TgZ(0,"span"),p._uU(1),p.qZA()),2&e){const e=p.oxw(2).$implicit,t=p.oxw();p.xp6(1),p.AsE("(",t.dateAgo," ",e("DAYS_AGO"),")")}}function $(e,t){1&e&&(p.TgZ(0,"mat-icon",44),p._uU(1,"sentiment_dissatisfied "),p.qZA())}function B(e,t){1&e&&(p.TgZ(0,"mat-icon",45),p._uU(1,"sentiment_satisfied_alt "),p.qZA())}function z(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div"),p.TgZ(1,"mat-form-field",26),p.TgZ(2,"input",46),p.NdJ("focusout",function(t){const n=p.CHM(e).$implicit;return p.oxw(4).validNoI(t,n)})("keyup",function(t){const n=p.CHM(e).$implicit;return p.oxw(4).validNoI(t,n)})("ngModelChange",function(t){const n=p.CHM(e).$implicit;return p.oxw(4).item[n.key]=t})("change",function(){return p.CHM(e),p.oxw(4).onChangeGroup("param")}),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.oxw(4);p.xp6(2),p.Q6J("min",e.min)("max",e.max)("placeholder",n.convertNameParam(e.name))("ngModel",n.item[e.key])("value",n.item[e.key])}}function G(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"mat-expansion-panel",8),p.NdJ("opened",function(){return p.CHM(e),p.oxw(3).setStep(1)}),p.TgZ(1,"mat-expansion-panel-header"),p.TgZ(2,"mat-panel-title"),p._uU(3),p.qZA(),p.TgZ(4,"mat-panel-description",9),p.YNc(5,$,2,0,"mat-icon",42),p.YNc(6,B,2,0,"mat-icon",17),p.TgZ(7,"mat-icon"),p._uU(8,"waves"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(9,"div",43),p.YNc(10,z,3,5,"div",34),p.qZA(),p.TgZ(11,"mat-action-row"),p.TgZ(12,"button",30),p.NdJ("click",function(){return p.CHM(e),p.oxw(3).prevStep()}),p.TgZ(13,"mat-icon"),p._uU(14,"arrow_upward"),p.qZA(),p.qZA(),p.TgZ(15,"button",14),p.NdJ("click",function(){return p.CHM(e),p.oxw(3).nextStep()}),p.TgZ(16,"mat-icon"),p._uU(17,"arrow_downward"),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=p.oxw(2).$implicit,t=p.oxw();p.Q6J("expanded",1===t.step),p.xp6(3),p.hij(" ",e("ENVIRONMENT")," "),p.xp6(2),p.Q6J("ngIf",!t.formGroupStatus.param),p.xp6(1),p.Q6J("ngIf",t.formGroupStatus.param),p.xp6(4),p.Q6J("ngForOf",t.pondService.trackingObjects)}}function W(e,t){1&e&&(p.TgZ(0,"mat-icon",47),p._uU(1," report_problem "),p.qZA())}function K(e,t){1&e&&(p.TgZ(0,"mat-icon",45),p._uU(1," sentiment_satisfied_alt "),p.qZA())}function X(e,t){if(1&e&&(p.TgZ(0,"div",52),p._uU(1),p.qZA()),2&e){const e=p.oxw().$implicit,t=p.oxw(3).$implicit;p.xp6(1),p.AsE(" ",t("TREATED")," ",e.disease_name," ")}}function ee(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div",53),p.TgZ(1,"div",54),p._uU(2),p.qZA(),p.TgZ(3,"div",55),p.TgZ(4,"div"),p.TgZ(5,"button",56),p.NdJ("click",function(){p.CHM(e);const t=p.oxw(),n=t.index,i=t.$implicit;return p.oxw(4).processDisease(n,i)}),p.TgZ(6,"mat-icon"),p._uU(7,"emoji_objects"),p.qZA(),p._uU(8),p.qZA(),p.qZA(),p.TgZ(9,"div"),p.TgZ(10,"button",57),p.NdJ("click",function(){p.CHM(e);const t=p.oxw(),n=t.index,i=t.$implicit;return p.oxw(4).deleteDisease(n,i)}),p.TgZ(11,"mat-icon"),p._uU(12,"delete"),p.qZA(),p._uU(13),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=p.oxw().$implicit,t=p.oxw(3).$implicit;p.xp6(2),p.hij("",e.disease_name," "),p.xp6(6),p.hij("",t("TREAT")," "),p.xp6(5),p.hij("",t("DELETE")," ")}}function te(e,t){if(1&e&&(p.TgZ(0,"div",49),p.YNc(1,X,2,2,"div",50),p.YNc(2,ee,14,3,"div",51),p.qZA()),2&e){const e=t.$implicit;p.xp6(1),p.Q6J("ngIf",1==e.processed),p.xp6(1),p.Q6J("ngIf",0==e.processed)}}function ne(e,t){if(1&e&&(p.TgZ(0,"div"),p.YNc(1,te,3,2,"div",48),p.qZA()),2&e){const e=p.oxw(3);p.xp6(1),p.Q6J("ngForOf",e.pondService.dailyDisease)}}function ie(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"mat-chip",58),p.NdJ("removed",function(){const t=p.CHM(e).index;return p.oxw(3).removeDisease(t)}),p._uU(1),p.TgZ(2,"mat-icon",59),p._uU(3,"cancel"),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit;p.Q6J("selectable",!0)("removable",!0),p.xp6(1),p.hij(" ",e.name," ")}}function re(e,t){if(1&e&&(p.TgZ(0,"mat-option",60),p._uU(1),p.qZA()),2&e){const e=t.$implicit;p.Q6J("value",e.id),p.xp6(1),p.hij(" ",e.name," ")}}function se(e,t){if(1&e&&(p.TgZ(0,"mat-panel-description",9),p._uU(1),p.TgZ(2,"mat-icon"),p._uU(3,"opacity"),p.qZA(),p.qZA()),2&e){const e=p.oxw(2).$implicit,t=p.oxw();p.xp6(1),p.AsE(" ",null==t.item.enviroment?null:t.item.enviroment.length," ",e("ROW")," ")}}function oe(e,t){if(1&e&&(p.TgZ(0,"mat-panel-description",9),p._uU(1),p.TgZ(2,"mat-icon"),p._uU(3,"opacity"),p.qZA(),p.qZA()),2&e){const e=p.oxw(2).$implicit,t=p.oxw();p.xp6(1),p.AsE(" ",null==t.item.enviroment?null:t.item.enviroment.length," ",e("ROWS")," ")}}function ae(e,t){if(1&e&&(p.ynx(0),p.TgZ(1,"mat-option",60),p._uU(2),p.qZA(),p.BQk()),2&e){const e=t.$implicit;p.xp6(1),p.Q6J("value",e.code),p.xp6(1),p.hij("",e.name," ")}}function le(e,t){if(1&e&&(p.TgZ(0,"mat-option",60),p._uU(1),p.qZA()),2&e){const e=p.oxw().$implicit;p.Q6J("value",e.id),p.xp6(1),p.AsE(" ",e.name," (",e.unit,") ")}}function ce(e,t){if(1&e&&(p.ynx(0),p.YNc(1,le,2,3,"mat-option",68),p.BQk()),2&e){const e=t.$implicit;p.xp6(1),p.Q6J("ngIf",3==e.group_id)}}function ue(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"tr"),p.TgZ(1,"td",61),p.TgZ(2,"mat-form-field",62),p.TgZ(3,"mat-select",63,64),p.NdJ("ngModelChange",function(t){return p.CHM(e).$implicit.wcode=t}),p.YNc(5,ae,3,2,"ng-container",34),p.qZA(),p.qZA(),p.qZA(),p.TgZ(6,"td",61),p.TgZ(7,"mat-form-field",62),p.TgZ(8,"mat-select",63),p.NdJ("ngModelChange",function(t){return p.CHM(e).$implicit.product_id=t}),p.YNc(9,ce,2,1,"ng-container",34),p.qZA(),p.qZA(),p.qZA(),p.TgZ(10,"td",61),p.TgZ(11,"mat-form-field",26),p.TgZ(12,"input",65),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw(3).validNo(t)})("ngModelChange",function(t){return p.CHM(e).$implicit.quantity=t}),p.qZA(),p.qZA(),p.qZA(),p.TgZ(13,"td",61),p.TgZ(14,"button",66),p.NdJ("click",function(){const t=p.CHM(e).index;return p.oxw(3).removeRowEnviro(t)}),p.TgZ(15,"mat-icon",67),p._uU(16,"remove_circle_outline"),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.oxw(2).$implicit,i=p.oxw();p.xp6(3),p.Q6J("placeholder",n("WAREHOUSE"))("ngModel",e.wcode),p.xp6(2),p.Q6J("ngForOf",i.listStore),p.xp6(3),p.Q6J("placeholder",n("CHEM_TREATMENT"))("ngModel",e.product_id),p.xp6(1),p.Q6J("ngForOf",i.listQuantityCurrent),p.xp6(3),p.Q6J("placeholder",n("AMOUNT"))("ngModel",e.quantity),p.xp6(2),p.Q6J("matTooltip",n("DELETE_ROW")),p.xp6(1),p.Q6J("aria-label",n("DELETE"))}}function de(e,t){if(1&e&&(p.ynx(0),p.TgZ(1,"mat-option",60),p._uU(2),p.qZA(),p.BQk()),2&e){const e=t.$implicit;p.xp6(1),p.Q6J("value",e.code),p.xp6(1),p.hij("",e.name," ")}}function he(e,t){if(1&e&&(p.TgZ(0,"mat-option",60),p._uU(1),p.qZA()),2&e){const e=p.oxw().$implicit;p.Q6J("value",e.id),p.xp6(1),p.AsE(" ",e.name," (",e.unit,") ")}}function pe(e,t){if(1&e&&(p.ynx(0),p.YNc(1,he,2,3,"mat-option",68),p.BQk()),2&e){const e=t.$implicit;p.xp6(1),p.Q6J("ngIf",1==e.group_id)}}function me(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"tr"),p.TgZ(1,"td",61),p.TgZ(2,"mat-form-field",62),p.TgZ(3,"mat-select",63),p.NdJ("ngModelChange",function(t){return p.CHM(e).$implicit.wcode=t}),p.YNc(4,de,3,2,"ng-container",34),p.qZA(),p.qZA(),p.qZA(),p.TgZ(5,"td",61),p.TgZ(6,"mat-form-field",62),p.TgZ(7,"mat-select",63),p.NdJ("ngModelChange",function(t){return p.CHM(e).$implicit.product_id=t}),p.YNc(8,pe,2,1,"ng-container",34),p.qZA(),p.qZA(),p.qZA(),p.TgZ(9,"td",61),p.TgZ(10,"mat-form-field",26),p.TgZ(11,"input",72),p.NdJ("ngModelChange",function(t){return p.CHM(e).$implicit.quantity=t})("change",function(){const t=p.CHM(e).$implicit;return p.oxw(4).onChangeFeed(t)}),p.qZA(),p.qZA(),p.qZA(),p.TgZ(12,"td",61),p.TgZ(13,"button",73),p.NdJ("click",function(){const t=p.CHM(e).index,n=p.oxw().index;return p.oxw(3).removeRowFeed(n,t)}),p.TgZ(14,"mat-icon",67),p._uU(15,"remove_circle_outline"),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.oxw(3).$implicit,i=p.oxw();p.xp6(3),p.Q6J("placeholder",n("WAREHOUSE"))("ngModel",e.wcode),p.xp6(1),p.Q6J("ngForOf",i.listStore),p.xp6(3),p.Q6J("placeholder",n("FEED"))("ngModel",e.product_id),p.xp6(1),p.Q6J("ngForOf",i.listQuantityCurrent),p.xp6(3),p.Q6J("placeholder",n("AMOUNT"))("ngModel",e.quantity)("value",e.quantity),p.xp6(3),p.Q6J("aria-label",n("DELETE"))}}function fe(e,t){if(1&e&&(p.ynx(0),p.TgZ(1,"mat-option",60),p._uU(2),p.qZA(),p.BQk()),2&e){const e=t.$implicit;p.xp6(1),p.Q6J("value",e.code),p.xp6(1),p.hij("",e.name," ")}}function ge(e,t){if(1&e&&(p.TgZ(0,"mat-option",60),p._uU(1),p.qZA()),2&e){const e=p.oxw().$implicit;p.Q6J("value",e.id),p.xp6(1),p.AsE(" ",e.name," (",e.unit,") ")}}function ve(e,t){if(1&e&&(p.ynx(0),p.YNc(1,ge,2,3,"mat-option",68),p.BQk()),2&e){const e=t.$implicit;p.xp6(1),p.Q6J("ngIf",2==e.group_id)}}function ye(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"tr"),p.TgZ(1,"td",61),p.TgZ(2,"mat-form-field",62),p.TgZ(3,"mat-select",63),p.NdJ("ngModelChange",function(t){return p.CHM(e).$implicit.wcode=t}),p.YNc(4,fe,3,2,"ng-container",34),p.qZA(),p.qZA(),p.qZA(),p.TgZ(5,"td",61),p.TgZ(6,"mat-form-field",62),p.TgZ(7,"mat-select",63),p.NdJ("ngModelChange",function(t){return p.CHM(e).$implicit.product_id=t}),p.YNc(8,ve,2,1,"ng-container",34),p.qZA(),p.qZA(),p.qZA(),p.TgZ(9,"td",61),p.TgZ(10,"mat-form-field",26),p.TgZ(11,"input",74),p.NdJ("keyup",function(t){return p.CHM(e),p.oxw(4).checkValue(t)})("click",function(){p.CHM(e);const t=p.oxw().index;return p.oxw(3).getIndex(t)})("ngModelChange",function(t){return p.CHM(e).$implicit.quantity=t})("change",function(){const t=p.CHM(e).$implicit;return p.oxw(4).checkInventory(t)}),p.qZA(),p.qZA(),p.qZA(),p.TgZ(12,"td",61),p.TgZ(13,"button",73),p.NdJ("click",function(){const t=p.CHM(e).index,n=p.oxw().index;return p.oxw(3).removeRowBlend(n,t)}),p.TgZ(14,"mat-icon",67),p._uU(15,"remove_circle_outline"),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.oxw(3).$implicit,i=p.oxw();p.xp6(3),p.Q6J("placeholder",n("WAREHOUSE"))("ngModel",e.wcode),p.xp6(1),p.Q6J("ngForOf",i.listStore),p.xp6(3),p.Q6J("placeholder",n("BLEND"))("ngModel",e.product_id),p.xp6(1),p.Q6J("ngForOf",i.listQuantityCurrent),p.xp6(3),p.Q6J("placeholder",n("AMOUNT"))("value",e.quantity)("ngModel",e.quantity),p.xp6(3),p.Q6J("aria-label",n("DELETE"))}}function _e(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div",32),p.TgZ(1,"div",69),p.TgZ(2,"div"),p._uU(3),p.TgZ(4,"span",70),p._uU(5),p.qZA(),p.qZA(),p.TgZ(6,"div"),p.TgZ(7,"button",71),p.NdJ("click",function(){const t=p.CHM(e).index;return p.oxw(3).addRowFeed(t)}),p.TgZ(8,"mat-icon"),p._uU(9,"add_circle_outline"),p.qZA(),p._uU(10),p.qZA(),p.TgZ(11,"button",71),p.NdJ("click",function(){const t=p.CHM(e).index;return p.oxw(3).addRowBlend(t)}),p.TgZ(12,"mat-icon"),p._uU(13,"add_circle_outline"),p.qZA(),p._uU(14),p.qZA(),p.qZA(),p.qZA(),p.TgZ(15,"table",33),p.YNc(16,me,16,10,"tr",34),p._UZ(17,"tr",61),p.YNc(18,ye,16,10,"tr",34),p.qZA(),p.qZA()}if(2&e){const e=t.index,n=p.oxw(2).$implicit,i=p.oxw();p.xp6(3),p.hij(" ",n("REPAST")," "),p.xp6(2),p.Oqu(e+1),p.xp6(5),p.hij(" ",n("FEED")," "),p.xp6(4),p.hij(" ",n("BLEND")," "),p.xp6(2),p.Q6J("ngForOf",i.feed[e]),p.xp6(2),p.Q6J("ngForOf",i.blend[e])}}function Te(e,t){1&e&&(p.TgZ(0,"mat-icon",75),p._uU(1,"sentiment_dissatisfied"),p.qZA())}function xe(e,t){1&e&&(p.TgZ(0,"mat-icon",76),p._uU(1,"sentiment_satisfied_alt"),p.qZA())}const we=function(){return{prefix:"",thousands:",",decimal:".",precision:0}};function be(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"mat-accordion"),p.TgZ(1,"mat-expansion-panel",8),p.NdJ("opened",function(){return p.CHM(e),p.oxw(2).setStep(0)}),p.TgZ(2,"mat-expansion-panel-header"),p.TgZ(3,"mat-panel-title"),p._uU(4),p.qZA(),p.TgZ(5,"mat-panel-description",9),p.TgZ(6,"span"),p._uU(7),p.ALo(8,"date"),p.YNc(9,V,2,1,"span",3),p.YNc(10,j,2,2,"span",3),p.YNc(11,H,2,2,"span",3),p.qZA(),p.TgZ(12,"mat-icon"),p._uU(13,"date_range"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(14,"div",10),p.TgZ(15,"mat-form-field"),p.TgZ(16,"input",11),p.NdJ("focus",function(){return p.CHM(e),p.MAs(19).open()})("dateChange",function(t){return p.CHM(e),p.oxw(2).onDateChange(t)})("dateInput",function(t){return p.CHM(e),p.oxw(2).onDateChange(t)}),p.qZA(),p._UZ(17,"mat-datepicker-toggle",12),p._UZ(18,"mat-datepicker",null,13),p.qZA(),p.qZA(),p.TgZ(20,"mat-action-row"),p.TgZ(21,"button",14),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).nextStep()}),p.TgZ(22,"mat-icon"),p._uU(23,"arrow_downward"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.YNc(24,G,18,5,"mat-expansion-panel",15),p.TgZ(25,"mat-expansion-panel",8),p.NdJ("opened",function(){return p.CHM(e),p.oxw(2).setStep(2)}),p.TgZ(26,"mat-expansion-panel-header"),p.TgZ(27,"mat-panel-title"),p._uU(28),p.qZA(),p.TgZ(29,"mat-panel-description",9),p.YNc(30,W,2,0,"mat-icon",16),p.YNc(31,K,2,0,"mat-icon",17),p.TgZ(32,"mat-icon"),p._uU(33,"local_hospital"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(34,"div"),p.YNc(35,ne,2,1,"div",3),p.qZA(),p.TgZ(36,"div",18),p.NdJ("click",function(t){return p.CHM(e),p.oxw(2).testFirst(t)}),p.TgZ(37,"div"),p.TgZ(38,"mat-chip-list",19),p.YNc(39,ie,4,3,"mat-chip",20),p.qZA(),p.TgZ(40,"mat-form-field",21),p.TgZ(41,"mat-label"),p._uU(42),p.qZA(),p.TgZ(43,"input",22),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw(2).item.note_health=t})("input",function(t){return p.CHM(e),p.oxw(2).onChangeGroup(t.target.value)}),p.qZA(),p.TgZ(44,"mat-autocomplete",23,24),p.NdJ("optionSelected",function(t){return p.CHM(e),p.oxw(2).addDisease(t.option.value)}),p.YNc(46,re,2,2,"mat-option",25),p.ALo(47,"async"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(48,"mat-form-field",26),p.TgZ(49,"input",27),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw(2).validNo(t)})("ngModelChange",function(t){return p.CHM(e),p.oxw(2).item.weight=t})("ngModelChange",function(t){p.CHM(e);const n=p.oxw(2);return n.onChangeGroup("health"),n.convertLoss(t,n.item.loss,n.lossWeight)}),p.qZA(),p.qZA(),p.TgZ(50,"mat-form-field",21),p.TgZ(51,"input",28),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw(2).validNo(t)})("ngModelChange",function(t){return p.CHM(e),p.oxw(2).item.loss=t})("change",function(){return p.CHM(e),p.oxw(2).onChangeGroup("health")})("ngModelChange",function(t){p.CHM(e);const n=p.oxw(2);return n.heheWhy(n.item.weight,t)}),p.qZA(),p.qZA(),p.TgZ(52,"mat-form-field",26),p.TgZ(53,"input",29),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw(2).validNo(t)})("ngModelChange",function(t){return p.CHM(e),p.oxw(2).lossWeight=t})("ngModelChange",function(t){p.CHM(e);const n=p.oxw(2);return n.convertLossKg(n.item.weight,t)}),p.qZA(),p.qZA(),p.qZA(),p.TgZ(54,"mat-action-row"),p.TgZ(55,"button",30),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).prevStep()}),p.TgZ(56,"mat-icon"),p._uU(57,"arrow_upward"),p.qZA(),p.qZA(),p.TgZ(58,"button",14),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).nextStep()}),p.TgZ(59,"mat-icon"),p._uU(60,"arrow_downward"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(61,"mat-expansion-panel",8),p.NdJ("opened",function(){return p.CHM(e),p.oxw(2).setStep(3)}),p.TgZ(62,"mat-expansion-panel-header"),p.TgZ(63,"mat-panel-title"),p._uU(64),p.qZA(),p.YNc(65,se,4,2,"mat-panel-description",31),p.YNc(66,oe,4,2,"mat-panel-description",31),p.qZA(),p.TgZ(67,"div",32),p.TgZ(68,"table",33),p.YNc(69,ue,17,10,"tr",34),p.qZA(),p.qZA(),p.TgZ(70,"mat-action-row"),p.TgZ(71,"button",30),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).addRowEnviro()}),p.TgZ(72,"mat-icon"),p._uU(73,"add_circle_outline"),p.qZA(),p.qZA(),p.TgZ(74,"button",30),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).prevStep()}),p.TgZ(75,"mat-icon"),p._uU(76,"arrow_upward"),p.qZA(),p.qZA(),p.TgZ(77,"button",14),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).nextStep()}),p.TgZ(78,"mat-icon"),p._uU(79,"arrow_downward"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(80,"mat-expansion-panel",8),p.NdJ("opened",function(){return p.CHM(e),p.oxw(2).setStep(4)}),p.TgZ(81,"mat-expansion-panel-header"),p.TgZ(82,"mat-panel-title"),p._uU(83),p.qZA(),p.TgZ(84,"mat-panel-description",9),p._uU(85),p.TgZ(86,"mat-icon"),p._uU(87,"scatter_plot"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(88,"mat-list"),p.YNc(89,_e,19,6,"div",35),p.qZA(),p.TgZ(90,"mat-action-row"),p.TgZ(91,"button",30),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).prevStep()}),p.TgZ(92,"mat-icon"),p._uU(93,"arrow_upward"),p.qZA(),p.qZA(),p.TgZ(94,"button",14),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).nextStep()}),p.TgZ(95,"mat-icon"),p._uU(96,"arrow_downward"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(97,"mat-expansion-panel",8),p.NdJ("opened",function(){return p.CHM(e),p.oxw(2).setStep(5)}),p.TgZ(98,"mat-expansion-panel-header"),p.TgZ(99,"mat-panel-title"),p._uU(100),p.qZA(),p.TgZ(101,"mat-panel-description",9),p.YNc(102,Te,2,0,"mat-icon",36),p.YNc(103,xe,2,0,"mat-icon",37),p.TgZ(104,"mat-icon"),p._uU(105,"note"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(106,"div",38),p.TgZ(107,"mat-form-field",21),p.TgZ(108,"input",39),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw(2).validNo(t)})("ngModelChange",function(t){return p.CHM(e),p.oxw(2).item.income=t})("change",function(){return p.CHM(e),p.oxw(2).onChangeGroup("note")}),p.qZA(),p.qZA(),p.TgZ(109,"mat-form-field",26),p.TgZ(110,"input",39),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw(2).validNo(t)})("ngModelChange",function(t){return p.CHM(e),p.oxw(2).item.cost_other=t})("change",function(){return p.CHM(e),p.oxw(2).onChangeGroup("note")}),p.qZA(),p.qZA(),p.qZA(),p.TgZ(111,"div"),p.TgZ(112,"mat-form-field",40),p.TgZ(113,"textarea",41),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw(2).item.note_general=t})("change",function(){return p.CHM(e),p.oxw(2).onChangeGroup("note")}),p.qZA(),p.qZA(),p.qZA(),p.TgZ(114,"mat-action-row"),p.TgZ(115,"button",30),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).prevStep()}),p.TgZ(116,"mat-icon"),p._uU(117,"arrow_upward"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=p.MAs(19),t=p.MAs(45),n=p.oxw().$implicit,i=p.oxw();p.xp6(1),p.Q6J("expanded",0===i.step),p.xp6(3),p.hij(" ",n("TITLE")," "),p.xp6(3),p.hij(" ",p.xi3(8,53,i.dateForm.value,"d-M-YYYY")," "),p.xp6(2),p.Q6J("ngIf",0==i.dateAgo),p.xp6(1),p.Q6J("ngIf",1==i.dateAgo),p.xp6(1),p.Q6J("ngIf",i.dateAgo>1),p.xp6(3),p.Q6J("formGroup",i.form),p.xp6(2),p.Q6J("placeholder",n("DATE_RECORD"))("matDatepicker",e)("min",i.minDate)("max",i.maxDate),p.xp6(1),p.Q6J("for",e),p.xp6(7),p.Q6J("ngIf",null==i.pondService.trackingObjects?null:i.pondService.trackingObjects.length),p.xp6(1),p.Q6J("expanded",2===i.step),p.xp6(3),p.hij(" ",n("HEALTH")," "),p.xp6(2),p.Q6J("ngIf",i.pondService.currentDiseaseCount>0),p.xp6(1),p.Q6J("ngIf",0==i.pondService.currentDiseaseCount),p.xp6(4),p.Q6J("ngIf",(null==i.pondService.dailyDisease?null:i.pondService.dailyDisease.length)>0),p.xp6(4),p.Q6J("ngForOf",i.chosenDisease),p.xp6(3),p.Oqu(n("HEALTH_NOTE")),p.xp6(1),p.Q6J("placeholder",n("HEALTH_NOTE"))("ngModel",i.item.note_health)("value",i.item.note_health)("matAutocomplete",t),p.xp6(3),p.Q6J("ngForOf",p.lcZ(47,56,i.showingDiseaseList)),p.xp6(3),p.Q6J("placeholder",n("WEIGHT"))("ngModel",i.item.weight)("value",i.item.weight),p.xp6(2),p.Q6J("placeholder",n("LOSS_PIECE"))("ngModel",i.item.loss),p.xp6(2),p.Q6J("placeholder",n("LOSS_KG"))("ngModel",i.lossWeight),p.xp6(8),p.Q6J("expanded",3===i.step),p.xp6(3),p.hij(" ",n("CHEM_TREATMENT")," "),p.xp6(1),p.Q6J("ngIf",i.item.environment&&1==i.item.enviroment.length),p.xp6(1),p.Q6J("ngIf",i.item.environment&&i.item.enviroment.length>=1),p.xp6(3),p.Q6J("ngForOf",i.item.enviroment),p.xp6(11),p.Q6J("expanded",4===i.step),p.xp6(3),p.hij(" ",n("FEED")," "),p.xp6(2),p.hij(" ",i.quantityFeed," kg "),p.xp6(4),p.Q6J("ngForOf",i.repast),p.xp6(8),p.Q6J("expanded",5===i.step),p.xp6(3),p.hij(" ",n("NOTE")," "),p.xp6(2),p.Q6J("ngIf",!i.formGroupStatus.note),p.xp6(1),p.Q6J("ngIf",i.formGroupStatus.note),p.xp6(5),p.Q6J("placeholder",n("OTHER_INCOME"))("options",p.DdM(58,we))("ngModel",i.item.income),p.xp6(2),p.Q6J("placeholder",n("OTHER_COSTS"))("options",p.DdM(59,we))("ngModel",i.item.cost_other),p.xp6(3),p.Q6J("placeholder",n("NOTE"))("ngModel",i.item.note_general)}}function Ze(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.YNc(2,Q,1,0,"mat-progress-bar",2),p.YNc(3,be,118,60,"mat-accordion",3),p.TgZ(4,"div",4),p.TgZ(5,"button",5),p.NdJ("click",function(){return p.CHM(e),p.oxw().onSave()}),p._uU(6),p.qZA(),p.TgZ(7,"a",6),p._uU(8),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.oxw();p.xp6(2),p.Q6J("ngIf",n.saveLoading.pending),p.xp6(1),p.Q6J("ngIf",n.pondService.products&&n.item),p.xp6(2),p.Q6J("disabled",!n.form.valid),p.xp6(1),p.Oqu(e("SAVE")),p.xp6(1),p.MGl("routerLink","/pond/",n.pondService.pcode,""),p.xp6(1),p.Oqu(e("CANCEL"))}}let Ae=(()=>{class e{constructor(e,t,n,i,r,s,l,u){this.reqAPIService=e,this.dialog=t,this.pondService=n,this.alertService=i,this.router=r,this._fuseConfirmationService=s,this._translate=l,this.storeService=u,this.indexSelected=0,this.lossWeight=0,this.dataRaw=[],this.quantityFeed=0,this.repast=[],this.feed=[],this.blend=[],this.feedTotal=0,this.chosenDisease=[],this.replaceTerm="",this.form=new o.cw({date:new o.NI(c()(),o.kI.required)}),this.ipBlend="",this.dateAgo=0,this.maxDate=c()(),this.formGroupStatus={param:!1,enviro:!1,health:!1,feed:!1,note:!1},this.saveLoading=new a.E,this.checkUnit=localStorage.getItem("unit"),this.isDisablel=!0,this.step=1,this.tagLoss=!0}ngOnInit(){this.dateForm=new o.NI(c()()),console.log(this.pondService.pcode),this.pondService.loadSeason().pipe().subscribe(e=>{e.start_season&&(this.pondService.dailyData=e.data_chart_eviro.map(e=>{let t=e.date.split("/");return e.dateIso=new Date(t[2]+"-"+t[1]+"-"+t[0]),e}),console.log(this.pondService.dailyData),this.pondService.setTracking(e.data_season.tracking_factor,e.data_season.feed_no),this.prepareData())}),this.pondService.loadProducts(),this.getListStore(),this.getTotalQuantityFeed(),this.getMindate()}getMindate(){this.pondService.getHistory().pipe().subscribe(e=>{console.log(e.data),this.minDate=c()(1e3*e.data[0].start_time).format("YYYY-MM-DD"),console.log(this.minDate)})}fetchStoreDetail(){return this.reqAPIService.get(this.storeService._urlApiWareHouse+"?wcode="+this.listStore[0].code+"&action=get").pipe().subscribe(e=>{0==e.status?alert("loi fetchStoreDetail"):(this.listQuantityCurrent=e.data.list,console.log("data of FetchDetail",e.data.list))},e=>{console.log("error after subscribe")})}getTotalQuantityFeed(){this.pondService.loadDailyPaging({pageIndex:0,pageSize:90},c()(this.maxDate).format("YYYY-MM-DD")).subscribe(e=>{e.data&&(this.dataRaw=e.data,this.quantityFeed=this.dataRaw[0].feed_incremental)})}getListStore(){this.storeService.getApiStore("get-list-avaiable","&pcode="+this.pondService.pcode,"manager/pond-store-api").pipe().subscribe(e=>{(e.status=0)||(console.log("data",e),this.listStore=e.data,this.fetchStoreDetail())},()=>{this.alertService.error(this._translate.translate("hoho"))})}validNo(e){const t=e.which?e.which:e.keycode;return!(t>31&&(t<48||t>57))}validNoI(e,t){this.isDisablel=!(e.target.value>t.max||e.target.value<t.min);const n=e.which?e.which:e.keycode;return!(n>31&&(n<46||n>57))}prepareData(){this.item=this.pondService.dailyData&&this.pondService.dailyData.length>0&&this.form.value.date.format("YYYY-MM-DD")===this.pondService.dailyData[0].date?this.pondService.dailyData[0]:this.pondService.createNotExistDay(),void 0===this.item.enviroment&&(this.item.enviroment=[]),0==this.item.enviroment.length&&this.addRowEnviro(),console.log(this.item),this.lossWeight=this.item.loss*(this.item.weight/1e3),this.processGroupRepast()}setStep(e){this.step=e}nextStep(){this.step++}prevStep(){this.step--}onDateChange(e){console.log(c()(e.value).format("YYYY-MM-DD")),this.dateForm.setValue(c()(e.value));let t=this.dataRaw.filter(t=>t.date==c()(e.value).format("YYYY-MM-DD"));if(null!=t[0])console.log(t),this.quantityFeed=t[0].feed_incremental,console.log(this.quantityFeed);else{const t=this.dataRaw.filter(t=>t.date<=c()(e.value).format("YYYY-MM-DD"));console.log("Date of arr thisdateeow",t),console.log(this.quantityFeed),this.quantityFeed=0==t.length?0:t[0].feed_incremental}this.dateAgo=Math.floor(Math.abs((new Date(e.value).valueOf()-this.maxDate.valueOf())/864e5)),this.pondService.dailyData.length>0&&c()(this.pondService.dailyData[this.pondService.dailyData.length-1].date).isBefore(e.value)?(this.item=this.pondService.dailyData.find(t=>t.date===c()(e.value).format("YYYY-MM-DD")),void 0===this.item&&(this.item=this.pondService.createNotExistDay(c()(e.value).format("YYYY-MM-DD"))),void 0===this.item.enviroment&&(this.item.enviroment=[]),0==this.item.enviroment.length&&this.addRowEnviro(),this.processGroupRepast()):(this.saveLoading.setPending(!0),this.pondService.loadDailyDetail(c()(e.value).format("YYYY-MM-DD")).subscribe(t=>{this.item=1==t.status?t.data:this.pondService.createNotExistDay(c()(e.value).format("YYYY-MM-DD")),void 0===this.item&&(this.item=this.pondService.createNotExistDay(c()(e.value).format("YYYY-MM-DD"))),void 0===this.item.enviroment&&(this.item.enviroment=[]),0==this.item.enviroment.length&&this.addRowEnviro(),this.processGroupRepast(),this.saveLoading.setResult(!0)},()=>{this.saveLoading.setResult(!1),this.alertService.error(this._translate.translate("CONNECT_ERROR"))}))}processGroupRepast(){this.repast=[],this.blend=[],this.feed=[];for(let e=1;e<=this.pondService.numRepast;e++)this.repast.push([]),this.feed.push([]),this.blend.push([]);this.item.feed&&this.item.feed.forEach(e=>{e.type=1,this.feed[e.times-1].push(e)}),this.item.blend&&this.item.blend.forEach(e=>{this.blend[e.times-1].push(this.setValueUnit({pond_daily_id:e.pond_daily_id,product_id:e.product_id,product_name:e.product_name,quantity:e.quantity,unit:e.unit,wcode:e.wcode,type:2}))}),this.onChangeFeed()}convertSaveBlend(e){let t;return t="g"==this.checkUnit,t?(e.unit="kg",e.quantity=e.quantity/1e3):(e.unit="kg",e.quantity=e.quantity),e}setValueUnit(e){let t;return t="g"==this.checkUnit,t?(console.log("show item",e),"kg"==e.unit?(e.unit="g",e.quantity=1e3*e.quantity):"lit"==e.unit&&(e.unit="ml",e.quantity=1e3*e.quantity)):"g"==e.unit&&(e.unit="kg",e.quantity=e.quantity/1e3),e}getIndex(e){console.log("blend",this.blend[e]),console.log(e)}addRowEnviro(){if(this.item.enviroment.length>6)return this.alertService.error(this._translate.translate("POND.UPDATE.ROW_LIMIT")),!1;this.item.enviroment.push({product_id:null,product_name:null,quantity:null}),console.log("enviroment of addRowEviro",this.item.enviroment)}removeRowEnviro(e){this.item.enviroment.splice(e,1)}addRowFeed(e){if(this.feed[e].length>2)return this.alertService.error(this._translate.translate("POND.UPDATE.ROW_LIMIT")),!1;this.feed[e].push({product_id:null,product_name:null,quantity:null})}removeRowFeed(e,t){if(0==t)return this.feed[e][0].quantity=0,this.onChangeFeed(),!1;this.feed[e].splice(t,1),this.onChangeFeed()}addRowBlend(e){this.blend[e].length<5?this.blend[e].push({product_id:null,product_name:null,quantity:null}):this.alertService.error(this._translate.translate("POND.UPDATE.ROW_LIMIT"))}removeRowBlend(e,t){if(0==t)return this.blend[e][0].quantity=0,!1;this.blend[e].splice(t,1)}onChangeFeed(e){this.feedTotal=0,this.feed.map(e=>{e.map(e=>{e.quantity&&(this.feedTotal=this.feedTotal+parseInt(e.quantity))})})}onChangeGroup(e){var t=this;return(0,s.Z)(function*(){t.showingDiseaseList=(0,u.of)([]);let n=e.split(" "),i=n[n.length-1];i.length>=2&&(yield t.delay(300),t.showingDiseaseList=t.pondService.getListDisease(i).pipe(e=>e))})()}delay(e){return new Promise(t=>setTimeout(t,e))}addDisease(e){this.showingDiseaseList.subscribe(t=>{t.forEach(t=>{t.id==e&&0==this.chosenDisease.fill(t=>t.id===e).length&&this.chosenDisease.push(t)})})}removeDisease(e){this.chosenDisease.splice(e,1)}testFirst(e){null!=e.target.value&&"mat-input-1"!=e.target.id&&"mat-input-2"!=e.target.id&&("mat-input-3"!=e.target.id&&(this.tagLoss=!0),"mat-input-4"!=e.target.id&&(this.tagLoss=!1))}convertLoss(e,t,n){this.tagLoss?e>0&&(console.log("false",n),this.item.loss=Math.ceil(n/(e/1e3))):e>0&&(this.lossWeight=t*(e/1e3))}convertLossKg(e,t){e>0&&(this.item.loss=Math.ceil(t/(e/1e3)))}heheWhy(e,t){e>0&&(this.lossWeight=t*(e/1e3))}onSave(){if(this.isDisablel){console.log(this.isDisablel),this.saveLoading.setPending(!0);let e=[];this.item.enviroment.forEach(t=>{t.quantity>0&&e.push({wcode:t.wcode,kind:t.product_id,quantity:t.quantity})});let t={};this.pondService.trackingObjects.forEach(e=>{t[e.key]=this.item[e.key]});let n={};this.repast.forEach((e,t)=>{n[t]={feeds:this.feed[t].map(e=>({wcode:e.wcode,kind:e.product_id,quantity:e.quantity,unit:e.unit})),blends:this.blend[t].map(e=>({wcode:(e=this.convertSaveBlend(e)).wcode,kind:e.product_id,quantity:e.quantity,unit:e.unit}))}});let i={date:this.item.date,parameter:t,heath:{weight:this.item.weight,loss:this.item.loss,desease:this.item.note_health},cost_other:parseInt(this.item.cost_other),income:parseInt(this.item.income),note_general:this.item.note_general,enviro:e,repast:n};this.chosenDisease.length>0&&this.pondService.updateHealth({date:this.item.date,heath:{disease:this.chosenDisease,weight:this.item.weight,loss:this.item.loss,desease:this.item.note_health}}).subscribe(e=>{"success"==e.status?(this.saveLoading.setResult(!0),this.pondService.reloadSeason$.next(1),this.pondService.onLoaded$.next(this.pondService.counterLoad)):(this.alertService.error(e.message),this.saveLoading.setResult(!1))},()=>{this.alertService.error(this._translate.translate("UPDATE_UNSUCESSFUL"))}),this.pondService.fullUpdate(i).subscribe(e=>{"success"==e.status?(this.alertService.success(this._translate.translate("UPDATE_SUCCESS")),this.saveLoading.setResult(!0),this.router.navigate(["/pond/"+this.pondService.pcode])):(this.alertService.error(e.message),this.saveLoading.setResult(!1))},()=>{this.alertService.error(this._translate.translate("UPDATE_UNSUCESSFUL"))})}else this.alertService.error(this._translate.translate("Error"))}processDisease(e,t){console.log(t),this.dialog.open(M,{width:"250px",data:{disease_id:t.disease_id,name:t.disease_name,bigData:t}}).afterClosed().subscribe(t=>{t&&this.pondService.saveProcessDisease(t).subscribe(t=>{1==t.status?(this.alertService.success(this._translate.translate("POND.UPDATE.PROCESS_SUCCESS")),this.pondService.dailyDisease.splice(e,1)):this.alertService.error(t.error)},()=>{this.alertService.error(this._translate.translate("CONNECT_ERROR"))})})}deleteDisease(e,t){this._fuseConfirmationService.open({title:this._translate.translate("WARNING"),message:this._translate.translate("POND.UPDATE.CONFIRM_DISEASE_DELETE")}).afterClosed().subscribe(n=>{n&&"confirmed"==n&&this.pondService.saveProcessDisease({type_action:0,action_del:"all",disease_id:t.disease_id}).subscribe(t=>{1==t.status?(this.alertService.success(this._translate.translate("POND.UPDATE.DISEASE_DELETED")),this.pondService.dailyDisease.splice(e,1)):this.alertService.error(t.error)},()=>{this.alertService.error(this._translate.translate("CONNECT_ERROR"))})})}moveCaretToEnd(e){var t=e.target,n=t.value.length;if(n)if(t.setSelectionRange)t.focus(),t.setSelectionRange(n,n);else if(t.createTextRange){var i=t.createTextRange();i.collapse(!0),i.moveEnd("character",n),i.moveStart("character",n),i.select()}}convertNameParam(e){let t="";switch(e.toUpperCase()){case"PH_AM":t=this._translate.translate("POND.MORNING_PH");break;case"PH_PM":t=this._translate.translate("POND.NOON_PH");break;case"OXYGEN":t="DO";break;case"TEMPERATURE":t=this._translate.translate("POND.TEMP");break;case"NH3":t="NH3";break;case"NO2":t="NO2";break;case"SALINITY":t=this._translate.translate("POND.SALINITY");break;case"KH":t=this._translate.translate("POND.ALKALINITY");break;case"CLARITY":t=this._translate.translate("POND.CLARITY");break;case"VIBRIO":t="Vibrio";break;case"MAGIESIUM":t=this._translate.translate("POND.MAGNESIUM");break;case"CALCIUM":t=this._translate.translate("POND.CALCIUM");break;case"HYDRO_SULFUA":t="H2S";break;case"ORP":t="ORP";break;case"ALGAE":t=this._translate.translate("POND.ALGAE")}return t}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(U.$),p.Y36(d.uw),p.Y36(m.p),p.Y36(f.c),p.Y36(r.F0),p.Y36(P.R),p.Y36(g.Vn),p.Y36(F.d))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-daily-update"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"w-full"],["mode","indeterminate",4,"ngIf"],[4,"ngIf"],[1,"text-right","py-12"],["mat-flat-button","","color","primary",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",1,"btn-mr",3,"routerLink"],["mode","indeterminate"],["hideToggle","true",3,"expanded","opened"],[1,"justify-between"],[1,"flex","items-center","justify-center",3,"formGroup"],["matInput","","formControlName","date",1,"pointer-events-none",3,"placeholder","matDatepicker","min","max","focus","dateChange","dateInput"],["matSuffix","",3,"for"],["datePicker",""],["mat-icon-button","","color","primary",3,"click"],["hideToggle","true",3,"expanded","opened",4,"ngIf"],["color","text-secondary","class","secondary-text",4,"ngIf"],["class","text-green-400",4,"ngIf"],[1,"grid","grid-cols-2",3,"click"],["aria-label","suggested disease"],["color","accent",3,"selectable","removable","removed",4,"ngFor","ngForOf"],["appearance","legacy",1,"w-full","md:pr-2"],["matInput","",3,"placeholder","ngModel","value","matAutocomplete","ngModelChange","input"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["appearance","legacy"],["min","0","type","number","matInput","",3,"placeholder","ngModel","value","keypress","ngModelChange"],["min","0","type","number","matInput","",3,"placeholder","ngModel","keypress","ngModelChange","change"],["min","0","matInput","","type","number",3,"placeholder","ngModel","keypress","ngModelChange"],["mat-icon-button","",3,"click"],["class","justify-between",4,"ngIf"],[1,"text-center"],[1,"tb-product"],[4,"ngFor","ngForOf"],["class","text-center",4,"ngFor","ngForOf"],["class","secondary-text",4,"ngIf"],["class","green-fg",4,"ngIf"],[1,"grid","grid-cols-2"],["matInput","","currencyMask","",3,"placeholder","options","ngModel","keypress","ngModelChange","change"],["appearance","legacy",1,"w-full"],["matInput","",3,"placeholder","ngModel","ngModelChange","change"],["class","text-secondary",4,"ngIf"],[1,"grid","md:grid-cols-4","sm:grid-cols-2"],[1,"text-secondary"],[1,"text-green-400"],["type","number","matInput","",3,"min","max","placeholder","ngModel","value","focusout","keyup","ngModelChange","change"],["color","text-secondary",1,"secondary-text"],["style","align-items: center;",4,"ngFor","ngForOf"],[2,"align-items","center"],["style","color: green; margin-bottom: 10px;","class","justify-start",4,"ngIf"],["class","flex justify-between items-center","style","margin-bottom: 10px;",4,"ngIf"],[1,"justify-start",2,"color","green","margin-bottom","10px"],[1,"flex","justify-between","items-center",2,"margin-bottom","10px"],[2,"align-self","center","color","red"],[1,"flex","justify-start","items-center"],["mat-stroked-button","","color","primary",2,"border-radius","10px","line-height","25px","margin-right","5px",3,"click"],["mat-stroked-button","","color","warn",2,"border-radius","10px","line-height","25px",3,"click"],["color","accent",3,"selectable","removable","removed"],["matChipRemove",""],[3,"value"],[1,"p-1"],["appearance","legacy",1,"fw-product-name"],[3,"placeholder","ngModel","ngModelChange"],["select",""],["matInput","","min","0","type","number",3,"placeholder","ngModel","keypress","ngModelChange"],["mat-icon-button","","color","warn",3,"matTooltip","click"],[3,"aria-label"],[3,"value",4,"ngIf"],[1,"flex","justify-between","items-center"],[1,"font-size-24","px-5","indigo-fg"],["mat-button","",1,"grey-fg",3,"click"],["matInput","","type","number","step","any",3,"placeholder","ngModel","value","ngModelChange","change"],["mat-icon-button","","color","warn",3,"click"],["matInput","","min","0","type","number","step","any",3,"placeholder","value","ngModel","keyup","click","ngModelChange","change"],[1,"secondary-text"],[1,"green-fg"]],template:function(e,t){1&e&&p.YNc(0,Ze,9,6,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.UPDATE")},directives:[g.KI,i.O5,v.lW,v.zs,r.yS,I.pW,L.pp,L.ib,L.yz,L.yK,L.u4,y.Hw,o.JL,o.sg,_.KE,T.Nt,o.Fj,x.hl,o.JJ,o.u,x.nW,_.R9,x.Mq,L.VG,b.qn,i.sg,_.hX,w.ZL,o.On,w.XC,o.qQ,o.wV,J.i$,o.Fd,b.HS,b.qH,A.ey,Z.gD,Y.gM],pipes:[i.uU,i.Ov],styles:["mat-panel-description[_ngcontent-%COMP%]{max-width:50%}.tb-product[_ngcontent-%COMP%]{margin:0 auto}.fw-product-name[_ngcontent-%COMP%]{min-width:200px}.select-blend[_ngcontent-%COMP%]{color:aqua}"]}),e})();var Ie=n(37296),Se=n(92340),Ee=n(26215);let qe=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-daily-disease"]],decls:2,vars:0,template:function(e,t){1&e&&(p.TgZ(0,"p"),p._uU(1,"daily-disease works!"),p.qZA())},styles:[""]}),e})();var Ne=n(84796),Ce=n(13994);function De(e,t){1&e&&p._UZ(0,"mat-progress-bar",21)}function Re(e,t){1&e&&p._UZ(0,"mat-progress-bar",21)}function Oe(e,t){if(1&e&&(p.TgZ(0,"fuse-alert",22),p._UZ(1,"mat-icon",23),p._uU(2),p.qZA()),2&e){const e=p.oxw().$implicit,t=p.oxw();p.Q6J("appearance","soft")("type","info"),p.xp6(1),p.Q6J("svgIcon","heroicons_solid:light-bulb"),p.xp6(1),p.AsE(" ",e("POND.FEED_UPDATE.EXPECTED")," ",null==t.inforloadExpectedDaily?null:t.inforloadExpectedDaily.for_calendar.value_check,"kg ")}}function ke(e,t){if(1&e&&(p.ynx(0),p.TgZ(1,"mat-option",32),p._uU(2),p.qZA(),p.BQk()),2&e){const e=t.$implicit;p.xp6(1),p.Q6J("value",e.code),p.xp6(1),p.hij("",e.name," ")}}function Me(e,t){if(1&e&&(p.ynx(0),p.TgZ(1,"mat-option",32),p._uU(2),p.qZA(),p.BQk()),2&e){const e=t.$implicit;p.xp6(1),p.Q6J("value",e.id),p.xp6(1),p.AsE("",e.name," (",e.unit,") ")}}function Ue(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div",24),p.TgZ(1,"mat-form-field",25),p.TgZ(2,"mat-select",26),p.NdJ("ngModelChange",function(t){return p.CHM(e).$implicit.wcode=t})("selectionChange",function(t){const n=p.CHM(e).index;return p.oxw(2).changeStore(t.value,n)}),p.YNc(3,ke,3,2,"ng-container",27),p.qZA(),p.qZA(),p.TgZ(4,"mat-form-field",25),p.TgZ(5,"mat-select",28),p.NdJ("ngModelChange",function(t){return p.CHM(e).$implicit.product_id=t}),p.YNc(6,Me,3,3,"ng-container",27),p.qZA(),p.qZA(),p.TgZ(7,"mat-form-field",25),p.TgZ(8,"input",29),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw(2).validNo(t)})("ngModelChange",function(t){return p.CHM(e).$implicit.quantity=t}),p.qZA(),p.qZA(),p.TgZ(9,"button",30),p.NdJ("click",function(){const t=p.CHM(e).index;return p.oxw(2).removeRow(t)}),p._UZ(10,"mat-icon",31),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.oxw().$implicit,i=p.oxw();p.xp6(2),p.Q6J("placeholder",n("WAREHOUSE"))("ngModel",e.wcode),p.xp6(1),p.Q6J("ngForOf",i.listStore),p.xp6(2),p.Q6J("placeholder",n("PRODUCT"))("ngModel",e.product_id),p.xp6(1),p.Q6J("ngForOf",i.listProduct[e.wcode]),p.xp6(2),p.Q6J("ngModel",e.quantity)("placeholder",n("ENTER_AMOUNT"))}}function Pe(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.YNc(8,De,1,0,"mat-progress-bar",7),p.YNc(9,Re,1,0,"mat-progress-bar",7),p.TgZ(10,"div",8),p.TgZ(11,"mat-form-field",9),p.TgZ(12,"mat-label"),p._uU(13),p.qZA(),p.TgZ(14,"input",10),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw().dateRangeSelected=t})("dateChange",function(t){return p.CHM(e),p.oxw().onChangeDate(t)}),p.qZA(),p._UZ(15,"mat-datepicker-toggle",11),p._UZ(16,"mat-datepicker",null,12),p.qZA(),p.YNc(18,Oe,3,5,"fuse-alert",13),p.qZA(),p.TgZ(19,"div"),p.YNc(20,Ue,11,8,"div",14),p.qZA(),p.TgZ(21,"div",15),p.TgZ(22,"button",16),p.NdJ("click",function(){return p.CHM(e),p.oxw().addRow()}),p._UZ(23,"mat-icon",17),p._uU(24),p.qZA(),p.qZA(),p.qZA(),p.TgZ(25,"div",18),p.TgZ(26,"button",19),p.NdJ("click",function(){return p.CHM(e),p.oxw().save()}),p._uU(27),p.qZA(),p.TgZ(28,"button",20),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(29),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(17),i=p.oxw();p.xp6(4),p.Oqu(e("TITLE")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(2),p.Q6J("ngIf",i.loadingFlag.pending),p.xp6(1),p.Q6J("ngIf",i.savingFlag.pending),p.xp6(4),p.Oqu(e("DATE")),p.xp6(1),p.Q6J("max",i.maxDate.toDate())("matDatepicker",n)("ngModel",i.dateRangeSelected),p.xp6(1),p.Q6J("for",n),p.xp6(3),p.Q6J("ngIf",i.inforloadExpectedDaily&&i.inforloadExpectedDaily.for_calendar),p.xp6(2),p.Q6J("ngForOf",i.enviro),p.xp6(2),p.Q6J("disabled",i.enviro.length>=7),p.xp6(2),p.hij(" ",e("ADD")," "),p.xp6(3),p.hij(" ",e("SAVE")," "),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let Fe=(()=>{class e{constructor(e,t,n,i,r,s,o){this.pondService=e,this.alertService=t,this.dialogRef=n,this.data=i,this._translate=r,this.calendarService=s,this.storeService=o,this.loadingFlag=new a.E,this.savingFlag=new a.E,this.dateRangeSelected=c()().format("YYYY-MM-DD"),this.maxDate=c()(),this.minDate=c()().subtract(180,"days"),this.enviro=[],this.dataRaw=[],this.listProduct={},this.listStore=[],this.itemRemind="",this.disabledForm=!1}ngOnInit(){var e=this;return(0,s.Z)(function*(){e.item=e.data.item,e.minDate<e.pondService.seasonStartTime&&(e.minDate=e.pondService.seasonStartTime),e.item.date==e.dateRangeSelected&&(e.itemSelected=e.item),yield e.loadStore(),e.processData(),null==e.pondService.products&&e.pondService.loadProducts(),e.loadExpectedDaily()})()}loadExpectedDaily(){console.log(c()(this.dateRangeSelected).valueOf()/1e3),this.calendarService.getExpectedDaily(this.pondService.pond.current_season,"enviro",c()(this.dateRangeSelected).valueOf()/1e3).subscribe(e=>{1==e.status?this.inforloadExpectedDaily=e.data:this.alertService.error(e.error)},()=>{this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}validNo(e){const t=e.which?e.which:e.keyCode;return!(t>31&&(t<46||t>57))}onChangeDate(e){this.dateRangeSelected=e.value,console.log(e.detail);let t=c()(this.dateRangeSelected);console.log(this.dataRaw.length),this.dataRaw.length>0?(this.itemSelected=this.dataRaw[this.dataRaw.findIndex(e=>e.date==t.format("YYYY-MM-DD"))],console.log(this.itemSelected),this.processData(),(t<c()(this.dataRaw[this.dataRaw.length-1].date)||t>c()(this.dataRaw[0].date))&&this.getData()):this.getData(),this.loadExpectedDaily()}setProduct(e,t){this.pondService.products.findIndex(t=>t.id===e)}changeDate(e){let t=c()(this.dateRangeSelected).add(e,"days");if(t<this.minDate||t>this.maxDate)return!1;this.dateRangeSelected=t.format("YYYY-MM-DD")}addRow(){if(this.enviro.length>10)return this.alertService.warn(this._translate.translate("POND.ENV_UPDATE.LIMIT")),!1;this.enviro.push({wcode:this.wcodeSelected,product_id:null,product_name:null,quantity:null})}removeRow(e){if(0==e)return this.enviro[0].quantity=0,!1;this.enviro.splice(e,1)}getData(){this.loadingFlag.setStart(!0);let e=c()(this.dateRangeSelected).format("YYYY-MM-DD");this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},e).subscribe(t=>{t.data?(this.dataRaw=t.data,this.itemSelected=this.dataRaw[this.dataRaw.findIndex(t=>t.date==e)],this.processData(),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},e=>{this.loadingFlag.setResult(!1),this.alertService.error(e)})}processData(){this.enviro=[],void 0!==this.itemSelected&&this.itemSelected.enviroment?this.itemSelected.enviroment.forEach(e=>{this.enviro.push(e),this.listProduct[e.wcode]&&0!=this.listProduct[e.wcode].length||this.getListProduct(e.wcode)}):this.enviro=[{product_id:null,product_name:null,quantity:null,wcode:this.listStore.length>0?this.listStore[0].code:null}]}save(){this.savingFlag.setPending(!0);let e=[];this.enviro.forEach(t=>{null!==t.product_id&&e.push({kind:t.product_id,quantity:t.quantity.toString().replace(",","."),wcode:t.wcode})});let t={date:c()(this.dateRangeSelected).format("YYYY-MM-DD"),enviro:e};this.pondService.fullUpdate(t).subscribe(e=>{"success"==e.status?(this.alertService.success(this._translate.translate("UPDATE_SUCCESS")),this.savingFlag.setResult(!0),this.dateRangeSelected==this.maxDate.format("YYYY-MM-DD")?this.dialogRef.close(this.enviro):this.dialogRef.close()):(this.alertService.error(e.message),this.savingFlag.setResult(!1))},()=>{this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}changeStore(e,t){var n=this;return(0,s.Z)(function*(){n.wcodeSelected=e,console.log(n.wcodeSelected),n.enviro[t].product_id="",n.enviro[t].product_name="",e&&(yield n.loadStore())})()}loadStore(){var e=this;return(0,s.Z)(function*(){if(e.loadingFlag.setPending(!0),0==e.listStore.length){const t=yield e.storeService.getApiStore("get-list-avaiable","&pcode="+e.pondService.pcode,"manager/pond-store-api").toPromise().catch(()=>{e.alertService.error(e._translate.translate("CONNECT_ERROR"))});1==t.status?e.listStore=t.data:e.alertService.warn(t.error),e.wcodeSelected=e.listStore[0].code,e.listProduct[e.wcodeSelected]=[]}if(!e.listProduct[e.wcodeSelected]||0==e.listProduct[e.wcodeSelected].length){const t=yield e.storeService.getApiStore("get-list-product","&pcode="+e.pondService.pcode+"&wcode="+e.wcodeSelected,"manager/pond-store-api").toPromise().catch(()=>{e.alertService.error(e._translate.translate("CONNECT_ERROR"))});1==t.status?e.listProduct[e.wcodeSelected]=t.data.filter(e=>3==+e.group_id):e.alertService.warn(t.error)}e.loadingFlag.setResult(!0)})()}getListProduct(e){var t=this;return(0,s.Z)(function*(){const n=yield t.storeService.getApiStore("get-list-product","&pcode="+t.pondService.pcode+"&wcode="+e,"manager/pond-store-api").toPromise().catch(()=>{t.alertService.error(t._translate.translate("CONNECT_ERROR"))});1==n.status?t.listProduct[e]=n.data.filter(e=>3==+e.group_id):t.alertService.warn(n.error)})()}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(f.c),p.Y36(d.so),p.Y36(d.WI),p.Y36(g.Vn),p.Y36(Ne.o),p.Y36(F.d))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-daily-enviroment-update"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto"],["mode","indeterminate",4,"ngIf"],[1,"grid","grid-cols-1"],[1,"w-full","p-2"],["matInput","",3,"max","matDatepicker","ngModel","ngModelChange","dateChange"],["matSuffix","",3,"for"],["picker",""],[3,"appearance","type",4,"ngIf"],["class","flex justify-between",4,"ngFor","ngForOf"],[1,"text-center"],["mat-button","","shape","round","fill","outline","size","small","color","primary",3,"disabled","click"],["matPrefix","","svgIcon","mat_solid:add",1,"icon-size-5"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"click"],["mat-stroked-button","",3,"click"],["mode","indeterminate"],[3,"appearance","type"],["fuseAlertIcon","",1,"icon-size-5",3,"svgIcon"],[1,"flex","justify-between"],["appearance","legacy",1,"w-full","m-2"],[3,"placeholder","ngModel","ngModelChange","selectionChange"],[4,"ngFor","ngForOf"],[3,"placeholder","ngModel","ngModelChange"],["matInput","","type","number","min","0","required","",3,"ngModel","placeholder","keypress","ngModelChange"],["mat-icon-button","",1,"text-red-400","m-2",3,"click"],["svgIcon","heroicons_solid:minus-circle",1,"size-icon-5"],[3,"value"]],template:function(e,t){1&e&&p.YNc(0,Pe,30,16,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.ENV_UPDATE")},directives:[g.KI,v.lW,d.ZT,y.Hw,i.O5,_.KE,_.hX,T.Nt,x.hl,o.Fj,o.JJ,o.On,x.nW,_.R9,x.Mq,i.sg,_.qo,I.pW,Ce.W,Z.gD,o.qQ,o.wV,o.Q7,A.ey],styles:[""]}),e})();var Le=n(93104);function Je(e,t){if(1&e&&p._UZ(0,"div",17),2&e){const e=p.oxw(2);p.Q6J("options",e.optionChart)("merge",e.dataUpdate)}}function Ye(e,t){if(1&e&&(p.TgZ(0,"div",18),p.TgZ(1,"span"),p._uU(2),p.qZA(),p.TgZ(3,"span"),p.TgZ(4,"b"),p._uU(5),p.ALo(6,"number"),p.TgZ(7,"small"),p._uU(8,"kg"),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&e){const e=t.$implicit;p.xp6(2),p.AsE("",e.store_name," | ",e.product_name,""),p.xp6(3),p.hij("",p.xi3(6,3,e.quantity,"1.0-3")," ")}}function Qe(e,t){if(1&e&&(p.TgZ(0,"div",18),p.TgZ(1,"span"),p._uU(2),p.qZA(),p.TgZ(3,"span",19),p.TgZ(4,"b"),p._uU(5),p.TgZ(6,"small"),p._uU(7,"kg"),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&e){const e=p.oxw().$implicit,t=p.oxw();p.xp6(2),p.Oqu(e("EXPECTED")),p.xp6(3),p.hij("",null==t.inforloadExpectedDaily?null:t.inforloadExpectedDaily.for_calendar.value_check," ")}}function Ve(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.TgZ(8,"mat-form-field",7),p.TgZ(9,"mat-label"),p._uU(10),p.qZA(),p.TgZ(11,"input",8),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw().dateRangeSelected=t})("dateChange",function(t){return p.CHM(e),p.oxw().onChangeDate(t)}),p.qZA(),p._UZ(12,"mat-datepicker-toggle",9),p._UZ(13,"mat-datepicker",null,10),p.qZA(),p.TgZ(15,"div",11),p.YNc(16,Je,1,2,"div",12),p.TgZ(17,"div",13),p.TgZ(18,"div",14),p.YNc(19,Ye,9,6,"div",15),p.YNc(20,Qe,8,2,"div",16),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(14),i=p.oxw();p.xp6(4),p.Oqu(e("TITLE")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(4),p.Oqu(e("DATE")),p.xp6(1),p.Q6J("min",i.minDate)("max",i.maxDate.toDate())("matDatepicker",n)("ngModel",i.dateRangeSelected),p.xp6(1),p.Q6J("for",n),p.xp6(4),p.Q6J("ngIf",i.show),p.xp6(3),p.Q6J("ngForOf",i.itemSelected),p.xp6(1),p.Q6J("ngIf",i.inforloadExpectedDaily&&i.inforloadExpectedDaily.for_calendar)}}let je=(()=>{class e{constructor(e,t,n,i,r){this.pondService=e,this.alertService=t,this.dialogRef=n,this.calendarService=i,this._translate=r,this.loadingFlag=new a.E,this.data=[],this.dataRaw=[],this.show=!1,this.dateRangeSelected=c()().format("YYYY-MM-DD"),this.maxDate=c()(),this.itemSelected=[],this.optionChart={legend:{show:!0,bottom:0},grid:{bottom:100},tooltip:{trigger:"axis",formatter:e=>{let t=c()(e[0].value[0]).format("DD-MM-YYYY")+"<br/>";return e.forEach(e=>{t+=e.marker+e.value[2]+" : "+(new Intl.NumberFormat).format(e.value[1])+"<br>"}),t},axisPointer:{animation:!0}},xAxis:{type:"time",axisLabel:{formatter:function(e){return new Date(e).getDate()}}},yAxis:{},series:[]}}ngOnInit(){this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.getData(),this.loadExpectedDaily(),this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.pondService.getHistory().pipe().subscribe(e=>{0==e.status||(this.minDate=new Date(1e3*e.data[0].start_time))},e=>{})}loadExpectedDaily(){console.log(c()(this.dateRangeSelected).valueOf()/1e3),this.calendarService.getExpectedDaily(this.pondService.pond.current_season,"enviro",c()(this.dateRangeSelected).valueOf()/1e3).subscribe(e=>{1==e.status?this.inforloadExpectedDaily=e.data:this.alertService.error(e.error)},()=>{this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}getData(){this.loadingFlag.setStart(!0),this.pondService.loadDailyDependency("enviroment",{pageIndex:0,pageSize:7},c()(this.dateRangeSelected).format("YYYY-MM-DD")).subscribe(e=>{e.data?(this.dataRaw=e.data,this.itemSelected=this.dataRaw.filter(e=>e.date==c()(this.dateRangeSelected).format("YYYY-MM-DD")),this.prepareData(this.dataRaw),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},e=>{this.loadingFlag.setResult(!1)})}prepareData(e){this.processData(),this.data=[];let t=[],n=[];e.forEach(e=>{if(t.includes(e.product_id)){let n=t.findIndex(t=>t==e.product_id);this.data[n].push([e.date,e.quantity,e.product_name])}else t.push(e.product_id),this.data.push([[e.date,e.quantity,e.product_name]]),n.push(e.product_name)});let i=[];t.forEach((e,t)=>{i.push({data:this.data[t],type:"scatter",name:n[t],symbolSize:function(e){let t=2*parseInt(e[1]);return t=t<50?t:50,t=t>5?t:5,t}})}),this.dataUpdate={series:i},console.log(this.dataUpdate)}onChangeDate(e){this.dateRangeSelected=e.value;let t=c()(this.dateRangeSelected);this.processData(),this.dataRaw.length>0?(t>c()(this.dataRaw[this.dataRaw.length-1].date)||t<c()(this.dataRaw[0].date))&&this.getData():this.getData(),this.loadExpectedDaily()}changeDate(e){let t=c()(this.dateRangeSelected).add(e,"days");if(t<this.minDate||t>this.maxDate)return!1;this.dateRangeSelected=t.format("YYYY-MM-DD")}processData(){this.itemSelected=this.dataRaw.filter(e=>e.date==c()(this.dateRangeSelected).format("YYYY-MM-DD"))}ngAfterViewInit(){this.show=!0}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(f.c),p.Y36(d.so),p.Y36(Ne.o),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-daily-enviroment"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto"],[1,"w-full","p-2"],["matInput","",3,"min","max","matDatepicker","ngModel","ngModelChange","dateChange"],["matSuffix","",3,"for"],["picker",""],[1,"grid","md:grid-cols-2","sm:grid-cols-1",2,"height","400px"],["style","min-height: 300px;","echarts","","class","demo-chart",3,"options","merge",4,"ngIf"],[1,"flex","items-center"],[1,"w-full"],["class","flex justify-between pl-2 pr-2",4,"ngFor","ngForOf"],["class","flex justify-between pl-2 pr-2",4,"ngIf"],["echarts","",1,"demo-chart",2,"min-height","300px",3,"options","merge"],[1,"flex","justify-between","pl-2","pr-2"],[1,"text-blue-600"]],template:function(e,t){1&e&&p.YNc(0,Ve,21,12,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.ENVIRONMENT_DAILY")},directives:[g.KI,v.lW,d.ZT,y.Hw,_.KE,_.hX,T.Nt,x.hl,o.Fj,o.JJ,o.On,x.nW,_.R9,x.Mq,i.O5,i.sg,Le.w],pipes:[i.JJ],styles:[""]}),e})();function He(e,t){1&e&&p._UZ(0,"mat-progress-bar",21)}function $e(e,t){1&e&&p._UZ(0,"mat-progress-bar",21)}function Be(e,t){if(1&e&&(p.TgZ(0,"mat-option",22),p._uU(1),p.qZA()),2&e){const e=t.index,n=p.oxw().$implicit;p.Q6J("value",e),p.xp6(1),p.AsE("",n("REPAST_SHORT")," ",e+1," ")}}function ze(e,t){if(1&e&&(p.TgZ(0,"fuse-alert",23),p._UZ(1,"mat-icon",24),p._uU(2),p.qZA()),2&e){const e=p.oxw().$implicit,t=p.oxw();p.Q6J("appearance","soft")("type","info"),p.xp6(1),p.Q6J("svgIcon","heroicons_solid:light-bulb"),p.xp6(1),p.AsE(" ",e("EXPECTED")," ",null==t.inforloadExpectedDaily?null:t.inforloadExpectedDaily.for_calendar.value_check,"kg ")}}function Ge(e,t){if(1&e&&(p.TgZ(0,"fuse-alert",23),p._UZ(1,"mat-icon",24),p._uU(2),p.qZA()),2&e){const e=p.oxw().$implicit,t=p.oxw();p.Q6J("appearance","soft")("type","success"),p.xp6(1),p.Q6J("svgIcon","heroicons_solid:check"),p.xp6(1),p.AsE(" ",e("FOR_PROCEDURE")," ",null==t.inforloadExpectedDaily?null:t.inforloadExpectedDaily.for_procedure.feed,"kg ")}}function We(e,t){if(1&e&&(p.ynx(0),p.TgZ(1,"mat-option",22),p._uU(2),p.qZA(),p.BQk()),2&e){const e=t.$implicit;p.xp6(1),p.Q6J("value",e.code),p.xp6(1),p.hij(" ",e.name," ")}}function Ke(e,t){if(1&e&&(p.TgZ(0,"mat-option",22),p._uU(1),p.qZA()),2&e){const e=p.oxw().$implicit;p.Q6J("value",e.id),p.xp6(1),p.AsE(" ",e.name," (",e.unit,") ")}}function Xe(e,t){if(1&e&&(p.ynx(0),p.YNc(1,Ke,2,3,"mat-option",36),p.BQk()),2&e){const e=t.$implicit;p.xp6(1),p.Q6J("ngIf",1==e.group_id)}}function et(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div"),p.TgZ(1,"div",30),p.TgZ(2,"mat-form-field",31),p.TgZ(3,"mat-select",13),p.NdJ("ngModelChange",function(t){return p.CHM(e).$implicit.wcode=t})("selectionChange",function(t){const n=p.CHM(e).index,i=p.oxw().index;return p.oxw(2).changeStore(t.value,n,"feed",i)}),p.YNc(4,We,3,2,"ng-container",26),p.qZA(),p.qZA(),p.TgZ(5,"mat-form-field",31),p.TgZ(6,"mat-select",32),p.NdJ("ngModelChange",function(t){return p.CHM(e).$implicit.product_id=t}),p.YNc(7,Xe,2,1,"ng-container",26),p.qZA(),p.qZA(),p.TgZ(8,"mat-form-field",31),p.TgZ(9,"input",33),p.NdJ("ngModelChange",function(t){return p.CHM(e).$implicit.quantity=t})("keypress",function(t){return p.CHM(e),p.oxw(3).validNo(t)})("change",function(t){const n=p.CHM(e).$implicit,i=p.oxw().index,r=p.oxw(2);return r.changeValidators(t,r.listProduct[n.wcode],i)}),p.qZA(),p.TgZ(10,"mat-error"),p._uU(11,"L\u1edbn h\u01a1n 0 "),p.qZA(),p.qZA(),p.TgZ(12,"button",34),p.NdJ("click",function(){const t=p.CHM(e).index,n=p.oxw().index;return p.oxw(2).removeRowFeed(n,t)}),p._UZ(13,"mat-icon",35),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.oxw(2).$implicit,i=p.oxw();p.xp6(3),p.Q6J("placeholder",n("WAREHOUSE"))("ngModel",e.wcode),p.xp6(1),p.Q6J("ngForOf",i.listStore),p.xp6(2),p.Q6J("placeholder",n("FEED"))("ngModel",e.product_id),p.xp6(1),p.Q6J("ngForOf",i.listProduct[e.wcode]),p.xp6(2),p.Q6J("ngModel",e.quantity)("placeholder",n("AMOUNT"))}}function tt(e,t){if(1&e&&(p.ynx(0),p.TgZ(1,"mat-option",22),p._uU(2),p.qZA(),p.BQk()),2&e){const e=t.$implicit;p.xp6(1),p.Q6J("value",e.code),p.xp6(1),p.hij(" ",e.name," ")}}function nt(e,t){if(1&e&&(p.TgZ(0,"mat-option",22),p._uU(1),p.qZA()),2&e){const e=p.oxw().$implicit;p.Q6J("value",e.id),p.xp6(1),p.AsE(" ",e.name," (",e.unit,") ")}}function it(e,t){if(1&e&&(p.ynx(0),p.YNc(1,nt,2,3,"mat-option",36),p.BQk()),2&e){const e=t.$implicit;p.xp6(1),p.Q6J("ngIf",2==e.group_id)}}function rt(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div"),p.TgZ(1,"div",30),p.TgZ(2,"mat-form-field",31),p.TgZ(3,"mat-select",13),p.NdJ("ngModelChange",function(t){return p.CHM(e).$implicit.wcode=t})("selectionChange",function(t){const n=p.CHM(e).index,i=p.oxw().index;return p.oxw(2).changeStore(t.value,n,"blend",i)}),p.YNc(4,tt,3,2,"ng-container",26),p.qZA(),p.qZA(),p.TgZ(5,"mat-form-field",31),p.TgZ(6,"mat-select",32),p.NdJ("ngModelChange",function(t){return p.CHM(e).$implicit.product_id=t}),p.YNc(7,it,2,1,"ng-container",26),p.qZA(),p.qZA(),p.TgZ(8,"mat-form-field",31),p.TgZ(9,"input",33),p.NdJ("ngModelChange",function(t){return p.CHM(e).$implicit.quantity=t})("keypress",function(t){return p.CHM(e),p.oxw(3).validNo(t)})("change",function(t){p.CHM(e);const n=p.oxw().index,i=p.oxw(2);return i.changeValidatorsBlend(t,i.listProduct[i.repast.wcode],n)}),p.qZA(),p.TgZ(10,"mat-error"),p._uU(11,"L\u1edbn h\u01a1n 0 "),p.qZA(),p.qZA(),p.TgZ(12,"button",34),p.NdJ("click",function(){const t=p.CHM(e).index,n=p.oxw().index;return p.oxw(2).removeRowBlend(n,t)}),p._UZ(13,"mat-icon",35),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.oxw(2).$implicit,i=p.oxw();p.xp6(3),p.Q6J("placeholder",n("WAREHOUSE"))("ngModel",e.wcode),p.xp6(1),p.Q6J("ngForOf",i.listStore),p.xp6(2),p.Q6J("placeholder",n("BLEND"))("ngModel",e.product_id),p.xp6(1),p.Q6J("ngForOf",i.listProduct[e.wcode]),p.xp6(2),p.Q6J("ngModel",e.quantity)("placeholder",n("AMOUNT"))}}function st(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div",25),p.YNc(1,et,14,8,"div",26),p.YNc(2,rt,14,8,"div",26),p.TgZ(3,"div",27),p.TgZ(4,"button",28),p.NdJ("click",function(){const t=p.CHM(e).index;return p.oxw(2).addRowFeed(t)}),p._UZ(5,"mat-icon",29),p._uU(6),p.qZA(),p.TgZ(7,"button",28),p.NdJ("click",function(){const t=p.CHM(e).index;return p.oxw(2).addRowBlend(t)}),p._UZ(8,"mat-icon",29),p._uU(9),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=t.index,n=p.oxw().$implicit,i=p.oxw();p.Q6J("hidden",e!=i.repastSelected),p.xp6(1),p.Q6J("ngForOf",i.feed[e]),p.xp6(1),p.Q6J("ngForOf",i.blend[e]),p.xp6(2),p.Q6J("disabled",i.feed[e]&&i.feed[e].length>=3),p.xp6(2),p.hij(" ",n("FEED")," "),p.xp6(1),p.Q6J("disabled",i.blend[e]&&i.blend[e].length>=5),p.xp6(2),p.hij(" ",n("BLEND")," ")}}function ot(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.YNc(8,He,1,0,"mat-progress-bar",7),p.YNc(9,$e,1,0,"mat-progress-bar",7),p.TgZ(10,"div",8),p.TgZ(11,"mat-form-field",9),p.TgZ(12,"mat-label"),p._uU(13),p.qZA(),p.TgZ(14,"input",10),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw().dateRangeSelected=t})("dateChange",function(t){return p.CHM(e),p.oxw().onChangeDate(t)}),p.qZA(),p._UZ(15,"mat-datepicker-toggle",11),p._UZ(16,"mat-datepicker",null,12),p.qZA(),p.TgZ(18,"mat-form-field",9),p.TgZ(19,"mat-label"),p._uU(20),p.qZA(),p.TgZ(21,"mat-select",13),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw().repastSelected=t})("selectionChange",function(t){return p.CHM(e),p.oxw().changeRepast(t)}),p.YNc(22,Be,2,3,"mat-option",14),p.qZA(),p._UZ(23,"mat-icon",15),p.qZA(),p.qZA(),p.TgZ(24,"div",8),p.YNc(25,ze,3,5,"fuse-alert",16),p.YNc(26,Ge,3,5,"fuse-alert",16),p.qZA(),p.YNc(27,st,10,7,"div",17),p.qZA(),p.TgZ(28,"div",18),p.TgZ(29,"button",19),p.NdJ("click",function(){return p.CHM(e),p.oxw().save()}),p._uU(30),p.qZA(),p.TgZ(31,"button",20),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(32),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(17),i=p.oxw();p.xp6(4),p.Oqu(e("TITLE")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(2),p.Q6J("ngIf",i.loadingFlag.pending),p.xp6(1),p.Q6J("ngIf",i.savingFlag.pending),p.xp6(4),p.Oqu(e("DATE")),p.xp6(1),p.Q6J("min",i.minDate)("max",i.maxDate.toDate())("matDatepicker",n)("ngModel",i.dateRangeSelected),p.xp6(1),p.Q6J("for",n),p.xp6(5),p.Oqu(e("REPAST")),p.xp6(1),p.Q6J("placeholder",e("REPAST_SELECT"))("ngModel",i.repastSelected),p.xp6(1),p.Q6J("ngForOf",i.repasts),p.xp6(3),p.Q6J("ngIf",i.inforloadExpectedDaily&&i.inforloadExpectedDaily.for_calendar),p.xp6(1),p.Q6J("ngIf",i.inforloadExpectedDaily&&i.inforloadExpectedDaily.for_procedure),p.xp6(1),p.Q6J("ngForOf",i.repasts),p.xp6(2),p.Q6J("disabled",i.isInputQuantity),p.xp6(1),p.hij(" ",e("SAVE")," "),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let at=(()=>{class e{constructor(e,t,n,i,r,s,o,l){this.pondService=e,this.dialogRef=t,this._alertService=n,this.data=i,this._translate=r,this.calendarService=s,this.storeService=o,this._formBuilder=l,this.loadingFlag=new a.E,this.savingFlag=new a.E,this.dateRangeSelected=c()().format("YYYY-MM-DD"),this.maxDate=c()(),this.dataRaw=[],this.repastSelected=0,this.repasts=[],this.feed=[],this.blend=[],this.checkUnit=localStorage.getItem("unit"),this.itemRemind="",this.disableForm={feed:!1,blend:!1},this.listStore=[],this.listProduct={}}ngOnInit(){var e=this;return(0,s.Z)(function*(){e.repast=e.data.repast,e.item=e.data.item,console.log(e.repasts),e.repastSelected=e.repast?e.repast:0,e.minDate<e.pondService.seasonStartTime&&(e.minDate=e.pondService.seasonStartTime),e.item.date==e.dateRangeSelected&&(e.itemSelected=e.item);for(let t=1;t<=e.pondService.numRepast;t++)e.repasts.push([]);e.processGroupRepast(),yield e.loadStore(),e.loadExpectedDaily(),e.minDate<e.pondService.seasonStartTime&&(e.minDate=e.pondService.seasonStartTime),e.pondService.getHistory().pipe().subscribe(t=>{0==t.status||(e.minDate=new Date(1e3*t.data[0].start_time))},e=>{})})()}changeValidators(e,t,n){console.log("\ud83d\ude80\ud83d\ude80\ud83c\udf89 >>> event",e.target.value),e.target.value>0?this.isInputQuantity=!1:e.target.value>t[n-1].quantity_current?this.alertWarning="C\u1ea3nh b\xe1o":this.isInputQuantity=!0}changeValidatorsBlend(e,t,n){console.log(e.target.value),e.target.value>0?this.isInputQuantity=!1:e.target.value>t[n-1].quantity_current?this.alertWarning="C\u1ea3nh b\xe1o":this.isInputQuantity=!0}loadExpectedDaily(){console.log(c()(this.dateRangeSelected).valueOf()/1e3),this.calendarService.getExpectedDaily(this.pondService.pond.current_season,"feed",c()(this.dateRangeSelected).valueOf()/1e3).subscribe(e=>{1==e.status?this.inforloadExpectedDaily=e.data:this._alertService.error(e.error)},()=>{this._alertService.error(this._translate.translate("CONNECT_ERROR"))})}close(){this.dialogRef.close()}save(){this.savingFlag.setPending(!0);let e=[];this.repasts.forEach((t,n)=>{e[n]={feeds:this.feed[n].map(e=>{if(e.product_id)return{kind:e.product_id,quantity:e.quantity.toString().replace(",","."),wcode:e.wcode,unit:e.unit}}),blends:this.blend[n].map(e=>{if(e=this.convertSaveBlend(e),console.log(e),e.product_id)return{kind:e.product_id,quantity:e.quantity.toString().replace(",","."),wcode:e.wcode,unit:e.unit}})}}),console.log("item of the repast",e);let t=c()(this.dateRangeSelected).format("YYYY-MM-DD"),n={date:t,repast:e};console.log(n),this.pondService.fullUpdate(n).subscribe(e=>{"success"==e.status?(this._alertService.success(this._translate.translate("UPDATE_SUCCESS")),this.savingFlag.setResult(!0),t==this.maxDate.format("YYYY-MM-DD")&&this.dialogRef.close(n),console.log("data",e)):(this._alertService.error(e.message),this.savingFlag.setResult(!1))},()=>{this._alertService.error(this._translate.translate("CONNECT_ERROR"))})}onChangeDate(e){this.dateRangeSelected=e.value;let t=c()(this.dateRangeSelected);this.dataRaw.length>0?(this.itemSelected=this.dataRaw[this.dataRaw.findIndex(e=>e.date==t.format("YYYY-MM-DD"))],this.processGroupRepast(),(t<c()(this.dataRaw[this.dataRaw.length-1].date)||t>c()(this.dataRaw[0].date))&&this.getData()):this.getData(),this.loadExpectedDaily()}changeDate(e){let t=c()(this.dateRangeSelected).add(e,"days");if(t<this.minDate||t>this.maxDate)return!1;this.dateRangeSelected=t.format("YYYY-MM-DD")}changeRepast(e){this.repastSelected=e.value}addRowFeed(e){if(this.feed[e].length>2)return this._alertService.warn(this._translate.translate("POND.FEED_UPATE.ROW_LIMIT")),!1;this.feed[e].push({wcode:this.wcodeSelected,product_id:null,product_index:null,product_name:null,quantity:null,unit:null})}removeRowFeed(e,t){if(0==t)return this.feed[e][0].quantity=0,!1;this.feed[e].splice(t,1)}addRowBlend(e){this.blend[e].length<5?this.blend[e].push({wcode:this.wcodeSelected,product_id:null,product_index:null,product_name:null,quantity:null,unit:null}):this._alertService.warn(this._translate.translate("POND.FEED_UPATE.ROW_LIMIT"))}removeRowBlend(e,t){if(0==t)return this.blend[e][0].quantity=0,!1;this.blend[e].splice(t,1)}setProduct(e,t,n){const i=this.pondService.products.findIndex(e=>e.id===n);1==e?(this.feed[t].product_id=this.pondService.products[i].id,this.feed[t].product_name=this.pondService.products[i].name):(this.blend[t].product_id=this.pondService.products[i].id,this.blend[t].product_name=this.pondService.products[i].name)}getData(){this.loadingFlag.setStart(!0);let e=c()(this.dateRangeSelected).format("YYYY-MM-DD");this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},e).subscribe(t=>{t.data?(this.dataRaw=t.data,this.itemSelected=this.dataRaw[this.dataRaw.findIndex(t=>t.date==e)],this.processGroupRepast(),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},e=>{this.loadingFlag.setResult(!1),this._alertService.error(e)})}processGroupRepast(){var e=this;return(0,s.Z)(function*(){e.blend=[],e.feed=[];for(let t=1;t<=e.pondService.numRepast;t++)e.feed.push([]),e.blend.push([]);void 0!==e.itemSelected?(console.log(e.itemSelected),e.itemSelected.feed&&e.itemSelected.feed.forEach(t=>{e.feed[t.times-1].push(t),e.listProduct[t.wcode]&&0!=e.listProduct[t.wcode].length||e.getListProduct(t.wcode)}),console.log(e.itemSelected.blend),e.itemSelected.blend&&e.itemSelected.blend.forEach(t=>{const n={pond_daily_id:t.pond_daily_id,product_id:t.product_id,product_name:t.product_name,quantity:t.quantity,wcode:t.wcode,type:2,unit:t.unit};console.log("element",t),e.blend[t.times-1].push(e.checkUnitBlend(n)),e.listProduct[t.wcode]&&0!=e.listProduct[t.wcode].length||e.getListProduct(t.wcode)})):console.log("item undefined")})()}convertSaveBlend(e){let t;return t="g"==this.checkUnit,console.log("item",e),t?(e.unit="kg",e.quantity=e.quantity/1e3):(e.unit="kg",e.quantity=e.quantity),e}checkUnitBlend(e){let t;return t="g"==this.checkUnit,t?(console.log("show item",e),"kg"==e.unit?(e.unit="g",e.quantity=1e3*e.quantity):"lit"==e.unit&&(e.unit="ml",e.quantity=1e3*e.quantity)):"g"==e.unit&&(e.unit="kg",e.quantity=e.quantity/1e3),e}changeStore(e,t,n,i){var r=this;return(0,s.Z)(function*(){r.wcodeSelected=e,e&&(r[n][i][t].product_id="",r[n][i][t].product_name="",r[n][i][t].wcode=e,yield r.loadStore())})()}loadStore(){var e=this;return(0,s.Z)(function*(){if(e.loadingFlag.setPending(!0),0==e.listStore.length){const t=yield e.storeService.getApiStore("get-list-avaiable","&pcode="+e.pondService.pcode,"manager/pond-store-api").toPromise().catch(()=>{e._alertService.error(e._translate.translate("CONNECT_ERROR"))});1==t.status?e.listStore=t.data:e._alertService.warn(t.error),e.wcodeSelected=e.listStore[0].code,e.listProduct[e.wcodeSelected]=[]}const t=yield e.storeService.getApiStore("get-list-product","&pcode="+e.pondService.pcode+"&wcode="+e.wcodeSelected,"manager/pond-store-api").toPromise().catch(()=>{e._alertService.error(e._translate.translate("CONNECT_ERROR"))});1==t.status?e.listProduct[e.wcodeSelected]=t.data:e._alertService.warn(t.error),e.loadingFlag.setResult(!0)})()}getListProduct(e){var t=this;return(0,s.Z)(function*(){if(t.listProduct[e]&&t.listProduct[e].length>0)return;const n=yield t.storeService.getApiStore("get-list-product","&pcode="+t.pondService.pcode+"&wcode="+e,"manager/pond-store-api").toPromise().catch(()=>{t._alertService.error(t._translate.translate("CONNECT_ERROR"))});1==n.status?t.listProduct[e]=n.data:t._alertService.warn(n.error)})()}validNo(e){const t=e.which?e.which:e.keycode;return!(t>31&&(t<46||t>58))}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(d.so),p.Y36(f.c),p.Y36(d.WI),p.Y36(g.Vn),p.Y36(Ne.o),p.Y36(F.d),p.Y36(o.qu))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-daily-feed-update"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto"],["mode","indeterminate",4,"ngIf"],[1,"grid","grid-cols-2"],[1,"w-full","p-2"],["matInput","",3,"min","max","matDatepicker","ngModel","ngModelChange","dateChange"],["matSuffix","",3,"for"],["picker",""],[3,"placeholder","ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["matPrefix","","svgIcon","iconsmind:fish",1,"icon-size-5"],[3,"appearance","type",4,"ngIf"],[3,"hidden",4,"ngFor","ngForOf"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",3,"click"],["mode","indeterminate"],[3,"value"],[3,"appearance","type"],["fuseAlertIcon","",1,"icon-size-5",3,"svgIcon"],[3,"hidden"],[4,"ngFor","ngForOf"],[1,"text-center"],["mat-button","","shape","round","fill","outline","size","small","color","primary",3,"disabled","click"],["matPrefix","","svgIcon","mat_solid:add",1,"icon-size-5"],[1,"flex","justify-between"],["appearance","legacy",1,"w-full","m-2"],[3,"placeholder","ngModel","ngModelChange"],["matInput","","type","number","required","","min","0",3,"ngModel","placeholder","ngModelChange","keypress","change"],["mat-icon-button","",1,"text-red-400","m-2",3,"click"],["svgIcon","heroicons_solid:minus-circle",1,"size-icon-5"],[3,"value",4,"ngIf"]],template:function(e,t){1&e&&p.YNc(0,ot,33,21,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.FEED_UPDATE")},directives:[g.KI,v.lW,d.ZT,y.Hw,i.O5,_.KE,_.hX,T.Nt,x.hl,o.Fj,o.JJ,o.On,x.nW,_.R9,x.Mq,Z.gD,i.sg,_.qo,I.pW,A.ey,Ce.W,o.qQ,o.wV,o.Q7,_.TO],styles:[""]}),e})();var lt=n(90650);function ct(e,t){if(1&e&&p._UZ(0,"div",21),2&e){const e=p.oxw(2);p.Q6J("options",e.optionLine)("merge",e.dataUpdate)}}function ut(e,t){1&e&&p._UZ(0,"div")}function dt(e,t){if(1&e&&(p.TgZ(0,"div",19),p.TgZ(1,"span"),p._uU(2),p.qZA(),p.TgZ(3,"span"),p.TgZ(4,"b"),p._uU(5),p._UZ(6,"small"),p.qZA(),p.qZA(),p.qZA()),2&e){const e=t.$implicit,n=t.index,i=p.oxw(2).$implicit;p.xp6(2),p.AsE("",i("REPAST")," ",n+1,""),p.xp6(3),p.hij("",null==e[0]?null:e[0].quantity," ")}}function ht(e,t){if(1&e&&p.YNc(0,dt,7,3,"div",22),2&e){const e=p.oxw(2);p.Q6J("ngForOf",e.feed)}}function pt(e,t){if(1&e&&(p.TgZ(0,"div",19),p.TgZ(1,"span"),p._uU(2),p.qZA(),p.TgZ(3,"span"),p.TgZ(4,"b"),p._uU(5),p._UZ(6,"small"),p.qZA(),p.qZA(),p.qZA()),2&e){const e=t.$implicit,n=t.index,i=p.oxw(2).$implicit;p.xp6(2),p.AsE("",i("REPAST")," ",n+1,""),p.xp6(3),p.hij("",e," ")}}function mt(e,t){if(1&e&&p.YNc(0,pt,7,3,"div",22),2&e){const e=p.oxw(2);p.Q6J("ngForOf",e.totalFeed)}}function ft(e,t){if(1&e&&(p.TgZ(0,"div",19),p.TgZ(1,"span"),p._uU(2),p.qZA(),p.TgZ(3,"span",23),p.TgZ(4,"b"),p._uU(5),p.TgZ(6,"small"),p._uU(7,"kg"),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&e){const e=p.oxw().$implicit,t=p.oxw();p.xp6(2),p.Oqu(e("EXPECTED")),p.xp6(3),p.hij("",null==t.inforloadExpectedDaily?null:t.inforloadExpectedDaily.for_calendar.value_check," ")}}function gt(e,t){if(1&e&&(p.TgZ(0,"div",19),p.TgZ(1,"span"),p._uU(2),p.qZA(),p.TgZ(3,"span",24),p.TgZ(4,"b"),p._uU(5),p.TgZ(6,"small"),p._uU(7,"kg"),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&e){const e=p.oxw().$implicit,t=p.oxw();p.xp6(2),p.Oqu(e("FOR_PROCEDURE")),p.xp6(3),p.hij("",null==t.inforloadExpectedDaily?null:t.inforloadExpectedDaily.for_procedure.feed," ")}}function vt(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.TgZ(8,"div",7),p.TgZ(9,"h2"),p.TgZ(10,"b"),p._uU(11," Th\u1ee9c \u0103n c\u1ed9ng d\u1ed3n "),p.qZA(),p.qZA(),p.TgZ(12,"h2"),p._uU(13),p.ALo(14,"number"),p.TgZ(15,"small"),p._uU(16,"kg"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(17,"mat-form-field",8),p.TgZ(18,"mat-label"),p._uU(19),p.qZA(),p.TgZ(20,"input",9),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw().dateRangeSelected=t})("dateChange",function(t){return p.CHM(e),p.oxw().onChangeDate(t)}),p.qZA(),p._UZ(21,"mat-datepicker-toggle",10),p._UZ(22,"mat-datepicker",null,11),p.qZA(),p.TgZ(24,"div",12),p.YNc(25,ct,1,2,"div",13),p.TgZ(26,"div",14),p.TgZ(27,"div",15),p.YNc(28,ut,1,0,"div",16),p.YNc(29,ht,1,1,"ng-template",null,17,p.W1O),p.YNc(31,mt,1,1,"ng-template",null,18,p.W1O),p.TgZ(33,"div",19),p.TgZ(34,"span"),p._uU(35),p.qZA(),p.TgZ(36,"span"),p.TgZ(37,"b"),p._uU(38),p.ALo(39,"number"),p._UZ(40,"small"),p.qZA(),p.qZA(),p.qZA(),p.YNc(41,ft,8,2,"div",20),p.YNc(42,gt,8,2,"div",20),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(23),i=p.MAs(30),r=p.MAs(32),s=p.oxw();p.xp6(4),p.Oqu(e("TITLE")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(7),p.hij(" ",p.xi3(14,18,s.itemIncremental,"1.0-1")," "),p.xp6(6),p.Oqu(e("DATE")),p.xp6(1),p.Q6J("min",s.minDate)("max",s.maxDate.toDate())("matDatepicker",n)("ngModel",s.dateRangeSelected),p.xp6(1),p.Q6J("for",n),p.xp6(4),p.Q6J("ngIf",s.show),p.xp6(3),p.Q6J("ngIf",0==s.totalFeed.length)("ngIfThen",i)("ngIfElse",r),p.xp6(7),p.Oqu(e("TOTAL")),p.xp6(3),p.hij("",p.xi3(39,21,null==s.itemSelected?null:s.itemSelected.feed_today,"1.0-1")," "),p.xp6(3),p.Q6J("ngIf",s.inforloadExpectedDaily&&s.inforloadExpectedDaily.for_calendar),p.xp6(1),p.Q6J("ngIf",s.inforloadExpectedDaily&&s.inforloadExpectedDaily.for_procedure)}}let yt=(()=>{class e{constructor(e,t,n,i,r){this.pondService=e,this.alertService=t,this.dialogRef=n,this.calendarService=i,this._translate=r,this.loadingFlag=new a.E,this.data=[],this.dataRaw=[],this.dateRangeSelected=c()().format("YYYY-MM-DD"),this.maxDate=c()(),this.feed=[],this.show=!1,this.arrExamle=[],this.itemIncremental=0,this.totalFeed=[],this.optionLine={tooltip:{trigger:"axis",formatter:e=>{let t=c()(e[0].value[0]).format("DD-MM-YYYY")+"<br/>";return e.forEach(e=>{let n="number"==typeof e.value[1]?(new Intl.NumberFormat).format(e.value[1]):0;t+=e.marker+e.seriesName+" : "+n+"<br>"}),t},axisPointer:{animation:!0}},xAxis:{type:"time",splitLine:{show:!1},axisLabel:{formatter:function(e){return new Date(e).getDate()}}},yAxis:{type:"value",splitLine:{show:!0}},series:[{data:this.data,type:"line",smooth:!0,name:"Cho \u0103n",showSymbol:!0,hoverAnimation:!0,lineStyle:{width:1,color:"rgba(128, 255, 165)"},areaStyle:{color:new lt.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(128, 255, 165)"},{offset:1,color:"rgba(1, 191, 236)"}])}}]}}ngOnInit(){this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.getData(),this.loadExpectedDaily(),this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.pondService.getHistory().pipe().subscribe(e=>{0==e.status||(this.minDate=new Date(1e3*e.data[0].start_time))},e=>{})}loadExpectedDaily(){this.calendarService.getExpectedDaily(this.pondService.pond.current_season,"feed",c()(this.dateRangeSelected).valueOf()/1e3).subscribe(e=>{1==e.status?this.inforloadExpectedDaily=e.data:this.alertService.error(e.error)},()=>{this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}getData(){this.loadingFlag.setStart(!0),this.pondService.loadDailyPaging({pageIndex:0,pageSize:90},c()(this.dateRangeSelected).format("YYYY-MM-DD")).subscribe(e=>{e.data?(this.dataRaw=e.data,console.log(this.dataRaw),this.itemIncremental=null!=this.dataRaw[0].feed_incremental?this.dataRaw[0].feed_incremental:0,this.dataRaw[0]&&this.dataRaw[0].date==c()(this.dateRangeSelected).format("YYYY-MM-DD")&&(this.itemSelected=this.dataRaw[0]),this.prepareData(this.dataRaw),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},e=>{this.loadingFlag.setResult(!1)})}prepareData(e){this.processFeed(),this.data=[],e.forEach(e=>{let t=new Date(e.date);this.data.push({name:t.toString(),value:[e.date,+e.feed_today]})}),this.data.reverse(),this.dataUpdate={series:[{data:this.data}]}}onChangeDate(e){this.totalFeed=[],this.dateRangeSelected=e.value;let t=c()(this.dateRangeSelected);this.itemSelected=this.dataRaw[this.dataRaw.findIndex(e=>e.date==t.format("YYYY-MM-DD"))],console.log(t.format("YYYY-MM-DD"));let n=this.dataRaw.filter(e=>e.date==t.format("YYYY-MM-DD"));if(null!=n[0])this.itemIncremental=n[0].feed_incremental;else{const e=this.dataRaw.filter(e=>e.date<=t.format("YYYY-MM-DD"));console.log("Date of arr thisdateeow",e),this.itemIncremental=0==e.length?0:e[0].feed_incremental}this.processFeed(),(!this.dataRaw[0]||t<c()(this.dataRaw[this.dataRaw.length-1].date)||t>c()(this.dataRaw[0].date))&&this.getData(),this.loadExpectedDaily()}changeDate(e){let t=c()(this.dateRangeSelected).add(e,"days");if(t<this.minDate||t>this.maxDate)return!1;this.dateRangeSelected=t.format("YYYY-MM-DD")}processFeed(){this.feed=[];for(let t=1;t<=this.pondService.numRepast;t++)this.feed.push([]);if(void 0!==this.itemSelected){for(var e of(this.itemSelected.feed&&this.itemSelected.feed.forEach(e=>{e.type=1,this.feed[e.times-1].push(e)}),this.itemSelected.blend&&this.itemSelected.blend.forEach(e=>{e.type=2,this.feed[e.times-1].push(e)}),console.log(this.feed),this.feed)){const t=(e=e.filter(e=>1==e.type)).reduce((e,t)=>e+Number(t.quantity),0);this.totalFeed.push(t)}console.log(this.totalFeed)}}ngAfterViewInit(){this.show=!0}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(f.c),p.Y36(d.so),p.Y36(Ne.o),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-daily-feed"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","overflow-y-auto"],[1,"text-center"],[1,"w-full","p-2"],["matInput","",3,"min","max","matDatepicker","ngModel","ngModelChange","dateChange"],["matSuffix","",3,"for"],["picker",""],[1,"grid","md:grid-cols-2","sm:grid-cols-1",2,"height","400px"],["style","min-height: 300px;","echarts","","class","demo-chart",3,"options","merge",4,"ngIf"],[1,"flex","items-center"],[1,"w-full"],[4,"ngIf","ngIfThen","ngIfElse"],["truthy",""],["falshy",""],[1,"flex","justify-between","pl-2","pr-2"],["class","flex justify-between pl-2 pr-2",4,"ngIf"],["echarts","",1,"demo-chart",2,"min-height","300px",3,"options","merge"],["class","flex justify-between pl-2 pr-2",4,"ngFor","ngForOf"],[1,"text-blue-600"],[1,"text-success-600"]],template:function(e,t){1&e&&p.YNc(0,vt,43,24,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.FEED_DAILY")},directives:[g.KI,v.lW,d.ZT,y.Hw,_.KE,_.hX,T.Nt,x.hl,o.Fj,o.JJ,o.On,x.nW,_.R9,x.Mq,i.O5,Le.w,i.sg],pipes:[i.JJ],styles:[""]}),e})();function _t(e,t){1&e&&p._UZ(0,"mat-progress-bar",41)}function Tt(e,t){1&e&&p._UZ(0,"mat-progress-bar",41)}function xt(e,t){if(1&e&&(p.TgZ(0,"p"),p._uU(1),p.qZA()),2&e){const e=t.$implicit,n=p.oxw().$implicit;p.xp6(1),p.AsE(" ",n("TREATED")," ",e.name," ")}}function wt(e,t){if(1&e&&(p.TgZ(0,"p"),p._uU(1),p.qZA()),2&e){const e=t.$implicit,n=p.oxw().$implicit;p.xp6(1),p.AsE(" ",n("CURRENT_DISEASE")," ",e.name," ")}}function bt(e,t){if(1&e&&(p.TgZ(0,"mat-option",42),p._uU(1),p.qZA()),2&e){const e=t.$implicit;p.Q6J("value",e.name),p.xp6(1),p.hij(" ",e.name," ")}}function Zt(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"mat-chip",43),p.NdJ("removed",function(){const t=p.CHM(e).index;return p.oxw(2).removeDisease(t)}),p._uU(1),p.TgZ(2,"mat-icon",44),p._uU(3,"cancel"),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.oxw(2);p.Q6J("selectable",n.selectable),p.xp6(1),p.hij(" ",e.name," ")}}function At(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"mat-form-field",19),p.TgZ(1,"mat-label"),p._uU(2),p.qZA(),p.TgZ(3,"input",45),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw(2).validateNo(t)})("change",function(){return p.CHM(e),p.oxw(2).convertLoss()}),p.qZA(),p.qZA()}if(2&e){const e=p.oxw().$implicit;p.xp6(2),p.AsE("",e("LOSS"),"(",e("ANIMALS"),")"),p.xp6(1),p.Q6J("placeholder",e("ENTER_LOSS"))}}function It(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"mat-form-field",19),p.TgZ(1,"mat-label"),p._uU(2),p.qZA(),p.TgZ(3,"input",46),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw(2).validateNo(t)})("change",function(){return p.CHM(e),p.oxw(2).convertLoss()}),p.qZA(),p.qZA()}if(2&e){const e=p.oxw().$implicit;p.xp6(2),p.hij("",e("LOSS"),"(kg)"),p.xp6(1),p.Q6J("placeholder",e("ENTER_LOSS"))}}function St(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.YNc(8,_t,1,0,"mat-progress-bar",7),p.YNc(9,Tt,1,0,"mat-progress-bar",7),p.TgZ(10,"div",8),p.TgZ(11,"mat-form-field",9),p.TgZ(12,"mat-label"),p._uU(13),p.qZA(),p.TgZ(14,"input",10),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw().dateRangeSelected=t})("dateChange",function(t){return p.CHM(e),p.oxw().onChangeDate(t)}),p.qZA(),p._UZ(15,"mat-datepicker-toggle",11),p._UZ(16,"mat-datepicker",null,12),p.qZA(),p.TgZ(18,"div",13),p.TgZ(19,"div",14),p.YNc(20,xt,2,2,"p",15),p.qZA(),p.TgZ(21,"div",16),p.YNc(22,wt,2,2,"p",15),p.qZA(),p.TgZ(23,"button",17),p.NdJ("click",function(){return p.CHM(e),p.MAs(35).focus()}),p._uU(24),p.qZA(),p.qZA(),p.qZA(),p.TgZ(25,"div",18),p.TgZ(26,"div",8),p.TgZ(27,"mat-form-field",19),p.TgZ(28,"mat-label"),p._uU(29),p.qZA(),p.TgZ(30,"input",20),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw().validateNo(t)}),p.qZA(),p.qZA(),p.TgZ(31,"mat-form-field",21),p.TgZ(32,"mat-label"),p._uU(33),p.qZA(),p._UZ(34,"input",22,23),p.TgZ(36,"mat-autocomplete",24,25),p.NdJ("optionSelected",function(t){return p.CHM(e),p.oxw().onSelectDisease(t.option.value)}),p.YNc(38,bt,2,2,"mat-option",26),p.ALo(39,"async"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(40,"div",27),p.TgZ(41,"mat-chip-list",28,29),p.YNc(43,Zt,4,2,"mat-chip",30),p.qZA(),p.qZA(),p.TgZ(44,"div",8),p.YNc(45,At,4,3,"mat-form-field",31),p.YNc(46,It,4,2,"mat-form-field",31),p.TgZ(47,"mat-form-field",32),p.TgZ(48,"mat-label"),p._uU(49),p.qZA(),p.TgZ(50,"mat-select",33),p.TgZ(51,"mat-option",34),p._uU(52),p.qZA(),p.TgZ(53,"mat-option",35),p._uU(54,"Kg"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(55,"div",36),p.TgZ(56,"mat-form-field",32),p.TgZ(57,"mat-label"),p._uU(58),p.qZA(),p._UZ(59,"textarea",37),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(60,"div",38),p.TgZ(61,"button",39),p.NdJ("click",function(){return p.CHM(e),p.oxw().save()}),p._uU(62),p.qZA(),p.TgZ(63,"button",40),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(64),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(17),i=p.MAs(37),r=p.oxw();p.xp6(4),p.Oqu(e("TITLE")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(2),p.Q6J("ngIf",r.loadingFlag.pending),p.xp6(1),p.Q6J("ngIf",r.savingFlag.pending),p.xp6(4),p.Oqu(e("DATE")),p.xp6(1),p.Q6J("min",r.minDate)("max",r.maxDate.toDate())("matDatepicker",n)("ngModel",r.dateRangeSelected),p.xp6(1),p.Q6J("for",n),p.xp6(5),p.Q6J("ngForOf",r.object_filter.arr_disease_current_done),p.xp6(2),p.Q6J("ngForOf",r.object_filter.arr_disease_current),p.xp6(2),p.Oqu(e("HEALTH_NOTE")),p.xp6(1),p.Q6J("formGroup",r.form),p.xp6(4),p.hij("",e("WEIGHT"),"(g)"),p.xp6(1),p.Q6J("placeholder",e("ENTER_WEIGHT")),p.xp6(3),p.Oqu(e("HEALTH_NOTE")),p.xp6(1),p.Q6J("placeholder",e("SEARCH_DISEASE"))("aria-label",e("SEARCH_DISEASE"))("matAutocomplete",i),p.xp6(4),p.Q6J("ngForOf",p.lcZ(39,33,r.listDisease)),p.xp6(5),p.Q6J("ngForOf",r.object_filter.arr_disease_new),p.xp6(2),p.Q6J("ngIf","con"==r.form.value.unit),p.xp6(1),p.Q6J("ngIf","kg"==r.form.value.unit),p.xp6(3),p.Oqu(e("UNIT")),p.xp6(1),p.Q6J("placeholder",e("ENTER_UNIT")),p.xp6(2),p.Oqu(e("PIECES")),p.xp6(6),p.Oqu(e("STATUS")),p.xp6(1),p.Q6J("placeholder",e("ENTER_STATUS")),p.xp6(2),p.Q6J("disabled",r.form.invalid),p.xp6(1),p.hij(" ",e("SAVE")," "),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let Et=(()=>{class e{constructor(e,t,n,i,r,s){this.pondService=e,this._fb=t,this.alertService=n,this.dialogRef=i,this.data=r,this._translate=s,this.loadingFlag=new a.E,this.savingFlag=new a.E,this.dateRangeSelected=c()().format("YYYY-MM-DD"),this.maxDate=c()(),this.dataRaw=[],this.invalid=!0,this.showDisease=!1,this.listSynonym=[],this.form=this._fb.group({weight:new o.NI("",[o.kI.required,o.kI.min(0)]),loss:new o.NI("",[o.kI.min(0)]),lossKg:new o.NI("",[o.kI.min(0)]),desease:new o.NI(""),unit:new o.NI("kg"),textSearch:new o.NI("")}),this.object_filter={arr_disease_current:[],arr_disease_current_done:[],arr_disease_new:[],arr_sub_new:[]}}ngOnInit(){this.item=this.data.item,this.disease=this.data.disease,this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.item.date==this.dateRangeSelected&&(this.itemSelected=this.item),this.processData(),this.form.controls.textSearch.valueChanges.pipe((0,h.b)(300)).subscribe(e=>{this.getListDisease(e),this.object_filter.arr_disease_current.filter(t=>{e==t.name&&this.alertService.error(this._translate.translate("REPEAT_ERROR"))})}),this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.pondService.getHistory().pipe().subscribe(e=>{0==e.status||(this.minDate=new Date(1e3*e.data[0].start_time))},e=>{})}getListDisease(e){e.length>=2&&(this.listDisease=this.pondService.getListDisease(e).pipe(e=>e))}validateNo(e){const t=e.which?e.which:e.keyCode;return!(t>31&&(t<48||t>57))}delay(e){return new Promise(t=>setTimeout(t,e))}onChangeDate(e){this.dateRangeSelected=e.value;let t=c()(this.dateRangeSelected);if(this.object_filter.arr_disease_current=[],this.object_filter.arr_disease_current_done=[],this.object_filter.arr_disease_new=[],this.dataRaw.length>0){let e=this.dataRaw[this.dataRaw.findIndex(e=>e.date==t.format("YYYY-MM-DD"))];void 0!==e&&(this.itemSelected=e,this.disease=this.itemSelected.disease,this.processData()),(t<c()(this.dataRaw[this.dataRaw.length-1].date)||t>c()(this.dataRaw[0].date))&&this.getData()}else this.getData()}changeDate(e){let t=c()(this.dateRangeSelected).add(e,"days");if(t<this.minDate||t>this.maxDate)return!1;this.dateRangeSelected=t.format("YYYY-MM-DD")}getData(){this.loadingFlag.setStart(!0);let e=c()(this.dateRangeSelected).format("YYYY-MM-DD");this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},e).subscribe(t=>{if(t.data){this.dataRaw=t.data;let n=this.dataRaw[this.dataRaw.findIndex(t=>t.date==e)];void 0!==n&&(this.itemSelected=n,console.log(this.itemSelected.disease),this.disease=this.itemSelected.disease?this.itemSelected.disease:[],this.processData()),this.loadingFlag.setResult(!0)}else this.loadingFlag.setResult(!1)},e=>{this.loadingFlag.setResult(!1),this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}save(){this.savingFlag.setPending(!0);let e=c()(this.dateRangeSelected).format("YYYY-MM-DD"),t=this.form.value;t.disease=this.object_filter.arr_disease_new,this.pondService.updateHealth({date:e,heath:t}).subscribe(n=>{"success"==n.status?(this.alertService.success(this._translate.translate("UPDATE_SUCCESS")),this.savingFlag.setResult(!0),e==this.maxDate.format("YYYY-MM-DD")?(t.disease=t.disease.concat(this.object_filter.arr_disease_current),this.dialogRef.close(t)):this.dialogRef.close()):(this.alertService.error(n.message),this.savingFlag.setResult(!1))},()=>{this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}processData(){if(void 0!==this.itemSelected&&this.itemSelected){let e=this.itemSelected.weight>0?this.itemSelected.weight:"";this.form.patchValue({weight:e,loss:this.itemSelected.loss,lossKg:e*this.itemSelected.loss/1e3,desease:this.itemSelected.note_health,unit:"kg"})}this.invalid=this.form.invalid,this.object_filter.arr_disease_current=[],this.object_filter.arr_disease_current_done=[],this.disease.forEach(e=>{1==parseInt(e.processed)?this.object_filter.arr_disease_current_done.push({id:e.disease_id,name:e.disease_name}):this.object_filter.arr_disease_current.push({id:e.disease_id,name:e.disease_name})})}getListSynonym(){this.pondService.getListSynonym().subscribe(e=>{1==e.status?(this.listSynonym=e.data,console.log(this.listSynonym)):this.alertService.error(e.message)},()=>{this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}convertLoss(){if(this.form.value.weight>0){if("kg"==this.form.value.unit){let e=Math.ceil(this.form.value.lossKg/(this.form.value.weight/1e3));this.form.patchValue({loss:e})}else{let e=Math.ceil(this.form.value.loss*this.form.value.weight/1e3);this.form.patchValue({lossKg:e})}this.form.get("weight").clearValidators()}else 0!=this.form.value.loss||0!=this.form.value.lossKg?(this.form.get("weight").setValidators([o.kI.required,o.kI.min(.01)]),this.form.get("weight").updateValueAndValidity()):this.form.get("weight").clearValidators();this.invalid=this.form.invalid}onSelectDisease(e){this.listDisease.subscribe(t=>{t.forEach(t=>{t.name===e&&(this.object_filter.arr_disease_new.some(t=>t.name===e)||this.object_filter.arr_disease_new.push(t))})})}removeDisease(e){this.object_filter.arr_disease_new.splice(e,1)}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(o.qu),p.Y36(f.c),p.Y36(d.so),p.Y36(d.WI),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-daily-heath-update"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto"],["mode","indeterminate",4,"ngIf"],[1,"grid","grid-cols-2"],[1,"w-full","p-2"],["matInput","",3,"min","max","matDatepicker","ngModel","ngModelChange","dateChange"],["matSuffix","",3,"for"],["picker",""],[1,"flex","justify-center","items-center","flex-col"],[1,"text-center","text-green-400"],[4,"ngFor","ngForOf"],[1,"text-center","text-red-400"],["mat-raised-button","","color","warn",1,"w-40",3,"click"],[3,"formGroup"],[1,"w-full","pr-2"],["matInput","","formControlName","weight","required","",3,"placeholder","keypress"],["appearance","fill",1,"example-full-width"],["type","text","matInput","","formControlName","textSearch",3,"placeholder","aria-label","matAutocomplete"],["input",""],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"flex","justify-end"],[1,"mb-4"],["chipList",""],["removable","true","color","warn","selected","",3,"selectable","removed",4,"ngFor","ngForOf"],["class","w-full pr-2",4,"ngIf"],[1,"w-full"],["formControlName","unit",3,"placeholder"],["value","con"],["value","kg"],[1,"grid","grid-cols-1"],["matInput","","formControlName","desease",3,"placeholder"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",3,"click"],["mode","indeterminate"],[3,"value"],["removable","true","color","warn","selected","",3,"selectable","removed"],["matChipRemove",""],["matInput","","formControlName","loss","required","",3,"placeholder","keypress","change"],["matInput","","formControlName","lossKg","required","",3,"placeholder","keypress","change"]],template:function(e,t){1&e&&p.YNc(0,St,65,35,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.HEALTH_UPDATE")},directives:[g.KI,v.lW,d.ZT,y.Hw,i.O5,_.KE,_.hX,T.Nt,x.hl,o.Fj,o.JJ,o.On,x.nW,_.R9,x.Mq,i.sg,o.JL,o.sg,o.u,o.Q7,w.ZL,w.XC,b.qn,Z.gD,A.ey,I.pW,b.HS,b.qH],pipes:[i.Ov],styles:[""]}),e})();function qt(e,t){1&e&&p._UZ(0,"mat-progress-bar",14)}function Nt(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.YNc(8,qt,1,0,"mat-progress-bar",7),p.TgZ(9,"div"),p.TgZ(10,"div",8),p.TgZ(11,"h2"),p.TgZ(12,"b"),p._uU(13),p.qZA(),p.qZA(),p.TgZ(14,"h2"),p._uU(15),p.ALo(16,"number"),p.qZA(),p.TgZ(17,"h2"),p._uU(18),p.qZA(),p.qZA(),p.TgZ(19,"mat-form-field",9),p.TgZ(20,"mat-label"),p._uU(21),p.qZA(),p.TgZ(22,"input",10),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw().dateRangeSelected=t})("dateChange",function(t){return p.CHM(e),p.oxw().onChangeDate(t)}),p.qZA(),p._UZ(23,"mat-datepicker-toggle",11),p._UZ(24,"mat-datepicker",null,12),p.qZA(),p.qZA(),p.TgZ(26,"div"),p._UZ(27,"div",13),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(25),i=p.oxw();p.xp6(4),p.Oqu(e("TITLE")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(2),p.Q6J("ngIf",i.loadingFlag.pending),p.xp6(5),p.lnq(" ",e("WEIGHT")," ",null==i.itemSelected?null:i.itemSelected.weight," ",e("WEIGHT_UNIT")," "),p.xp6(2),p.AsE(" ",e("LOSS")," ",p.xi3(16,18,(null==i.itemSelected?null:i.itemSelected.loss)*(null==i.itemSelected?null:i.itemSelected.weight)/1e3,"1.0-1")," "),p.xp6(3),p.hij(" ",null==i.itemSelected?null:i.itemSelected.note_health," "),p.xp6(3),p.Oqu(e("DATE")),p.xp6(1),p.Q6J("min",i.minDate)("max",i.maxDate.toDate())("matDatepicker",n)("ngModel",i.dateRangeSelected),p.xp6(1),p.Q6J("for",n),p.xp6(4),p.Q6J("options",i.optionChart)("merge",i.dataUpdate)}}let Ct=(()=>{class e{constructor(e,t,n,i){this.pondService=e,this.alertService=t,this.dialogRef=n,this._translate=i,this.loadingFlag=new a.E,this.data=[],this.dataRaw=[],this.dateRangeSelected=c()().format("YYYY-MM-DD"),this.maxDate=c()(),this.show=!1,this.optionChart={tooltip:{trigger:"axis",formatter:e=>{let t=c()(e[0].axisValue).format("DD-MM-YYYY")+"<br/>";return e.forEach(e=>{t+=2==e.seriesIndex?e.marker+" "+e.seriesName+": "+e.value[2]+"<br>":e.marker+" "+e.seriesName+": "+(new Intl.NumberFormat).format(e.value[1])+" <br>"}),t}},xAxis:{type:"time",splitLine:{show:!1},axisLabel:{formatter:e=>new Date(e).getDate()}},yAxis:[{type:"value",splitLine:{show:!1}},{type:"value",position:"right",splitLine:{show:!1}}],series:[{type:"line",smooth:!0,name:this._translate.translate("POND.HEALTH.MASS"),itemStyle:{color:"#00c853"}},{type:"bar",name:this._translate.translate("POND.HEALTH.LOSS"),barWidth:"10%",yAxisIndex:1},{symbolSize:20,name:this._translate.translate("POND.HEALTH.HEALTH"),type:"scatter",yAxisIndex:1,itemStyle:{shadowBlur:10,shadowColor:"rgba(120, 36, 50, 0.5)",shadowOffsetY:5}}]}}ngOnInit(){this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.getData(),this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.pondService.getHistory().pipe().subscribe(e=>{0==e.status||(this.minDate=new Date(1e3*e.data[0].start_time))},e=>{})}getData(){this.loadingFlag.setStart(!0),this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},c()(this.dateRangeSelected).format("YYYY-MM-DD")).subscribe(e=>{e.data?(this.dataRaw=e.data,this.dataRaw[0].date==c()(this.dateRangeSelected).format("YYYY-MM-DD")&&(this.itemSelected=this.dataRaw[0]),this.prepareData(this.dataRaw),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},e=>{this.loadingFlag.setResult(!1),this.alertService.error(e)})}prepareData(e){this.data=[];let t=[],n=[];e.forEach(e=>{e.weight>0&&this.data.push([e.date,e.weight]),e.loss>0&&t.push([e.date,e.loss]),e.note_health&&n.push([e.date,e.weight,e.note_health])}),this.data.reverse(),this.dataUpdate={series:[{data:this.data},{data:t},{data:n}]},console.log(this.dataUpdate)}onChangeDate(e){this.dateRangeSelected=e.value;let t=c()(this.dateRangeSelected);this.itemSelected=this.dataRaw[this.dataRaw.findIndex(e=>e.date==t.format("YYYY-MM-DD"))],(t<c()(this.dataRaw[this.dataRaw.length-1].date)||t>c()(this.dataRaw[0].date))&&this.getData()}changeDate(e){let t=c()(this.dateRangeSelected).add(e,"days");if(t<this.minDate||t>this.maxDate)return!1;this.dateRangeSelected=t.format("YYYY-MM-DD")}ngAfterViewInit(){this.show=!0}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(f.c),p.Y36(d.so),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-daily-heath"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto"],["mode","indeterminate",4,"ngIf"],[1,"text-center"],[1,"w-full","p-2"],["matInput","",3,"min","max","matDatepicker","ngModel","ngModelChange","dateChange"],["matSuffix","",3,"for"],["picker",""],["echarts","",1,"demo-chart",3,"options","merge"],["mode","indeterminate"]],template:function(e,t){1&e&&p.YNc(0,Nt,28,21,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.HEALTH")},directives:[g.KI,v.lW,d.ZT,y.Hw,i.O5,_.KE,_.hX,T.Nt,x.hl,o.Fj,o.JJ,o.On,x.nW,_.R9,x.Mq,Le.w,I.pW],pipes:[i.JJ],styles:[""]}),e})();function Dt(e,t){1&e&&p._UZ(0,"mat-progress-bar",23)}function Rt(e,t){1&e&&p._UZ(0,"mat-progress-bar",23)}function Ot(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.YNc(8,Dt,1,0,"mat-progress-bar",7),p.YNc(9,Rt,1,0,"mat-progress-bar",7),p.TgZ(10,"div",8),p.TgZ(11,"mat-form-field",9),p.TgZ(12,"mat-label"),p._uU(13),p.qZA(),p.TgZ(14,"input",10),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw().dateRangeSelected=t})("dateChange",function(t){return p.CHM(e),p.oxw().onChangeDate(t)}),p.qZA(),p._UZ(15,"mat-datepicker-toggle",11),p._UZ(16,"mat-datepicker",null,12),p.qZA(),p.qZA(),p.TgZ(18,"div",13),p.TgZ(19,"div",8),p.TgZ(20,"mat-form-field",14),p.TgZ(21,"mat-label"),p._uU(22),p.qZA(),p.TgZ(23,"input",15),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw().validateNo(t)}),p.qZA(),p.qZA(),p.TgZ(24,"mat-form-field",16),p.TgZ(25,"mat-label"),p._uU(26),p.qZA(),p.TgZ(27,"input",17),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw().validateNo(t)}),p.qZA(),p.qZA(),p.qZA(),p.TgZ(28,"div"),p.TgZ(29,"mat-form-field",18),p.TgZ(30,"mat-label"),p._uU(31),p.qZA(),p._UZ(32,"textarea",19),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(33,"div",20),p.TgZ(34,"button",21),p.NdJ("click",function(){return p.CHM(e),p.oxw().save()}),p._uU(35),p.qZA(),p.TgZ(36,"button",22),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(37),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(17),i=p.oxw();p.xp6(4),p.Oqu(e("UPDATE_TITLE")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(1),p.Q6J("formGroup",i.form),p.xp6(1),p.Q6J("ngIf",i.loadingFlag.pending),p.xp6(1),p.Q6J("ngIf",i.savingFlag.pending),p.xp6(4),p.Oqu(e("DATE")),p.xp6(1),p.Q6J("min",i.minDate)("max",i.maxDate.toDate())("matDatepicker",n)("ngModel",i.dateRangeSelected),p.xp6(1),p.Q6J("for",n),p.xp6(3),p.Q6J("formGroup",i.form),p.xp6(4),p.Oqu(e("OTHER_COSTS")),p.xp6(1),p.Q6J("placeholder",e("OTHER_COSTS")),p.xp6(3),p.Oqu(e("OTHER_INCOME")),p.xp6(1),p.Q6J("placeholder",e("OTHER_INCOME")),p.xp6(4),p.Oqu(e("NOTE")),p.xp6(1),p.Q6J("placeholder",e("NOTE")),p.xp6(2),p.Q6J("disabled",!i.form.valid),p.xp6(1),p.hij(" ",e("SAVE")," "),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let kt=(()=>{class e{constructor(e,t,n,i,r){this.pondService=e,this.alertService=t,this.dialogRef=n,this.data=i,this._translate=r,this.loadingFlag=new a.E,this.savingFlag=new a.E,this.dateRangeSelected=c()().format("YYYY-MM-DD"),this.maxDate=c()(),this.dataRaw=[],this.form=new o.cw({cost:new o.NI("",[o.kI.min(0)]),income:new o.NI("",[o.kI.min(0)]),note:new o.NI(""),onlyToday:new o.NI([new Date,o.kI.required])})}ngOnInit(){this.item=this.data.item,this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.item.date==this.dateRangeSelected&&(this.itemSelected=this.item),this.processData(),this.pondService.getHistory().pipe().subscribe(e=>{0==e.status||(this.minDate=new Date(1e3*e.data[0].start_time))},e=>{})}onChangeDate(e){this.dateRangeSelected=e.value;let t=c()(this.dateRangeSelected);this.dataRaw.length>0?(this.itemSelected=this.dataRaw[this.dataRaw.findIndex(e=>e.date==t.format("YYYY-MM-DD"))],this.processData(),(t<c()(this.dataRaw[this.dataRaw.length-1].date)||t>c()(this.dataRaw[0].date))&&this.getData()):this.getData()}changeDate(e){let t=c()(this.dateRangeSelected).add(e,"days");if(t<this.minDate||t>this.maxDate)return!1;this.dateRangeSelected=t.format("YYYY-MM-DD")}validateNo(e){const t=e.which?e.which:e.keyCode;return!(t>31&&(t<48||t>57))}getData(){this.loadingFlag.setStart(!0);let e=c()(this.dateRangeSelected).format("YYYY-MM-DD");this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},e).subscribe(t=>{t.data?(this.dataRaw=t.data,this.itemSelected=this.dataRaw[this.dataRaw.findIndex(t=>t.date==e)],this.processData(),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},e=>{this.loadingFlag.setResult(!1),this.alertService.error(e)})}save(){this.savingFlag.setPending(!0);let e=c()(this.dateRangeSelected).format("YYYY-MM-DD");this.pondService.fullUpdate({date:e,cost_other:this.form.value.cost,income:this.form.value.income,note_general:this.form.value.note}).subscribe(t=>{"success"==t.status?(this.alertService.success(this._translate.translate("UPDATE_SUCCESS")),this.savingFlag.setResult(!0),e==this.maxDate.format("YYYY-MM-DD")?this.dialogRef.close(this.form.value):this.dialogRef.close()):(this.alertService.error(t.message),this.savingFlag.setResult(!1))},()=>{this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}processData(){void 0!==this.itemSelected&&this.itemSelected&&(console.log(this.itemSelected),this.form.patchValue({cost:this.itemSelected.cost_other,income:this.itemSelected.income,note:this.itemSelected.note_general}))}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(f.c),p.Y36(d.so),p.Y36(d.WI),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-daily-note-update"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto",3,"formGroup"],["mode","indeterminate",4,"ngIf"],[1,"grid","grid-cols-2"],[1,"w-full","p-2"],["matInput","","formControlName","onlyToday","required","",3,"min","max","matDatepicker","ngModel","ngModelChange","dateChange"],["matSuffix","",3,"for"],["picker",""],[1,"p-2",3,"formGroup"],[1,"w-full","md:pr-2"],["matInput","","required","","formControlName","cost",3,"placeholder","keypress"],[1,"w-full"],["matInput","","required","","formControlName","income",3,"placeholder","keypress"],[1,"w-full","md:mr-2"],["matInput","","formControlName","note",3,"placeholder"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",3,"click"],["mode","indeterminate"]],template:function(e,t){1&e&&p.YNc(0,Ot,38,22,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.NOTE")},directives:[g.KI,v.lW,d.ZT,y.Hw,o.JL,o.sg,i.O5,_.KE,_.hX,T.Nt,o.Fj,x.hl,o.JJ,o.u,o.Q7,x.nW,_.R9,x.Mq,I.pW],styles:[""]}),e})();function Mt(e,t){1&e&&p._UZ(0,"mat-progress-bar",13)}function Ut(e,t){if(1&e&&(p.TgZ(0,"mat-list-item",14),p.TgZ(1,"div",15),p._uU(2),p.qZA(),p.qZA()),2&e){const e=p.oxw().$implicit;p.xp6(2),p.Oqu(e("NO_NOTES"))}}function Pt(e,t){if(1&e&&(p.TgZ(0,"div",17),p.TgZ(1,"span"),p._uU(2),p.qZA(),p.TgZ(3,"span"),p._uU(4),p.ALo(5,"number"),p.qZA(),p.qZA()),2&e){const e=p.oxw().$implicit,t=p.oxw().$implicit;p.xp6(2),p.Oqu(t("OTHER_INCOME")),p.xp6(2),p.hij("",p.lcZ(5,2,e.income)," \u0111")}}function Ft(e,t){if(1&e&&(p.TgZ(0,"div",17),p.TgZ(1,"span"),p._uU(2),p.qZA(),p.TgZ(3,"span"),p._uU(4),p.ALo(5,"number"),p.qZA(),p.qZA()),2&e){const e=p.oxw().$implicit,t=p.oxw().$implicit;p.xp6(2),p.Oqu(t("OTHER_COSTS")),p.xp6(2),p.hij("",p.lcZ(5,2,e.cost_other)," \u0111")}}function Lt(e,t){if(1&e&&(p.TgZ(0,"mat-list-item",14),p.TgZ(1,"div",15),p.TgZ(2,"small"),p._uU(3),p.ALo(4,"date"),p.qZA(),p._uU(5),p.qZA(),p.YNc(6,Pt,6,4,"div",16),p.YNc(7,Ft,6,4,"div",16),p.qZA()),2&e){const e=t.$implicit;p.xp6(3),p.Oqu(p.xi3(4,4,e.date,"dd-MM-yyyy")),p.xp6(2),p.hij(" | ",e.note_general,""),p.xp6(1),p.Q6J("ngIf",e.income>0),p.xp6(1),p.Q6J("ngIf",e.cost_other>0)}}function Jt(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"button",18),p.NdJ("click",function(){p.CHM(e);const t=p.oxw(2);return t.getData(t.pageLoaded+1)}),p._uU(1),p.qZA()}if(2&e){const e=p.oxw().$implicit;p.xp6(1),p.Oqu(e("MORE"))}}function Yt(e,t){if(1&e&&(p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.YNc(7,Mt,1,0,"mat-progress-bar",6),p.TgZ(8,"div",7),p.TgZ(9,"mat-list",8),p.YNc(10,Ut,3,1,"mat-list-item",9),p.YNc(11,Lt,8,7,"mat-list-item",10),p.qZA(),p.TgZ(12,"div",11),p.YNc(13,Jt,2,1,"button",12),p.qZA(),p.qZA(),p.qZA(),p.BQk()),2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Oqu(e("TITLE")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(1),p.Q6J("ngIf",n.loadingFlag.pending),p.xp6(3),p.Q6J("ngIf",0==n.items.length),p.xp6(1),p.Q6J("ngForOf",n.items),p.xp6(2),p.Q6J("ngIf",n.items.length%25==0)}}let Qt=(()=>{class e{constructor(e,t){this.pondService=e,this.dialogRef=t,this.items=[],this.loadingFlag=new a.E,this.pageLoaded=0}ngOnInit(){this.getData(0)}getData(e){this.loadingFlag.setStart(!0),this.pondService.loadDailyPaging({pageIndex:e,pageSize:30},c()().format("YYYY-MM-DD")).subscribe(e=>{e.data?(Array.prototype.push.apply(this.items,this.filter(e.data)),this.loadingFlag.setResult(!0),this.pageLoaded++):this.loadingFlag.setResult(!1)},e=>{this.loadingFlag.setResult(!1)})}filter(e){return e.filter(e=>parseInt(e.cost_other)>0||parseInt(e.income)>0&&"string"==typeof e.note_general)}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(d.so))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-daily-note"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],["mode","indeterminate",4,"ngIf"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","overflow-y-auto"],["role","list"],["role","listitem",4,"ngIf"],["role","listitem",4,"ngFor","ngForOf"],[1,"text-center"],["mat-button","",3,"click",4,"ngIf"],["mode","indeterminate"],["role","listitem"],["mat-line",""],["mat-line","","class","flex justify-between",4,"ngIf"],["mat-line","",1,"flex","justify-between"],["mat-button","",3,"click"]],template:function(e,t){1&e&&p.YNc(0,Yt,14,7,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.NOTE")},directives:[g.KI,v.lW,d.ZT,y.Hw,i.O5,J.i$,i.sg,I.pW,J.Tg,A.X2],pipes:[i.uU,i.JJ],styles:[""]}),e})();function Vt(e,t){if(1&e&&(p.TgZ(0,"mat-error"),p._uU(1),p.qZA()),2&e){const e=p.oxw().$implicit;p.xp6(1),p.hij(" ",e("VALUE_ERROR")," ")}}function jt(e,t){if(1&e&&(p.TgZ(0,"mat-error"),p._uU(1),p.qZA()),2&e){const e=p.oxw().$implicit;p.xp6(1),p.hij(" ",e("VALUE_OVERFLOW")," ")}}function Ht(e,t){1&e&&p._UZ(0,"mat-progress-bar",17)}function $t(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.TgZ(8,"mat-form-field",7),p.TgZ(9,"mat-label"),p._uU(10),p.qZA(),p._UZ(11,"input",8),p._UZ(12,"mat-datepicker-toggle",9),p._UZ(13,"mat-datepicker",null,10),p.qZA(),p.TgZ(15,"mat-form-field",7),p.TgZ(16,"input",11),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw().validNo(t)}),p.qZA(),p.YNc(17,Vt,2,1,"mat-error",12),p.YNc(18,jt,2,1,"mat-error",12),p.qZA(),p.qZA(),p.YNc(19,Ht,1,0,"mat-progress-bar",13),p.TgZ(20,"div",14),p.TgZ(21,"button",15),p.NdJ("click",function(){return p.CHM(e),p.oxw().onSave()}),p._uU(22),p.qZA(),p.TgZ(23,"button",16),p.NdJ("click",function(){return p.CHM(e),p.oxw().onNoClick()}),p._uU(24),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(14),i=p.oxw();p.xp6(4),p.AsE("",e("UPDATE_TITLE")," ",i.data.label,""),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(1),p.Q6J("formGroup",i.form),p.xp6(3),p.Oqu(e("DATE")),p.xp6(1),p.Q6J("min",i.minDate.toDate())("max",i.maxDate.toDate())("matDatepicker",n),p.xp6(1),p.Q6J("for",n),p.xp6(4),p.Q6J("placeholder",e("ENTER_VALUE")),p.xp6(1),p.Q6J("ngIf",i.form.controls.value.hasError("min")||i.form.controls.value.hasError("max")),p.xp6(1),p.Q6J("ngIf",i.form.controls.value.hasError("required")),p.xp6(1),p.Q6J("ngIf",i.saveLoadingFlag.pending),p.xp6(2),p.Q6J("disabled",i.form.invalid),p.xp6(1),p.Oqu(e("SAVE")),p.xp6(2),p.Oqu(e("CANCEL"))}}let Bt=(()=>{class e{constructor(e,t,n,i,r){this.alertService=e,this.pondService=t,this.dialogRef=n,this.data=i,this._translate=r,this.saveLoadingFlag=new a.E,this.form=new o.cw({date:new o.NI(c()().format("YYYY-MM-DD")),value:new o.NI("",[o.kI.required,o.kI.min(0)])}),this.seedsSuggest=[.9,.95,1,1.05,1.1],this.valueSuggest=[],this.maxDate=c()(),this.minDate=c()().subtract(180,"days")}ngOnInit(){this.factor=this.data.param,this.form.patchValue({value:this.factor.values[0]}),this.form.controls.value.setValidators([o.kI.min(this.factor.min),o.kI.max(this.factor.max)]),console.log(this.form),this.factor.values[0]>0&&this.seedsSuggest.forEach(e=>{let t=+(e*this.factor.values[0]).toFixed(1);-1==this.valueSuggest.indexOf(+t)&&this.valueSuggest.push(t)}),console.log(this.factor.max),this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.form.controls.date.valueChanges.subscribe(e=>{let t=c()(e).format("YYYY-MM-DD");this.pondService.loadDay(t).subscribe(e=>{e.data?this.form.patchValue({value:e.data[this.factor.key]}):this.form.controls.value.reset()}),console.log(this.form.value)})}onSave(){this.saveLoadingFlag.setPending(!0);let e={};e[this.factor.key]=this.form.value.value;let t=c()(this.form.value.date).format("YYYY-MM-DD");this.pondService.quickUpdateParam(e,t).pipe().subscribe(e=>{this.alertService.success(e.message),this.saveLoadingFlag.setResult(!0),this.form.value.date==this.maxDate.format("YYYY-MM-DD")?this.dialogRef.close({value:this.form.value.value}):this.dialogRef.close(!1)},()=>{this.saveLoadingFlag.setResult(!1),this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}choiceSuggest(e){this.form.patchValue({value:e})}changeDate(e){let t=c()(this.form.value.date).add(e,"days");if(t<this.minDate||t>this.maxDate)return!1;this.form.patchValue({date:t.format("YYYY-MM-DD")}),console.log(this.form.value)}onNoClick(){this.dialogRef.close()}validNo(e){const t=e.which?e.which:e.keycode;return!(t>31&&(t<46||t>57))}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(f.c),p.Y36(m.p),p.Y36(d.so),p.Y36(d.WI),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-daily-parameter-update"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto",3,"formGroup"],[1,"w-full"],["matInput","","formControlName","date",3,"min","max","matDatepicker"],["matSuffix","",3,"for"],["picker",""],["matInput","","min","0","type","number","required","","matInputAutofocus","","formControlName","value",3,"placeholder","keypress"],[4,"ngIf"],["mode","indeterminate",4,"ngIf"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","type","submit","color","primary","cdkFocusInitial","",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",3,"click"],["mode","indeterminate"]],template:function(e,t){1&e&&p.YNc(0,$t,25,17,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.PARAMETER")},directives:[g.KI,v.lW,d.ZT,y.Hw,o.JL,o.sg,_.KE,_.hX,T.Nt,o.Fj,x.hl,o.JJ,o.u,x.nW,_.R9,x.Mq,o.qQ,o.wV,o.Q7,i.O5,_.TO,I.pW],styles:[""]}),e})();function zt(e,t){1&e&&p._UZ(0,"mat-progress-bar",13)}const Gt=function(e){return{color:e}};function Wt(e,t){if(1&e&&(p.TgZ(0,"div",18),p.TgZ(1,"div",19),p._uU(2),p.qZA(),p.TgZ(3,"div",20),p._uU(4),p.ALo(5,"number"),p.qZA(),p.qZA()),2&e){const e=t.$implicit;p.Q6J("ngStyle",p.VKq(6,Gt,e.colorStr)),p.xp6(2),p.hij(" ",e.name," "),p.xp6(2),p.hij(" ",p.xi3(5,3,e.values[0],"1.0-1")," ")}}function Kt(e,t){if(1&e&&p._UZ(0,"div",21),2&e){const e=p.oxw().$implicit,t=p.oxw(2);p.Q6J("options",t.groupsChartOption[e])("merge",t.groupsChartData[e])}}function Xt(e,t){if(1&e&&(p.TgZ(0,"div",14),p.TgZ(1,"div",15),p.YNc(2,Wt,6,8,"div",16),p.qZA(),p.YNc(3,Kt,1,2,"div",17),p.qZA()),2&e){const e=t.$implicit,n=p.oxw(2);p.xp6(2),p.Q6J("ngForOf",n.groupsChartLabel[e]),p.xp6(1),p.Q6J("ngIf",n.view)}}function en(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.YNc(8,zt,1,0,"mat-progress-bar",7),p.TgZ(9,"mat-form-field",8),p.TgZ(10,"mat-label"),p._uU(11),p.qZA(),p.TgZ(12,"input",9),p.NdJ("dateChange",function(t){return p.CHM(e),p.oxw().onChangeDate(t)}),p.qZA(),p._UZ(13,"mat-datepicker-toggle",10),p._UZ(14,"mat-datepicker",null,11),p.qZA(),p.YNc(16,Xt,4,2,"div",12),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(15),i=p.oxw();p.xp6(4),p.Oqu(e("TITLE")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(2),p.Q6J("ngIf",i.loadingFlag.pending),p.xp6(3),p.Oqu(e("DATE")),p.xp6(1),p.Q6J("formControl",i.date)("min",i.minDate)("max",i.maxDate.toDate())("matDatepicker",n),p.xp6(1),p.Q6J("for",n),p.xp6(3),p.Q6J("ngForOf",i.groupsChart)}}let tn=(()=>{class e{constructor(e,t,n){this.pondService=e,this.alertService=t,this.dialogRef=n,this.maxDate=c()(),this.date=new o.NI(new Date),this.view=!1,this.factor="",this.loadingFlag=new a.E,this.data=[],this.dataRaw=[],this.dateRangeSelected=c()().format("YYYY-MM-DD"),this.dateMax=c()().format("YYYY-MM-DD"),this.numberGroupChart=0,this.groupsChart=[],this.test=[],this.groupsChartOption=[],this.groupsChartData=[],this.groupsChartLabel=[],this.optionLine={tooltip:{trigger:"axis",formatter:e=>{let t=c()(e[0].value[0]).format("DD-MM-YYYY")+"<br/>";return e.forEach(e=>{t+=e.marker+e.seriesName+" : "+(new Intl.NumberFormat).format(e.value[1])+"<br>"}),t},axisPointer:{animation:!0}},xAxis:{type:"time",splitLine:{show:!1},axisLabel:{formatter:function(e){return new Date(e).getDate()}}},yAxis:[],series:[]}}ngOnInit(){this.paramSelected=this.pondService.trackingPamameters[0],this.paramSelectedItem=this.pondService.trackingObjects[0],console.log(this.pondService.trackingPamameters),this.numberGroupChart=Math.ceil(this.pondService.trackingPamameters.length/4),console.log(this.numberGroupChart),this.getData(),console.log(this.data),this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.pondService.getHistory().pipe().subscribe(e=>{0==e.status||(this.minDate=new Date(1e3*e.data[0].start_time))},e=>{})}onChangeDate(e){this.dateRangeSelected=c()(e.value).format("YYYY-MM-DD"),this.getData(),console.log(this.groupsChartOption)}onChangeParam(){this.paramSelectedItem=this.pondService.trackingObjects[this.pondService.trackingObjects.findIndex(e=>e.key==this.paramSelected)],this.prepareData(this.dataRaw)}getData(){this.loadingFlag.setStart(!0),this.pondService.loadParamDaily(this.dateRangeSelected,30).subscribe(e=>{e.data?(this.dataRaw=e.data,console.log(this.dataRaw),this.prepareData(this.dataRaw),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},e=>{this.loadingFlag.setResult(!1),console.log(e)})}prepareData(e){console.log("run s"),console.log("run"),e.forEach(e=>{let t=new Date(e.date);this.pondService.trackingObjects.forEach(n=>{void 0===this.data[n.key]&&(this.data[n.key]=[]),this.data[n.key].unshift({name:t.toString(),value:[e.date,e[n.key]]})})});for(let t=0;t<this.numberGroupChart;t++){this.test.push(t),this.groupsChart=this.test.filter((e,t,n)=>n.indexOf(e)==t);let e=this.pondService.trackingObjects.slice(4*t,4*(t+1));this.groupsChartLabel.push(e),console.log(this.groupsChartLabel),console.log(e);let n=[],i=[];e.forEach((e,t)=>{n.push({show:0==t,type:"value",name:e.name,min:e.min,max:e.max,axisLabel:{formatter:t=>e.max>=1e6?t/1e6+"tri\u1ec7u":e.max>=1e5&&e.max<1e6?t/1e5+"tr\u0103m":t}}),i.push({data:this.data[e.key],type:"line",yAxisIndex:t,itemStyle:{color:e.colorStr},smooth:!0,name:e.name,showSymbol:!0,hoverAnimation:!0})}),this.groupsChartOption.push(this.setChartOption(n)),this.groupsChartData.push({series:i})}}setChartOption(e){let t=Object.assign({},this.optionLine);return t.yAxis=e,t}onNoClick(){this.dialogRef.close()}ngAfterViewInit(){this.view=!0}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(f.c),p.Y36(d.so))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-daily-parameter"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto"],["mode","indeterminate",4,"ngIf"],[1,"w-full"],["matInput","",3,"formControl","min","max","matDatepicker","dateChange"],["matSuffix","",3,"for"],["picker",""],["class","data-item",4,"ngFor","ngForOf"],["mode","indeterminate"],[1,"data-item"],[1,"grid","grid-cols-4","gap-4"],["class","ion-text-center",3,"ngStyle",4,"ngFor","ngForOf"],["echarts","","class","demo-chart",3,"options","merge",4,"ngIf"],[1,"ion-text-center",3,"ngStyle"],[1,"ion-text-uppercase","title"],[1,"para-value"],["echarts","",1,"demo-chart",3,"options","merge"]],template:function(e,t){1&e&&p.YNc(0,en,17,11,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.PARAMETER")},directives:[g.KI,v.lW,d.ZT,y.Hw,i.O5,_.KE,_.hX,T.Nt,o.Fj,x.hl,o.JJ,o.oH,x.nW,_.R9,x.Mq,i.sg,I.pW,i.PC,Le.w],pipes:[i.JJ],styles:[""]}),e})();function nn(e,t){if(1&e&&p._UZ(0,"img",23),2&e){const e=p.oxw(2);p.Q6J("src",e.pathPhoto,p.LSH)}}function rn(e,t){1&e&&p._UZ(0,"mat-progress-bar",24)}function sn(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.TgZ(8,"mat-form-field",7),p.TgZ(9,"mat-label"),p._uU(10),p.qZA(),p.TgZ(11,"input",8),p.NdJ("dateChange",function(t){return p.CHM(e),p.oxw().onChangeDate(t)}),p.qZA(),p._UZ(12,"mat-datepicker-toggle",9),p._UZ(13,"mat-datepicker",null,10),p.qZA(),p.TgZ(15,"div",11),p.YNc(16,nn,1,1,"img",12),p.TgZ(17,"button",13),p.NdJ("click",function(){return p.CHM(e),p.MAs(22).click()}),p._UZ(18,"mat-icon",14),p.TgZ(19,"span",15),p._uU(20),p.qZA(),p.qZA(),p.qZA(),p.TgZ(21,"input",16,17),p.NdJ("change",function(t){return p.CHM(e),p.oxw().choosePhoto(t)}),p.qZA(),p.TgZ(23,"mat-form-field",7),p._UZ(24,"textarea",18),p.qZA(),p.qZA(),p.YNc(25,rn,1,0,"mat-progress-bar",19),p.TgZ(26,"div",20),p.TgZ(27,"button",21),p.NdJ("click",function(){return p.CHM(e),p.oxw().onSave()}),p._uU(28),p.qZA(),p.TgZ(29,"button",22),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(30),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(14),i=p.oxw();p.xp6(4),p.Oqu(e("DAILY_PHOTO_UPDATE")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(1),p.Q6J("formGroup",i.form),p.xp6(3),p.Oqu(e("DATE")),p.xp6(1),p.Q6J("min",i.minDate.toDate())("max",i.maxDate.toDate())("matDatepicker",n),p.xp6(1),p.Q6J("for",n),p.xp6(4),p.Q6J("ngIf",i.pathPhoto),p.xp6(1),p.Q6J("color","primary"),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:upload"),p.xp6(2),p.Oqu(e("CHOOSE_IMAGE")),p.xp6(4),p.Q6J("placeholder","M\xf4 t\u1ea3"),p.xp6(1),p.Q6J("ngIf",i.saveLoadingFlag.pending),p.xp6(2),p.Q6J("disabled",i.form.invalid),p.xp6(1),p.Oqu(e("SAVE")),p.xp6(2),p.Oqu(e("CANCEL"))}}let on=(()=>{class e{constructor(e,t,n,i,r){this.translateService=e,this.pondService=t,this.alertService=n,this.dialogRef=i,this.data=r,this.saveLoadingFlag=new a.E,this.loadingFlag=new a.E,this.form=new o.cw({date:new o.NI(c()().format("YYYY-MM-DD")),description:new o.NI("",[o.kI.required])}),this.maxDate=c()(),this.minDate=c()().subtract(180,"days"),this.dateRangeSelected=c()().format("YYYY-MM-DD"),this.myFormDataPhoto=new FormData}ngOnInit(){console.log(this.data),this.itemSelected=this.data.inforDaily,this.dataRaw=[this.itemSelected],this.setData(this.itemSelected)}choosePhoto(e){let t=e.target.files;if(t.length>0){this.myPhoto=t[0],this.namePhoto=this.myPhoto.name;var n=new FileReader;n.readAsDataURL(this.myPhoto),n.onload=e=>{this.pathPhoto=n.result},this.myFormDataPhoto=new FormData,this.myFormDataPhoto.append("image",this.myPhoto)}}onSave(){this.myFormDataPhoto.append("description",this.form.value.description),this.myFormDataPhoto.append("date",c()(this.form.value.date).format("YYYY-MM-DD")),this.pondService.uploadPhoto(this.myFormDataPhoto,this.namePhoto).pipe().subscribe(e=>{1==e.status?(this.alertService.success(this.translateService.translate("UPDATE_SUCCESS")),this.dialogRef.close({image:e.data,description:this.form.value.description,date:c()(this.form.value.date).format("YYYY-MM-DD")})):this.alertService.error(e.error),this.saveLoadingFlag.setResult(!0)},e=>{this.saveLoadingFlag.setResult(!1),this.alertService.error(this.translateService.translate("CONNECT_ERROR"))})}onChangeDate(e){this.dateRangeSelected=e.value;let t=c()(this.dateRangeSelected);this.pathPhoto="",this.dataRaw.length>0?(this.itemSelected=this.dataRaw[this.dataRaw.findIndex(e=>e.date==t.format("YYYY-MM-DD"))],this.setData(this.itemSelected),(t<c()(this.dataRaw[this.dataRaw.length-1].date)||t>c()(this.dataRaw[0].date))&&this.getData()):this.getData()}setData(e){void 0!==e&&(this.form.patchValue({description:e.description}),this.pathPhoto=e.image?Se.bl.FILE_PATH+"/upload/season/"+this.data.scode+"/thumb_image/"+e.image:"",console.log(this.pathPhoto))}changeDate(e){let t=c()(this.dateRangeSelected).add(e,"days");if(t<this.minDate||t>this.maxDate)return!1;this.dateRangeSelected=t.format("YYYY-MM-DD")}getData(){this.loadingFlag.setStart(!0);let e=c()(this.dateRangeSelected).format("YYYY-MM-DD");this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},e).subscribe(t=>{t.data?(this.dataRaw=t.data,this.itemSelected=this.dataRaw[this.dataRaw.findIndex(t=>t.date==e)],this.setData(this.itemSelected),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},e=>{this.loadingFlag.setResult(!1),this.alertService.error(e)})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(g.Vn),p.Y36(m.p),p.Y36(f.c),p.Y36(d.so),p.Y36(d.WI))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-daily-photo-update"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto",3,"formGroup"],[1,"w-full"],["matInput","","formControlName","date",3,"min","max","matDatepicker","dateChange"],["matSuffix","",3,"for"],["picker",""],[1,"flex","flex-col","items-center","justify-between","pb-2"],["class","w-min",3,"src",4,"ngIf"],["mat-button","",1,"my-2",3,"color","click"],[1,"icon-size-5",3,"svgIcon"],[1,"ml-2"],["type","file","accept","image/*",1,"hidden",3,"change"],["file",""],["matInput","","maxlength","255","required","","matInputAutofocus","","formControlName","description",3,"placeholder"],["mode","indeterminate",4,"ngIf"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","type","submit","color","primary","cdkFocusInitial","",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",3,"click"],[1,"w-min",3,"src"],["mode","indeterminate"]],template:function(e,t){1&e&&p.YNc(0,sn,31,18,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.PHOTO")},directives:[g.KI,v.lW,d.ZT,y.Hw,o.JL,o.sg,_.KE,_.hX,T.Nt,o.Fj,x.hl,o.JJ,o.u,x.nW,_.R9,x.Mq,i.O5,o.nD,o.Q7,I.pW],styles:[""]}),e})();function an(e,t){1&e&&p._UZ(0,"mat-progress-bar",14)}function ln(e,t){if(1&e&&p._UZ(0,"img",15),2&e){const e=p.oxw(2);p.Q6J("src",e.pathPhoto,p.LSH)}}function cn(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.TgZ(8,"mat-form-field",7),p.TgZ(9,"mat-label"),p._uU(10),p.qZA(),p.TgZ(11,"input",8),p.NdJ("dateChange",function(t){return p.CHM(e),p.oxw().onChangeDate(t)}),p.qZA(),p._UZ(12,"mat-datepicker-toggle",9),p._UZ(13,"mat-datepicker",null,10),p.qZA(),p.YNc(15,an,1,0,"mat-progress-bar",11),p.TgZ(16,"div",12),p.YNc(17,ln,1,1,"img",13),p.TgZ(18,"p"),p._uU(19),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(14),i=p.oxw();p.xp6(4),p.Oqu(e("DAILY_PHOTO_UPDATE")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(1),p.Q6J("formGroup",i.form),p.xp6(3),p.Oqu(e("DATE")),p.xp6(1),p.Q6J("min",i.minDate.toDate())("max",i.maxDate.toDate())("matDatepicker",n),p.xp6(1),p.Q6J("for",n),p.xp6(3),p.Q6J("ngIf",i.loadingFlag.pending),p.xp6(2),p.Q6J("ngIf",i.pathPhoto),p.xp6(2),p.Oqu(null==i.itemSelected?null:i.itemSelected.description)}}let un=(()=>{class e{constructor(e,t,n,i,r){this.translateService=e,this.pondService=t,this.alertService=n,this.dialogRef=i,this.data=r,this.loadingFlag=new a.E,this.form=new o.cw({date:new o.NI(c()().format("YYYY-MM-DD")),description:new o.NI("",[o.kI.required,o.kI.max(255)])}),this.maxDate=c()(),this.minDate=c()().subtract(180,"days"),this.dateRangeSelected=c()().format("YYYY-MM-DD")}ngOnInit(){console.log(this.data),this.itemSelected=this.data.inforDaily,this.dataRaw=[this.itemSelected],this.setData(this.itemSelected)}onChangeDate(e){this.dateRangeSelected=e.value;let t=c()(this.dateRangeSelected);this.dataRaw.length>0?(this.itemSelected=this.dataRaw[this.dataRaw.findIndex(e=>e.date==t.format("YYYY-MM-DD"))],this.setData(this.itemSelected),(t<c()(this.dataRaw[this.dataRaw.length-1].date)||t>c()(this.dataRaw[0].date))&&this.getData()):this.getData()}setData(e){void 0!==e&&(this.form.patchValue({description:e.description}),this.pathPhoto=e.image?Se.bl.FILE_PATH+"/upload/season/"+this.data.scode+"/thumb_image/"+e.image:"",console.log(this.pathPhoto))}changeDate(e){let t=c()(this.dateRangeSelected).add(e,"days");if(t<this.minDate||t>this.maxDate)return!1;this.dateRangeSelected=t.format("YYYY-MM-DD")}getData(){this.loadingFlag.setStart(!0);let e=c()(this.dateRangeSelected).format("YYYY-MM-DD");this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},e).subscribe(t=>{t.data?(this.dataRaw=t.data,this.itemSelected=this.dataRaw[this.dataRaw.findIndex(t=>t.date==e)],this.setData(this.itemSelected),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},e=>{this.loadingFlag.setResult(!1),this.alertService.error(e)})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(g.Vn),p.Y36(m.p),p.Y36(f.c),p.Y36(d.so),p.Y36(d.WI))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-daily-photo"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","overflow-y-auto",3,"formGroup"],[1,"w-full"],["matInput","","formControlName","date",3,"min","max","matDatepicker","dateChange"],["matSuffix","",3,"for"],["picker",""],["mode","indeterminate",4,"ngIf"],[1,"flex","justify-between","pb-3"],["class","w-min",3,"src",4,"ngIf"],["mode","indeterminate"],[1,"w-min",3,"src"]],template:function(e,t){1&e&&p.YNc(0,cn,20,12,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.PHOTO")},directives:[g.KI,v.lW,d.ZT,y.Hw,o.JL,o.sg,_.KE,_.hX,T.Nt,o.Fj,x.hl,o.JJ,o.u,x.nW,_.R9,x.Mq,i.O5,I.pW],styles:[""]}),e})();var dn=n(1769),hn=n(45396);function pn(e,t){if(1&e&&(p.TgZ(0,"small"),p._uU(1),p.ALo(2,"number"),p.qZA()),2&e){const e=p.oxw(2);p.xp6(1),p.hij("\xb1",p.xi3(2,1,(null==e.todayData?null:e.todayData.quantityPCSDelta)/1e3,"1.0-1"),"")}}function mn(e,t){if(1&e&&(p.TgZ(0,"small"),p._uU(1),p.ALo(2,"number"),p.qZA()),2&e){const e=p.oxw(2);p.xp6(1),p.hij("\xb1",p.xi3(2,1,(null==e.todayData?null:e.todayData.quantityDelta)/1e3,"1.0-1"),"")}}function fn(e,t){if(1&e&&(p.TgZ(0,"small"),p._uU(1),p.ALo(2,"number"),p.qZA()),2&e){const e=p.oxw(2);p.xp6(1),p.hij("\xb1",p.xi3(2,1,(null==e.next7Data?null:e.next7Data.quantityDelta)/1e3,"1.0-1"),"")}}function gn(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._UZ(4,"span",4),p.qZA(),p.TgZ(5,"button",5),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._UZ(6,"mat-icon",6),p.qZA(),p.qZA(),p.TgZ(7,"mat-dialog-content"),p.TgZ(8,"h2",7),p.TgZ(9,"b"),p._UZ(10,"mat-icon",8),p._uU(11),p.qZA(),p.qZA(),p.TgZ(12,"div",9),p.TgZ(13,"span"),p._uU(14),p.TgZ(15,"small"),p._uU(16),p.qZA(),p.qZA(),p.TgZ(17,"b"),p._uU(18),p.ALo(19,"number"),p.qZA(),p.qZA(),p._UZ(20,"mat-divider"),p.TgZ(21,"div",9),p.TgZ(22,"span"),p._uU(23),p.TgZ(24,"small"),p._uU(25),p.ALo(26,"number"),p.qZA(),p.qZA(),p.TgZ(27,"b"),p._uU(28),p.ALo(29,"number"),p.TgZ(30,"small"),p._uU(31,"g"),p.qZA(),p.qZA(),p.qZA(),p._UZ(32,"mat-divider"),p.TgZ(33,"div",9),p.TgZ(34,"span"),p._uU(35),p.TgZ(36,"small"),p._uU(37),p.qZA(),p.qZA(),p.TgZ(38,"b"),p._uU(39),p.ALo(40,"number"),p.YNc(41,pn,3,4,"small",10),p.qZA(),p.qZA(),p._UZ(42,"mat-divider"),p.TgZ(43,"div",9),p.TgZ(44,"span"),p._uU(45),p.TgZ(46,"small"),p._uU(47),p.qZA(),p.qZA(),p.TgZ(48,"b"),p._uU(49),p.ALo(50,"number"),p.YNc(51,mn,3,4,"small",10),p.qZA(),p.qZA(),p._UZ(52,"mat-divider"),p.TgZ(53,"div",9),p.TgZ(54,"span"),p._uU(55),p.qZA(),p.TgZ(56,"b"),p._uU(57),p.ALo(58,"number"),p.qZA(),p.qZA(),p._UZ(59,"mat-divider"),p.TgZ(60,"div",9),p.TgZ(61,"span"),p._uU(62),p.qZA(),p.TgZ(63,"b"),p._uU(64),p.ALo(65,"number"),p.qZA(),p.qZA(),p.TgZ(66,"h2",7),p.TgZ(67,"b"),p._UZ(68,"mat-icon",8),p._uU(69),p.qZA(),p.qZA(),p.TgZ(70,"div",9),p.TgZ(71,"span"),p._uU(72),p.TgZ(73,"small"),p._uU(74),p.ALo(75,"number"),p.qZA(),p.qZA(),p.TgZ(76,"b"),p._uU(77),p.ALo(78,"number"),p.TgZ(79,"small"),p._uU(80,"g"),p.qZA(),p.qZA(),p.qZA(),p._UZ(81,"mat-divider"),p.TgZ(82,"div",9),p.TgZ(83,"span"),p._uU(84),p.TgZ(85,"small"),p._uU(86),p.qZA(),p.qZA(),p.TgZ(87,"b"),p._uU(88),p.ALo(89,"number"),p.YNc(90,fn,3,4,"small",10),p.qZA(),p.qZA(),p._UZ(91,"mat-divider"),p.TgZ(92,"div",9),p.TgZ(93,"span"),p._uU(94),p.qZA(),p.TgZ(95,"b"),p._uU(96),p.ALo(97,"number"),p.qZA(),p.qZA(),p._UZ(98,"mat-divider"),p.TgZ(99,"div",9),p.TgZ(100,"span"),p._uU(101),p.qZA(),p.TgZ(102,"b"),p._uU(103),p.ALo(104,"number"),p.qZA(),p.qZA(),p._UZ(105,"mat-divider"),p.TgZ(106,"div",9),p.TgZ(107,"span"),p._uU(108),p.qZA(),p.TgZ(109,"b"),p._uU(110),p.ALo(111,"number"),p.qZA(),p.qZA(),p._UZ(112,"mat-divider"),p.TgZ(113,"div",9),p.TgZ(114,"span"),p._uU(115),p.qZA(),p.TgZ(116,"b"),p._uU(117),p.ALo(118,"number"),p.qZA(),p.qZA(),p.TgZ(119,"div",11),p.TgZ(120,"mat-form-field",12),p.TgZ(121,"input",13),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw().price=t}),p.qZA(),p.qZA(),p.TgZ(122,"mat-slide-toggle",14),p.NdJ("change",function(t){return p.CHM(e),p.oxw().setDelta(t)}),p._uU(123),p.qZA(),p.qZA(),p.TgZ(124,"div",7),p.TgZ(125,"p"),p._uU(126),p.qZA(),p.TgZ(127,"p"),p._uU(128),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Q6J("innerHTML",e("TITLE"),p.oJD),p.xp6(2),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(4),p.Q6J("svgIcon","iconsmind:medical_sign"),p.xp6(1),p.hij(" ",e("TODAY")," "),p.xp6(3),p.hij("",e("GROW_RATE")," "),p.xp6(2),p.Oqu(e("GRAM_DAY")),p.xp6(2),p.Oqu(p.xi3(19,48,n.data.grow_speed,"0.0-1")),p.xp6(5),p.hij("",e("SIZE")," "),p.xp6(2),p.AsE("(",p.xi3(26,51,1e3/n.data.weight,"1.0-1")," ",e("PIECE_KG"),")"),p.xp6(3),p.hij("",p.xi3(29,54,n.data.weight,"1.0-1")," "),p.xp6(7),p.hij("",e("QUANTITY")," "),p.xp6(2),p.hij("(",e("THOUSANDS"),")"),p.xp6(2),p.hij("",p.xi3(40,57,(null==n.todayData?null:n.todayData.quantityPCS)/1e3,"1.0-1")," "),p.xp6(2),p.Q6J("ngIf",n.showDelta),p.xp6(4),p.hij("",e("MASS")," "),p.xp6(2),p.hij("(",e("TONES"),")"),p.xp6(2),p.hij("",p.xi3(50,60,n.todayData.quantity/1e3,"1.0-2")," "),p.xp6(2),p.Q6J("ngIf",n.showDelta),p.xp6(4),p.Oqu(e("REVENUE")),p.xp6(2),p.Oqu(p.xi3(58,63,n.todayData.quantity*n.price,"1.0-0")),p.xp6(5),p.Oqu(e("PROFIT")),p.xp6(2),p.Oqu(p.xi3(65,66,n.todayData.quantity*n.price-n.todayData.cost,"1.0-0")),p.xp6(4),p.Q6J("svgIcon","iconsmind:medical_sign"),p.xp6(1),p.AsE(" ",n.day," ",e("DAY_LATER")," "),p.xp6(3),p.hij("",e("SIZE")," "),p.xp6(2),p.AsE("(",p.xi3(75,69,1e3/n.next7Data.weight,"1.0-1")," ",e("PIECE_KG"),")"),p.xp6(3),p.hij("",p.xi3(78,72,n.next7Data.weight,"1.0-1")," "),p.xp6(7),p.hij("",e("MASS")," "),p.xp6(2),p.hij("(",e("TONES"),")"),p.xp6(2),p.hij("",p.xi3(89,75,n.next7Data.quantity/1e3,"1.0-2")," "),p.xp6(2),p.Q6J("ngIf",n.showDelta),p.xp6(4),p.Oqu(e("EXPECTED_PRICE")),p.xp6(2),p.Oqu(p.xi3(97,78,n.price7day,"1.0-1")),p.xp6(5),p.Oqu(e("EXTRA_COSTS")),p.xp6(2),p.Oqu(p.xi3(104,81,n.next7Data.deltaCost,"1.0-0")),p.xp6(5),p.Oqu(e("REVENUE")),p.xp6(2),p.Oqu(p.xi3(111,84,n.next7Data.quantity*n.price7day,"1.0-0")),p.xp6(5),p.Oqu(e("PROFIT")),p.xp6(2),p.Oqu(p.xi3(118,87,n.next7Data.quantity*n.price7day-n.next7Data.cost,"1.0-0")),p.xp6(4),p.Q6J("placeholder",e("ENTER_PRICE"))("ngModel",n.price),p.xp6(1),p.Q6J("checked",n.showDelta),p.xp6(1),p.hij("",e("SHOW_DEVIATION")," "),p.xp6(3),p.Oqu(e("ESTIMATE_NOTE")),p.xp6(2),p.Oqu(e("PRICES_FROM"))}}let vn=(()=>{class e{constructor(e,t,n,i){this.pondService=e,this.dialogRef=t,this.dataInput=n,this.alertService=i,this.costLoadingFlag=new a.E,this.priceLoadingFlag=new a.E,this.showDelta=!1,this.todayData={},this.next7Data={},this.priceList=[],this.price=0,this.price7day=0,this.day=7}ngOnInit(){this.data=this.dataInput.data,this.procedure=this.dataInput.procedure,this.season=this.dataInput.season,this.procesEstimate(),"company_manager"==this.pondService.permission&&this.loadCost(),console.log(this.data)}procesEstimate(){this.procedure&&this.procedure.culture_day>0&&this.procedure.FCR>0&&this.procedure.survival_ratio>0?(this.todayData.quantityPCSTheory=this.data.old<this.procedure.culture_day?this.data.old*this.pondService.seasonInfo.seedQuantity*this.procedure.survival_ratio/this.procedure.culture_day:this.pondService.seasonInfo.seedQuantity*this.procedure.survival_ratio,this.todayData.quantityPCSDelta=Math.abs(this.todayData.quantityPCSTheory-this.data.quantity_pcs)/2,this.todayData.quantityFCR=this.data.feed/parseFloat(this.procedure.FCR),this.next7Data.quantityPCSTheory=(this.data.old+this.day)*this.pondService.seasonInfo.seedQuantity*this.procedure.survival_ratio/this.procedure.culture_day,this.next7Data.quantityPCSDelta=Math.abs(this.next7Data.quantityPCSTheory-this.data.quantity_pcs)/2):(this.todayData.quantityPCSDelta=0,this.todayData.quantityPCSTheory=this.data.quantity_pcs,this.todayData.quantityFCR=this.data.quantity_pcs*this.data.weight/1e3,this.next7Data.quantityPCSDelta=0,this.next7Data.quantityPCSTheory=this.data.quantity_pcs),this.todayData.quantity=Math.min(this.todayData.quantityPCSTheory*this.data.weight/1e3,this.data.quantity,this.todayData.quantityFCR),this.todayData.quantityDelta=Math.abs(this.todayData.quantity-Math.max(this.todayData.quantityPCSTheory*this.data.weight/1e3,this.data.quantity,this.todayData.quantityFCR))/2,this.todayData.quantityPCS=1e3*this.todayData.quantity/this.data.weight,this.next7Data.weight=this.data.grow_speed*this.day+this.data.weight,this.next7Data.quantity=this.todayData.quantityPCS*this.next7Data.weight/1e3,this.getCurrentPrice()}loadCost(){this.costLoadingFlag.setStart(!0),this.pondService.getTotalCost().subscribe(e=>{if(1==e.status){this.todayData.cost=e.data.cost.feed+e.data.cost.blend+e.data.cost.enviroment+e.data.cost.seed+e.data.cost.other+parseInt(e.data.cost.record.amounts);let t=this.data.FCR*this.next7Data.quantity*(e.data.cost.feed/this.data.feed)-e.data.cost.feed;t<0&&(t=e.data.cost.feed/this.data.old*this.day),this.next7Data.deltaCost=t+e.data.cost.enviroment/this.data.old*this.day,this.next7Data.cost=e.data.cost.feed+this.next7Data.deltaCost}else this.alertService.error(e.error);this.costLoadingFlag.setResult(!0)},()=>{this.costLoadingFlag.setResult(!1)})}getCurrentPrice(){this.priceLoadingFlag.setStart(!0),this.pondService.getCurrentPrice(this.season.species_id,0).subscribe(e=>{"success"==e.status?(1==e.data.length?(this.price=e.data[0].price,this.price7day=e.data[0].price):(this.priceList=e.data,this.priceList.push({price:0,time:0,diff:"",size:parseFloat(this.data.weight)}),this.price=this.matchPrice(this.priceList,this.data.weight),this.priceList.push({price:0,time:0,diff:"",size:parseFloat(this.next7Data.weight)}),this.price7day=this.matchPrice(this.priceList,this.next7Data.weight)),console.log(this.price),this.size=e.data[e.data.length-1].size,console.log(this.size)):this.alertService.error(e.error.message),this.priceLoadingFlag.setResult(!0)},()=>{this.priceLoadingFlag.setResult(!1)})}matchPrice(e,t){let n=0;e.map(e=>(parseFloat(e.size),e)),console.log("runing"),e.sort((e,t)=>e.size>t.size?1:e.size<t.size?-1:0),console.log(t);let i=e.findIndex(e=>e.size==t&&0==e.time);return console.log(i),console.log(e),0==i?(n=e.length>1?e[1].price*t/e[1].size:0,console.log(n)):i+1==e.length?(n=e[i-1].price,console.log(i)):n=(e[i+1].price-e[i-1].price)/(e[i+1].size-e[i-1].size)*(t-e[i-1].size)+parseInt(e[i-1].price),e.splice(i,1),n>1e4&&(n=100*Math.round(n/100)),n}setDelta(e){this.showDelta=!!e.checked}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(d.so),p.Y36(d.WI),p.Y36(f.c))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-pond-estimate"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"dialog-content-wrapper","flex","flex-col","max-w-240","md:min-w-120","sm:max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],[1,"title","dialog-title",3,"innerHTML"],["mat-icon-button","","mat-dialog-close","",3,"click"],[1,"text-current",3,"svgIcon"],[1,"text-center"],[1,"text-white","icon-size-5","mr-1",3,"svgIcon"],[1,"flex","justify-between","p-2"],[4,"ngIf"],[1,"flex","justify-between","p-4","items-center"],["appearance","legacy"],["matInput","","type","number","required","","matInputAutofocus","",3,"placeholder","ngModel","ngModelChange"],[3,"checked","change"]],template:function(e,t){1&e&&p.YNc(0,gn,129,90,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.ESTIMATE_MOD")},directives:[g.KI,v.lW,d.ZT,y.Hw,d.xY,dn.d,i.O5,_.KE,T.Nt,o.wV,o.Fj,o.Q7,o.JJ,o.On,hn.Rr],pipes:[i.JJ],styles:["[_nghost-%COMP%]{width:100%}"]}),e})();function yn(e,t){1&e&&p._UZ(0,"mat-progress-bar",15)}function _n(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._UZ(4,"span",4),p.qZA(),p.TgZ(5,"button",5),p._UZ(6,"mat-icon",6),p.qZA(),p.qZA(),p.TgZ(7,"div",7),p.YNc(8,yn,1,0,"mat-progress-bar",8),p.TgZ(9,"div",9),p.TgZ(10,"mat-form-field",10),p.TgZ(11,"mat-label"),p._uU(12),p.qZA(),p._UZ(13,"textarea",11),p.qZA(),p.qZA(),p.qZA(),p.TgZ(14,"div",12),p.TgZ(15,"button",13),p.NdJ("click",function(){return p.CHM(e),p.oxw().onSubmit()}),p._uU(16),p.qZA(),p.TgZ(17,"button",14),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(18),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Q6J("innerHTML",e("TITLE"),p.oJD),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(2),p.Q6J("ngIf",n.loadingFlag.pending),p.xp6(1),p.Q6J("formGroup",n.form),p.xp6(3),p.Oqu(e("CONTENT")),p.xp6(1),p.Q6J("placeholder",e("CONTENT")),p.xp6(2),p.Q6J("disabled",n.form.invalid),p.xp6(1),p.hij(" ",e("SEND")," "),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let Tn=(()=>{class e{constructor(e,t,n,i,r){this.alertService=e,this.dialogRef=t,this.data=n,this.formBuilder=i,this.pondService=r,this.loadingFlag=new a.E}ngOnInit(){this.expert=this.data.expert,this.createForm()}createForm(){this.form=this.formBuilder.group({content:["",o.kI.required]})}onSubmit(){this.loadingFlag.setPending(!0),this.form.valid&&this.pondService.addSuggestion({content:this.form.value.content,pond:this.pondService.pcode}).subscribe(e=>{this.loadingFlag.setResult(!0),e.status?(this.alertService.success(e.message),this.dialogRef.close(this.form.value.content)):this.alertService.error(e.message)},e=>{this.loadingFlag.setResult(!1)})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(f.c),p.Y36(d.so),p.Y36(d.WI),p.Y36(o.qu),p.Y36(m.p))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-pond-suggest"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],[1,"title","dialog-title",3,"innerHTML"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","overflow-y-auto","sm:pb-0"],["mode","indeterminate",4,"ngIf"],[3,"formGroup"],[1,"w-full"],["matInput","","required","","formControlName","content",3,"placeholder"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",3,"click"],["mode","indeterminate"]],template:function(e,t){1&e&&p.YNc(0,_n,19,10,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.SUGGEST")},directives:[g.KI,v.lW,d.ZT,y.Hw,i.O5,o.JL,o.sg,_.KE,_.hX,T.Nt,o.Fj,o.Q7,o.JJ,o.u,I.pW],styles:[""]}),e})();var xn=n(53040),wn=n(79765);function bn(e,t){1&e&&p._UZ(0,"mat-progress-bar",31)}function Zn(e,t){1&e&&p._UZ(0,"mat-progress-bar",31)}function An(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"mat-form-field",14),p.TgZ(1,"mat-label"),p._uU(2),p.qZA(),p.TgZ(3,"input",32),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw(2).validNo(t)}),p.qZA(),p.qZA()}if(2&e){const e=p.oxw().$implicit;p.xp6(2),p.Oqu(e("PRICE_PIECE")),p.xp6(1),p.Q6J("placeholder",e("ENTER_PRICE_PIECE"))}}function In(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"mat-form-field",14),p.TgZ(1,"mat-label"),p._uU(2),p.qZA(),p.TgZ(3,"input",33),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw(2).validNo(t)}),p.qZA(),p.qZA()}if(2&e){const e=p.oxw().$implicit;p.xp6(2),p.Oqu(e("PRICE_KG")),p.xp6(1),p.Q6J("placeholder",e("ENTER_PRICE_KG"))}}function Sn(e,t){if(1&e&&(p.TgZ(0,"mat-option",34),p.TgZ(1,"b"),p._uU(2),p.qZA(),p._uU(3),p.qZA()),2&e){const e=t.$implicit;p.Q6J("value",e.id),p.xp6(2),p.Oqu(e.name),p.xp6(1),p.hij(" | ",e.fullname," ")}}function En(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._UZ(4,"span",4),p.qZA(),p.TgZ(5,"button",5),p._UZ(6,"mat-icon",6),p.qZA(),p.qZA(),p.TgZ(7,"div",7),p.YNc(8,bn,1,0,"mat-progress-bar",8),p.YNc(9,Zn,1,0,"mat-progress-bar",8),p.TgZ(10,"div",9),p.TgZ(11,"mat-form-field",10),p.TgZ(12,"mat-label"),p._uU(13),p.qZA(),p.TgZ(14,"input",11),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw().validNo(t)}),p.qZA(),p._UZ(15,"mat-datepicker-toggle",12),p._UZ(16,"mat-datepicker",null,13),p.qZA(),p.TgZ(18,"mat-form-field",14),p.TgZ(19,"mat-label"),p._uU(20),p.qZA(),p.TgZ(21,"mat-select",15),p.TgZ(22,"mat-option",16),p._uU(23),p.qZA(),p.TgZ(24,"mat-option",17),p._uU(25,"Kg"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(26,"mat-form-field",10),p.TgZ(27,"mat-label"),p._uU(28),p.qZA(),p.TgZ(29,"input",18),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw().validNo(t)})("input",function(t){return p.CHM(e),p.oxw().numberFormatQuantity.setValue(t.target.value)}),p.qZA(),p.qZA(),p.YNc(30,An,4,2,"mat-form-field",19),p.YNc(31,In,4,2,"mat-form-field",19),p.TgZ(32,"mat-form-field",10),p.TgZ(33,"mat-label"),p._uU(34),p.qZA(),p._UZ(35,"input",20),p.qZA(),p.TgZ(36,"mat-form-field",14),p.TgZ(37,"mat-label"),p._uU(38),p.qZA(),p.TgZ(39,"input",21),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw().validNo(t)}),p.qZA(),p.qZA(),p.qZA(),p.TgZ(40,"div",22),p.TgZ(41,"mat-form-field",14),p.TgZ(42,"mat-label"),p._uU(43),p.qZA(),p._UZ(44,"input",23),p.TgZ(45,"mat-autocomplete",24,25),p.NdJ("optionSelected",function(t){return p.CHM(e),p.oxw().onSelect(t.option.value)}),p.YNc(47,Sn,4,3,"mat-option",26),p.ALo(48,"async"),p.qZA(),p.qZA(),p.TgZ(49,"mat-form-field",14),p.TgZ(50,"mat-label"),p._uU(51),p.qZA(),p._UZ(52,"textarea",27),p.qZA(),p.qZA(),p.qZA(),p.TgZ(53,"div",28),p.TgZ(54,"button",29),p.NdJ("click",function(){return p.CHM(e),p.oxw().onSave()}),p._uU(55),p.qZA(),p.TgZ(56,"button",30),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(57),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(17),i=p.MAs(46),r=p.oxw();p.xp6(4),p.Q6J("innerHTML",e("TITLE"),p.oJD),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(1),p.Q6J("formGroup",r.form),p.xp6(1),p.Q6J("ngIf",r.loadingFlag.pending),p.xp6(1),p.Q6J("ngIf",r.savingFlag.pending),p.xp6(4),p.Oqu(e("DATE")),p.xp6(1),p.Q6J("min",r.minDate)("max",r.maxDate.toDate())("matDatepicker",n),p.xp6(1),p.Q6J("for",n),p.xp6(5),p.Oqu(e("UNIT")),p.xp6(1),p.Q6J("placeholder",e("SELECT_UNIT")),p.xp6(2),p.Oqu(e("PIECES")),p.xp6(5),p.Oqu(e("QUANTITY")),p.xp6(1),p.Q6J("placeholder",e("ENTER_QUANTITY"))("value",r.numberFormatQuantity.fakeView),p.xp6(1),p.Q6J("ngIf","con"==r.form.controls.unit.value),p.xp6(1),p.Q6J("ngIf","kg"==r.form.controls.unit.value),p.xp6(3),p.Oqu(e("WEIGHT")),p.xp6(1),p.Q6J("placeholder",e("ENTER_WEIGHT")),p.xp6(3),p.Oqu(e("AGE")),p.xp6(1),p.Q6J("placeholder",e("ENTER_AGE")),p.xp6(4),p.Oqu(e("SUPPLIER")),p.xp6(1),p.Q6J("placeholder",e("ENTER_SUPPLIER"))("matAutocomplete",i),p.xp6(3),p.Q6J("ngForOf",p.lcZ(48,32,r.manufacturer$)),p.xp6(4),p.Oqu(e("NOTE")),p.xp6(1),p.Q6J("placeholder",e("NOTE")),p.xp6(2),p.Q6J("disabled",r.form.invalid),p.xp6(1),p.hij(" ",e("SAVE")," "),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let qn=(()=>{class e{constructor(e,t,n,i,r,s){this._formBuilder=e,this.pondService=t,this.dialogRef=n,this.data=i,this.alertService=r,this._translate=s,this.loadingFlag=new a.E,this.savingFlag=new a.E,this.numberFormatPrice=new xn.y(""),this.numberFormatQuantity=new xn.y(""),this.maxDate=c()(),this.searchTerms=new wn.xQ,this.message=""}ngOnInit(){this.createForm(),this.form.controls.seed_supplier.valueChanges.pipe((0,h.b)(300)).subscribe(e=>{this.form.controls.seed_supplier_id.setValue(0),this.getListManufacturer(e)}),this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.pondService.getHistory().pipe().subscribe(e=>{0==e.status||(this.minDate=new Date(1e3*e.data[0].start_time))},e=>{})}search(e){this.searchTerms.next(e)}getListManufacturer(e){e.length>=2&&(this.loadingFlag.setPending(!0),this.manufacturer$=this.pondService.searchManufacturer(e).pipe(e=>(this.message=0==e.length?this._translate.translate("SEASON.HARVEST_MOD.NO_INFO"):"",this.loadingFlag.setResult(!0),e)))}validNo(e){const t=e.which?e.which:e.keyCode;return!(t>31&&(t<47||t>58))}createForm(){this.form=this._formBuilder.group({seed_quantity:["",o.kI.required],seed_quantity_individuals:[0],seed_supplier:[""],seed_supplier_id:[""],seed_old:[""],seed_cost:[""],seed_cost_individuals:[""],seed_cost_kg:[""],seed_weight:[""],note:[""],seed_date:c()().format("YYYY-MM-DD"),unit:["con"]})}onSave(){let e=!1,t={seed_quantity:this.numberFormatQuantity.realValue,seed_quantity_individuals:this.form.value.seed_quantity_individuals,seed_supplier:this.form.value.seed_supplier,seed_supplier_id:this.form.value.seed_supplier_id,seed_old:this.form.value.seed_old,seed_cost:this.form.value.seed_cost,seed_cost_individuals:this.form.value.seed_cost_individuals.toString().replace(",","."),seed_cost_kg:this.form.value.seed_cost_kg.toString().replace(",","."),seed_weight:this.form.value.seed_weight,note:this.form.value.note,seed_date:c()(this.form.value.seed_date).endOf("day").valueOf()/1e3,unit:this.form.value.unit};console.log(c()(this.form.value.seed_date).valueOf()/1e3),console.log(c()(this.form.value.seed_date).endOf("day").valueOf()/1e3),"kg"==this.form.controls.unit.value?(console.log(this.form.controls.seed_weight.value),""!=this.form.controls.seed_weight.value?(t.seed_quantity_individuals=1e3*this.numberFormatQuantity.realValue/this.form.controls.seed_weight.value,t.seed_cost=parseFloat(this.form.controls.seed_cost_kg.value.toString())*this.form.controls.seed_weight.value/1e3):(this.form.controls.seed_weight.setValidators(o.kI.required),this.alertService.error(this._translate.translate("SEASON.SEED_MOD.UNIT_ERROR")),e=!0),this.form.controls.seed_cost_kg.setValidators(o.kI.required)):(this.form.controls.seed_cost_individuals.setValidators(o.kI.required),t.seed_quantity_individuals=this.numberFormatQuantity.realValue,t.seed_cost=this.form.value.seed_cost_individuals),console.log(t),0==e&&(this.savingFlag.setPending(!0),this.pondService.reqSeasonSeed(t).subscribe(e=>{1==e.status?(this.alertService.success(e.message),this.savingFlag.setResult(!0),this.pondService.pond.seed_date=c()().valueOf()/1e3,this.pondService.onLoaded$.next(1),this.dialogRef.close(t)):(this.alertService.error(e.error),this.savingFlag.setResult(!1))},()=>{this.savingFlag.setResult(!1),this.alertService.error(this._translate.translate("CONNECT_ERROR"))}))}onSelect(e){this.manufacturer$.subscribe(t=>{t.forEach(t=>{t.id==e&&(this.manufacturerSelected=t,this.form.controls.seed_supplier.setValue(t.fullname),this.form.controls.seed_supplier_id.setValue(t.id))})})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(o.qu),p.Y36(m.p),p.Y36(d.so),p.Y36(d.WI),p.Y36(f.c),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-season-seed"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","md:min-w-120","sm:max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],[1,"title","dialog-title",3,"innerHTML"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto",3,"formGroup"],["mode","indeterminate",4,"ngIf"],[1,"grid","grid-cols-2"],[1,"w-full","md:pr-2"],["matInput","","formControlName","seed_date",3,"min","max","matDatepicker","keypress"],["matSuffix","",3,"for"],["picker",""],[1,"w-full"],["formControlName","unit",3,"placeholder"],["value","con"],["value","kg"],["matInput","","formControlName","seed_quantity",3,"placeholder","value","keypress","input"],["class","w-full",4,"ngIf"],["matInput","","min","0","type","number","formControlName","seed_weight",3,"placeholder"],["matInput","","min","0","type","number","formControlName","seed_old",3,"placeholder","keypress"],[1,"grid","grid-cols-1"],["type","text","matInput","","formControlName","seed_supplier",3,"placeholder","matAutocomplete"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","note",3,"placeholder"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",3,"click"],["mode","indeterminate"],["matInput","","min","0","type","number","formControlName","seed_cost_individuals",3,"placeholder","keypress"],["matInput","","min","0","type","number","formControlName","seed_cost_kg",3,"placeholder","keypress"],[3,"value"]],template:function(e,t){1&e&&p.YNc(0,En,58,34,"ng-container",0),2&e&&p.Q6J("translocoRead","SEASON.SEED_MOD")},directives:[g.KI,v.lW,d.ZT,y.Hw,o.JL,o.sg,i.O5,_.KE,_.hX,T.Nt,o.Fj,x.hl,o.JJ,o.u,x.nW,_.R9,x.Mq,Z.gD,A.ey,o.qQ,o.wV,w.ZL,w.XC,i.sg,I.pW],pipes:[i.Ov],styles:[""]}),e})();var Nn=n(71291),Cn=n(7539);function Dn(e,t){1&e&&p._UZ(0,"mat-progress-bar",18)}function Rn(e,t){if(1&e&&(p.TgZ(0,"small"),p._uU(1),p.qZA()),2&e){const e=p.oxw().$implicit;p.xp6(1),p.hij("(",e.unit,")")}}function On(e,t){if(1&e&&(p.TgZ(0,"div",19),p.TgZ(1,"mat-checkbox",20),p.TgZ(2,"h4"),p._uU(3),p.YNc(4,Rn,2,1,"small",21),p.qZA(),p.qZA(),p.qZA()),2&e){const e=t.$implicit,n=p.oxw(2);p.xp6(1),p.s9C("formControlName",e.key),p.xp6(2),p.hij("",n.convertNameParam(e.name)," "),p.xp6(1),p.Q6J("ngIf",e.unit)}}function kn(e,t){if(1&e&&(p.TgZ(0,"div",19),p.TgZ(1,"mat-checkbox",20),p.TgZ(2,"h4"),p._uU(3),p.TgZ(4,"small"),p._uU(5),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&e){const e=t.$implicit,n=p.oxw(2);p.xp6(1),p.s9C("formControlName",e.key),p.xp6(2),p.hij("",n.convertNameParam(e.name)," "),p.xp6(2),p.hij("(",e.unit,")")}}function Mn(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._UZ(4,"span",4),p.qZA(),p.TgZ(5,"button",5),p._UZ(6,"mat-icon",6),p.qZA(),p.qZA(),p.TgZ(7,"div",7),p.YNc(8,Dn,1,0,"mat-progress-bar",8),p.TgZ(9,"form",9),p.TgZ(10,"h3",10),p._uU(11),p.TgZ(12,"span"),p._uU(13),p.qZA(),p.qZA(),p.TgZ(14,"div"),p.TgZ(15,"div"),p.TgZ(16,"div",11),p._uU(17),p.qZA(),p.TgZ(18,"div",12),p.YNc(19,On,5,3,"div",13),p.qZA(),p.qZA(),p.TgZ(20,"div"),p.TgZ(21,"div",11),p._uU(22),p.qZA(),p.TgZ(23,"div",14),p.YNc(24,kn,6,3,"div",13),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(25,"div",15),p.TgZ(26,"button",16),p.NdJ("click",function(){return p.CHM(e),p.oxw().updateEnvironmentSetting()}),p._uU(27),p.qZA(),p.TgZ(28,"button",17),p._uU(29),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Q6J("innerHTML",e("SETTING"),p.oJD),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(2),p.Q6J("ngIf",n.saveLoading.pending),p.xp6(1),p.Q6J("formGroup",n.form),p.xp6(2),p.Oqu(e("MONITORING_INDICES")),p.xp6(2),p.hij(" (",n.countTracking,")"),p.xp6(4),p.hij(" ",e("BASICS")," "),p.xp6(2),p.Q6J("ngForOf",n.trackingGeneralObjects),p.xp6(3),p.hij(" ",e("ADVANCED")," "),p.xp6(2),p.Q6J("ngForOf",n.trackingAdvanceObjects),p.xp6(3),p.Oqu(e("CONFIRM")),p.xp6(2),p.Oqu(e("CANCEL"))}}let Un=(()=>{class e{constructor(e,t,n,i,r){this.pondService=e,this.dialogRef=t,this._formBuilder=n,this._translate=i,this._alertService=r,this.saveLoading=new a.E,this.trackingGeneralObjects=[],this.trackingAdvanceObjects=[],this.trackingObjects=[],this.trackingFormsGen={},this.trackingFormsAdv={},this.countTracking=0,Nn.Cs.forEach(e=>{this.trackingFormsGen[e]=new o.NI(this.isInTracking(e)&&!0);let t=(new Nn.hz).mapByKey(e);this.trackingGeneralObjects.push(new Nn.d2(e,t.name,t.colorCls,t.colorStr,t.unit,t.max,t.min))}),Nn.SV.forEach(e=>{this.trackingFormsAdv[e]=new o.NI(this.isInTracking(e)&&!0);let t=(new Nn.hz).mapByKey(e);this.trackingAdvanceObjects.push(new Nn.d2(e,t.name,t.colorCls,t.colorStr,t.unit,t.max,t.min))})}ngOnInit(){this.form=this._formBuilder.group(Object.assign(Object.assign({},this.trackingFormsGen),this.trackingFormsAdv)),this.formChange();let e=[];for(var t in this.form.value)this.form.value[t]&&e.push(this.form.value[t]);this.countTracking=e.length}formChange(){this.form.valueChanges.subscribe(e=>{let t=0,n="";this.trackingGeneralObjects.concat(this.trackingAdvanceObjects).forEach(i=>{1==e[i.key]&&(n+=i.key+",",t++)}),this.trackingString=n,this.countTracking=t})}convertNameParam(e){let t="";switch(e.toUpperCase()){case"PH_AM":t=this._translate.translate("POND.MORNING_PH");break;case"PH_PM":t=this._translate.translate("POND.NOON_PH");break;case"OXYGEN":t="DO";break;case"TEMPERATURE":t=this._translate.translate("POND.TEMP");break;case"NH3":t="NH3";break;case"NO2":t="NO2";break;case"SALINITY":t=this._translate.translate("POND.SALINITY");break;case"KH":t=this._translate.translate("POND.ALKALINITY");break;case"CLARITY":t=this._translate.translate("POND.CLARITY");break;case"VIBRIO":t="Vibrio";break;case"MAGIESIUM":t=this._translate.translate("POND.MAGNESIUM");break;case"CALCIUM":t=this._translate.translate("POND.CALCIUM");break;case"HYDRO_SULFUA":t="H2S";break;case"ORP":t="ORP";break;case"ALGAE":t=this._translate.translate("POND.ALGAE")}return t}isInTracking(e){return this.pondService.trackingObjects.map(e=>e.key).includes(e)}updateEnvironmentSetting(){var e=this;this.saveLoading.setPending(!0);const t=Object.keys(this.form.value).filter(e=>!0===this.form.value[e]);this.pondService.settingSeasonEnvironment({listParam:t}).subscribe(function(){var t=(0,s.Z)(function*(t){t.error||1!=t.status?(e._alertService.error(t.message),e.saveLoading.setResult(!1)):(e._alertService.success(e._translate.translate("POND.ENVIRONMENT.UPDATE_SUCCESS")),e.pondService.onLoaded$.next(1),e.dialogRef.close("success"))});return function(e){return t.apply(this,arguments)}}(),()=>{this._alertService.error(this._translate.translate("POND.ENVIRONMENT.UPDATE_FAIL")),this.saveLoading.setResult(!1)})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(d.so),p.Y36(o.qu),p.Y36(g.Vn),p.Y36(f.c))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-pond-environment-setting"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],[1,"title","dialog-title",3,"innerHTML"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","overflow-y-auto","sm:pb-1"],["mode","indeterminate",4,"ngIf"],[3,"formGroup"],[1,"font-bold"],[1,"mt-2","secondary-text","font-semibold"],[1,"grid","md:grid-cols-4","sm:grid-cols-2","mt-2"],["class","p-2",4,"ngFor","ngForOf"],[1,"grid","md:grid-cols-4","sm:grid-cols-2"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"click"],["mat-stroked-button","","mat-dialog-close",""],["mode","indeterminate"],[1,"p-2"],[3,"formControlName"],[4,"ngIf"]],template:function(e,t){1&e&&p.YNc(0,Mn,30,13,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.ENVIRONMENT")},directives:[g.KI,v.lW,d.ZT,y.Hw,i.O5,o._Y,o.JL,o.sg,i.sg,I.pW,Cn.oG,o.JJ,o.u],styles:[""]}),e})();function Pn(e,t){1&e&&p._UZ(0,"mat-progress-bar",19)}function Fn(e,t){if(1&e&&(p.TgZ(0,"mat-error"),p._uU(1),p.qZA()),2&e){const e=p.oxw().$implicit;p.xp6(1),p.hij(" ",e("MIN")," ")}}function Ln(e,t){if(1&e&&(p.TgZ(0,"mat-error"),p._uU(1),p.qZA()),2&e){const e=p.oxw().$implicit;p.xp6(1),p.hij(" ",e("MAX")," ")}}function Jn(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._UZ(4,"span",4),p.qZA(),p.TgZ(5,"button",5),p._UZ(6,"mat-icon",6),p.qZA(),p.qZA(),p.TgZ(7,"div",7),p.YNc(8,Pn,1,0,"mat-progress-bar",8),p.TgZ(9,"div"),p.TgZ(10,"mat-form-field",9),p.TgZ(11,"mat-label"),p._uU(12),p.qZA(),p.TgZ(13,"input",10),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw().value=t}),p.qZA(),p.YNc(14,Fn,2,1,"mat-error",11),p.YNc(15,Ln,2,1,"mat-error",11),p.qZA(),p.qZA(),p.TgZ(16,"div"),p.TgZ(17,"mat-form-field",12),p.TgZ(18,"mat-label"),p._uU(19),p.qZA(),p.TgZ(20,"mat-select",13),p.ynx(21),p.TgZ(22,"mat-option",14),p._uU(23,"g "),p.qZA(),p.TgZ(24,"mat-option",15),p._uU(25,"kg "),p.qZA(),p.BQk(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(26,"div",16),p.TgZ(27,"button",17),p.NdJ("click",function(){return p.CHM(e),p.oxw().updateFeedSetting()}),p._uU(28),p.qZA(),p.TgZ(29,"button",18),p._uU(30),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Q6J("innerHTML",e("SETTING"),p.oJD),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(2),p.Q6J("ngIf",n.saveLoading.pending),p.xp6(4),p.Oqu(e("REPASTS")),p.xp6(1),p.Q6J("ngModel",n.value),p.xp6(1),p.Q6J("ngIf",n.value<1),p.xp6(1),p.Q6J("ngIf",n.value>10),p.xp6(4),p.Oqu(e("UNITS")),p.xp6(1),p.Q6J("formControl",n.valueG),p.xp6(7),p.Q6J("disabled",n.value<1||n.value>10),p.xp6(1),p.Oqu(e("CONFIRM")),p.xp6(2),p.Oqu(e("CANCEL"))}}let Yn=(()=>{class e{constructor(e,t,n,i){this.dialogRef=e,this.pondService=t,this._alertService=n,this._translate=i,this.value=this.pondService.numRepast,this.saveLoading=new a.E,this.valueG=new o.NI("g",o.kI.required)}ngOnInit(){console.log(localStorage.getItem("unit")),console.log(this.valueG.value),this.valueG.setValue(localStorage.getItem("unit"))}updateFeedSetting(){var e=this;localStorage.setItem("unit",this.valueG.value),this.saveLoading.setPending(!0),this.pondService.settingSeasonFeed({feed_no:this.value}).subscribe(function(){var t=(0,s.Z)(function*(t){t.error||1!=t.status?(e._alertService.error(t.message),e.saveLoading.setResult(!1)):(e._alertService.success(e._translate.translate("UPDATE_SUCCESS")),e.pondService.onLoaded$.next(1),e.dialogRef.close("success"))});return function(e){return t.apply(this,arguments)}}(),()=>{this._alertService.error(this._translate.translate("UPDATE_FAIL")),this.saveLoading.setResult(!1)})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(d.so),p.Y36(m.p),p.Y36(f.c),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-pond-feed-setting"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],[1,"title","dialog-title",3,"innerHTML"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","overflow-y-auto","sm:pb-1"],["mode","indeterminate",4,"ngIf"],["appearance","fill",1,"w-full"],["matInput","","type","number","min","1","max","10",3,"ngModel","ngModelChange"],[4,"ngIf"],["appearance","legacy",1,"w-full"],[3,"formControl"],["value","g"],["value","kg"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"disabled","click"],["mat-stroked-button","","mat-dialog-close",""],["mode","indeterminate"]],template:function(e,t){1&e&&p.YNc(0,Jn,31,13,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.FEED")},directives:[g.KI,v.lW,d.ZT,y.Hw,i.O5,_.KE,_.hX,T.Nt,o.qQ,o.Fd,o.wV,o.Fj,o.JJ,o.On,Z.gD,o.oH,A.ey,I.pW,_.TO],styles:[""]}),e})();function Qn(e,t){if(1&e&&(p.TgZ(0,"div",8),p.TgZ(1,"div",9),p._UZ(2,"mat-icon",10),p.TgZ(3,"b",11),p._uU(4),p.qZA(),p.TgZ(5,"em"),p._uU(6),p.ALo(7,"date"),p.qZA(),p.qZA(),p.TgZ(8,"p"),p._uU(9),p.qZA(),p.qZA()),2&e){const e=t.$implicit;p.xp6(4),p.Oqu(e.vendor_name),p.xp6(2),p.Oqu(p.xi3(7,3,1e3*e.add_time,"hh:mm a, dd/MM")),p.xp6(3),p.Oqu(e.message)}}function Vn(e,t){if(1&e&&(p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.YNc(8,Qn,10,6,"div",7),p.qZA(),p.qZA(),p.BQk()),2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Oqu(e("TITLE")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(2),p.Q6J("ngForOf",n.suggestionList)}}let jn=(()=>{class e{constructor(e,t,n,i){this.pondService=e,this._alertService=t,this._translate=n,this.dialogRef=i}ngOnInit(){this.pondService.getSuggestList().pipe().subscribe(e=>{console.log(e.data),1==e.status&&(this.suggestionList=e.data)},e=>{this._alertService.error(this._translate.translate("CONNECT_ERROR"))})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(f.c),p.Y36(g.Vn),p.Y36(d.so))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-suggestion-list"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","overflow-y-auto"],["class","my-3 flex flex-col items-start",4,"ngFor","ngForOf"],[1,"my-3","flex","flex-col","items-start"],[1,"flex","items-center","mb-1"],["svgIcon","heroicons_outline:user"],[1,"mx-2"]],template:function(e,t){1&e&&p.YNc(0,Vn,9,4,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.SUGGEST")},directives:[g.KI,v.lW,d.ZT,y.Hw,i.sg],pipes:[i.uU],styles:[""]}),e})();var Hn=n(46954),$n=n(2564),Bn=n(33637),zn=n(67574),Gn=n(94402),Wn=n(39126),Kn=n(39761),Xn=n(59328),ei=n(88002),ti=n(42145),ni=n(87519),ii=n(45435),ri=n(59746),si=n(39958),oi=(n(26300),n(54486)),ai=n(55452),li=n(16034),ci=n(60300),ui=n(64685),di=function(e,t){return(di=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function hi(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var pi,mi="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},fi=fi||{},gi=mi||self;function vi(){}function yi(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function _i(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Ti="closure_uid_"+(1e9*Math.random()>>>0),xi=0;function wi(e,t,n){return e.call.apply(e.bind,arguments)}function bi(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function Zi(e,t,n){return(Zi=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?wi:bi).apply(null,arguments)}function Ai(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function Ii(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}function Si(){this.s=this.s,this.o=this.o}var Ei={};Si.prototype.s=!1,Si.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,Ti)&&e[Ti]||(e[Ti]=++xi)}(this);delete Ei[e]}},Si.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var qi=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},Ni=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var i=e.length,r="string"==typeof e?e.split(""):e,s=0;s<i;s++)s in r&&t.call(n,r[s],s,e)};function Ci(e){return Array.prototype.concat.apply([],arguments)}function Di(e){var t=e.length;if(0<t){for(var n=Array(t),i=0;i<t;i++)n[i]=e[i];return n}return[]}function Ri(e){return/^[\s\xa0]*$/.test(e)}var Oi,ki=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function Mi(e,t){return-1!=e.indexOf(t)}function Ui(e,t){return e<t?-1:e>t?1:0}e:{var Pi=gi.navigator;if(Pi){var Fi=Pi.userAgent;if(Fi){Oi=Fi;break e}}Oi=""}function Li(e,t,n){for(var i in e)t.call(n,e[i],i,e)}function Ji(e){var t={};for(var n in e)t[n]=e[n];return t}var Yi="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Qi(e,t){for(var n,i,r=1;r<arguments.length;r++){for(n in i=arguments[r])e[n]=i[n];for(var s=0;s<Yi.length;s++)n=Yi[s],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function Vi(e){return Vi[" "](e),e}Vi[" "]=vi;var ji,Hi,$i=Mi(Oi,"Opera"),Bi=Mi(Oi,"Trident")||Mi(Oi,"MSIE"),zi=Mi(Oi,"Edge"),Gi=zi||Bi,Wi=Mi(Oi,"Gecko")&&!(Mi(Oi.toLowerCase(),"webkit")&&!Mi(Oi,"Edge"))&&!(Mi(Oi,"Trident")||Mi(Oi,"MSIE"))&&!Mi(Oi,"Edge"),Ki=Mi(Oi.toLowerCase(),"webkit")&&!Mi(Oi,"Edge");function Xi(){var e=gi.document;return e?e.documentMode:void 0}e:{var er="",tr=(Hi=Oi,Wi?/rv:([^\);]+)(\)|;)/.exec(Hi):zi?/Edge\/([\d\.]+)/.exec(Hi):Bi?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Hi):Ki?/WebKit\/(\S+)/.exec(Hi):$i?/(?:Version)[ \/]?(\S+)/.exec(Hi):void 0);if(tr&&(er=tr?tr[1]:""),Bi){var nr=Xi();if(null!=nr&&nr>parseFloat(er)){ji=String(nr);break e}}ji=er}var ir={};var rr=gi.document&&Bi&&(Xi()||parseInt(ji,10))||void 0,sr=function(){if(!gi.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{gi.addEventListener("test",vi,t),gi.removeEventListener("test",vi,t)}catch(n){}return e}();function or(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function ar(e,t){if(or.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Wi){e:{try{Vi(t.nodeName);var r=!0;break e}catch(s){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:lr[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&ar.Z.h.call(this)}}or.prototype.h=function(){this.defaultPrevented=!0},Ii(ar,or);var lr={2:"touch",3:"pen",4:"mouse"};ar.prototype.h=function(){ar.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var cr="closure_listenable_"+(1e6*Math.random()|0),ur=0;function dr(e,t,n,i,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ia=r,this.key=++ur,this.ca=this.fa=!1}function hr(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function pr(e){this.src=e,this.g={},this.h=0}function mr(e,t){var n=t.type;if(n in e.g){var i,r=e.g[n],s=qi(r,t);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(hr(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function fr(e,t,n,i){for(var r=0;r<e.length;++r){var s=e[r];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==i)return r}return-1}pr.prototype.add=function(e,t,n,i,r){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=fr(e,t,i,r);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new dr(t,this.src,s,!!i,r)).fa=n,e.push(t)),t};var gr="closure_lm_"+(1e6*Math.random()|0),vr={};function yr(e,t,n,i,r){if(i&&i.once)return Tr(e,t,n,i,r);if(Array.isArray(t)){for(var s=0;s<t.length;s++)yr(e,t[s],n,i,r);return null}return n=Sr(n),e&&e[cr]?e.N(t,n,_i(i)?!!i.capture:!!i,r):_r(e,t,n,!1,i,r)}function _r(e,t,n,i,r,s){if(!t)throw Error("Invalid event type");var o=_i(r)?!!r.capture:!!r,a=Ar(e);if(a||(e[gr]=a=new pr(e)),(n=a.add(t,n,i,o,s)).proxy)return n;if(i=function(){var e=Zr;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)sr||(r=o),void 0===r&&(r=!1),e.addEventListener(t.toString(),i,r);else if(e.attachEvent)e.attachEvent(br(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}function Tr(e,t,n,i,r){if(Array.isArray(t)){for(var s=0;s<t.length;s++)Tr(e,t[s],n,i,r);return null}return n=Sr(n),e&&e[cr]?e.O(t,n,_i(i)?!!i.capture:!!i,r):_r(e,t,n,!0,i,r)}function xr(e,t,n,i,r){if(Array.isArray(t))for(var s=0;s<t.length;s++)xr(e,t[s],n,i,r);else i=_i(i)?!!i.capture:!!i,n=Sr(n),e&&e[cr]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=fr(s=e.g[t],n,i,r))&&(hr(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=Ar(e))&&(t=e.g[t.toString()],e=-1,t&&(e=fr(t,n,i,r)),(n=-1<e?t[e]:null)&&wr(n))}function wr(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[cr])mr(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(br(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=Ar(t))?(mr(n,e),0==n.h&&(n.src=null,t[gr]=null)):hr(e)}}}function br(e){return e in vr?vr[e]:vr[e]="on"+e}function Zr(e,t){if(e.ca)e=!0;else{t=new ar(t,this);var n=e.listener,i=e.ia||e.src;e.fa&&wr(e),e=n.call(i,t)}return e}function Ar(e){return(e=e[gr])instanceof pr?e:null}var Ir="__closure_events_fn_"+(1e9*Math.random()>>>0);function Sr(e){return"function"==typeof e?e:(e[Ir]||(e[Ir]=function(t){return e.handleEvent(t)}),e[Ir])}function Er(){Si.call(this),this.i=new pr(this),this.P=this,this.I=null}function qr(e,t){var n,i=e.I;if(i)for(n=[];i;i=i.I)n.push(i);if(e=e.P,i=t.type||t,"string"==typeof t)t=new or(t,e);else if(t instanceof or)t.target=t.target||e;else{var r=t;Qi(t=new or(i,e),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];r=Nr(o,i,!0,t)&&r}if(r=Nr(o=t.g=e,i,!0,t)&&r,r=Nr(o,i,!1,t)&&r,n)for(s=0;s<n.length;s++)r=Nr(o=t.g=n[s],i,!1,t)&&r}function Nr(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ca&&o.capture==n){var a=o.listener,l=o.ia||o.src;o.fa&&mr(e.i,o),r=!1!==a.call(l,i)&&r}}return r&&!i.defaultPrevented}Ii(Er,Si),Er.prototype[cr]=!0,Er.prototype.removeEventListener=function(e,t,n,i){xr(this,e,t,n,i)},Er.prototype.M=function(){if(Er.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)hr(n[i]);delete t.g[e],t.h--}}this.I=null},Er.prototype.N=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},Er.prototype.O=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};var Cr=gi.JSON.stringify;function Dr(){var e=Lr,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Rr,Or=function(){function e(){this.h=this.g=null}return e.prototype.add=function(e,t){var n=kr.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n},e}(),kr=new(function(){function e(e,t){this.i=e,this.j=t,this.h=0,this.g=null}return e.prototype.get=function(){var e;return 0<this.h?(this.h--,this.g=(e=this.g).next,e.next=null):e=this.i(),e},e}())(function(){return new Mr},function(e){return e.reset()}),Mr=function(){function e(){this.next=this.g=this.h=null}return e.prototype.set=function(e,t){this.h=e,this.g=t,this.next=null},e.prototype.reset=function(){this.next=this.g=this.h=null},e}();function Ur(e){gi.setTimeout(function(){throw e},0)}function Pr(e,t){Rr||function(){var e=gi.Promise.resolve(void 0);Rr=function(){e.then(Jr)}}(),Fr||(Rr(),Fr=!0),Lr.add(e,t)}var Fr=!1,Lr=new Or;function Jr(){for(var e;e=Dr();){try{e.h.call(e.g)}catch(n){Ur(n)}var t=kr;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Fr=!1}function Yr(e,t){Er.call(this),this.h=e||1,this.g=t||gi,this.j=Zi(this.kb,this),this.l=Date.now()}function Qr(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function Vr(e,t,n){if("function"==typeof e)n&&(e=Zi(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Zi(e.handleEvent,e)}return 2147483647<Number(t)?-1:gi.setTimeout(e,t||0)}function jr(e){e.g=Vr(function(){e.g=null,e.i&&(e.i=!1,jr(e))},e.j);var t=e.h;e.h=null,e.m.apply(null,t)}Ii(Yr,Er),(pi=Yr.prototype).da=!1,pi.S=null,pi.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),qr(this,"tick"),this.da&&(Qr(this),this.start()))}},pi.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},pi.M=function(){Yr.Z.M.call(this),Qr(this),delete this.g};var Hr=function(e){function t(t,n){var i=e.call(this)||this;return i.m=t,i.j=n,i.h=null,i.i=!1,i.g=null,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}di(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.l=function(e){this.h=arguments,this.g?this.i=!0:jr(this)},t.prototype.M=function(){e.prototype.M.call(this),this.g&&(gi.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},t}(Si);function $r(e){Si.call(this),this.h=e,this.g={}}Ii($r,Si);var Br=[];function zr(e,t,n,i){Array.isArray(n)||(n&&(Br[0]=n.toString()),n=Br);for(var r=0;r<n.length;r++){var s=yr(t,n[r],i||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Gr(e){Li(e.g,function(e,t){this.g.hasOwnProperty(t)&&wr(e)},e),e.g={}}function Wr(){this.g=!0}function Kr(e,t,n,i){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}return Cr(n)}catch(a){return t}}(e,n)+(i?" "+i:"")})}$r.prototype.M=function(){$r.Z.M.call(this),Gr(this)},$r.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Wr.prototype.Aa=function(){this.g=!1},Wr.prototype.info=function(){};var Xr={},es=null;function ts(){return es=es||new Er}function ns(e){or.call(this,Xr.Ma,e)}function is(e){var t=ts();qr(t,new ns(t,e))}function rs(e,t){or.call(this,Xr.STAT_EVENT,e),this.stat=t}function ss(e){var t=ts();qr(t,new rs(t,e))}function os(e,t){or.call(this,Xr.Na,e),this.size=t}function as(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return gi.setTimeout(function(){e()},t)}Xr.Ma="serverreachability",Ii(ns,or),Xr.STAT_EVENT="statevent",Ii(rs,or),Xr.Na="timingevent",Ii(os,or);var ls={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},cs={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function us(){}function ds(){}us.prototype.h=null;var hs,ps={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function ms(){or.call(this,"d")}function fs(){or.call(this,"c")}function gs(){}function vs(e,t,n,i){this.l=e,this.j=t,this.m=n,this.X=i||1,this.V=new $r(this),this.P=_s,this.W=new Yr(e=Gi?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ys}function ys(){this.i=null,this.g="",this.h=!1}Ii(ms,or),Ii(fs,or),Ii(gs,us),gs.prototype.g=function(){return new XMLHttpRequest},gs.prototype.i=function(){return{}},hs=new gs;var _s=45e3,Ts={},xs={};function ws(e,t,n){e.K=1,e.v=js(Fs(t)),e.s=n,e.U=!0,bs(e,null)}function bs(e,t){e.F=Date.now(),Ss(e),e.A=Fs(e.v);var n=e.A,i=e.X;Array.isArray(i)||(i=[String(i)]),ro(n.h,"t",i),e.C=0,n=e.l.H,e.h=new ys,e.g=oa(e.l,n?t:null,!e.s),0<e.O&&(e.L=new Hr(Zi(e.Ia,e,e.g),e.O)),zr(e.V,e.g,"readystatechange",e.gb),t=e.H?Ji(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),is(1),function(e,t,n,i,r,s){e.info(function(){if(e.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var d=u.split("_");o=2<=d.length&&"type"==d[1]?o+(u+"=")+c+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+t+"\n"+n+"\n"+o})}(e.j,e.u,e.A,e.m,e.X,e.s)}function Zs(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function As(e,t,n){for(var i,r=!0;!e.I&&e.C<n.length;){if((i=Is(e,n))==xs){4==t&&(e.o=4,ss(14),r=!1),Kr(e.j,e.m,null,"[Incomplete Response]");break}if(i==Ts){e.o=4,ss(15),Kr(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}Kr(e.j,e.m,i,null),Ds(e,i)}Zs(e)&&i!=xs&&i!=Ts&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,ss(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Ko(t),t.L=!0,ss(11))):(Kr(e.j,e.m,n,"[Invalid Chunked Response]"),Cs(e),Ns(e))}function Is(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?xs:(n=Number(t.substring(n,i)),isNaN(n)?Ts:(i+=1)+n>t.length?xs:(t=t.substr(i,n),e.C=i+n,t))}function Ss(e){e.Y=Date.now()+e.P,Es(e,e.P)}function Es(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=as(Zi(e.eb,e),t)}function qs(e){e.B&&(gi.clearTimeout(e.B),e.B=null)}function Ns(e){0==e.l.G||e.I||ta(e.l,e)}function Cs(e){qs(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Qr(e.W),Gr(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Ds(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||ho(n.i,e)))if(n.I=e.N,!e.J&&ho(n.i,e)&&3==n.G){try{var i=n.Ca.g.parse(t)}catch(s){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;ea(n),Qo(n)}Wo(n),ss(18)}}else n.ta=r[1],0<n.ta-n.U&&37500>r[2]&&n.N&&0==n.A&&!n.v&&(n.v=as(Zi(n.ab,n),6e3));if(1>=uo(n.i)&&n.ka){try{n.ka()}catch(s){}n.ka=void 0}}else ia(n,11)}else if((e.J||n.g==e)&&ea(n),!Ri(t))for(r=n.Ca.g.parse(t),t=0;t<r.length;t++){var s=r[t];if(n.U=s[0],s=s[1],2==n.G)if("c"==s[0]){n.J=s[1],n.la=s[2];var o=s[3];null!=o&&(n.ma=o,n.h.info("VER="+n.ma));var a=s[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var l=s[5];null!=l&&"number"==typeof l&&0<l&&(n.K=i=1.5*l,n.h.info("backChannelRequestTimeoutMs_="+i)),i=n;var c=e.g;if(c){var u=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(u){var d=i.i;!d.g&&(Mi(u,"spdy")||Mi(u,"quic")||Mi(u,"h2"))&&(d.j=d.l,d.g=new Set,d.h&&(po(d,d.h),d.h=null))}if(i.D){var h=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;h&&(i.sa=h,Vs(i.F,i.D,h))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var p=e;if((i=n).oa=sa(i,i.H?i.la:null,i.W),p.J){mo(i.i,p);var m=p,f=i.K;f&&m.setTimeout(f),m.B&&(qs(m),Ss(m)),i.g=p}else Go(i);0<n.l.length&&Ho(n)}else"stop"!=s[0]&&"close"!=s[0]||ia(n,7);else 3==n.G&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?ia(n,7):Yo(n):"noop"!=s[0]&&n.j&&n.j.wa(s),n.A=0)}is(4)}catch(s){}}function Rs(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(yi(e)||"string"==typeof e)Ni(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(yi(e)||"string"==typeof e){n=[];for(var i=e.length,r=0;r<i;r++)n.push(r)}else for(r in n=[],i=0,e)n[i++]=r;r=(i=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(yi(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e)).length;for(var s=0;s<r;s++)t.call(void 0,i[s],n&&n[s],e)}}function Os(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var i=0;i<n;i+=2)this.set(arguments[i],arguments[i+1])}else if(e)if(e instanceof Os)for(n=e.T(),i=0;i<n.length;i++)this.set(n[i],e.get(n[i]));else for(i in e)this.set(i,e[i])}function ks(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var i=e.g[t];Ms(e.h,i)&&(e.g[n++]=i),t++}e.g.length=n}if(e.i!=e.g.length){var r={};for(n=t=0;t<e.g.length;)Ms(r,i=e.g[t])||(e.g[n++]=i,r[i]=1),t++;e.g.length=n}}function Ms(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(pi=vs.prototype).setTimeout=function(e){this.P=e},pi.gb=function(e){e=e.target;var t=this.L;t&&3==Uo(e)?t.l():this.Ia(e)},pi.Ia=function(e){try{if(e==this.g)e:{var t=Uo(this.g),n=this.g.Da(),i=this.g.ba();if(!(3>t)&&(3!=t||Gi||this.g&&(this.h.h||this.g.ga()||Po(this.g)))){this.I||4!=t||7==n||is(8==n||0>=i?3:2),qs(this);var r=this.g.ba();this.N=r;t:if(Zs(this)){var s=Po(this.g);e="";var o=s.length,a=4==Uo(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Cs(this),Ns(this);var l="";break t}this.h.i=new gi.TextDecoder}for(n=0;n<o;n++)this.h.h=!0,e+=this.h.i.decode(s[n],{stream:a&&n==o-1});s.splice(0,o),this.h.g+=e,this.C=0,l=this.h.g}else l=this.g.ga();if(this.i=200==r,function(e,t,n,i,r,s,o){e.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+s+" "+o})}(this.j,this.u,this.A,this.m,this.X,t,r),this.i){if(this.$&&!this.J){t:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ri(c)){var d=c;break t}}d=null}if(!(r=d)){this.i=!1,this.o=3,ss(12),Cs(this),Ns(this);break e}Kr(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ds(this,r)}this.U?(As(this,t,l),Gi&&this.i&&3==t&&(zr(this.V,this.W,"tick",this.fb),this.W.start())):(Kr(this.j,this.m,l,null),Ds(this,l)),4==t&&Cs(this),this.i&&!this.I&&(4==t?ta(this.l,this):(this.i=!1,Ss(this)))}else 400==r&&0<l.indexOf("Unknown SID")?(this.o=3,ss(12)):(this.o=0,ss(13)),Cs(this),Ns(this)}}}catch(t){}},pi.fb=function(){if(this.g){var e=Uo(this.g),t=this.g.ga();this.C<t.length&&(qs(this),As(this,e,t),this.i&&4!=e&&Ss(this))}},pi.cancel=function(){this.I=!0,Cs(this)},pi.eb=function(){this.B=null;var e=Date.now();0<=e-this.Y?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.K&&(is(3),ss(17)),Cs(this),this.o=2,Ns(this)):Es(this,this.Y-e)},(pi=Os.prototype).R=function(){ks(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},pi.T=function(){return ks(this),this.g.concat()},pi.get=function(e,t){return Ms(this.h,e)?this.h[e]:t},pi.set=function(e,t){Ms(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},pi.forEach=function(e,t){for(var n=this.T(),i=0;i<n.length;i++){var r=n[i],s=this.get(r);e.call(t,s,r,this)}};var Us=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ps(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Ps){this.g=void 0!==t?t:e.g,Ls(this,e.j),this.s=e.s,Js(this,e.i),Ys(this,e.m),this.l=e.l,t=e.h;var n=new eo;n.i=t.i,t.g&&(n.g=new Os(t.g),n.h=t.h),Qs(this,n),this.o=e.o}else e&&(n=String(e).match(Us))?(this.g=!!t,Ls(this,n[1]||"",!0),this.s=Hs(n[2]||""),Js(this,n[3]||"",!0),Ys(this,n[4]),this.l=Hs(n[5]||"",!0),Qs(this,n[6]||"",!0),this.o=Hs(n[7]||"")):(this.g=!!t,this.h=new eo(null,this.g))}function Fs(e){return new Ps(e)}function Ls(e,t,n){e.j=n?Hs(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Js(e,t,n){e.i=n?Hs(t,!0):t}function Ys(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Qs(e,t,n){t instanceof eo?(e.h=t,function(e,t){t&&!e.j&&(to(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(no(this,t),ro(this,n,e))},e)),e.j=t}(e.h,e.g)):(n||(t=$s(t,Ks)),e.h=new eo(t,e.g))}function Vs(e,t,n){e.h.set(t,n)}function js(e){return Vs(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Hs(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function $s(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Bs),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Bs(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Ps.prototype.toString=function(){var e=[],t=this.j;t&&e.push($s(t,zs,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push($s(t,zs,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push($s(n,"/"==n.charAt(0)?Ws:Gs,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",$s(n,Xs)),e.join("")};var zs=/[#\/\?@]/g,Gs=/[#\?:]/g,Ws=/[#\?]/g,Ks=/[#\?@]/g,Xs=/#/g;function eo(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function to(e){e.g||(e.g=new Os,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),r=null;if(0<=i){var s=e[n].substring(0,i);r=e[n].substring(i+1)}else s=e[n];t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function no(e,t){to(e),t=so(e,t),Ms(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,Ms((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&ks(e)))}function io(e,t){return to(e),t=so(e,t),Ms(e.g.h,t)}function ro(e,t,n){no(e,t),0<n.length&&(e.i=null,e.g.set(so(e,t),Di(n)),e.h+=n.length)}function so(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(pi=eo.prototype).add=function(e,t){to(this),this.i=null,e=so(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},pi.forEach=function(e,t){to(this),this.g.forEach(function(n,i){Ni(n,function(n){e.call(t,n,i,this)},this)},this)},pi.T=function(){to(this);for(var e=this.g.R(),t=this.g.T(),n=[],i=0;i<t.length;i++)for(var r=e[i],s=0;s<r.length;s++)n.push(t[i]);return n},pi.R=function(e){to(this);var t=[];if("string"==typeof e)io(this,e)&&(t=Ci(t,this.g.get(so(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=Ci(t,e[n])}return t},pi.set=function(e,t){return to(this),this.i=null,io(this,e=so(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},pi.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},pi.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var i=t[n],r=encodeURIComponent(String(i));i=this.R(i);for(var s=0;s<i.length;s++){var o=r;""!==i[s]&&(o+="="+encodeURIComponent(String(i[s]))),e.push(o)}}return this.i=e.join("&")};var oo=function(e,t){this.h=e,this.g=t};function ao(e){this.l=e||lo,e=gi.PerformanceNavigationTiming?0<(e=gi.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(gi.g&&gi.g.Ea&&gi.g.Ea()&&gi.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var lo=10;function co(e){return!!e.h||!!e.g&&e.g.size>=e.j}function uo(e){return e.h?1:e.g?e.g.size:0}function ho(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function po(e,t){e.g?e.g.add(t):e.h=t}function mo(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function fo(e){var t,n;if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){var i=e.i;try{for(var r=hi(e.g.values()),s=r.next();!s.done;s=r.next())i=i.concat(s.value.D)}catch(o){t={error:o}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return i}return Di(e.i)}function go(){}function vo(){this.g=new go}function yo(e,t,n){var i=n||"";try{Rs(e,function(e,n){var r=e;_i(e)&&(r=Cr(e)),t.push(i+n+"="+encodeURIComponent(r))})}catch(r){throw t.push(i+"type="+encodeURIComponent("_badmap")),r}}function _o(e,t,n,i,r){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,r(i)}catch(s){}}function To(e){this.l=e.$b||null,this.j=e.ib||!1}function xo(e,t){Er.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=wo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ao.prototype.cancel=function(){var e,t;if(this.i=fo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=hi(this.g.values()),i=n.next();!i.done;i=n.next())i.value.cancel()}catch(r){e={error:r}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.g.clear()}},go.prototype.stringify=function(e){return gi.JSON.stringify(e,void 0)},go.prototype.parse=function(e){return gi.JSON.parse(e,void 0)},Ii(To,us),To.prototype.g=function(){return new xo(this.l,this.j)},To.prototype.i=function(e){return function(){return e}}({}),Ii(xo,Er);var wo=0;function bo(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function Zo(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Ao(e)}function Ao(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(pi=xo.prototype).open=function(e,t){if(this.readyState!=wo)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Ao(this)},pi.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||gi).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},pi.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Zo(this)),this.readyState=wo},pi.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ao(this)),this.g&&(this.readyState=3,Ao(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==gi.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;bo(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},pi.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Zo(this):Ao(this),3==this.readyState&&bo(this)}},pi.Ua=function(e){this.g&&(this.response=this.responseText=e,Zo(this))},pi.Ta=function(e){this.g&&(this.response=e,Zo(this))},pi.ha=function(){this.g&&Zo(this)},pi.setRequestHeader=function(e,t){this.v.append(e,t)},pi.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},pi.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(xo.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Io=gi.JSON.parse;function So(e){Er.call(this),this.headers=new Os,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Eo,this.K=this.L=!1}Ii(So,Er);var Eo="",qo=/^https?$/i,No=["POST","PUT"];function Co(e){return"content-type"==e.toLowerCase()}function Do(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Ro(e),ko(e)}function Ro(e){e.D||(e.D=!0,qr(e,"complete"),qr(e,"error"))}function Oo(e){if(e.h&&void 0!==fi&&(!e.C[1]||4!=Uo(e)||2!=e.ba()))if(e.v&&4==Uo(e))Vr(e.Fa,0,e);else if(qr(e,"readystatechange"),4==Uo(e)){e.h=!1;try{var t,n=e.ba();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var i=!0;break e;default:i=!1}if(!(t=i)){var r;if(r=0===n){var s=String(e.H).match(Us)[1]||null;if(!s&&gi.self&&gi.self.location){var o=gi.self.location.protocol;s=o.substr(0,o.length-1)}r=!qo.test(s?s.toLowerCase():"")}t=r}if(t)qr(e,"complete"),qr(e,"success");else{e.m=6;try{var a=2<Uo(e)?e.g.statusText:""}catch(l){a=""}e.j=a+" ["+e.ba()+"]",Ro(e)}}finally{ko(e)}}}function ko(e,t){if(e.g){Mo(e);var n=e.g,i=e.C[0]?vi:null;e.g=null,e.C=null,t||qr(e,"ready");try{n.onreadystatechange=i}catch(r){}}}function Mo(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(gi.clearTimeout(e.A),e.A=null)}function Uo(e){return e.g?e.g.readyState:0}function Po(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Eo:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Fo(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=function(e){var t="";return Li(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Vs(e,t,n))}function Lo(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Jo(e){this.za=0,this.l=[],this.h=new Wr,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Lo("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Lo("baseRetryDelayMs",5e3,e),this.$a=Lo("retryDelaySeedMs",1e4,e),this.Ya=Lo("forwardChannelMaxRetries",2,e),this.ra=Lo("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new ao(e&&e.concurrentRequestLimit),this.Ca=new vo,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function Yo(e){if(Vo(e),3==e.G){var t=e.V++,n=Fs(e.F);Vs(n,"SID",e.J),Vs(n,"RID",t),Vs(n,"TYPE","terminate"),Bo(e,n),(t=new vs(e,e.h,t,void 0)).K=2,t.v=js(Fs(n)),n=!1,gi.navigator&&gi.navigator.sendBeacon&&(n=gi.navigator.sendBeacon(t.v.toString(),"")),!n&&gi.Image&&((new Image).src=t.v,n=!0),n||(t.g=oa(t.l,null),t.g.ea(t.v)),t.F=Date.now(),Ss(t)}ra(e)}function Qo(e){e.g&&(Ko(e),e.g.cancel(),e.g=null)}function Vo(e){Qo(e),e.u&&(gi.clearTimeout(e.u),e.u=null),ea(e),e.i.cancel(),e.m&&("number"==typeof e.m&&gi.clearTimeout(e.m),e.m=null)}function jo(e,t){e.l.push(new oo(e.Za++,t)),3==e.G&&Ho(e)}function Ho(e){co(e.i)||e.m||(e.m=!0,Pr(e.Ha,e),e.C=0)}function $o(e,t){var n;n=t?t.m:e.V++;var i=Fs(e.F);Vs(i,"SID",e.J),Vs(i,"RID",n),Vs(i,"AID",e.U),Bo(e,i),e.o&&e.s&&Fo(i,e.o,e.s),n=new vs(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=zo(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),po(e.i,n),ws(n,i,t)}function Bo(e,t){e.j&&Rs({},function(e,n){Vs(t,n,e)})}function zo(e,t,n){n=Math.min(e.l.length,n);var i=e.j?Zi(e.j.Oa,e.j,e):null;e:for(var r=e.l,s=-1;;){var o=["count="+n];-1==s?0<n?o.push("ofs="+(s=r[0].h)):s=0:o.push("ofs="+s);for(var a=!0,l=0;l<n;l++){var c=r[l].h,u=r[l].g;if(0>(c-=s))s=Math.max(0,r[l].h-100),a=!1;else try{yo(u,o,"req"+c+"_")}catch(ka){i&&i(u)}}if(a){i=o.join("&");break e}}return e=e.l.splice(0,n),t.D=e,i}function Go(e){e.g||e.u||(e.Y=1,Pr(e.Ga,e),e.A=0)}function Wo(e){return!(e.g||e.u||3<=e.A||(e.Y++,e.u=as(Zi(e.Ga,e),na(e,e.A)),e.A++,0))}function Ko(e){null!=e.B&&(gi.clearTimeout(e.B),e.B=null)}function Xo(e){e.g=new vs(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=Fs(e.oa);Vs(t,"RID","rpc"),Vs(t,"SID",e.J),Vs(t,"CI",e.N?"0":"1"),Vs(t,"AID",e.U),Bo(e,t),Vs(t,"TYPE","xmlhttp"),e.o&&e.s&&Fo(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=js(Fs(t)),n.s=null,n.U=!0,bs(n,e)}function ea(e){null!=e.v&&(gi.clearTimeout(e.v),e.v=null)}function ta(e,t){var n=null;if(e.g==t){ea(e),Ko(e),e.g=null;var i=2}else{if(!ho(e.i,t))return;n=t.D,mo(e.i,t),i=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==i){n=t.s?t.s.length:0,t=Date.now()-t.F;var r=e.C;qr(i=ts(),new os(i,n,t,r)),Ho(e)}else Go(e);else if(3==(r=t.o)||0==r&&0<e.I||!(1==i&&function(e,t){return!(uo(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=as(Zi(e.Ha,e,t),na(e,e.C)),e.C++,0)))}(e,t)||2==i&&Wo(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),r){case 1:ia(e,5);break;case 4:ia(e,10);break;case 3:ia(e,6);break;default:ia(e,2)}}function na(e,t){var n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function ia(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var i=Zi(e.jb,e);n||(n=new Ps("//www.google.com/images/cleardot.gif"),gi.location&&"http"==gi.location.protocol||Ls(n,"https"),js(n)),function(e,t){var n=new Wr;if(gi.Image){var i=new Image;i.onload=Ai(_o,n,i,"TestLoadImage: loaded",!0,t),i.onerror=Ai(_o,n,i,"TestLoadImage: error",!1,t),i.onabort=Ai(_o,n,i,"TestLoadImage: abort",!1,t),i.ontimeout=Ai(_o,n,i,"TestLoadImage: timeout",!1,t),gi.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=e}else t(!1)}(n.toString(),i)}else ss(2);e.G=0,e.j&&e.j.va(t),ra(e),Vo(e)}function ra(e){e.G=0,e.I=-1,e.j&&(0==fo(e.i).length&&0==e.l.length||(e.i.i.length=0,Di(e.l),e.l.length=0),e.j.ua())}function sa(e,t,n){var i=function(e){return e instanceof Ps?Fs(e):new Ps(e,void 0)}(n);if(""!=i.i)t&&Js(i,t+"."+i.i),Ys(i,i.m);else{var r=gi.location;i=function(e,t,n,i){var r=new Ps(null,void 0);return e&&Ls(r,e),t&&Js(r,t),n&&Ys(r,n),i&&(r.l=i),r}(r.protocol,t?t+"."+r.hostname:r.hostname,+r.port,n)}return e.aa&&Li(e.aa,function(e,t){Vs(i,t,e)}),n=e.sa,(t=e.D)&&n&&Vs(i,t,n),Vs(i,"VER",e.ma),Bo(e,i),i}function oa(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new So(n&&e.Ba&&!e.qa?new To({ib:!0}):e.qa)).L=e.H,t}function aa(){}function la(){if(Bi&&!(10<=Number(rr)))throw Error("Environmental error: no available transport.")}function ca(e,t){Er.call(this),this.g=new Jo(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!Ri(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Ri(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new ha(this)}function ua(e){ms.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function da(){fs.call(this),this.status=1}function ha(e){this.g=e}(pi=So.prototype).ea=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():hs.g(),this.C=function(e){return e.h||(e.h=e.i())}(this.u?this.u:hs),this.g.onreadystatechange=Zi(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(s){return void Do(this,s)}e=n||"";var r=new Os(this.headers);i&&Rs(i,function(e,t){r.set(t,e)}),i=function(e){e:{for(var t=Co,n=e.length,i="string"==typeof e?e.split(""):e,r=0;r<n;r++)if(r in i&&t.call(void 0,i[r],r,e)){t=r;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(r.T()),n=gi.FormData&&e instanceof gi.FormData,!(0<=qi(No,t))||i||n||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Mo(this),0<this.B&&((this.K=function(e){return Bi&&function(){return e=ir,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){for(var e=0,t=ki(String(ji)).split("."),n=ki("9").split("."),i=Math.max(t.length,n.length),r=0;0==e&&r<i;r++){var s=t[r]||"",o=n[r]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],0==s[0].length&&0==o[0].length)break;e=Ui(0==s[1].length?0:parseInt(s[1],10),0==o[1].length?0:parseInt(o[1],10))||Ui(0==s[2].length,0==o[2].length)||Ui(s[2],o[2]),s=s[3],o=o[3]}while(0==e)}return 0<=e}();var e}()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Zi(this.pa,this)):this.A=Vr(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(s){Do(this,s)}},pi.pa=function(){void 0!==fi&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,qr(this,"timeout"),this.abort(8))},pi.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,qr(this,"complete"),qr(this,"abort"),ko(this))},pi.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ko(this,!0)),So.Z.M.call(this)},pi.Fa=function(){this.s||(this.F||this.v||this.l?Oo(this):this.cb())},pi.cb=function(){Oo(this)},pi.ba=function(){try{return 2<Uo(this)?this.g.status:-1}catch(Hi){return-1}},pi.ga=function(){try{return this.g?this.g.responseText:""}catch(Hi){return""}},pi.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Io(t)}},pi.Da=function(){return this.m},pi.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(pi=Jo.prototype).ma=8,pi.G=1,pi.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(t){}},pi.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;var t=new vs(this,this.h,e,void 0),n=this.s;if(this.P&&(n?Qi(n=Ji(n),this.P):n=this.P),null===this.o&&(t.H=n),this.ja)e:{for(var i=0,r=0;r<this.l.length;r++){var s=this.l[r];if(void 0===(s="__data__"in s.g&&"string"==typeof(s=s.g.__data__)?s.length:void 0))break;if(4096<(i+=s)){i=r;break e}if(4096===i||r===this.l.length-1){i=r+1;break e}}i=1e3}else i=1e3;i=zo(this,t,i),Vs(r=Fs(this.F),"RID",e),Vs(r,"CVER",22),this.D&&Vs(r,"X-HTTP-Session-Id",this.D),Bo(this,r),this.o&&n&&Fo(r,this.o,n),po(this.i,t),this.Ra&&Vs(r,"TYPE","init"),this.ja?(Vs(r,"$req",i),Vs(r,"SID","null"),t.$=!0,ws(t,r,null)):ws(t,r,i),this.G=2}}else 3==this.G&&(e?$o(this,e):0==this.l.length||co(this.i)||$o(this))},pi.Ga=function(){if(this.u=null,Xo(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=as(Zi(this.bb,this),e)}},pi.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ss(10),Qo(this),Xo(this))},pi.ab=function(){null!=this.v&&(this.v=null,Qo(this),Wo(this),ss(19))},pi.jb=function(e){e?(this.h.info("Successfully pinged google.com"),ss(2)):(this.h.info("Failed to ping google.com"),ss(1))},(pi=aa.prototype).xa=function(){},pi.wa=function(){},pi.va=function(){},pi.ua=function(){},pi.Oa=function(){},la.prototype.g=function(e,t){return new ca(e,t)},Ii(ca,Er),ca.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),Pr(Zi(e.hb,e,t))),ss(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=sa(e,null,e.W),Ho(e)},ca.prototype.close=function(){Yo(this.g)},ca.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,jo(this.g,t)}else this.v?((t={}).__data__=Cr(e),jo(this.g,t)):jo(this.g,e)},ca.prototype.M=function(){this.g.j=null,delete this.j,Yo(this.g),delete this.g,ca.Z.M.call(this)},Ii(ua,ms),Ii(da,fs),Ii(ha,aa),ha.prototype.xa=function(){qr(this.g,"a")},ha.prototype.wa=function(e){qr(this.g,new ua(e))},ha.prototype.va=function(e){qr(this.g,new da(e))},ha.prototype.ua=function(){qr(this.g,"b")},la.prototype.createWebChannel=la.prototype.g,ca.prototype.send=ca.prototype.u,ca.prototype.open=ca.prototype.m,ca.prototype.close=ca.prototype.close,ls.NO_ERROR=0,ls.TIMEOUT=8,ls.HTTP_ERROR=6,cs.COMPLETE="complete",ds.EventType=ps,ps.OPEN="a",ps.CLOSE="b",ps.ERROR="c",ps.MESSAGE="d",Er.prototype.listen=Er.prototype.N,So.prototype.listenOnce=So.prototype.O,So.prototype.getLastError=So.prototype.La,So.prototype.getLastErrorCode=So.prototype.Da,So.prototype.getStatus=So.prototype.ba,So.prototype.getResponseJson=So.prototype.Qa,So.prototype.getResponseText=So.prototype.ga,So.prototype.send=So.prototype.ea;var pa=ls,ma=cs,fa=Xr,ga=To,va=ds,ya=So;class _a{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}_a.UNAUTHENTICATED=new _a(null),_a.GOOGLE_CREDENTIALS=new _a("google-credentials-uid"),_a.FIRST_PARTY=new _a("first-party-uid"),_a.MOCK_USER=new _a("mock-user");let Ta="9.0.0";const xa=new ci.Yd("@firebase/firestore");function wa(){return xa.logLevel}function ba(e,...t){if(xa.logLevel<=ci.in.DEBUG){const n=t.map(Ia);xa.debug(`Firestore (${Ta}): ${e}`,...n)}}function Za(e,...t){if(xa.logLevel<=ci.in.ERROR){const n=t.map(Ia);xa.error(`Firestore (${Ta}): ${e}`,...n)}}function Aa(e,...t){if(xa.logLevel<=ci.in.WARN){const n=t.map(Ia);xa.warn(`Firestore (${Ta}): ${e}`,...n)}}function Ia(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Sa(e="Unexpected state"){const t=`FIRESTORE (${Ta}) INTERNAL ASSERTION FAILED: `+e;throw Za(t),new Error(t)}function Ea(e,t){e||Sa()}function qa(e,t){return e}const Na={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ca extends Error{constructor(e,t){super(t),this.code=e,this.message=t,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Da{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Ra{constructor(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${e}`}}class Oa{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(_a.UNAUTHENTICATED))}shutdown(){}}class ka{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Ma{constructor(e){this.t=e,this.currentUser=_a.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let i=this.i;const r=e=>this.i!==i?(i=this.i,t(e)):Promise.resolve();let o=new Da;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Da,e.enqueueRetryable(()=>r(this.currentUser))};const a=t=>{e.enqueueRetryable((0,s.Z)(function*(){ba("FirebaseCredentialsProvider","Auth detected"),n.auth=t,n.auth.addAuthTokenListener(n.o),yield o.promise,yield r(n.currentUser)}))};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(ba("FirebaseCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Da)}},0),e.enqueueRetryable((0,s.Z)(function*(){0===n.i&&(yield o.promise,yield r(n.currentUser))}))}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(ba("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Ea("string"==typeof t.accessToken),new Ra(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Ea(null===e||"string"==typeof e),new _a(e)}}class Ua{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=_a.FIRST_PARTY}get authHeaders(){const e={"X-Goog-AuthUser":this.l},t=this.h.auth.getAuthHeaderValueForFirstParty([]);return t&&(e.Authorization=t),this.m&&(e["X-Goog-Iam-Authorization-Token"]=this.m),e}}class Pa{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Ua(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(_a.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Fa{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.g(e),this.p=e=>t.writeSequenceNumber(e))}g(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.p&&this.p(e),e}}function La(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let i=0;i<e;i++)n[i]=Math.floor(256*Math.random());return n}Fa.T=-1;class Ja{static I(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const i=La(40);for(let r=0;r<i.length;++r)n.length<20&&i[r]<t&&(n+=e.charAt(i[r]%e.length))}return n}}function Ya(e,t){return e<t?-1:e>t?1:0}function Qa(e,t,n){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}function Va(e){return e+"\0"}class ja{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ca(Na.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ca(Na.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Ca(Na.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ca(Na.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ja.fromMillis(Date.now())}static fromDate(e){return ja.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new ja(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ya(this.nanoseconds,e.nanoseconds):Ya(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Ha{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ha(e)}static min(){return new Ha(new ja(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function $a(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Ba(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function za(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Ga{constructor(e,t,n){void 0===t?t=0:t>e.length&&Sa(),void 0===n?n=e.length-t:n>e.length-t&&Sa(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Ga.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ga?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=e.get(i),r=t.get(i);if(n<r)return-1;if(n>r)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Wa extends Ga{construct(e,t,n){return new Wa(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Ca(Na.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new Wa(t)}static emptyPath(){return new Wa([])}}const Ka=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Xa extends Ga{construct(e,t,n){return new Xa(e,t,n)}static isValidIdentifier(e){return Ka.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Xa.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Xa(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const r=()=>{if(0===n.length)throw new Ca(Na.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;i<e.length;){const t=e[i];if("\\"===t){if(i+1===e.length)throw new Ca(Na.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Ca(Na.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?(s=!s,i++):"."!==t||s?(n+=t,i++):(r(),i++)}if(r(),s)throw new Ca(Na.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Xa(t)}static emptyPath(){return new Xa([])}}class el{constructor(e){this.fields=e,e.sort(Xa.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Qa(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class tl{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new tl(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new tl(t)}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ya(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}tl.EMPTY_BYTE_STRING=new tl("");const nl=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function il(e){if(Ea(!!e),"string"==typeof e){let t=0;const n=nl.exec(e);if(Ea(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:rl(e.seconds),nanos:rl(e.nanos)}}function rl(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function sl(e){return"string"==typeof e?tl.fromBase64String(e):tl.fromUint8Array(e)}function ol(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function al(e){const t=e.mapValue.fields.__previous_value__;return ol(t)?al(t):t}function ll(e){const t=il(e.mapValue.fields.__local_write_time__.timestampValue);return new ja(t.seconds,t.nanos)}function cl(e){return null==e}function ul(e){return 0===e&&1/e==-1/0}function dl(e){return"number"==typeof e&&Number.isInteger(e)&&!ul(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class hl{constructor(e){this.path=e}static fromPath(e){return new hl(Wa.fromString(e))}static fromName(e){return new hl(Wa.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===Wa.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Wa.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new hl(new Wa(e.slice()))}}function pl(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ol(e)?4:10:Sa()}function ml(e,t){const n=pl(e);if(n!==pl(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ll(e).isEqual(ll(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=il(e.timestampValue),i=il(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return sl(e.bytesValue).isEqual(sl(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return rl(e.geoPointValue.latitude)===rl(t.geoPointValue.latitude)&&rl(e.geoPointValue.longitude)===rl(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return rl(e.integerValue)===rl(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=rl(e.doubleValue),i=rl(t.doubleValue);return n===i?ul(n)===ul(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return Qa(e.arrayValue.values||[],t.arrayValue.values||[],ml);case 10:return function(e,t){const n=e.mapValue.fields||{},i=t.mapValue.fields||{};if($a(n)!==$a(i))return!1;for(const r in n)if(n.hasOwnProperty(r)&&(void 0===i[r]||!ml(n[r],i[r])))return!1;return!0}(e,t);default:return Sa()}}function fl(e,t){return void 0!==(e.values||[]).find(e=>ml(e,t))}function gl(e,t){const n=pl(e),i=pl(t);if(n!==i)return Ya(n,i);switch(n){case 0:return 0;case 1:return Ya(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=rl(e.integerValue||e.doubleValue),i=rl(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return vl(e.timestampValue,t.timestampValue);case 4:return vl(ll(e),ll(t));case 5:return Ya(e.stringValue,t.stringValue);case 6:return function(e,t){const n=sl(e),i=sl(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),i=t.split("/");for(let r=0;r<n.length&&r<i.length;r++){const e=Ya(n[r],i[r]);if(0!==e)return e}return Ya(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Ya(rl(e.latitude),rl(t.latitude));return 0!==n?n:Ya(rl(e.longitude),rl(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],i=t.values||[];for(let r=0;r<n.length&&r<i.length;++r){const e=gl(n[r],i[r]);if(e)return e}return Ya(n.length,i.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},i=Object.keys(n),r=t.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let o=0;o<i.length&&o<s.length;++o){const e=Ya(i[o],s[o]);if(0!==e)return e;const t=gl(n[i[o]],r[s[o]]);if(0!==t)return t}return Ya(i.length,s.length)}(e.mapValue,t.mapValue);default:throw Sa()}}function vl(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Ya(e,t);const n=il(e),i=il(t),r=Ya(n.seconds,i.seconds);return 0!==r?r:Ya(n.nanos,i.nanos)}function yl(e){return _l(e)}function _l(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=il(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?sl(e.bytesValue).toBase64():"referenceValue"in e?hl.fromName(e.referenceValue).toString():"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const i of e.values||[])n?n=!1:t+=",",t+=_l(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",i=!0;for(const r of t)i?i=!1:n+=",",n+=`${r}:${_l(e.fields[r])}`;return n+"}"}(e.mapValue):Sa();var t}function Tl(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function xl(e){return!!e&&"integerValue"in e}function wl(e){return!!e&&"arrayValue"in e}function bl(e){return!!e&&"nullValue"in e}function Zl(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Al(e){return!!e&&"mapValue"in e}function Il(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Ba(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Il(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Il(e.arrayValue.values[n]);return t}return Object.assign({},e)}class Sl{constructor(e){this.value=e}static empty(){return new Sl({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Al(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Il(t)}setAll(e){let t=Xa.emptyPath(),n={},i=[];e.forEach((e,r)=>{if(!t.isImmediateParentOf(r)){const e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=r.popLast()}e?n[r.lastSegment()]=Il(e):i.push(r.lastSegment())});const r=this.getFieldsMap(t);this.applyChanges(r,n,i)}delete(e){const t=this.field(e.popLast());Al(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ml(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Al(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Ba(t,(t,n)=>e[t]=n);for(const i of n)delete e[i]}clone(){return new Sl(Il(this.value))}}function El(e){const t=[];return Ba(e.fields,(e,n)=>{const i=new Xa([e]);if(Al(n)){const e=El(n.mapValue).fields;if(0===e.length)t.push(i);else for(const n of e)t.push(i.child(n))}else t.push(i)}),new el(t)}class ql{constructor(e,t,n,i,r){this.key=e,this.documentType=t,this.version=n,this.data=i,this.documentState=r}static newInvalidDocument(e){return new ql(e,0,Ha.min(),Sl.empty(),0)}static newFoundDocument(e,t,n){return new ql(e,1,t,n,0)}static newNoDocument(e,t){return new ql(e,2,t,Sl.empty(),0)}static newUnknownDocument(e,t){return new ql(e,3,t,Sl.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Sl.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Sl.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ql&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}clone(){return new ql(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Nl{constructor(e,t=null,n=[],i=[],r=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=o,this.A=null}}function Cl(e,t=null,n=[],i=[],r=null,s=null,o=null){return new Nl(e,t,n,i,r,s,o)}function Dl(e){const t=qa(e);if(null===t.A){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function(e){return e.field.canonicalString()+e.op.toString()+yl(e.value)}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),cl(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=jl(t.startAt)),t.endAt&&(e+="|ub:",e+=jl(t.endAt)),t.A=e}return t.A}function Rl(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!$l(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if((n=e.filters[r]).op!==(i=t.filters[r]).op||!n.field.isEqual(i.field)||!ml(n.value,i.value))return!1;var n,i;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!zl(e.startAt,t.startAt)&&zl(e.endAt,t.endAt)}function Ol(e){return hl.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class kl extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.R(e,t,n):new Ml(e,t,n):"array-contains"===t?new Ll(e,n):"in"===t?new Jl(e,n):"not-in"===t?new Yl(e,n):"array-contains-any"===t?new Ql(e,n):new kl(e,t,n)}static R(e,t,n){return"in"===t?new Ul(e,n):new Pl(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.P(gl(t,this.value)):null!==t&&pl(this.value)===pl(t)&&this.P(gl(t,this.value))}P(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Sa()}}v(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Ml extends kl{constructor(e,t,n){super(e,t,n),this.key=hl.fromName(n.referenceValue)}matches(e){const t=hl.comparator(e.key,this.key);return this.P(t)}}class Ul extends kl{constructor(e,t){super(e,"in",t),this.keys=Fl(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Pl extends kl{constructor(e,t){super(e,"not-in",t),this.keys=Fl(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Fl(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>hl.fromName(e.referenceValue))}class Ll extends kl{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return wl(t)&&fl(t.arrayValue,this.value)}}class Jl extends kl{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&fl(this.value.arrayValue,t)}}class Yl extends kl{constructor(e,t){super(e,"not-in",t)}matches(e){if(fl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!fl(this.value.arrayValue,t)}}class Ql extends kl{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!wl(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>fl(this.value.arrayValue,e))}}class Vl{constructor(e,t){this.position=e,this.before=t}}function jl(e){return`${e.before?"b":"a"}:${e.position.map(e=>yl(e)).join(",")}`}class Hl{constructor(e,t="asc"){this.field=e,this.dir=t}}function $l(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function Bl(e,t,n){let i=0;for(let r=0;r<e.position.length;r++){const s=t[r],o=e.position[r];if(i=s.field.isKeyField()?hl.comparator(hl.fromName(o.referenceValue),n.key):gl(o,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return e.before?i<=0:i<0}function zl(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.before!==t.before||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ml(e.position[n],t.position[n]))return!1;return!0}class Gl{constructor(e,t=null,n=[],i=[],r=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=o,this.endAt=a,this.V=null,this.S=null}}function Wl(e,t,n,i,r,s,o,a){return new Gl(e,t,n,i,r,s,o,a)}function Kl(e){return new Gl(e)}function Xl(e){return!cl(e.limit)&&"F"===e.limitType}function ec(e){return!cl(e.limit)&&"L"===e.limitType}function tc(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function nc(e){for(const t of e.filters)if(t.v())return t.field;return null}function ic(e){return null!==e.collectionGroup}function rc(e){const t=qa(e);if(null===t.V){t.V=[];const e=nc(t),n=tc(t);if(null!==e&&null===n)e.isKeyField()||t.V.push(new Hl(e)),t.V.push(new Hl(Xa.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.V.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.V.push(new Hl(Xa.keyField(),e))}}}return t.V}function sc(e){const t=qa(e);if(!t.S)if("F"===t.limitType)t.S=Cl(t.path,t.collectionGroup,rc(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const r of rc(t))e.push(new Hl(r.field,"desc"===r.dir?"asc":"desc"));const n=t.endAt?new Vl(t.endAt.position,!t.endAt.before):null,i=t.startAt?new Vl(t.startAt.position,!t.startAt.before):null;t.S=Cl(t.path,t.collectionGroup,e,t.filters,t.limit,n,i)}return t.S}function oc(e,t,n){return new Gl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ac(e,t){return Rl(sc(e),sc(t))&&e.limitType===t.limitType}function lc(e){return`${Dl(sc(e))}|lt:${e.limitType}`}function cc(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>{return`${(t=e).field.canonicalString()} ${t.op} ${yl(t.value)}`;var t}).join(", ")}]`),cl(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: "+jl(e.startAt)),e.endAt&&(t+=", endAt: "+jl(e.endAt)),`Target(${t})`}(sc(e))}; limitType=${e.limitType})`}function uc(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):hl.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!Bl(e.startAt,rc(e),t)||e.endAt&&Bl(e.endAt,rc(e),t))}(e,t)}function dc(e){return(t,n)=>{let i=!1;for(const r of rc(e)){const e=hc(r,t,n);if(0!==e)return e;i=i||r.field.isKeyField()}return 0}}function hc(e,t,n){const i=e.field.isKeyField()?hl.comparator(t.key,n.key):function(e,t,n){const i=t.data.field(e),r=n.data.field(e);return null!==i&&null!==r?gl(i,r):Sa()}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return Sa()}}function pc(e,t){if(e.D){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ul(t)?"-0":t}}function mc(e){return{integerValue:""+e}}function fc(e,t){return dl(t)?mc(t):pc(e,t)}class gc{constructor(){this._=void 0}}function vc(e,t,n){return e instanceof Tc?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof xc?wc(e,t):e instanceof bc?Zc(e,t):function(e,t){const n=_c(e,t),i=Ic(n)+Ic(e.C);return xl(n)&&xl(e.C)?mc(i):pc(e.N,i)}(e,t)}function yc(e,t,n){return e instanceof xc?wc(e,t):e instanceof bc?Zc(e,t):n}function _c(e,t){return e instanceof Ac?xl(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class Tc extends gc{}class xc extends gc{constructor(e){super(),this.elements=e}}function wc(e,t){const n=Sc(t);for(const i of e.elements)n.some(e=>ml(e,i))||n.push(i);return{arrayValue:{values:n}}}class bc extends gc{constructor(e){super(),this.elements=e}}function Zc(e,t){let n=Sc(t);for(const i of e.elements)n=n.filter(e=>!ml(e,i));return{arrayValue:{values:n}}}class Ac extends gc{constructor(e,t){super(),this.N=e,this.C=t}}function Ic(e){return rl(e.integerValue||e.doubleValue)}function Sc(e){return wl(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ec{constructor(e,t){this.field=e,this.transform=t}}class qc{constructor(e,t){this.version=e,this.transformResults=t}}class Nc{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Nc}static exists(e){return new Nc(void 0,e)}static updateTime(e){return new Nc(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Cc(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Dc{}function Rc(e,t,n){e instanceof Pc?function(e,t,n){const i=e.value.clone(),r=Jc(e.fieldTransforms,t,n.transformResults);i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):e instanceof Fc?function(e,t,n){if(!Cc(e.precondition,t))return void t.convertToUnknownDocument(n.version);const i=Jc(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(Lc(e)),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Oc(e,t,n){e instanceof Pc?function(e,t,n){if(!Cc(e.precondition,t))return;const i=e.value.clone(),r=Yc(e.fieldTransforms,n,t);i.setAll(r),t.convertToFoundDocument(Uc(t),i).setHasLocalMutations()}(e,t,n):e instanceof Fc?function(e,t,n){if(!Cc(e.precondition,t))return;const i=Yc(e.fieldTransforms,n,t),r=t.data;r.setAll(Lc(e)),r.setAll(i),t.convertToFoundDocument(Uc(t),r).setHasLocalMutations()}(e,t,n):function(e,t){Cc(e.precondition,t)&&t.convertToNoDocument(Ha.min())}(e,t)}function kc(e,t){let n=null;for(const i of e.fieldTransforms){const e=t.data.field(i.field),r=_c(i.transform,e||null);null!=r&&(null==n&&(n=Sl.empty()),n.set(i.field,r))}return n||null}function Mc(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Qa(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof xc&&t instanceof xc||e instanceof bc&&t instanceof bc?Qa(e.elements,t.elements,ml):e instanceof Ac&&t instanceof Ac?ml(e.C,t.C):e instanceof Tc&&t instanceof Tc}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function Uc(e){return e.isFoundDocument()?e.version:Ha.min()}class Pc extends Dc{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}}class Fc extends Dc{constructor(e,t,n,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}}function Lc(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const i=e.data.field(n);t.set(n,i)}}),t}function Jc(e,t,n){const i=new Map;Ea(e.length===n.length);for(let r=0;r<n.length;r++){const s=e[r],o=s.transform,a=t.data.field(s.field);i.set(s.field,yc(o,a,n[r]))}return i}function Yc(e,t,n){const i=new Map;for(const r of e){const e=r.transform,s=n.data.field(r.field);i.set(r.field,vc(e,s,t))}return i}class Qc extends Dc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class Vc extends Dc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class jc{constructor(e){this.count=e}}var Hc,$c;function Bc(e){switch(e){case Na.OK:return Sa();case Na.CANCELLED:case Na.UNKNOWN:case Na.DEADLINE_EXCEEDED:case Na.RESOURCE_EXHAUSTED:case Na.INTERNAL:case Na.UNAVAILABLE:case Na.UNAUTHENTICATED:return!1;case Na.INVALID_ARGUMENT:case Na.NOT_FOUND:case Na.ALREADY_EXISTS:case Na.PERMISSION_DENIED:case Na.FAILED_PRECONDITION:case Na.ABORTED:case Na.OUT_OF_RANGE:case Na.UNIMPLEMENTED:case Na.DATA_LOSS:return!0;default:return Sa()}}function zc(e){if(void 0===e)return Za("GRPC error has no .code"),Na.UNKNOWN;switch(e){case Hc.OK:return Na.OK;case Hc.CANCELLED:return Na.CANCELLED;case Hc.UNKNOWN:return Na.UNKNOWN;case Hc.DEADLINE_EXCEEDED:return Na.DEADLINE_EXCEEDED;case Hc.RESOURCE_EXHAUSTED:return Na.RESOURCE_EXHAUSTED;case Hc.INTERNAL:return Na.INTERNAL;case Hc.UNAVAILABLE:return Na.UNAVAILABLE;case Hc.UNAUTHENTICATED:return Na.UNAUTHENTICATED;case Hc.INVALID_ARGUMENT:return Na.INVALID_ARGUMENT;case Hc.NOT_FOUND:return Na.NOT_FOUND;case Hc.ALREADY_EXISTS:return Na.ALREADY_EXISTS;case Hc.PERMISSION_DENIED:return Na.PERMISSION_DENIED;case Hc.FAILED_PRECONDITION:return Na.FAILED_PRECONDITION;case Hc.ABORTED:return Na.ABORTED;case Hc.OUT_OF_RANGE:return Na.OUT_OF_RANGE;case Hc.UNIMPLEMENTED:return Na.UNIMPLEMENTED;case Hc.DATA_LOSS:return Na.DATA_LOSS;default:return Sa()}}($c=Hc||(Hc={}))[$c.OK=0]="OK",$c[$c.CANCELLED=1]="CANCELLED",$c[$c.UNKNOWN=2]="UNKNOWN",$c[$c.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",$c[$c.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",$c[$c.NOT_FOUND=5]="NOT_FOUND",$c[$c.ALREADY_EXISTS=6]="ALREADY_EXISTS",$c[$c.PERMISSION_DENIED=7]="PERMISSION_DENIED",$c[$c.UNAUTHENTICATED=16]="UNAUTHENTICATED",$c[$c.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",$c[$c.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",$c[$c.ABORTED=10]="ABORTED",$c[$c.OUT_OF_RANGE=11]="OUT_OF_RANGE",$c[$c.UNIMPLEMENTED=12]="UNIMPLEMENTED",$c[$c.INTERNAL=13]="INTERNAL",$c[$c.UNAVAILABLE=14]="UNAVAILABLE",$c[$c.DATA_LOSS=15]="DATA_LOSS";class Gc{constructor(e,t){this.comparator=e,this.root=t||Kc.EMPTY}insert(e,t){return new Gc(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Kc.BLACK,null,null))}remove(e){return new Gc(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Kc.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Wc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Wc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Wc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Wc(this.root,e,this.comparator,!0)}}class Wc{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Kc{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:Kc.RED,this.left=null!=i?i:Kc.EMPTY,this.right=null!=r?r:Kc.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,r){return new Kc(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Kc.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Kc.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Kc.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Kc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Sa();if(this.right.isRed())throw Sa();const e=this.left.check();if(e!==this.right.check())throw Sa();return e+(this.isRed()?0:1)}}Kc.EMPTY=null,Kc.RED=!0,Kc.BLACK=!1,Kc.EMPTY=new class{constructor(){this.size=0}get key(){throw Sa()}get value(){throw Sa()}get color(){throw Sa()}get left(){throw Sa()}get right(){throw Sa()}copy(e,t,n,i,r){return this}insert(e,t,n){return new Kc(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Xc{constructor(e){this.comparator=e,this.data=new Gc(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new eu(this.data.getIterator())}getIteratorFrom(e){return new eu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Xc))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Xc(this.comparator);return t.data=e,t}}class eu{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const tu=new Gc(hl.comparator);function nu(){return tu}const iu=new Gc(hl.comparator);function ru(){return iu}const su=new Gc(hl.comparator);function ou(){return su}const au=new Xc(hl.comparator);function lu(...e){let t=au;for(const n of e)t=t.add(n);return t}const cu=new Xc(Ya);function uu(){return cu}class du{constructor(e,t,n,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,hu.createSynthesizedTargetChangeForCurrentChange(e,t)),new du(Ha.min(),n,uu(),nu(),lu())}}class hu{constructor(e,t,n,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t){return new hu(tl.EMPTY_BYTE_STRING,t,lu(),lu(),lu())}}class pu{constructor(e,t,n,i){this.k=e,this.removedTargetIds=t,this.key=n,this.$=i}}class mu{constructor(e,t){this.targetId=e,this.O=t}}class fu{constructor(e,t,n=tl.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class gu{constructor(){this.F=0,this.M=_u(),this.L=tl.EMPTY_BYTE_STRING,this.B=!1,this.U=!0}get current(){return this.B}get resumeToken(){return this.L}get q(){return 0!==this.F}get K(){return this.U}j(e){e.approximateByteSize()>0&&(this.U=!0,this.L=e)}W(){let e=lu(),t=lu(),n=lu();return this.M.forEach((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:Sa()}}),new hu(this.L,this.B,e,t,n)}G(){this.U=!1,this.M=_u()}H(e,t){this.U=!0,this.M=this.M.insert(e,t)}J(e){this.U=!0,this.M=this.M.remove(e)}Y(){this.F+=1}X(){this.F-=1}Z(){this.U=!0,this.B=!0}}class vu{constructor(e){this.tt=e,this.et=new Map,this.nt=nu(),this.st=yu(),this.it=new Xc(Ya)}rt(e){for(const t of e.k)e.$&&e.$.isFoundDocument()?this.ot(t,e.$):this.at(t,e.key,e.$);for(const t of e.removedTargetIds)this.at(t,e.key,e.$)}ct(e){this.forEachTarget(e,t=>{const n=this.ut(t);switch(e.state){case 0:this.ht(t)&&n.j(e.resumeToken);break;case 1:n.X(),n.q||n.G(),n.j(e.resumeToken);break;case 2:n.X(),n.q||this.removeTarget(t);break;case 3:this.ht(t)&&(n.Z(),n.j(e.resumeToken));break;case 4:this.ht(t)&&(this.lt(t),n.j(e.resumeToken));break;default:Sa()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.et.forEach((e,n)=>{this.ht(n)&&t(n)})}ft(e){const t=e.targetId,n=e.O.count,i=this.dt(t);if(i){const e=i.target;if(Ol(e))if(0===n){const n=new hl(e.path);this.at(t,n,ql.newNoDocument(n,Ha.min()))}else Ea(1===n);else this.wt(t)!==n&&(this.lt(t),this.it=this.it.add(t))}}_t(e){const t=new Map;this.et.forEach((n,i)=>{const r=this.dt(i);if(r){if(n.current&&Ol(r.target)){const t=new hl(r.target.path);null!==this.nt.get(t)||this.gt(i,t)||this.at(i,t,ql.newNoDocument(t,e))}n.K&&(t.set(i,n.W()),n.G())}});let n=lu();this.st.forEach((e,t)=>{let i=!0;t.forEachWhile(e=>{const t=this.dt(e);return!t||2===t.purpose||(i=!1,!1)}),i&&(n=n.add(e))});const i=new du(e,t,this.it,this.nt,n);return this.nt=nu(),this.st=yu(),this.it=new Xc(Ya),i}ot(e,t){if(!this.ht(e))return;const n=this.gt(e,t.key)?2:0;this.ut(e).H(t.key,n),this.nt=this.nt.insert(t.key,t),this.st=this.st.insert(t.key,this.yt(t.key).add(e))}at(e,t,n){if(!this.ht(e))return;const i=this.ut(e);this.gt(e,t)?i.H(t,1):i.J(t),this.st=this.st.insert(t,this.yt(t).delete(e)),n&&(this.nt=this.nt.insert(t,n))}removeTarget(e){this.et.delete(e)}wt(e){const t=this.ut(e).W();return this.tt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Y(e){this.ut(e).Y()}ut(e){let t=this.et.get(e);return t||(t=new gu,this.et.set(e,t)),t}yt(e){let t=this.st.get(e);return t||(t=new Xc(Ya),this.st=this.st.insert(e,t)),t}ht(e){const t=null!==this.dt(e);return t||ba("WatchChangeAggregator","Detected inactive target",e),t}dt(e){const t=this.et.get(e);return t&&t.q?null:this.tt.Et(e)}lt(e){this.et.set(e,new gu),this.tt.getRemoteKeysForTarget(e).forEach(t=>{this.at(e,t,null)})}gt(e,t){return this.tt.getRemoteKeysForTarget(e).has(t)}}function yu(){return new Gc(hl.comparator)}function _u(){return new Gc(hl.comparator)}const Tu={asc:"ASCENDING",desc:"DESCENDING"},xu={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class wu{constructor(e,t){this.databaseId=e,this.D=t}}function bu(e,t){return e.D?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Zu(e,t){return e.D?t.toBase64():t.toUint8Array()}function Au(e,t){return bu(e,t.toTimestamp())}function Iu(e){return Ea(!!e),Ha.fromTimestamp(function(e){const t=il(e);return new ja(t.seconds,t.nanos)}(e))}function Su(e,t){return function(e){return new Wa(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Eu(e){const t=Wa.fromString(e);return Ea(Ku(t)),t}function qu(e,t){return Su(e.databaseId,t.path)}function Nu(e,t){const n=Eu(t);if(n.get(1)!==e.databaseId.projectId)throw new Ca(Na.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Ca(Na.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new hl(Ou(n))}function Cu(e,t){return Su(e.databaseId,t)}function Du(e){const t=Eu(e);return 4===t.length?Wa.emptyPath():Ou(t)}function Ru(e){return new Wa(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ou(e){return Ea(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function ku(e,t,n){return{name:qu(e,t),fields:n.value.mapValue.fields}}function Mu(e,t,n){const i=Nu(e,t.name),r=Iu(t.updateTime),s=new Sl({mapValue:{fields:t.fields}}),o=ql.newFoundDocument(i,r,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Uu(e,t){let n;if(t instanceof Pc)n={update:ku(e,t.key,t.value)};else if(t instanceof Qc)n={delete:qu(e,t.key)};else if(t instanceof Fc)n={update:ku(e,t.key,t.data),updateMask:Wu(t.fieldMask)};else{if(!(t instanceof Vc))return Sa();n={verify:qu(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Tc)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof xc)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof bc)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ac)return{fieldPath:t.field.canonicalString(),increment:n.C};throw Sa()}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Au(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Sa()}(e,t.precondition)),n}function Pu(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Nc.updateTime(Iu(e.updateTime)):void 0!==e.exists?Nc.exists(e.exists):Nc.none()}(t.currentDocument):Nc.none(),i=t.updateTransforms?t.updateTransforms.map(t=>function(e,t){let n=null;"setToServerValue"in t?(Ea("REQUEST_TIME"===t.setToServerValue),n=new Tc):"appendMissingElements"in t?n=new xc(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new bc(t.removeAllFromArray.values||[]):"increment"in t?n=new Ac(e,t.increment):Sa();const i=Xa.fromServerFormat(t.fieldPath);return new Ec(i,n)}(e,t)):[];if(t.update){const r=Nu(e,t.update.name),s=new Sl({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){return new el((e.fieldPaths||[]).map(e=>Xa.fromServerFormat(e)))}(t.updateMask);return new Fc(r,s,e,n,i)}return new Pc(r,s,n,i)}if(t.delete){const i=Nu(e,t.delete);return new Qc(i,n)}if(t.verify){const i=Nu(e,t.verify);return new Vc(i,n)}return Sa()}function Fu(e,t){return{documents:[Cu(e,t.path)]}}function Lu(e,t){const n={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(n.parent=Cu(e,i),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Cu(e,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const r=function(e){if(0===e.length)return;const t=e.map(e=>function(e){if("=="===e.op){if(Zl(e.value))return{unaryFilter:{field:$u(e.field),op:"IS_NAN"}};if(bl(e.value))return{unaryFilter:{field:$u(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Zl(e.value))return{unaryFilter:{field:$u(e.field),op:"IS_NOT_NAN"}};if(bl(e.value))return{unaryFilter:{field:$u(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$u(e.field),op:Hu(e.op),value:e.value}}}(e));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);r&&(n.structuredQuery.where=r);const s=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:$u(e.field),direction:ju(e.dir)}}(e))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(e,t){return e.D||cl(t)?t:{value:t}}(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=Qu(t.startAt)),t.endAt&&(n.structuredQuery.endAt=Qu(t.endAt)),n}function Ju(e){let t=Du(e.parent);const n=e.structuredQuery,i=n.from?n.from.length:0;let r=null;if(i>0){Ea(1===i);const e=n.from[0];e.allDescendants?r=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=Yu(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>function(e){return new Hl(Bu(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,cl(t)?null:t}(n.limit));let l=null;n.startAt&&(l=Vu(n.startAt));let c=null;return n.endAt&&(c=Vu(n.endAt)),Wl(t,r,o,s,a,"F",l,c)}function Yu(e){return e?void 0!==e.unaryFilter?[Gu(e)]:void 0!==e.fieldFilter?[zu(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>Yu(e)).reduce((e,t)=>e.concat(t)):Sa():[]}function Qu(e){return{before:e.before,values:e.position}}function Vu(e){return new Vl(e.values||[],!!e.before)}function ju(e){return Tu[e]}function Hu(e){return xu[e]}function $u(e){return{fieldPath:e.canonicalString()}}function Bu(e){return Xa.fromServerFormat(e.fieldPath)}function zu(e){return kl.create(Bu(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Sa()}}(e.fieldFilter.op),e.fieldFilter.value)}function Gu(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Bu(e.unaryFilter.field);return kl.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Bu(e.unaryFilter.field);return kl.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Bu(e.unaryFilter.field);return kl.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Bu(e.unaryFilter.field);return kl.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Sa()}}function Wu(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Ku(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function Xu(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=td(t)),t=ed(e.get(n),t);return td(t)}function ed(e,t){let n=t;const i=e.length;for(let r=0;r<i;r++){const t=e.charAt(r);switch(t){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=t}}return n}function td(e){return e+"\x01\x01"}function nd(e){const t=e.length;if(Ea(t>=2),2===t)return Ea("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),Wa.emptyPath();const n=t-2,i=[];let r="";for(let s=0;s<t;){const t=e.indexOf("\x01",s);switch((t<0||t>n)&&Sa(),e.charAt(t+1)){case"\x01":const n=e.substring(s,t);let o;0===r.length?o=n:(r+=n,o=r,r=""),i.push(o);break;case"\x10":r+=e.substring(s,t),r+="\0";break;case"\x11":r+=e.substring(s,t+1);break;default:Sa()}s=t+2}return new Wa(i)}class id{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class rd{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}rd.store="owner",rd.key="owner";class sd{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}sd.store="mutationQueues",sd.keyPath="userId";class od{constructor(e,t,n,i,r){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=i,this.mutations=r}}od.store="mutations",od.keyPath="batchId",od.userMutationsIndex="userMutationsIndex",od.userMutationsKeyPath=["userId","batchId"];class ad{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,Xu(t)]}static key(e,t,n){return[e,Xu(t),n]}}ad.store="documentMutations",ad.PLACEHOLDER=new ad;class ld{constructor(e,t){this.path=e,this.readTime=t}}class cd{constructor(e,t){this.path=e,this.version=t}}class ud{constructor(e,t,n,i,r,s){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=i,this.readTime=r,this.parentPath=s}}ud.store="remoteDocuments",ud.readTimeIndex="readTimeIndex",ud.readTimeIndexPath="readTime",ud.collectionReadTimeIndex="collectionReadTimeIndex",ud.collectionReadTimeIndexPath=["parentPath","readTime"];class dd{constructor(e){this.byteSize=e}}dd.store="remoteDocumentGlobal",dd.key="remoteDocumentGlobalKey";class hd{constructor(e,t,n,i,r,s,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=i,this.lastListenSequenceNumber=r,this.lastLimboFreeSnapshotVersion=s,this.query=o}}hd.store="targets",hd.keyPath="targetId",hd.queryTargetsIndexName="queryTargetsIndex",hd.queryTargetsKeyPath=["canonicalId","targetId"];class pd{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}pd.store="targetDocuments",pd.keyPath=["targetId","path"],pd.documentTargetsIndex="documentTargetsIndex",pd.documentTargetsKeyPath=["path","targetId"];class md{constructor(e,t,n,i){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=i}}md.key="targetGlobalKey",md.store="targetGlobal";class fd{constructor(e,t){this.collectionId=e,this.parent=t}}fd.store="collectionParents",fd.keyPath=["collectionId","parent"];class gd{constructor(e,t,n,i){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=i}}gd.store="clientMetadata",gd.keyPath="clientId";class vd{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}vd.store="bundles",vd.keyPath="bundleId";class yd{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}yd.store="namedQueries",yd.keyPath="name";const _d=[sd.store,od.store,ad.store,ud.store,hd.store,rd.store,md.store,pd.store,gd.store,dd.store,fd.store,vd.store,yd.store],Td="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class xd{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class wd{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Sa(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new wd((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof wd?t:wd.resolve(t)}catch(e){return wd.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):wd.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):wd.reject(t)}static resolve(e){return new wd((t,n)=>{t(e)})}static reject(e){return new wd((t,n)=>{n(e)})}static waitFor(e){return new wd((t,n)=>{let i=0,r=0,s=!1;e.forEach(e=>{++i,e.next(()=>{++r,s&&r===i&&t()},e=>n(e))}),s=!0,r===i&&t()})}static or(e){let t=wd.resolve(!1);for(const n of e)t=t.next(e=>e?wd.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,i)=>{n.push(t.call(this,e,i))}),this.waitFor(n)}}class bd{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.Tt=new Da,this.transaction.oncomplete=()=>{this.Tt.resolve()},this.transaction.onabort=()=>{t.error?this.Tt.reject(new Id(e,t.error)):this.Tt.resolve()},this.transaction.onerror=t=>{const n=Cd(t.target.error);this.Tt.reject(new Id(e,n))}}static open(e,t,n,i){try{return new bd(t,e.transaction(i,n))}catch(e){throw new Id(t,e)}}get It(){return this.Tt.promise}abort(e){e&&this.Tt.reject(e),this.aborted||(ba("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){const t=this.transaction.objectStore(e);return new Ed(t)}}class Zd{constructor(e,t,n){this.name=e,this.version=t,this.At=n,12.2===Zd.Rt((0,ui.z$)())&&Za("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return ba("SimpleDb","Removing database:",e),qd(window.indexedDB.deleteDatabase(e)).toPromise()}static Pt(){if("undefined"==typeof indexedDB)return!1;if(Zd.bt())return!0;const e=(0,ui.z$)(),t=Zd.Rt(e),n=0<t&&t<10,i=Zd.vt(e),r=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||r)}static bt(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Vt)}static St(e,t){return e.store(t)}static Rt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static vt(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}Dt(e){var t=this;return(0,s.Z)(function*(){return t.db||(ba("SimpleDb","Opening database:",t.name),t.db=yield new Promise((n,i)=>{const r=indexedDB.open(t.name,t.version);r.onsuccess=e=>{n(e.target.result)},r.onblocked=()=>{i(new Id(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const n=t.target.error;i("VersionError"===n.name?new Ca(Na.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Id(e,n))},r.onupgradeneeded=e=>{ba("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',e.oldVersion),t.At.Ct(e.target.result,r.transaction,e.oldVersion,t.version).next(()=>{ba("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.Nt&&(t.db.onversionchange=e=>t.Nt(e)),t.db})()}xt(e){this.Nt=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){var r=this;return(0,s.Z)(function*(){const s="readonly"===t;let o=0;for(;;){++o;try{r.db=yield r.Dt(e);const t=bd.open(r.db,e,s?"readonly":"readwrite",n),o=i(t).catch(e=>(t.abort(e),wd.reject(e))).toPromise();return o.catch(()=>{}),yield t.It,o}catch(e){const n="FirebaseError"!==e.name&&o<3;if(ba("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),r.close(),!n)return Promise.reject(e)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Ad{constructor(e){this.kt=e,this.$t=!1,this.Ot=null}get isDone(){return this.$t}get Ft(){return this.Ot}set cursor(e){this.kt=e}done(){this.$t=!0}Mt(e){this.Ot=e}delete(){return qd(this.kt.delete())}}class Id extends Ca{constructor(e,t){super(Na.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Sd(e){return"IndexedDbTransactionError"===e.name}class Ed{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(ba("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(ba("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),qd(n)}add(e){return ba("SimpleDb","ADD",this.store.name,e,e),qd(this.store.add(e))}get(e){return qd(this.store.get(e)).next(t=>(void 0===t&&(t=null),ba("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return ba("SimpleDb","DELETE",this.store.name,e),qd(this.store.delete(e))}count(){return ba("SimpleDb","COUNT",this.store.name),qd(this.store.count())}Lt(e,t){const n=this.cursor(this.options(e,t)),i=[];return this.Bt(n,(e,t)=>{i.push(t)}).next(()=>i)}Ut(e,t){ba("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.qt=!1;const i=this.cursor(n);return this.Bt(i,(e,t,n)=>n.delete())}Kt(e,t){let n;t?n=e:(n={},t=e);const i=this.cursor(n);return this.Bt(i,t)}jt(e){const t=this.cursor({});return new wd((n,i)=>{t.onerror=e=>{const t=Cd(e.target.error);i(t)},t.onsuccess=t=>{const i=t.target.result;i?e(i.primaryKey,i.value).next(e=>{e?i.continue():n()}):n()}})}Bt(e,t){const n=[];return new wd((i,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{const r=e.target.result;if(!r)return void i();const s=new Ad(r),o=t(r.primaryKey,r.value,s);if(o instanceof wd){const e=o.catch(e=>(s.done(),wd.reject(e)));n.push(e)}s.isDone?i():null===s.Ft?r.continue():r.continue(s.Ft)}}).next(()=>wd.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.qt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function qd(e){return new wd((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{const t=Cd(e.target.error);n(t)}})}let Nd=!1;function Cd(e){const t=Zd.Rt((0,ui.z$)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new Ca("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Nd||(Nd=!0,setTimeout(()=>{throw e},0)),e}}return e}class Dd extends xd{constructor(e,t){super(),this.Qt=e,this.currentSequenceNumber=t}}function Rd(e,t){const n=qa(e);return Zd.St(n.Qt,t)}class Od{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const t=this.mutations[i];t.key.isEqual(e.key)&&Rc(t,e,n[i])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&Oc(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&Oc(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(t=>{const n=e.get(t.key),i=n;this.applyToLocalView(i),n.isValidDocument()||i.convertToNoDocument(Ha.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),lu())}isEqual(e){return this.batchId===e.batchId&&Qa(this.mutations,e.mutations,(e,t)=>Mc(e,t))&&Qa(this.baseMutations,e.baseMutations,(e,t)=>Mc(e,t))}}class kd{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){Ea(e.mutations.length===n.length);let i=ou();const r=e.mutations;for(let s=0;s<r.length;s++)i=i.insert(r[s].key,n[s].version);return new kd(e,t,n,i)}}class Md{constructor(e,t,n,i,r=Ha.min(),s=Ha.min(),o=tl.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new Md(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Md(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Md(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Ud{constructor(e){this.Wt=e}}function Pd(e,t){if(t.document)return Mu(e.Wt,t.document,!!t.hasCommittedMutations);if(t.noDocument){const e=hl.fromSegments(t.noDocument.path),n=Qd(t.noDocument.readTime),i=ql.newNoDocument(e,n);return t.hasCommittedMutations?i.setHasCommittedMutations():i}if(t.unknownDocument){const e=hl.fromSegments(t.unknownDocument.path),n=Qd(t.unknownDocument.version);return ql.newUnknownDocument(e,n)}return Sa()}function Fd(e,t,n){const i=Ld(n),r=t.key.path.popLast().toArray();if(t.isFoundDocument()){const n=function(e,t){return{name:qu(e,t.key),fields:t.data.value.mapValue.fields,updateTime:bu(e,t.version.toTimestamp())}}(e.Wt,t);return new ud(null,null,n,t.hasCommittedMutations,i,r)}if(t.isNoDocument()){const e=t.key.path.toArray(),n=Yd(t.version),s=t.hasCommittedMutations;return new ud(null,new ld(e,n),null,s,i,r)}if(t.isUnknownDocument()){const e=t.key.path.toArray(),n=Yd(t.version);return new ud(new cd(e,n),null,null,!0,i,r)}return Sa()}function Ld(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Jd(e){const t=new ja(e[0],e[1]);return Ha.fromTimestamp(t)}function Yd(e){const t=e.toTimestamp();return new id(t.seconds,t.nanoseconds)}function Qd(e){const t=new ja(e.seconds,e.nanoseconds);return Ha.fromTimestamp(t)}function Vd(e,t){const n=(t.baseMutations||[]).map(t=>Pu(e.Wt,t));for(let s=0;s<t.mutations.length-1;++s){const e=t.mutations[s];s+1<t.mutations.length&&void 0!==t.mutations[s+1].transform&&(e.updateTransforms=t.mutations[s+1].transform.fieldTransforms,t.mutations.splice(s+1,1),++s)}const i=t.mutations.map(t=>Pu(e.Wt,t)),r=ja.fromMillis(t.localWriteTimeMs);return new Od(t.batchId,r,n,i)}function jd(e){const t=Qd(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Qd(e.lastLimboFreeSnapshotVersion):Ha.min();let i;var r;return void 0!==e.query.documents?(Ea(1===(r=e.query).documents.length),i=sc(Kl(Du(r.documents[0])))):i=function(e){return sc(Ju(e))}(e.query),new Md(i,e.targetId,0,e.lastListenSequenceNumber,t,n,tl.fromBase64String(e.resumeToken))}function Hd(e,t){const n=Yd(t.snapshotVersion),i=Yd(t.lastLimboFreeSnapshotVersion);let r;r=Ol(t.target)?Fu(e.Wt,t.target):Lu(e.Wt,t.target);const s=t.resumeToken.toBase64();return new hd(t.targetId,Dl(t.target),n,s,t.sequenceNumber,i,r)}function $d(e){const t=Ju({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?oc(t,t.limit,"L"):t}class Bd{getBundleMetadata(e,t){return zd(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:Qd(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return zd(e).put({bundleId:(n=t).id,createTime:Yd(Iu(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return Gd(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:$d(t.bundledQuery),readTime:Qd(t.readTime)};var t})}saveNamedQuery(e,t){return Gd(e).put(function(e){return{name:e.name,readTime:Yd(Iu(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function zd(e){return Rd(e,vd.store)}function Gd(e){return Rd(e,yd.store)}class Wd{constructor(){this.Gt=new Kd}addToCollectionParentIndex(e,t){return this.Gt.add(t),wd.resolve()}getCollectionParents(e,t){return wd.resolve(this.Gt.getEntries(t))}}class Kd{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Xc(Wa.comparator),r=!i.has(n);return this.index[t]=i.add(n),r}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Xc(Wa.comparator)).toArray()}}class Xd{constructor(){this.zt=new Kd}addToCollectionParentIndex(e,t){if(!this.zt.has(t)){const n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.zt.add(t)});const r={collectionId:n,parent:Xu(i)};return eh(e).put(r)}return wd.resolve()}getCollectionParents(e,t){const n=[],i=IDBKeyRange.bound([t,""],[Va(t),""],!1,!0);return eh(e).Lt(i).next(e=>{for(const i of e){if(i.collectionId!==t)break;n.push(nd(i.parent))}return n})}}function eh(e){return Rd(e,fd.store)}const th={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class nh{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new nh(e,nh.DEFAULT_COLLECTION_PERCENTILE,nh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function ih(e,t,n){const i=e.store(od.store),r=e.store(ad.store),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const l=i.Kt({range:o},(e,t,n)=>(a++,n.delete()));s.push(l.next(()=>{Ea(1===a)}));const c=[];for(const u of n.mutations){const e=ad.key(t,u.key.path,n.batchId);s.push(r.delete(e)),c.push(u.key)}return wd.waitFor(s).next(()=>c)}function rh(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Sa();t=e.noDocument}return JSON.stringify(t).length}nh.DEFAULT_COLLECTION_PERCENTILE=10,nh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,nh.DEFAULT=new nh(41943040,nh.DEFAULT_COLLECTION_PERCENTILE,nh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),nh.DISABLED=new nh(-1,0,0);class sh{constructor(e,t,n,i){this.userId=e,this.N=t,this.Ht=n,this.referenceDelegate=i,this.Jt={}}static Yt(e,t,n,i){Ea(""!==e.uid);const r=e.isAuthenticated()?e.uid:"";return new sh(r,t,n,i)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ah(e).Kt({index:od.userMutationsIndex,range:n},(e,n,i)=>{t=!1,i.done()}).next(()=>t)}addMutationBatch(e,t,n,i){const r=lh(e),s=ah(e);return s.add({}).next(o=>{Ea("number"==typeof o);const a=new Od(o,t,n,i),l=function(e,t,n){const i=n.baseMutations.map(t=>Uu(e.Wt,t)),r=n.mutations.map(t=>Uu(e.Wt,t));return new od(t,n.batchId,n.localWriteTime.toMillis(),i,r)}(this.N,this.userId,a),c=[];let u=new Xc((e,t)=>Ya(e.canonicalString(),t.canonicalString()));for(const e of i){const t=ad.key(this.userId,e.key.path,o);u=u.add(e.key.path.popLast()),c.push(s.put(l)),c.push(r.put(t,ad.PLACEHOLDER))}return u.forEach(t=>{c.push(this.Ht.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Jt[o]=a.keys()}),wd.waitFor(c).next(()=>a)})}lookupMutationBatch(e,t){return ah(e).get(t).next(e=>e?(Ea(e.userId===this.userId),Vd(this.N,e)):null)}Xt(e,t){return this.Jt[t]?wd.resolve(this.Jt[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){const n=e.keys();return this.Jt[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]);let r=null;return ah(e).Kt({index:od.userMutationsIndex,range:i},(e,t,i)=>{t.userId===this.userId&&(Ea(t.batchId>=n),r=Vd(this.N,t)),i.done()}).next(()=>r)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return ah(e).Kt({index:od.userMutationsIndex,range:t,reverse:!0},(e,t,i)=>{n=t.batchId,i.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ah(e).Lt(od.userMutationsIndex,t).next(e=>e.map(e=>Vd(this.N,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=ad.prefixForPath(this.userId,t.path),i=IDBKeyRange.lowerBound(n),r=[];return lh(e).Kt({range:i},(n,i,s)=>{const[o,a,l]=n,c=nd(a);if(o===this.userId&&t.path.isEqual(c))return ah(e).get(l).next(e=>{if(!e)throw Sa();Ea(e.userId===this.userId),r.push(Vd(this.N,e))});s.done()}).next(()=>r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Xc(Ya);const i=[];return t.forEach(t=>{const r=ad.prefixForPath(this.userId,t.path),s=IDBKeyRange.lowerBound(r),o=lh(e).Kt({range:s},(e,i,r)=>{const[s,o,a]=e,l=nd(o);s===this.userId&&t.path.isEqual(l)?n=n.add(a):r.done()});i.push(o)}),wd.waitFor(i).next(()=>this.Zt(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1,r=ad.prefixForPath(this.userId,n),s=IDBKeyRange.lowerBound(r);let o=new Xc(Ya);return lh(e).Kt({range:s},(e,t,r)=>{const[s,a,l]=e,c=nd(a);s===this.userId&&n.isPrefixOf(c)?c.length===i&&(o=o.add(l)):r.done()}).next(()=>this.Zt(e,o))}Zt(e,t){const n=[],i=[];return t.forEach(t=>{i.push(ah(e).get(t).next(e=>{if(null===e)throw Sa();Ea(e.userId===this.userId),n.push(Vd(this.N,e))}))}),wd.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return ih(e.Qt,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.te(t.batchId)}),wd.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}te(e){delete this.Jt[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return wd.resolve();const n=IDBKeyRange.lowerBound(ad.prefixForUser(this.userId)),i=[];return lh(e).Kt({range:n},(e,t,n)=>{if(e[0]===this.userId){const t=nd(e[1]);i.push(t)}else n.done()}).next(()=>{Ea(0===i.length)})})}containsKey(e,t){return oh(e,this.userId,t)}ee(e){return ch(e).get(this.userId).next(e=>e||new sd(this.userId,-1,""))}}function oh(e,t,n){const i=ad.prefixForPath(t,n.path),r=i[1],s=IDBKeyRange.lowerBound(i);let o=!1;return lh(e).Kt({range:s,qt:!0},(e,n,i)=>{const[s,a,l]=e;s===t&&a===r&&(o=!0),i.done()}).next(()=>o)}function ah(e){return Rd(e,od.store)}function lh(e){return Rd(e,ad.store)}function ch(e){return Rd(e,sd.store)}class uh{constructor(e){this.ne=e}next(){return this.ne+=2,this.ne}static se(){return new uh(0)}static ie(){return new uh(-1)}}class dh{constructor(e,t){this.referenceDelegate=e,this.N=t}allocateTargetId(e){return this.re(e).next(t=>{const n=new uh(t.highestTargetId);return t.highestTargetId=n.next(),this.oe(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.re(e).next(e=>Ha.fromTimestamp(new ja(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.re(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.re(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.oe(e,i)))}addTargetData(e,t){return this.ae(e,t).next(()=>this.re(e).next(n=>(n.targetCount+=1,this.ce(t,n),this.oe(e,n))))}updateTargetData(e,t){return this.ae(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>hh(e).delete(t.targetId)).next(()=>this.re(e)).next(t=>(Ea(t.targetCount>0),t.targetCount-=1,this.oe(e,t)))}removeTargets(e,t,n){let i=0;const r=[];return hh(e).Kt((s,o)=>{const a=jd(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(i++,r.push(this.removeTargetData(e,a)))}).next(()=>wd.waitFor(r)).next(()=>i)}forEachTarget(e,t){return hh(e).Kt((e,n)=>{const i=jd(n);t(i)})}re(e){return ph(e).get(md.key).next(e=>(Ea(null!==e),e))}oe(e,t){return ph(e).put(md.key,t)}ae(e,t){return hh(e).put(Hd(this.N,t))}ce(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.re(e).next(e=>e.targetCount)}getTargetData(e,t){const n=Dl(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let r=null;return hh(e).Kt({range:i,index:hd.queryTargetsIndexName},(e,n,i)=>{const s=jd(n);Rl(t,s.target)&&(r=s,i.done())}).next(()=>r)}addMatchingKeys(e,t,n){const i=[],r=mh(e);return t.forEach(t=>{const s=Xu(t.path);i.push(r.put(new pd(n,s))),i.push(this.referenceDelegate.addReference(e,n,t))}),wd.waitFor(i)}removeMatchingKeys(e,t,n){const i=mh(e);return wd.forEach(t,t=>{const r=Xu(t.path);return wd.waitFor([i.delete([n,r]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){const n=mh(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),i=mh(e);let r=lu();return i.Kt({range:n,qt:!0},(e,t,n)=>{const i=nd(e[1]),s=new hl(i);r=r.add(s)}).next(()=>r)}containsKey(e,t){const n=Xu(t.path),i=IDBKeyRange.bound([n],[Va(n)],!1,!0);let r=0;return mh(e).Kt({index:pd.documentTargetsIndex,qt:!0,range:i},([e,t],n,i)=>{0!==e&&(r++,i.done())}).next(()=>r>0)}Et(e,t){return hh(e).get(t).next(e=>e?jd(e):null)}}function hh(e){return Rd(e,hd.store)}function ph(e){return Rd(e,md.store)}function mh(e){return Rd(e,pd.store)}function fh(e){return gh.apply(this,arguments)}function gh(){return(gh=(0,s.Z)(function*(e){if(e.code!==Na.FAILED_PRECONDITION||e.message!==Td)throw e;ba("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}function vh([e,t],[n,i]){const r=Ya(e,n);return 0===r?Ya(t,i):r}class yh{constructor(e){this.ue=e,this.buffer=new Xc(vh),this.he=0}le(){return++this.he}fe(e){const t=[e,this.le()];if(this.buffer.size<this.ue)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();vh(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class _h{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.de=!1,this.we=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this._e(e)}stop(){this.we&&(this.we.cancel(),this.we=null)}get started(){return null!==this.we}_e(e){var t=this;const n=this.de?3e5:6e4;ba("LruGarbageCollector",`Garbage collection scheduled in ${n}ms`),this.we=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(0,s.Z)(function*(){t.we=null,t.de=!0;try{yield e.collectGarbage(t.garbageCollector)}catch(e){Sd(e)?ba("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield fh(e)}yield t._e(e)}))}}class Th{constructor(e,t){this.me=e,this.params=t}calculateTargetCount(e,t){return this.me.ge(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return wd.resolve(Fa.T);const n=new yh(t);return this.me.forEachTarget(e,e=>n.fe(e.sequenceNumber)).next(()=>this.me.ye(e,e=>n.fe(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.me.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.me.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(ba("LruGarbageCollector","Garbage collection skipped; disabled"),wd.resolve(th)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(ba("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),th):this.pe(e,t))}getCacheSize(e){return this.me.getCacheSize(e)}pe(e,t){let n,i,r,s,o,a,l;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(ba("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),i=this.params.maximumSequenceNumbersToCollect):i=t,s=Date.now(),this.nthSequenceNumber(e,i))).next(i=>(n=i,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(r=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),wa()<=ci.in.DEBUG&&ba("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-c}ms\n\tDetermined least recently used ${i} in `+(o-s)+"ms\n"+`\tRemoved ${r} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(l-a)+"ms\n"+`Total Duration: ${l-c}ms`),wd.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:e})))}}class xh{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new Th(e,t)}(this,t)}ge(e){const t=this.Ee(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Ee(e){let t=0;return this.ye(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}ye(e,t){return this.Te(e,(e,n)=>t(n))}addReference(e,t,n){return wh(e,n)}removeReference(e,t,n){return wh(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return wh(e,t)}Ie(e,t){return function(e,t){let n=!1;return ch(e).jt(i=>oh(e,i,t).next(e=>(e&&(n=!0),wd.resolve(!e)))).next(()=>n)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let r=0;return this.Te(e,(s,o)=>{if(o<=t){const t=this.Ie(e,s).next(t=>{if(!t)return r++,n.getEntry(e,s).next(()=>(n.removeEntry(s),mh(e).delete([0,Xu(s.path)])))});i.push(t)}}).next(()=>wd.waitFor(i)).next(()=>n.apply(e)).next(()=>r)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return wh(e,t)}Te(e,t){const n=mh(e);let i,r=Fa.T;return n.Kt({index:pd.documentTargetsIndex},([e,n],{path:s,sequenceNumber:o})=>{0===e?(r!==Fa.T&&t(new hl(nd(i)),r),r=o,i=s):r=Fa.T}).next(()=>{r!==Fa.T&&t(new hl(nd(i)),r)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function wh(e,t){return mh(e).put(function(e,t){return new pd(0,Xu(e.path),t)}(t,e.currentSequenceNumber))}class bh{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,r]of n)if(this.equalsFn(i,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0!==i){for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],e))return void(i[n]=[e,t]);i.push([e,t])}else this.inner[n]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),!0;return!1}forEach(e){Ba(this.inner,(t,n)=>{for(const[i,r]of n)e(i,r)})}isEmpty(){return za(this.inner)}}class Zh{constructor(){this.changes=new bh(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}getReadTime(e){const t=this.changes.get(e);return t?t.readTime:Ha.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:ql.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?wd.resolve(n.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Ah{constructor(e,t){this.N=e,this.Ht=t}addEntry(e,t,n){return Eh(e).put(qh(t),n)}removeEntry(e,t){const n=Eh(e),i=qh(t);return n.delete(i)}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.Ae(e,n)))}getEntry(e,t){return Eh(e).get(qh(t)).next(e=>this.Re(t,e))}Pe(e,t){return Eh(e).get(qh(t)).next(e=>({document:this.Re(t,e),size:rh(e)}))}getEntries(e,t){let n=nu();return this.be(e,t,(e,t)=>{const i=this.Re(e,t);n=n.insert(e,i)}).next(()=>n)}ve(e,t){let n=nu(),i=new Gc(hl.comparator);return this.be(e,t,(e,t)=>{const r=this.Re(e,t);n=n.insert(e,r),i=i.insert(e,rh(t))}).next(()=>({documents:n,Ve:i}))}be(e,t,n){if(t.isEmpty())return wd.resolve();const i=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),r=t.getIterator();let s=r.getNext();return Eh(e).Kt({range:i},(e,t,i)=>{const o=hl.fromSegments(e);for(;s&&hl.comparator(s,o)<0;)n(s,null),s=r.getNext();s&&s.isEqual(o)&&(n(s,t),s=r.hasNext()?r.getNext():null),s?i.Mt(s.path.toArray()):i.done()}).next(()=>{for(;s;)n(s,null),s=r.hasNext()?r.getNext():null})}getDocumentsMatchingQuery(e,t,n){let i=nu();const r=t.path.length+1,s={};if(n.isEqual(Ha.min())){const e=t.path.toArray();s.range=IDBKeyRange.lowerBound(e)}else{const e=t.path.toArray(),i=Ld(n);s.range=IDBKeyRange.lowerBound([e,i],!0),s.index=ud.collectionReadTimeIndex}return Eh(e).Kt(s,(e,n,s)=>{if(e.length!==r)return;const o=Pd(this.N,n);t.path.isPrefixOf(o.key.path)?uc(t,o)&&(i=i.insert(o.key,o)):s.done()}).next(()=>i)}newChangeBuffer(e){return new Ih(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return Sh(e).get(dd.key).next(e=>(Ea(!!e),e))}Ae(e,t){return Sh(e).put(dd.key,t)}Re(e,t){if(t){const e=Pd(this.N,t);if(!e.isNoDocument()||!e.version.isEqual(Ha.min()))return e}return ql.newInvalidDocument(e)}}class Ih extends Zh{constructor(e,t){super(),this.Se=e,this.trackRemovals=t,this.De=new bh(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){const t=[];let n=0,i=new Xc((e,t)=>Ya(e.canonicalString(),t.canonicalString()));return this.changes.forEach((r,s)=>{const o=this.De.get(r);if(s.document.isValidDocument()){const a=Fd(this.Se.N,s.document,this.getReadTime(r));i=i.add(r.path.popLast());const l=rh(a);n+=l-o,t.push(this.Se.addEntry(e,r,a))}else if(n-=o,this.trackRemovals){const n=Fd(this.Se.N,ql.newNoDocument(r,Ha.min()),this.getReadTime(r));t.push(this.Se.addEntry(e,r,n))}else t.push(this.Se.removeEntry(e,r))}),i.forEach(n=>{t.push(this.Se.Ht.addToCollectionParentIndex(e,n))}),t.push(this.Se.updateMetadata(e,n)),wd.waitFor(t)}getFromCache(e,t){return this.Se.Pe(e,t).next(e=>(this.De.set(t,e.size),e.document))}getAllFromCache(e,t){return this.Se.ve(e,t).next(({documents:e,Ve:t})=>(t.forEach((e,t)=>{this.De.set(e,t)}),e))}}function Sh(e){return Rd(e,dd.store)}function Eh(e){return Rd(e,ud.store)}function qh(e){return e.path.toArray()}class Nh{constructor(e){this.N=e}Ct(e,t,n,i){Ea(n<i&&n>=0&&i<=11);const r=new bd("createOrUpgrade",t);n<1&&i>=1&&(function(e){e.createObjectStore(rd.store)}(e),function(e){e.createObjectStore(sd.store,{keyPath:sd.keyPath}),e.createObjectStore(od.store,{keyPath:od.keyPath,autoIncrement:!0}).createIndex(od.userMutationsIndex,od.userMutationsKeyPath,{unique:!0}),e.createObjectStore(ad.store)}(e),Ch(e),function(e){e.createObjectStore(ud.store)}(e));let s=wd.resolve();return n<3&&i>=3&&(0!==n&&(function(e){e.deleteObjectStore(pd.store),e.deleteObjectStore(hd.store),e.deleteObjectStore(md.store)}(e),Ch(e)),s=s.next(()=>function(e){const t=e.store(md.store),n=new md(0,0,Ha.min().toTimestamp(),0);return t.put(md.key,n)}(r))),n<4&&i>=4&&(0!==n&&(s=s.next(()=>function(e,t){return t.store(od.store).Lt().next(n=>{e.deleteObjectStore(od.store),e.createObjectStore(od.store,{keyPath:od.keyPath,autoIncrement:!0}).createIndex(od.userMutationsIndex,od.userMutationsKeyPath,{unique:!0});const i=t.store(od.store),r=n.map(e=>i.put(e));return wd.waitFor(r)})}(e,r))),s=s.next(()=>{!function(e){e.createObjectStore(gd.store,{keyPath:gd.keyPath})}(e)})),n<5&&i>=5&&(s=s.next(()=>this.Ce(r))),n<6&&i>=6&&(s=s.next(()=>(function(e){e.createObjectStore(dd.store)}(e),this.Ne(r)))),n<7&&i>=7&&(s=s.next(()=>this.xe(r))),n<8&&i>=8&&(s=s.next(()=>this.ke(e,r))),n<9&&i>=9&&(s=s.next(()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e),function(e){const t=e.objectStore(ud.store);t.createIndex(ud.readTimeIndex,ud.readTimeIndexPath,{unique:!1}),t.createIndex(ud.collectionReadTimeIndex,ud.collectionReadTimeIndexPath,{unique:!1})}(t)})),n<10&&i>=10&&(s=s.next(()=>this.$e(r))),n<11&&i>=11&&(s=s.next(()=>{!function(e){e.createObjectStore(vd.store,{keyPath:vd.keyPath})}(e),function(e){e.createObjectStore(yd.store,{keyPath:yd.keyPath})}(e)})),s}Ne(e){let t=0;return e.store(ud.store).Kt((e,n)=>{t+=rh(n)}).next(()=>{const n=new dd(t);return e.store(dd.store).put(dd.key,n)})}Ce(e){const t=e.store(sd.store),n=e.store(od.store);return t.Lt().next(t=>wd.forEach(t,t=>{const i=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.Lt(od.userMutationsIndex,i).next(n=>wd.forEach(n,n=>{Ea(n.userId===t.userId);const i=Vd(this.N,n);return ih(e,t.userId,i).next(()=>{})}))}))}xe(e){const t=e.store(pd.store),n=e.store(ud.store);return e.store(md.store).get(md.key).next(e=>{const i=[];return n.Kt((n,r)=>{const s=new Wa(n),o=function(e){return[0,Xu(e)]}(s);i.push(t.get(o).next(n=>n?wd.resolve():(n=>t.put(new pd(0,Xu(n),e.highestListenSequenceNumber)))(s)))}).next(()=>wd.waitFor(i))})}ke(e,t){e.createObjectStore(fd.store,{keyPath:fd.keyPath});const n=t.store(fd.store),i=new Kd,r=e=>{if(i.add(e)){const t=e.lastSegment(),i=e.popLast();return n.put({collectionId:t,parent:Xu(i)})}};return t.store(ud.store).Kt({qt:!0},(e,t)=>{const n=new Wa(e);return r(n.popLast())}).next(()=>t.store(ad.store).Kt({qt:!0},([e,t,n],i)=>{const s=nd(t);return r(s.popLast())}))}$e(e){const t=e.store(hd.store);return t.Kt((e,n)=>{const i=jd(n),r=Hd(this.N,i);return t.put(r)})}}function Ch(e){e.createObjectStore(pd.store,{keyPath:pd.keyPath}).createIndex(pd.documentTargetsIndex,pd.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(hd.store,{keyPath:hd.keyPath}).createIndex(hd.queryTargetsIndexName,hd.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(md.store)}const Dh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Rh{constructor(e,t,n,i,r,s,o,a,l,c){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Oe=r,this.window=s,this.document=o,this.Fe=l,this.Me=c,this.Le=null,this.Be=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ue=null,this.inForeground=!1,this.qe=null,this.Ke=null,this.je=Number.NEGATIVE_INFINITY,this.Qe=e=>Promise.resolve(),!Rh.Pt())throw new Ca(Na.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new xh(this,i),this.We=t+"main",this.N=new Ud(a),this.Ge=new Zd(this.We,11,new Nh(this.N)),this.ze=new dh(this.referenceDelegate,this.N),this.Ht=new Xd,this.He=function(e,t){return new Ah(e,t)}(this.N,this.Ht),this.Je=new Bd,this.window&&this.window.localStorage?this.Ye=this.window.localStorage:(this.Ye=null,!1===c&&Za("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Xe().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Ca(Na.FAILED_PRECONDITION,Dh);return this.Ze(),this.tn(),this.en(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.ze.getHighestSequenceNumber(e))}).then(e=>{this.Le=new Fa(e,this.Fe)}).then(()=>{this.Be=!0}).catch(e=>(this.Ge&&this.Ge.close(),Promise.reject(e)))}nn(e){var t=this;return this.Qe=function(){var n=(0,s.Z)(function*(n){if(t.started)return e(n)});return function(e){return n.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ge.xt(function(){var t=(0,s.Z)(function*(t){null===t.newVersion&&(yield e())});return function(e){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Oe.enqueueAndForget((0,s.Z)(function*(){t.started&&(yield t.Xe())})))}Xe(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>kh(e).put(new gd(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.sn(e).next(e=>{e||(this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)))})}).next(()=>this.rn(e)).next(t=>this.isPrimary&&!t?this.on(e).next(()=>!1):!!t&&this.an(e).next(()=>!0))).catch(e=>{if(Sd(e))return ba("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ba("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Oe.enqueueRetryable(()=>this.Qe(e)),this.isPrimary=e})}sn(e){return Oh(e).get(rd.key).next(e=>wd.resolve(this.cn(e)))}un(e){return kh(e).delete(this.clientId)}hn(){var e=this;return(0,s.Z)(function*(){if(e.isPrimary&&!e.ln(e.je,18e5)){e.je=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const n=Rd(t,gd.store);return n.Lt().next(t=>{const i=e.fn(t,18e5),r=t.filter(e=>-1===i.indexOf(e));return wd.forEach(r,e=>n.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(e.Ye)for(const n of t)e.Ye.removeItem(e.dn(n.clientId))}})()}en(){this.Ke=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Xe().then(()=>this.hn()).then(()=>this.en()))}cn(e){return!!e&&e.ownerId===this.clientId}rn(e){return this.Me?wd.resolve(!0):Oh(e).get(rd.key).next(t=>{if(null!==t&&this.ln(t.leaseTimestampMs,5e3)&&!this.wn(t.ownerId)){if(this.cn(t)&&this.networkEnabled)return!0;if(!this.cn(t)){if(!t.allowTabSynchronization)throw new Ca(Na.FAILED_PRECONDITION,Dh);return!1}}return!(!this.networkEnabled||!this.inForeground)||kh(e).Lt().next(e=>void 0===this.fn(e,5e3).find(e=>{if(this.clientId!==e.clientId){const t=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(!this.networkEnabled&&e.networkEnabled||t&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&ba("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){var e=this;return(0,s.Z)(function*(){e.Be=!1,e._n(),e.Ke&&(e.Ke.cancel(),e.Ke=null),e.mn(),e.gn(),yield e.Ge.runTransaction("shutdown","readwrite",[rd.store,gd.store],t=>{const n=new Dd(t,Fa.T);return e.on(n).next(()=>e.un(n))}),e.Ge.close(),e.yn()})()}fn(e,t){return e.filter(e=>this.ln(e.updateTimeMs,t)&&!this.wn(e.clientId))}pn(){return this.runTransaction("getActiveClients","readonly",e=>kh(e).Lt().next(e=>this.fn(e,18e5).map(e=>e.clientId)))}get started(){return this.Be}getMutationQueue(e){return sh.Yt(e,this.N,this.Ht,this.referenceDelegate)}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getIndexManager(){return this.Ht}getBundleCache(){return this.Je}runTransaction(e,t,n){let i;return ba("IndexedDbPersistence","Starting transaction:",e),this.Ge.runTransaction(e,"readonly"===t?"readonly":"readwrite",_d,r=>(i=new Dd(r,this.Le?this.Le.next():Fa.T),"readwrite-primary"===t?this.sn(i).next(e=>!!e||this.rn(i)).next(t=>{if(!t)throw Za(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)),new Ca(Na.FAILED_PRECONDITION,Td);return n(i)}).next(e=>this.an(i).next(()=>e)):this.En(i).next(()=>n(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}En(e){return Oh(e).get(rd.key).next(e=>{if(null!==e&&this.ln(e.leaseTimestampMs,5e3)&&!this.wn(e.ownerId)&&!this.cn(e)&&!(this.Me||this.allowTabSynchronization&&e.allowTabSynchronization))throw new Ca(Na.FAILED_PRECONDITION,Dh)})}an(e){const t=new rd(this.clientId,this.allowTabSynchronization,Date.now());return Oh(e).put(rd.key,t)}static Pt(){return Zd.Pt()}on(e){const t=Oh(e);return t.get(rd.key).next(e=>this.cn(e)?(ba("IndexedDbPersistence","Releasing primary lease."),t.delete(rd.key)):wd.resolve())}ln(e,t){const n=Date.now();return!(e<n-t||e>n&&(Za(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ze(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=()=>{this.Oe.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Xe()))},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)}mn(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)}tn(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Ue=()=>{this._n(),(0,ui.G6)()&&navigator.appVersion.match("Version/14")&&this.Oe.enterRestrictedMode(!0),this.Oe.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ue))}gn(){this.Ue&&(this.window.removeEventListener("pagehide",this.Ue),this.Ue=null)}wn(e){var t;try{const n=null!==(null===(t=this.Ye)||void 0===t?void 0:t.getItem(this.dn(e)));return ba("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Za("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}_n(){if(this.Ye)try{this.Ye.setItem(this.dn(this.clientId),String(Date.now()))}catch(e){Za("Failed to set zombie client id.",e)}}yn(){if(this.Ye)try{this.Ye.removeItem(this.dn(this.clientId))}catch(e){}}dn(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Oh(e){return Rd(e,rd.store)}function kh(e){return Rd(e,gd.store)}function Mh(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Uh{constructor(e,t){this.progress=e,this.Tn=t}}class Ph{constructor(e,t,n){this.He=e,this.In=t,this.Ht=n}An(e,t){return this.In.getAllMutationBatchesAffectingDocumentKey(e,t).next(n=>this.Rn(e,t,n))}Rn(e,t,n){return this.He.getEntry(e,t).next(e=>{for(const t of n)t.applyToLocalView(e);return e})}Pn(e,t){e.forEach((e,n)=>{for(const i of t)i.applyToLocalView(n)})}bn(e,t){return this.He.getEntries(e,t).next(t=>this.vn(e,t).next(()=>t))}vn(e,t){return this.In.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>this.Pn(t,e))}getDocumentsMatchingQuery(e,t,n){return function(e){return hl.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.Vn(e,t.path):ic(t)?this.Sn(e,t,n):this.Dn(e,t,n)}Vn(e,t){return this.An(e,new hl(t)).next(e=>{let t=ru();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}Sn(e,t,n){const i=t.collectionGroup;let r=ru();return this.Ht.getCollectionParents(e,i).next(s=>wd.forEach(s,s=>{const o=function(e,t){return new Gl(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(i));return this.Dn(e,o,n).next(e=>{e.forEach((e,t)=>{r=r.insert(e,t)})})}).next(()=>r))}Dn(e,t,n){let i,r;return this.He.getDocumentsMatchingQuery(e,t,n).next(n=>(i=n,this.In.getAllMutationBatchesAffectingQuery(e,t))).next(t=>(r=t,this.Cn(e,r,i).next(e=>{i=e;for(const t of r)for(const e of t.mutations){const n=e.key;let r=i.get(n);null==r&&(r=ql.newInvalidDocument(n),i=i.insert(n,r)),Oc(e,r,t.localWriteTime),r.isFoundDocument()||(i=i.remove(n))}}))).next(()=>(i.forEach((e,n)=>{uc(t,n)||(i=i.remove(e))}),i))}Cn(e,t,n){let i=lu();for(const s of t)for(const e of s.mutations)e instanceof Fc&&null===n.get(e.key)&&(i=i.add(e.key));let r=n;return this.He.getEntries(e,i).next(e=>(e.forEach((e,t)=>{t.isFoundDocument()&&(r=r.insert(e,t))}),r))}}class Fh{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Nn=n,this.xn=i}static kn(e,t){let n=lu(),i=lu();for(const r of t.docChanges)switch(r.type){case 0:n=n.add(r.doc.key);break;case 1:i=i.add(r.doc.key)}return new Fh(e,t.fromCache,n,i)}}class Lh{$n(e){this.On=e}getDocumentsMatchingQuery(e,t,n,i){return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||n.isEqual(Ha.min())?this.Fn(e,t):this.On.bn(e,i).next(r=>{const s=this.Mn(t,r);return(Xl(t)||ec(t))&&this.Ln(t.limitType,s,i,n)?this.Fn(e,t):(wa()<=ci.in.DEBUG&&ba("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),cc(t)),this.On.getDocumentsMatchingQuery(e,t,n).next(e=>(s.forEach(t=>{e=e.insert(t.key,t)}),e)))})}Mn(e,t){let n=new Xc(dc(e));return t.forEach((t,i)=>{uc(e,i)&&(n=n.add(i))}),n}Ln(e,t,n,i){if(n.size!==t.size)return!0;const r="F"===e?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Fn(e,t){return wa()<=ci.in.DEBUG&&ba("QueryEngine","Using full collection scan to execute query:",cc(t)),this.On.getDocumentsMatchingQuery(e,t,Ha.min())}}class Jh{constructor(e,t,n,i){this.persistence=e,this.Bn=t,this.N=i,this.Un=new Gc(Ya),this.qn=new bh(e=>Dl(e),Rl),this.Kn=Ha.min(),this.In=e.getMutationQueue(n),this.jn=e.getRemoteDocumentCache(),this.ze=e.getTargetCache(),this.Qn=new Ph(this.jn,this.In,this.persistence.getIndexManager()),this.Je=e.getBundleCache(),this.Bn.$n(this.Qn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Un))}}function Yh(e,t,n,i){return new Jh(e,t,n,i)}function Qh(e,t){return Vh.apply(this,arguments)}function Vh(){return(Vh=(0,s.Z)(function*(e,t){const n=qa(e);let i=n.In,r=n.Qn;const s=yield n.persistence.runTransaction("Handle user change","readonly",e=>{let s;return n.In.getAllMutationBatches(e).next(o=>(s=o,i=n.persistence.getMutationQueue(t),r=new Ph(n.jn,i,n.persistence.getIndexManager()),i.getAllMutationBatches(e))).next(t=>{const n=[],i=[];let o=lu();for(const e of s){n.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return r.bn(e,o).next(e=>({Wn:e,removedBatchIds:n,addedBatchIds:i}))})});return n.In=i,n.Qn=r,n.Bn.$n(n.Qn),s})).apply(this,arguments)}function jh(e,t){const n=qa(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const i=t.batch.keys(),r=n.jn.newChangeBuffer({trackRemovals:!0});return function(e,t,n,i){const r=n.batch,s=r.keys();let o=wd.resolve();return s.forEach(e=>{o=o.next(()=>i.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);Ea(null!==s),t.version.compareTo(s)<0&&(r.applyToRemoteDocument(t,n),t.isValidDocument()&&i.addEntry(t,n.commitVersion))})}),o.next(()=>e.In.removeMutationBatch(t,r))}(n,e,t,r).next(()=>r.apply(e)).next(()=>n.In.performConsistencyCheck(e)).next(()=>n.Qn.bn(e,i))})}function Hh(e){const t=qa(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.ze.getLastRemoteSnapshotVersion(e))}function $h(e,t){const n=qa(e),i=t.snapshotVersion;let r=n.Un;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.jn.newChangeBuffer({trackRemovals:!0});r=n.Un;const o=[];t.targetChanges.forEach((t,s)=>{const a=r.get(s);if(!a)return;o.push(n.ze.removeMatchingKeys(e,t.removedDocuments,s).next(()=>n.ze.addMatchingKeys(e,t.addedDocuments,s)));const l=t.resumeToken;if(l.approximateByteSize()>0){const c=a.withResumeToken(l,i).withSequenceNumber(e.currentSequenceNumber);r=r.insert(s,c),function(e,t,n){return Ea(t.resumeToken.approximateByteSize()>0),0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,t)&&o.push(n.ze.updateTargetData(e,c))}});let a=nu();if(t.documentUpdates.forEach((i,r)=>{t.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))}),o.push(Bh(e,s,t.documentUpdates,i,void 0).next(e=>{a=e})),!i.isEqual(Ha.min())){const t=n.ze.getLastRemoteSnapshotVersion(e).next(t=>n.ze.setTargetsMetadata(e,e.currentSequenceNumber,i));o.push(t)}return wd.waitFor(o).next(()=>s.apply(e)).next(()=>n.Qn.vn(e,a)).next(()=>a)}).then(e=>(n.Un=r,e))}function Bh(e,t,n,i,r){let s=lu();return n.forEach(e=>s=s.add(e)),t.getEntries(e,s).next(e=>{let s=nu();return n.forEach((n,o)=>{const a=e.get(n),l=(null==r?void 0:r.get(n))||i;o.isNoDocument()&&o.version.isEqual(Ha.min())?(t.removeEntry(n,l),s=s.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(o,l),s=s.insert(n,o)):ba("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)}),s})}function zh(e,t){const n=qa(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.In.getNextMutationBatchAfterBatchId(e,t)))}function Gh(e,t){const n=qa(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let i;return n.ze.getTargetData(e,t).next(r=>r?(i=r,wd.resolve(i)):n.ze.allocateTargetId(e).next(r=>(i=new Md(t,r,0,e.currentSequenceNumber),n.ze.addTargetData(e,i).next(()=>i))))}).then(e=>{const i=n.Un.get(e.targetId);return(null===i||e.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Un=n.Un.insert(e.targetId,e),n.qn.set(t,e.targetId)),e})}function Wh(e,t,n){return Kh.apply(this,arguments)}function Kh(){return(Kh=(0,s.Z)(function*(e,t,n){const i=qa(e),r=i.Un.get(t),s=n?"readwrite":"readwrite-primary";try{n||(yield i.persistence.runTransaction("Release target",s,e=>i.persistence.referenceDelegate.removeTarget(e,r)))}catch(e){if(!Sd(e))throw e;ba("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}i.Un=i.Un.remove(t),i.qn.delete(r.target)})).apply(this,arguments)}function Xh(e,t,n){const i=qa(e);let r=Ha.min(),s=lu();return i.persistence.runTransaction("Execute query","readonly",e=>function(e,t,n){const i=qa(e),r=i.qn.get(n);return void 0!==r?wd.resolve(i.Un.get(r)):i.ze.getTargetData(t,n)}(i,e,sc(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,i.ze.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>i.Bn.getDocumentsMatchingQuery(e,t,n?r:Ha.min(),n?s:lu())).next(e=>({documents:e,Gn:s})))}function ep(e,t){const n=qa(e),i=qa(n.ze),r=n.Un.get(t);return r?Promise.resolve(r.target):n.persistence.runTransaction("Get target data","readonly",e=>i.Et(e,t).next(e=>e?e.target:null))}function tp(e){const t=qa(e);return t.persistence.runTransaction("Get new document changes","readonly",e=>function(e,t,n){const i=qa(e);let r=nu(),s=Ld(n);const o=Eh(t),a=IDBKeyRange.lowerBound(s,!0);return o.Kt({index:ud.readTimeIndex,range:a},(e,t)=>{const n=Pd(i.N,t);r=r.insert(n.key,n),s=t.readTime}).next(()=>({Tn:r,readTime:Jd(s)}))}(t.jn,e,t.Kn)).then(({Tn:e,readTime:n})=>(t.Kn=n,e))}function np(){return(np=(0,s.Z)(function*(e){const t=qa(e);return t.persistence.runTransaction("Synchronize last document change read time","readonly",e=>function(e){const t=Eh(e);let n=Ha.min();return t.Kt({index:ud.readTimeIndex,reverse:!0},(e,t,i)=>{t.readTime&&(n=Jd(t.readTime)),i.done()}).next(()=>n)}(e)).then(e=>{t.Kn=e})})).apply(this,arguments)}function ip(){return(ip=(0,s.Z)(function*(e,t,n,i){const r=qa(e);let s=lu(),o=nu(),a=ou();for(const u of n){const e=t.zn(u.metadata.name);u.document&&(s=s.add(e)),o=o.insert(e,t.Hn(u)),a=a.insert(e,t.Jn(u.metadata.readTime))}const l=r.jn.newChangeBuffer({trackRemovals:!0}),c=yield Gh(r,function(e){return sc(Kl(Wa.fromString(`__bundle__/docs/${e}`)))}(i));return r.persistence.runTransaction("Apply bundle documents","readwrite",e=>Bh(e,l,o,Ha.min(),a).next(t=>(l.apply(e),t)).next(t=>r.ze.removeMatchingKeysForTargetId(e,c.targetId).next(()=>r.ze.addMatchingKeys(e,s,c.targetId)).next(()=>r.Qn.vn(e,t)).next(()=>t)))})).apply(this,arguments)}function rp(e,t){return sp.apply(this,arguments)}function sp(){return(sp=(0,s.Z)(function*(e,t,n=lu()){const i=yield Gh(e,sc($d(t.bundledQuery))),r=qa(e);return r.persistence.runTransaction("Save named query","readwrite",e=>{const s=Iu(t.readTime);if(i.snapshotVersion.compareTo(s)>=0)return r.Je.saveNamedQuery(e,t);const o=i.withResumeToken(tl.EMPTY_BYTE_STRING,s);return r.Un=r.Un.insert(o.targetId,o),r.ze.updateTargetData(e,o).next(()=>r.ze.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>r.ze.addMatchingKeys(e,n,i.targetId)).next(()=>r.Je.saveNamedQuery(e,t))})})).apply(this,arguments)}class op{constructor(e){this.N=e,this.Yn=new Map,this.Xn=new Map}getBundleMetadata(e,t){return wd.resolve(this.Yn.get(t))}saveBundleMetadata(e,t){var n;return this.Yn.set(t.id,{id:(n=t).id,version:n.version,createTime:Iu(n.createTime)}),wd.resolve()}getNamedQuery(e,t){return wd.resolve(this.Xn.get(t))}saveNamedQuery(e,t){return this.Xn.set(t.name,function(e){return{name:e.name,query:$d(e.bundledQuery),readTime:Iu(e.readTime)}}(t)),wd.resolve()}}class ap{constructor(){this.Zn=new Xc(lp.ts),this.es=new Xc(lp.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(e,t){const n=new lp(e,t);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}ss(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.rs(new lp(e,t))}os(e,t){e.forEach(e=>this.removeReference(e,t))}cs(e){const t=new hl(new Wa([])),n=new lp(t,e),i=new lp(t,e+1),r=[];return this.es.forEachInRange([n,i],e=>{this.rs(e),r.push(e.key)}),r}us(){this.Zn.forEach(e=>this.rs(e))}rs(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}hs(e){const t=new hl(new Wa([])),n=new lp(t,e),i=new lp(t,e+1);let r=lu();return this.es.forEachInRange([n,i],e=>{r=r.add(e.key)}),r}containsKey(e){const t=new lp(e,0),n=this.Zn.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class lp{constructor(e,t){this.key=e,this.ls=t}static ts(e,t){return hl.comparator(e.key,t.key)||Ya(e.ls,t.ls)}static ns(e,t){return Ya(e.ls,t.ls)||hl.comparator(e.key,t.key)}}class cp{constructor(e,t){this.Ht=e,this.referenceDelegate=t,this.In=[],this.fs=1,this.ds=new Xc(lp.ts)}checkEmpty(e){return wd.resolve(0===this.In.length)}addMutationBatch(e,t,n,i){const r=this.fs;this.fs++;const s=new Od(r,t,n,i);this.In.push(s);for(const o of i)this.ds=this.ds.add(new lp(o.key,r)),this.Ht.addToCollectionParentIndex(e,o.key.path.popLast());return wd.resolve(s)}lookupMutationBatch(e,t){return wd.resolve(this.ws(t))}getNextMutationBatchAfterBatchId(e,t){const n=this._s(t+1),i=n<0?0:n;return wd.resolve(this.In.length>i?this.In[i]:null)}getHighestUnacknowledgedBatchId(){return wd.resolve(0===this.In.length?-1:this.fs-1)}getAllMutationBatches(e){return wd.resolve(this.In.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new lp(t,0),i=new lp(t,Number.POSITIVE_INFINITY),r=[];return this.ds.forEachInRange([n,i],e=>{const t=this.ws(e.ls);r.push(t)}),wd.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Xc(Ya);return t.forEach(e=>{const t=new lp(e,0),i=new lp(e,Number.POSITIVE_INFINITY);this.ds.forEachInRange([t,i],e=>{n=n.add(e.ls)})}),wd.resolve(this.gs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let r=n;hl.isDocumentKey(r)||(r=r.child(""));const s=new lp(new hl(r),0);let o=new Xc(Ya);return this.ds.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(o=o.add(e.ls)),!0)},s),wd.resolve(this.gs(o))}gs(e){const t=[];return e.forEach(e=>{const n=this.ws(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){Ea(0===this.ys(t.batchId,"removed")),this.In.shift();let n=this.ds;return wd.forEach(t.mutations,i=>{const r=new lp(i.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.ds=n})}te(e){}containsKey(e,t){const n=new lp(t,0),i=this.ds.firstAfterOrEqual(n);return wd.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return wd.resolve()}ys(e,t){return this._s(e)}_s(e){return 0===this.In.length?0:e-this.In[0].batchId}ws(e){const t=this._s(e);return t<0||t>=this.In.length?null:this.In[t]}}class up{constructor(e,t){this.Ht=e,this.ps=t,this.docs=new Gc(hl.comparator),this.size=0}addEntry(e,t,n){const i=t.key,r=this.docs.get(i),s=r?r.size:0,o=this.ps(t);return this.docs=this.docs.insert(i,{document:t.clone(),size:o,readTime:n}),this.size+=o-s,this.Ht.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return wd.resolve(n?n.document.clone():ql.newInvalidDocument(t))}getEntries(e,t){let n=nu();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.clone():ql.newInvalidDocument(e))}),wd.resolve(n)}getDocumentsMatchingQuery(e,t,n){let i=nu();const r=new hl(t.path.child("")),s=this.docs.getIteratorFrom(r);for(;s.hasNext();){const{key:e,value:{document:r,readTime:o}}=s.getNext();if(!t.path.isPrefixOf(e.path))break;o.compareTo(n)<=0||uc(t,r)&&(i=i.insert(r.key,r.clone()))}return wd.resolve(i)}Es(e,t){return wd.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new dp(this)}getSize(e){return wd.resolve(this.size)}}class dp extends Zh{constructor(e){super(),this.Se=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.document.isValidDocument()?t.push(this.Se.addEntry(e,i.document,this.getReadTime(n))):this.Se.removeEntry(n)}),wd.waitFor(t)}getFromCache(e,t){return this.Se.getEntry(e,t)}getAllFromCache(e,t){return this.Se.getEntries(e,t)}}class hp{constructor(e){this.persistence=e,this.Ts=new bh(e=>Dl(e),Rl),this.lastRemoteSnapshotVersion=Ha.min(),this.highestTargetId=0,this.Is=0,this.As=new ap,this.targetCount=0,this.Rs=uh.se()}forEachTarget(e,t){return this.Ts.forEach((e,n)=>t(n)),wd.resolve()}getLastRemoteSnapshotVersion(e){return wd.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return wd.resolve(this.Is)}allocateTargetId(e){return this.highestTargetId=this.Rs.next(),wd.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Is&&(this.Is=t),wd.resolve()}ae(e){this.Ts.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Rs=new uh(t),this.highestTargetId=t),e.sequenceNumber>this.Is&&(this.Is=e.sequenceNumber)}addTargetData(e,t){return this.ae(t),this.targetCount+=1,wd.resolve()}updateTargetData(e,t){return this.ae(t),wd.resolve()}removeTargetData(e,t){return this.Ts.delete(t.target),this.As.cs(t.targetId),this.targetCount-=1,wd.resolve()}removeTargets(e,t,n){let i=0;const r=[];return this.Ts.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Ts.delete(s),r.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)}),wd.waitFor(r).next(()=>i)}getTargetCount(e){return wd.resolve(this.targetCount)}getTargetData(e,t){const n=this.Ts.get(t)||null;return wd.resolve(n)}addMatchingKeys(e,t,n){return this.As.ss(t,n),wd.resolve()}removeMatchingKeys(e,t,n){this.As.os(t,n);const i=this.persistence.referenceDelegate,r=[];return i&&t.forEach(t=>{r.push(i.markPotentiallyOrphaned(e,t))}),wd.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.As.cs(t),wd.resolve()}getMatchingKeysForTargetId(e,t){const n=this.As.hs(t);return wd.resolve(n)}containsKey(e,t){return wd.resolve(this.As.containsKey(t))}}class pp{constructor(e,t){this.Ps={},this.Le=new Fa(0),this.Be=!1,this.Be=!0,this.referenceDelegate=e(this),this.ze=new hp(this),this.Ht=new Wd,this.He=function(e,t){return new up(e,t)}(this.Ht,e=>this.referenceDelegate.bs(e)),this.N=new Ud(t),this.Je=new op(this.N)}start(){return Promise.resolve()}shutdown(){return this.Be=!1,Promise.resolve()}get started(){return this.Be}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Ht}getMutationQueue(e){let t=this.Ps[e.toKey()];return t||(t=new cp(this.Ht,this.referenceDelegate),this.Ps[e.toKey()]=t),t}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getBundleCache(){return this.Je}runTransaction(e,t,n){ba("MemoryPersistence","Starting transaction:",e);const i=new mp(this.Le.next());return this.referenceDelegate.vs(),n(i).next(e=>this.referenceDelegate.Vs(i).next(()=>e)).toPromise().then(e=>(i.raiseOnCommittedEvent(),e))}Ss(e,t){return wd.or(Object.values(this.Ps).map(n=>()=>n.containsKey(e,t)))}}class mp extends xd{constructor(e){super(),this.currentSequenceNumber=e}}class fp{constructor(e){this.persistence=e,this.Ds=new ap,this.Cs=null}static Ns(e){return new fp(e)}get xs(){if(this.Cs)return this.Cs;throw Sa()}addReference(e,t,n){return this.Ds.addReference(n,t),this.xs.delete(n.toString()),wd.resolve()}removeReference(e,t,n){return this.Ds.removeReference(n,t),this.xs.add(n.toString()),wd.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),wd.resolve()}removeTarget(e,t){this.Ds.cs(t.targetId).forEach(e=>this.xs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.xs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}vs(){this.Cs=new Set}Vs(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return wd.forEach(this.xs,n=>{const i=hl.fromPath(n);return this.ks(e,i).next(e=>{e||t.removeEntry(i)})}).next(()=>(this.Cs=null,t.apply(e)))}updateLimboDocument(e,t){return this.ks(e,t).next(e=>{e?this.xs.delete(t.toString()):this.xs.add(t.toString())})}bs(e){return 0}ks(e,t){return wd.or([()=>wd.resolve(this.Ds.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ss(e,t)])}}function gp(e,t){return`firestore_clients_${e}_${t}`}function vp(e,t,n){let i=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(i+=`_${t.uid}`),i}function yp(e,t){return`firestore_targets_${e}_${t}`}class _p{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static $s(e,t,n){const i=JSON.parse(n);let r,s="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code,s&&(r=new Ca(i.error.code,i.error.message))),s?new _p(e,t,i.state,r):(Za("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Tp{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static $s(e,t){const n=JSON.parse(t);let i,r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code,r&&(i=new Ca(n.error.code,n.error.message))),r?new Tp(e,n.state,i):(Za("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class xp{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){const n=JSON.parse(t);let i="object"==typeof n&&n.activeTargetIds instanceof Array,r=uu();for(let s=0;i&&s<n.activeTargetIds.length;++s)i=dl(n.activeTargetIds[s]),r=r.add(n.activeTargetIds[s]);return i?new xp(e,r):(Za("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class wp{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new wp(t.clientId,t.onlineState):(Za("SharedClientState",`Failed to parse online state: ${e}`),null)}}class bp{constructor(){this.activeTargetIds=uu()}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ms(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Os(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Zp{constructor(e,t,n,i,r){this.window=e,this.Oe=t,this.persistenceKey=n,this.Ls=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Bs=this.Us.bind(this),this.qs=new Gc(Ya),this.started=!1,this.Ks=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=r,this.js=gp(this.persistenceKey,this.Ls),this.Qs=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.qs=this.qs.insert(this.Ls,new bp),this.Ws=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.Gs=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.zs=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.Hs=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.Js=function(e){return`firestore_bundle_loaded_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.Bs)}static Pt(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,s.Z)(function*(){const t=yield e.syncEngine.pn();for(const i of t){if(i===e.Ls)continue;const t=e.getItem(gp(e.persistenceKey,i));if(t){const n=xp.$s(i,t);n&&(e.qs=e.qs.insert(n.clientId,n))}}e.Ys();const n=e.storage.getItem(e.Hs);if(n){const t=e.Xs(n);t&&e.Zs(t)}for(const i of e.Ks)e.Us(i);e.Ks=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Qs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ti(this.qs)}isActiveQueryTarget(e){let t=!1;return this.qs.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ei(e,"pending")}updateMutationState(e,t,n){this.ei(e,t,n),this.ni(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(yp(this.persistenceKey,e));if(n){const i=Tp.$s(e,n);i&&(t=i.state)}}return this.si.Fs(e),this.Ys(),t}removeLocalQueryTarget(e){this.si.Ms(e),this.Ys()}isLocalQueryTarget(e){return this.si.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(yp(this.persistenceKey,e))}updateQueryState(e,t,n){this.ii(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.ni(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.ri(e)}notifyBundleLoaded(){this.oi()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Bs),this.removeItem(this.js),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ba("SharedClientState","READ",e,t),t}setItem(e,t){ba("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){ba("SharedClientState","REMOVE",e),this.storage.removeItem(e)}Us(e){var t=this;const n=e;if(n.storageArea===this.storage){if(ba("SharedClientState","EVENT",n.key,n.newValue),n.key===this.js)return void Za("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Oe.enqueueRetryable((0,s.Z)(function*(){if(t.started){if(null!==n.key)if(t.Ws.test(n.key)){if(null==n.newValue){const e=t.ai(n.key);return t.ci(e,null)}{const e=t.ui(n.key,n.newValue);if(e)return t.ci(e.clientId,e)}}else if(t.Gs.test(n.key)){if(null!==n.newValue){const e=t.hi(n.key,n.newValue);if(e)return t.li(e)}}else if(t.zs.test(n.key)){if(null!==n.newValue){const e=t.fi(n.key,n.newValue);if(e)return t.di(e)}}else if(n.key===t.Hs){if(null!==n.newValue){const e=t.Xs(n.newValue);if(e)return t.Zs(e)}}else if(n.key===t.Qs){const e=function(e){let t=Fa.T;if(null!=e)try{const n=JSON.parse(e);Ea("number"==typeof n),t=n}catch(e){Za("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(n.newValue);e!==Fa.T&&t.sequenceNumberHandler(e)}else if(n.key===t.Js)return t.syncEngine.wi()}else t.Ks.push(n)}))}}get si(){return this.qs.get(this.Ls)}Ys(){this.setItem(this.js,this.si.Os())}ei(e,t,n){const i=new _p(this.currentUser,e,t,n),r=vp(this.persistenceKey,this.currentUser,e);this.setItem(r,i.Os())}ni(e){const t=vp(this.persistenceKey,this.currentUser,e);this.removeItem(t)}ri(e){this.storage.setItem(this.Hs,JSON.stringify({clientId:this.Ls,onlineState:e}))}ii(e,t,n){const i=yp(this.persistenceKey,e),r=new Tp(e,t,n);this.setItem(i,r.Os())}oi(){this.setItem(this.Js,"value-not-used")}ai(e){const t=this.Ws.exec(e);return t?t[1]:null}ui(e,t){const n=this.ai(e);return xp.$s(n,t)}hi(e,t){const n=this.Gs.exec(e),i=Number(n[1]);return _p.$s(new _a(void 0!==n[2]?n[2]:null),i,t)}fi(e,t){const n=this.zs.exec(e),i=Number(n[1]);return Tp.$s(i,t)}Xs(e){return wp.$s(e)}li(e){var t=this;return(0,s.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine._i(e.batchId,e.state,e.error);ba("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}di(e){return this.syncEngine.mi(e.targetId,e.state,e.error)}ci(e,t){const n=t?this.qs.insert(e,t):this.qs.remove(e),i=this.ti(this.qs),r=this.ti(n),s=[],o=[];return r.forEach(e=>{i.has(e)||s.push(e)}),i.forEach(e=>{r.has(e)||o.push(e)}),this.syncEngine.gi(s,o).then(()=>{this.qs=n})}Zs(e){this.qs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ti(e){let t=uu();return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class Ap{constructor(){this.yi=new bp,this.pi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.yi.Fs(e),this.pi[e]||"not-current"}updateQueryState(e,t,n){this.pi[e]=t}removeLocalQueryTarget(e){this.yi.Ms(e)}isLocalQueryTarget(e){return this.yi.activeTargetIds.has(e)}clearQueryState(e){delete this.pi[e]}getAllActiveQueryTargets(){return this.yi.activeTargetIds}isActiveQueryTarget(e){return this.yi.activeTargetIds.has(e)}start(){return this.yi=new bp,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class Ip{Ei(e){}shutdown(){}}class Sp{constructor(){this.Ti=()=>this.Ii(),this.Ai=()=>this.Ri(),this.Pi=[],this.bi()}Ei(e){this.Pi.push(e)}shutdown(){window.removeEventListener("online",this.Ti),window.removeEventListener("offline",this.Ai)}bi(){window.addEventListener("online",this.Ti),window.addEventListener("offline",this.Ai)}Ii(){ba("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Pi)e(0)}Ri(){ba("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Pi)e(1)}static Pt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Ep={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class qp{constructor(e){this.vi=e.vi,this.Vi=e.Vi}Si(e){this.Di=e}Ci(e){this.Ni=e}onMessage(e){this.xi=e}close(){this.Vi()}send(e){this.vi(e)}ki(){this.Di()}$i(e){this.Ni(e)}Oi(e){this.xi(e)}}class Np extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.Fi=(e.ssl?"https":"http")+"://"+e.host,this.Mi="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Li(e,t,n,i){const r=this.Bi(e,t);ba("RestConnection","Sending: ",r,n);const s={};return this.Ui(s,i),this.qi(e,r,s,n).then(e=>(ba("RestConnection","Received: ",e),e),t=>{throw Aa("RestConnection",`${e} failed with error: `,t,"url: ",r,"request:",n),t})}Ki(e,t,n,i){return this.Li(e,t,n,i)}Ui(e,t){if(e["X-Goog-Api-Client"]="gl-js/ fire/"+Ta,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t)for(const n in t.authHeaders)t.authHeaders.hasOwnProperty(n)&&(e[n]=t.authHeaders[n])}Bi(e,t){return`${this.Fi}/v1/${t}:${Ep[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}qi(e,t,n,i){return new Promise((r,s)=>{const o=new ya;o.listenOnce(ma.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case pa.NO_ERROR:const t=o.getResponseJson();ba("Connection","XHR received:",JSON.stringify(t)),r(t);break;case pa.TIMEOUT:ba("Connection",'RPC "'+e+'" timed out'),s(new Ca(Na.DEADLINE_EXCEEDED,"Request time out"));break;case pa.HTTP_ERROR:const n=o.getStatus();if(ba("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Na).indexOf(t)>=0?t:Na.UNKNOWN}(e.status);s(new Ca(t,e.message))}else s(new Ca(Na.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new Ca(Na.UNAVAILABLE,"Connection failed."));break;default:Sa()}}finally{ba("Connection",'RPC "'+e+'" completed.')}});const a=JSON.stringify(i);o.send(t,"POST",a,n,15)})}ji(e,t){const n=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=new la,r=ts(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(s.xmlHttpFactory=new ga({})),this.Ui(s.initMessageHeaders,t),(0,ui.uI)()||(0,ui.b$)()||(0,ui.d)()||(0,ui.w1)()||(0,ui.Mn)()||(0,ui.ru)()||(s.httpHeadersOverwriteParam="$httpHeaders");const o=n.join("");ba("Connection","Creating WebChannel: "+o,s);const a=i.createWebChannel(o,s);let l=!1,c=!1;const u=new qp({vi:e=>{c?ba("Connection","Not sending because WebChannel is closed:",e):(l||(ba("Connection","Opening WebChannel transport."),a.open(),l=!0),ba("Connection","WebChannel sending:",e),a.send(e))},Vi:()=>a.close()}),d=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return d(a,va.EventType.OPEN,()=>{c||ba("Connection","WebChannel transport opened.")}),d(a,va.EventType.CLOSE,()=>{c||(c=!0,ba("Connection","WebChannel transport closed"),u.$i())}),d(a,va.EventType.ERROR,e=>{c||(c=!0,Aa("Connection","WebChannel transport errored:",e),u.$i(new Ca(Na.UNAVAILABLE,"The operation could not be completed")))}),d(a,va.EventType.MESSAGE,e=>{var t;if(!c){const n=e.data[0];Ea(!!n);const i=n,r=i.error||(null===(t=i[0])||void 0===t?void 0:t.error);if(r){ba("Connection","WebChannel received error:",r);const e=r.status;let t=function(e){const t=Hc[e];if(void 0!==t)return zc(t)}(e),n=r.message;void 0===t&&(t=Na.INTERNAL,n="Unknown error status: "+e+" with message "+r.message),c=!0,u.$i(new Ca(t,n)),a.close()}else ba("Connection","WebChannel received:",n),u.Oi(n)}}),d(r,fa.STAT_EVENT,e=>{10===e.stat?ba("Connection","Detected buffering proxy"):11===e.stat&&ba("Connection","Detected no buffering proxy")}),setTimeout(()=>{u.ki()},0),u}}function Cp(){return"undefined"!=typeof window?window:null}function Dp(){return"undefined"!=typeof document?document:null}function Rp(e){return new wu(e,!0)}class Op{constructor(e,t,n=1e3,i=1.5,r=6e4){this.Oe=e,this.timerId=t,this.Qi=n,this.Wi=i,this.Gi=r,this.zi=0,this.Hi=null,this.Ji=Date.now(),this.reset()}reset(){this.zi=0}Yi(){this.zi=this.Gi}Xi(e){this.cancel();const t=Math.floor(this.zi+this.Zi()),n=Math.max(0,Date.now()-this.Ji),i=Math.max(0,t-n);i>0&&ba("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.zi} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Hi=this.Oe.enqueueAfterDelay(this.timerId,i,()=>(this.Ji=Date.now(),e())),this.zi*=this.Wi,this.zi<this.Qi&&(this.zi=this.Qi),this.zi>this.Gi&&(this.zi=this.Gi)}tr(){null!==this.Hi&&(this.Hi.skipDelay(),this.Hi=null)}cancel(){null!==this.Hi&&(this.Hi.cancel(),this.Hi=null)}Zi(){return(Math.random()-.5)*this.zi}}class kp{constructor(e,t,n,i,r,s){this.Oe=e,this.er=n,this.nr=i,this.credentialsProvider=r,this.listener=s,this.state=0,this.sr=0,this.ir=null,this.stream=null,this.rr=new Op(e,t)}ar(){return 1===this.state||2===this.state||4===this.state}cr(){return 2===this.state}start(){3!==this.state?this.auth():this.ur()}stop(){var e=this;return(0,s.Z)(function*(){e.ar()&&(yield e.close(0))})()}hr(){this.state=0,this.rr.reset()}lr(){this.cr()&&null===this.ir&&(this.ir=this.Oe.enqueueAfterDelay(this.er,6e4,()=>this.dr()))}wr(e){this._r(),this.stream.send(e)}dr(){var e=this;return(0,s.Z)(function*(){if(e.cr())return e.close(0)})()}_r(){this.ir&&(this.ir.cancel(),this.ir=null)}close(e,t){var n=this;return(0,s.Z)(function*(){n._r(),n.rr.cancel(),n.sr++,3!==e?n.rr.reset():t&&t.code===Na.RESOURCE_EXHAUSTED?(Za(t.toString()),Za("Using maximum backoff delay to prevent overloading the backend."),n.rr.Yi()):t&&t.code===Na.UNAUTHENTICATED&&n.credentialsProvider.invalidateToken(),null!==n.stream&&(n.mr(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.Ci(t)})()}mr(){}auth(){this.state=1;const e=this.gr(this.sr),t=this.sr;this.credentialsProvider.getToken().then(e=>{this.sr===t&&this.yr(e)},t=>{e(()=>{const e=new Ca(Na.UNKNOWN,"Fetching auth token failed: "+t.message);return this.pr(e)})})}yr(e){const t=this.gr(this.sr);this.stream=this.Er(e),this.stream.Si(()=>{t(()=>(this.state=2,this.listener.Si()))}),this.stream.Ci(e=>{t(()=>this.pr(e))}),this.stream.onMessage(e=>{t(()=>this.onMessage(e))})}ur(){var e=this;this.state=4,this.rr.Xi((0,s.Z)(function*(){e.state=0,e.start()}))}pr(e){return ba("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(3,e)}gr(e){return t=>{this.Oe.enqueueAndForget(()=>this.sr===e?t():(ba("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Mp extends kp{constructor(e,t,n,i,r){super(e,"listen_stream_connection_backoff","listen_stream_idle",t,n,r),this.N=i}Er(e){return this.nr.ji("Listen",e)}onMessage(e){this.rr.reset();const t=function(e,t){let n;if("targetChange"in t){const i=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Sa()}(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],s=function(e,t){return e.D?(Ea(void 0===t||"string"==typeof t),tl.fromBase64String(t||"")):(Ea(void 0===t||t instanceof Uint8Array),tl.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Na.UNKNOWN:zc(e.code);return new Ca(t,e.message||"")}(o);n=new fu(i,r,s,a||null)}else if("documentChange"in t){const i=t.documentChange,r=Nu(e,i.document.name),s=Iu(i.document.updateTime),o=new Sl({mapValue:{fields:i.document.fields}}),a=ql.newFoundDocument(r,s,o);n=new pu(i.targetIds||[],i.removedTargetIds||[],a.key,a)}else if("documentDelete"in t){const i=t.documentDelete,r=Nu(e,i.document),s=i.readTime?Iu(i.readTime):Ha.min(),o=ql.newNoDocument(r,s);n=new pu([],i.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){const i=t.documentRemove,r=Nu(e,i.document);n=new pu([],i.removedTargetIds||[],r,null)}else{if(!("filter"in t))return Sa();{const e=t.filter,i=new jc(e.count||0);n=new mu(e.targetId,i)}}return n}(this.N,e),n=function(e){if(!("targetChange"in e))return Ha.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Ha.min():t.readTime?Iu(t.readTime):Ha.min()}(e);return this.listener.Tr(t,n)}Ir(e){const t={};t.database=Ru(this.N),t.addTarget=function(e,t){let n;const i=t.target;return n=Ol(i)?{documents:Fu(e,i)}:{query:Lu(e,i)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=Zu(e,t.resumeToken):t.snapshotVersion.compareTo(Ha.min())>0&&(n.readTime=bu(e,t.snapshotVersion.toTimestamp())),n}(this.N,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Sa()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(0,e);n&&(t.labels=n),this.wr(t)}Ar(e){const t={};t.database=Ru(this.N),t.removeTarget=e,this.wr(t)}}class Up extends kp{constructor(e,t,n,i,r){super(e,"write_stream_connection_backoff","write_stream_idle",t,n,r),this.N=i,this.Rr=!1}get Pr(){return this.Rr}start(){this.Rr=!1,this.lastStreamToken=void 0,super.start()}mr(){this.Rr&&this.br([])}Er(e){return this.nr.ji("Write",e)}onMessage(e){if(Ea(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Rr){this.rr.reset();const t=function(e,t){return e&&e.length>0?(Ea(void 0!==t),e.map(e=>function(e,t){let n=Iu(e.updateTime?e.updateTime:t);return n.isEqual(Ha.min())&&(n=Iu(t)),new qc(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=Iu(e.commitTime);return this.listener.vr(n,t)}return Ea(!e.writeResults||0===e.writeResults.length),this.Rr=!0,this.listener.Vr()}Sr(){const e={};e.database=Ru(this.N),this.wr(e)}br(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>Uu(this.N,e))};this.wr(t)}}class Pp extends class{}{constructor(e,t,n){super(),this.credentials=e,this.nr=t,this.N=n,this.Dr=!1}Cr(){if(this.Dr)throw new Ca(Na.FAILED_PRECONDITION,"The client has already been terminated.")}Li(e,t,n){return this.Cr(),this.credentials.getToken().then(i=>this.nr.Li(e,t,n,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Na.UNAUTHENTICATED&&this.credentials.invalidateToken(),e):new Ca(Na.UNKNOWN,e.toString())})}Ki(e,t,n){return this.Cr(),this.credentials.getToken().then(i=>this.nr.Ki(e,t,n,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Na.UNAUTHENTICATED&&this.credentials.invalidateToken(),e):new Ca(Na.UNKNOWN,e.toString())})}terminate(){this.Dr=!0}}class Fp{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Nr=0,this.kr=null,this.$r=!0}Or(){0===this.Nr&&(this.Fr("Unknown"),this.kr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.kr=null,this.Mr("Backend didn't respond within 10 seconds."),this.Fr("Offline"),Promise.resolve())))}Lr(e){"Online"===this.state?this.Fr("Unknown"):(this.Nr++,this.Nr>=1&&(this.Br(),this.Mr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Fr("Offline")))}set(e){this.Br(),this.Nr=0,"Online"===e&&(this.$r=!1),this.Fr(e)}Fr(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}Mr(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.$r?(Za(t),this.$r=!1):ba("OnlineStateTracker",t)}Br(){null!==this.kr&&(this.kr.cancel(),this.kr=null)}}class Lp{constructor(e,t,n,i,r){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ur=[],this.qr=new Map,this.Kr=new Set,this.jr=[],this.Qr=r,this.Qr.Ei(e=>{n.enqueueAndForget((0,s.Z)(function*(){var e;Wp(o)&&(ba("RemoteStore","Restarting streams for network reachability change."),yield(e=(0,s.Z)(function*(e){const t=qa(e);t.Kr.add(4),yield Qp(t),t.Wr.set("Unknown"),t.Kr.delete(4),yield Jp(t)}),function(t){return e.apply(this,arguments)})(o))}))}),this.Wr=new Fp(n,i)}}function Jp(e){return Yp.apply(this,arguments)}function Yp(){return(Yp=(0,s.Z)(function*(e){if(Wp(e))for(const t of e.jr)yield t(!0)})).apply(this,arguments)}function Qp(e){return Vp.apply(this,arguments)}function Vp(){return(Vp=(0,s.Z)(function*(e){for(const t of e.jr)yield t(!1)})).apply(this,arguments)}function jp(e,t){const n=qa(e);n.qr.has(t.targetId)||(n.qr.set(t.targetId,t),Gp(n)?zp(n):Zm(n).cr()&&$p(n,t))}function Hp(e,t){const n=qa(e),i=Zm(n);n.qr.delete(t),i.cr()&&Bp(n,t),0===n.qr.size&&(i.cr()?i.lr():Wp(n)&&n.Wr.set("Unknown"))}function $p(e,t){e.Gr.Y(t.targetId),Zm(e).Ir(t)}function Bp(e,t){e.Gr.Y(t),Zm(e).Ar(t)}function zp(e){e.Gr=new vu({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.qr.get(t)||null}),Zm(e).start(),e.Wr.Or()}function Gp(e){return Wp(e)&&!Zm(e).ar()&&e.qr.size>0}function Wp(e){return 0===qa(e).Kr.size}function Kp(e){e.Gr=void 0}function Xp(e){return em.apply(this,arguments)}function em(){return(em=(0,s.Z)(function*(e){e.qr.forEach((t,n)=>{$p(e,t)})})).apply(this,arguments)}function tm(e,t){return nm.apply(this,arguments)}function nm(){return(nm=(0,s.Z)(function*(e,t){Kp(e),Gp(e)?(e.Wr.Lr(t),zp(e)):e.Wr.set("Unknown")})).apply(this,arguments)}function im(e,t,n){return rm.apply(this,arguments)}function rm(){return(rm=(0,s.Z)(function*(e,t,n){if(e.Wr.set("Online"),t instanceof fu&&2===t.state&&t.cause)try{yield(i=(0,s.Z)(function*(e,t){const n=t.cause;for(const i of t.targetIds)e.qr.has(i)&&(yield e.remoteSyncer.rejectListen(i,n),e.qr.delete(i),e.Gr.removeTarget(i))}),function(e,t){return i.apply(this,arguments)})(e,t)}catch(n){ba("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield sm(e,n)}else if(t instanceof pu?e.Gr.rt(t):t instanceof mu?e.Gr.ft(t):e.Gr.ct(t),!n.isEqual(Ha.min()))try{const t=yield Hh(e.localStore);n.compareTo(t)>=0&&(yield function(e,t){const n=e.Gr._t(t);return n.targetChanges.forEach((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const r=e.qr.get(i);r&&e.qr.set(i,r.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(t=>{const n=e.qr.get(t);if(!n)return;e.qr.set(t,n.withResumeToken(tl.EMPTY_BYTE_STRING,n.snapshotVersion)),Bp(e,t);const i=new Md(n.target,t,1,n.sequenceNumber);$p(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n))}catch(t){ba("RemoteStore","Failed to raise snapshot:",t),yield sm(e,t)}var i})).apply(this,arguments)}function sm(e,t,n){return om.apply(this,arguments)}function om(){return(om=(0,s.Z)(function*(e,t,n){if(!Sd(t))throw t;e.Kr.add(1),yield Qp(e),e.Wr.set("Offline"),n||(n=()=>Hh(e.localStore)),e.asyncQueue.enqueueRetryable((0,s.Z)(function*(){ba("RemoteStore","Retrying IndexedDB access"),yield n(),e.Kr.delete(1),yield Jp(e)}))})).apply(this,arguments)}function am(e,t){return t().catch(n=>sm(e,n,t))}function lm(e){return cm.apply(this,arguments)}function cm(){return(cm=(0,s.Z)(function*(e){const t=qa(e),n=Am(t);let i=t.Ur.length>0?t.Ur[t.Ur.length-1].batchId:-1;for(;um(t);)try{const e=yield zh(t.localStore,i);if(null===e){0===t.Ur.length&&n.lr();break}i=e.batchId,dm(t,e)}catch(e){yield sm(t,e)}hm(t)&&pm(t)})).apply(this,arguments)}function um(e){return Wp(e)&&e.Ur.length<10}function dm(e,t){e.Ur.push(t);const n=Am(e);n.cr()&&n.Pr&&n.br(t.mutations)}function hm(e){return Wp(e)&&!Am(e).ar()&&e.Ur.length>0}function pm(e){Am(e).start()}function mm(e){return fm.apply(this,arguments)}function fm(){return(fm=(0,s.Z)(function*(e){Am(e).Sr()})).apply(this,arguments)}function gm(e){return vm.apply(this,arguments)}function vm(){return(vm=(0,s.Z)(function*(e){const t=Am(e);for(const n of e.Ur)t.br(n.mutations)})).apply(this,arguments)}function ym(e,t,n){return _m.apply(this,arguments)}function _m(){return(_m=(0,s.Z)(function*(e,t,n){const i=e.Ur.shift(),r=kd.from(i,t,n);yield am(e,()=>e.remoteSyncer.applySuccessfulWrite(r)),yield lm(e)})).apply(this,arguments)}function Tm(e,t){return xm.apply(this,arguments)}function xm(){return(xm=(0,s.Z)(function*(e,t){var n;t&&Am(e).Pr&&(yield(n=(0,s.Z)(function*(e,t){if(Bc(n=t.code)&&n!==Na.ABORTED){const n=e.Ur.shift();Am(e).hr(),yield am(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),yield lm(e)}var n}),function(e,t){return n.apply(this,arguments)})(e,t)),hm(e)&&pm(e)})).apply(this,arguments)}function wm(e,t){return bm.apply(this,arguments)}function bm(){return(bm=(0,s.Z)(function*(e,t){const n=qa(e);t?(n.Kr.delete(2),yield Jp(n)):t||(n.Kr.add(2),yield Qp(n),n.Wr.set("Unknown"))})).apply(this,arguments)}function Zm(e){return e.zr||(e.zr=function(e,t,n){const i=qa(e);return i.Cr(),new Mp(t,i.nr,i.credentials,i.N,n)}(e.datastore,e.asyncQueue,{Si:Xp.bind(null,e),Ci:tm.bind(null,e),Tr:im.bind(null,e)}),e.jr.push(function(){var t=(0,s.Z)(function*(t){t?(e.zr.hr(),Gp(e)?zp(e):e.Wr.set("Unknown")):(yield e.zr.stop(),Kp(e))});return function(e){return t.apply(this,arguments)}}())),e.zr}function Am(e){return e.Hr||(e.Hr=function(e,t,n){const i=qa(e);return i.Cr(),new Up(t,i.nr,i.credentials,i.N,n)}(e.datastore,e.asyncQueue,{Si:mm.bind(null,e),Ci:Tm.bind(null,e),Vr:gm.bind(null,e),vr:ym.bind(null,e)}),e.jr.push(function(){var t=(0,s.Z)(function*(t){t?(e.Hr.hr(),yield lm(e)):(yield e.Hr.stop(),e.Ur.length>0&&(ba("RemoteStore",`Stopping write stream with ${e.Ur.length} pending writes`),e.Ur=[]))});return function(e){return t.apply(this,arguments)}}())),e.Hr}class Im{constructor(e,t,n,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new Da,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,i,r){const s=Date.now()+n,o=new Im(e,t,s,i,r);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ca(Na.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Sm(e,t){if(Za("AsyncQueue",`${t}: ${e}`),Sd(e))return new Ca(Na.UNAVAILABLE,`${t}: ${e}`);throw e}class Em{constructor(e){this.comparator=e?(t,n)=>e(t,n)||hl.comparator(t.key,n.key):(e,t)=>hl.comparator(e.key,t.key),this.keyedMap=ru(),this.sortedSet=new Gc(this.comparator)}static emptySet(e){return new Em(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Em))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Em;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class qm{constructor(){this.Jr=new Gc(hl.comparator)}track(e){const t=e.doc.key,n=this.Jr.get(t);n?0!==e.type&&3===n.type?this.Jr=this.Jr.insert(t,e):3===e.type&&1!==n.type?this.Jr=this.Jr.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Jr=this.Jr.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Jr=this.Jr.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Jr=this.Jr.remove(t):1===e.type&&2===n.type?this.Jr=this.Jr.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Jr=this.Jr.insert(t,{type:2,doc:e.doc}):Sa():this.Jr=this.Jr.insert(t,e)}Yr(){const e=[];return this.Jr.inorderTraversal((t,n)=>{e.push(n)}),e}}class Nm{constructor(e,t,n,i,r,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,i){const r=[];return t.forEach(e=>{r.push({type:0,doc:e})}),new Nm(e,t,Em.emptySet(t),r,n,i,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ac(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class Cm{constructor(){this.Xr=void 0,this.listeners=[]}}class Dm{constructor(){this.queries=new bh(e=>lc(e),ac),this.onlineState="Unknown",this.Zr=new Set}}function Rm(e,t){return Om.apply(this,arguments)}function Om(){return(Om=(0,s.Z)(function*(e,t){const n=qa(e),i=t.query;let r=!1,s=n.queries.get(i);if(s||(r=!0,s=new Cm),r)try{s.Xr=yield n.onListen(i)}catch(e){const n=Sm(e,`Initialization of query '${cc(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,s),s.listeners.push(t),t.eo(n.onlineState),s.Xr&&t.no(s.Xr)&&Fm(n)})).apply(this,arguments)}function km(e,t){return Mm.apply(this,arguments)}function Mm(){return(Mm=(0,s.Z)(function*(e,t){const n=qa(e),i=t.query;let r=!1;const s=n.queries.get(i);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),r=0===s.listeners.length)}if(r)return n.queries.delete(i),n.onUnlisten(i)})).apply(this,arguments)}function Um(e,t){const n=qa(e);let i=!1;for(const r of t){const e=n.queries.get(r.query);if(e){for(const t of e.listeners)t.no(r)&&(i=!0);e.Xr=r}}i&&Fm(n)}function Pm(e,t,n){const i=qa(e),r=i.queries.get(t);if(r)for(const s of r.listeners)s.onError(n);i.queries.delete(t)}function Fm(e){e.Zr.forEach(e=>{e.next()})}class Lm{constructor(e,t,n){this.query=e,this.so=t,this.io=!1,this.ro=null,this.onlineState="Unknown",this.options=n||{}}no(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Nm(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.io?this.oo(e)&&(this.so.next(e),t=!0):this.ao(e,this.onlineState)&&(this.co(e),t=!0),this.ro=e,t}onError(e){this.so.error(e)}eo(e){this.onlineState=e;let t=!1;return this.ro&&!this.io&&this.ao(this.ro,e)&&(this.co(this.ro),t=!0),t}ao(e,t){return!e.fromCache||!(this.options.uo&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}oo(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.ro&&this.ro.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}co(e){e=Nm.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.io=!0,this.so.next(e)}}class Jm{constructor(e,t){this.payload=e,this.byteLength=t}ho(){return"metadata"in this.payload}}class Ym{constructor(e){this.N=e}zn(e){return Nu(this.N,e)}Hn(e){return e.metadata.exists?Mu(this.N,e.document,!1):ql.newNoDocument(this.zn(e.metadata.name),this.Jn(e.metadata.readTime))}Jn(e){return Iu(e)}}class Qm{constructor(e,t,n){this.lo=e,this.localStore=t,this.N=n,this.queries=[],this.documents=[],this.progress=Vm(e)}fo(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}wo(e){const t=new Map,n=new Ym(this.N);for(const i of e)if(i.metadata.queries){const e=n.zn(i.metadata.name);for(const n of i.metadata.queries){const i=(t.get(n)||lu()).add(e);t.set(n,i)}}return t}complete(){var e=this;return(0,s.Z)(function*(){const t=yield function(e,t,n,i){return ip.apply(this,arguments)}(e.localStore,new Ym(e.N),e.documents,e.lo.id),n=e.wo(e.documents);for(const i of e.queries)yield rp(e.localStore,i,n.get(i.name));return e.progress.taskState="Success",new Uh(Object.assign({},e.progress),t)})()}}function Vm(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class jm{constructor(e){this.key=e}}class Hm{constructor(e){this.key=e}}class $m{constructor(e,t){this.query=e,this._o=t,this.mo=null,this.current=!1,this.yo=lu(),this.mutatedKeys=lu(),this.po=dc(e),this.Eo=new Em(this.po)}get To(){return this._o}Io(e,t){const n=t?t.Ao:new qm,i=t?t.Eo:this.Eo;let r=t?t.mutatedKeys:this.mutatedKeys,s=i,o=!1;const a=Xl(this.query)&&i.size===this.query.limit?i.last():null,l=ec(this.query)&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((e,t)=>{const c=i.get(e),u=uc(this.query,t)?t:null,d=!!c&&this.mutatedKeys.has(c.key),h=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let p=!1;c&&u?c.data.isEqual(u.data)?d!==h&&(n.track({type:3,doc:u}),p=!0):this.Ro(c,u)||(n.track({type:2,doc:u}),p=!0,(a&&this.po(u,a)>0||l&&this.po(u,l)<0)&&(o=!0)):!c&&u?(n.track({type:0,doc:u}),p=!0):c&&!u&&(n.track({type:1,doc:c}),p=!0,(a||l)&&(o=!0)),p&&(u?(s=s.add(u),r=h?r.add(e):r.delete(e)):(s=s.delete(e),r=r.delete(e)))}),Xl(this.query)||ec(this.query))for(;s.size>this.query.limit;){const e=Xl(this.query)?s.last():s.first();s=s.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{Eo:s,Ao:n,Ln:o,mutatedKeys:r}}Ro(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const i=this.Eo;this.Eo=e.Eo,this.mutatedKeys=e.mutatedKeys;const r=e.Ao.Yr();r.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Sa()}};return n(e)-n(t)}(e.type,t.type)||this.po(e.doc,t.doc)),this.Po(n);const s=t?this.bo():[],o=0===this.yo.size&&this.current?1:0,a=o!==this.mo;return this.mo=o,0!==r.length||a?{snapshot:new Nm(this.query,e.Eo,i,r,e.mutatedKeys,0===o,a,!1),vo:s}:{vo:s}}eo(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Eo:this.Eo,Ao:new qm,mutatedKeys:this.mutatedKeys,Ln:!1},!1)):{vo:[]}}Vo(e){return!this._o.has(e)&&!!this.Eo.has(e)&&!this.Eo.get(e).hasLocalMutations}Po(e){e&&(e.addedDocuments.forEach(e=>this._o=this._o.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._o=this._o.delete(e)),this.current=e.current)}bo(){if(!this.current)return[];const e=this.yo;this.yo=lu(),this.Eo.forEach(e=>{this.Vo(e.key)&&(this.yo=this.yo.add(e.key))});const t=[];return e.forEach(e=>{this.yo.has(e)||t.push(new Hm(e))}),this.yo.forEach(n=>{e.has(n)||t.push(new jm(n))}),t}So(e){this._o=e.Gn,this.yo=lu();const t=this.Io(e.documents);return this.applyChanges(t,!0)}Do(){return Nm.fromInitialDocuments(this.query,this.Eo,this.mutatedKeys,0===this.mo)}}class Bm{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class zm{constructor(e){this.key=e,this.Co=!1}}class Gm{constructor(e,t,n,i,r,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.No={},this.xo=new bh(e=>lc(e),ac),this.ko=new Map,this.$o=new Set,this.Oo=new Gc(hl.comparator),this.Fo=new Map,this.Mo=new ap,this.Lo={},this.Bo=new Map,this.Uo=uh.ie(),this.onlineState="Unknown",this.qo=void 0}get isPrimaryClient(){return!0===this.qo}}function Wm(e,t){return Km.apply(this,arguments)}function Km(){return(Km=(0,s.Z)(function*(e,t){const n=Yf(e);let i,r;const s=n.xo.get(t);if(s)i=s.targetId,n.sharedClientState.addLocalQueryTarget(i),r=s.view.Do();else{const e=yield Gh(n.localStore,sc(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);i=e.targetId,r=yield Xm(n,t,i,"current"===s),n.isPrimaryClient&&jp(n.remoteStore,e)}return r})).apply(this,arguments)}function Xm(e,t,n,i){return ef.apply(this,arguments)}function ef(){return(ef=(0,s.Z)(function*(e,t,n,i){e.Ko=(t,n,i)=>{return(r=(0,s.Z)(function*(e,t,n,i){let r=t.view.Io(n);r.Ln&&(r=yield Xh(e.localStore,t.query,!1).then(({documents:e})=>t.view.Io(e,r)));const s=i&&i.targetChanges.get(t.targetId),o=t.view.applyChanges(r,e.isPrimaryClient,s);return _f(e,t.targetId,o.vo),o.snapshot}),function(e,t,n,i){return r.apply(this,arguments)})(e,t,n,i);var r};const r=yield Xh(e.localStore,t,!0),o=new $m(t,r.Gn),a=o.Io(r.documents),l=hu.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState),c=o.applyChanges(a,e.isPrimaryClient,l);_f(e,n,c.vo);const u=new Bm(t,n,o);return e.xo.set(t,u),e.ko.has(n)?e.ko.get(n).push(t):e.ko.set(n,[t]),c.snapshot})).apply(this,arguments)}function tf(e,t){return nf.apply(this,arguments)}function nf(){return(nf=(0,s.Z)(function*(e,t){const n=qa(e),i=n.xo.get(t),r=n.ko.get(i.targetId);if(r.length>1)return n.ko.set(i.targetId,r.filter(e=>!ac(e,t))),void n.xo.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Wh(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),Hp(n.remoteStore,i.targetId),vf(n,i.targetId)}).catch(fh))):(vf(n,i.targetId),yield Wh(n.localStore,i.targetId,!0))})).apply(this,arguments)}function rf(){return(rf=(0,s.Z)(function*(e,t,n){const i=Qf(e);try{const e=yield function(e,t){const n=qa(e),i=ja.now(),r=t.reduce((e,t)=>e.add(t.key),lu());let s;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>n.Qn.bn(e,r).next(r=>{s=r;const o=[];for(const e of t){const t=kc(e,s.get(e.key));null!=t&&o.push(new Fc(e.key,t,El(t.value.mapValue),Nc.exists(!0)))}return n.In.addMutationBatch(e,i,o,t)})).then(e=>(e.applyToLocalDocumentSet(s),{batchId:e.batchId,changes:s}))}(i.localStore,t);i.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let i=e.Lo[e.currentUser.toKey()];i||(i=new Gc(Ya)),i=i.insert(t,n),e.Lo[e.currentUser.toKey()]=i}(i,e.batchId,n),yield wf(i,e.changes),yield lm(i.remoteStore)}catch(e){const t=Sm(e,"Failed to persist write");n.reject(t)}})).apply(this,arguments)}function sf(e,t){return of.apply(this,arguments)}function of(){return(of=(0,s.Z)(function*(e,t){const n=qa(e);try{const e=yield $h(n.localStore,t);t.targetChanges.forEach((e,t)=>{const i=n.Fo.get(t);i&&(Ea(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?i.Co=!0:e.modifiedDocuments.size>0?Ea(i.Co):e.removedDocuments.size>0&&(Ea(i.Co),i.Co=!1))}),yield wf(n,e,t)}catch(e){yield fh(e)}})).apply(this,arguments)}function af(e,t,n){const i=qa(e);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const e=[];i.xo.forEach((n,i)=>{const r=i.view.eo(t);r.snapshot&&e.push(r.snapshot)}),function(e,t){const n=qa(e);n.onlineState=t;let i=!1;n.queries.forEach((e,n)=>{for(const r of n.listeners)r.eo(t)&&(i=!0)}),i&&Fm(n)}(i.eventManager,t),e.length&&i.No.Tr(e),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}function lf(e,t,n){return cf.apply(this,arguments)}function cf(){return(cf=(0,s.Z)(function*(e,t,n){const i=qa(e);i.sharedClientState.updateQueryState(t,"rejected",n);const r=i.Fo.get(t),s=r&&r.key;if(s){let e=new Gc(hl.comparator);e=e.insert(s,ql.newNoDocument(s,Ha.min()));const n=lu().add(s),r=new du(Ha.min(),new Map,new Xc(Ya),e,n);yield sf(i,r),i.Oo=i.Oo.remove(s),i.Fo.delete(t),xf(i)}else yield Wh(i.localStore,t,!1).then(()=>vf(i,t,n)).catch(fh)})).apply(this,arguments)}function uf(e,t){return df.apply(this,arguments)}function df(){return(df=(0,s.Z)(function*(e,t){const n=qa(e),i=t.batch.batchId;try{const e=yield jh(n.localStore,t);gf(n,i,null),ff(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),yield wf(n,e)}catch(e){yield fh(e)}})).apply(this,arguments)}function hf(e,t,n){return pf.apply(this,arguments)}function pf(){return(pf=(0,s.Z)(function*(e,t,n){const i=qa(e);try{const e=yield function(e,t){const n=qa(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let i;return n.In.lookupMutationBatch(e,t).next(t=>(Ea(null!==t),i=t.keys(),n.In.removeMutationBatch(e,t))).next(()=>n.In.performConsistencyCheck(e)).next(()=>n.Qn.bn(e,i))})}(i.localStore,t);gf(i,t,n),ff(i,t),i.sharedClientState.updateMutationState(t,"rejected",n),yield wf(i,e)}catch(n){yield fh(n)}})).apply(this,arguments)}function mf(){return(mf=(0,s.Z)(function*(e,t){const n=qa(e);Wp(n.remoteStore)||ba("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=yield function(e){const t=qa(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.In.getHighestUnacknowledgedBatchId(e))}(n.localStore);if(-1===e)return void t.resolve();const i=n.Bo.get(e)||[];i.push(t),n.Bo.set(e,i)}catch(e){const n=Sm(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}})).apply(this,arguments)}function ff(e,t){(e.Bo.get(t)||[]).forEach(e=>{e.resolve()}),e.Bo.delete(t)}function gf(e,t,n){const i=qa(e);let r=i.Lo[i.currentUser.toKey()];if(r){const e=r.get(t);e&&(n?e.reject(n):e.resolve(),r=r.remove(t)),i.Lo[i.currentUser.toKey()]=r}}function vf(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const i of e.ko.get(t))e.xo.delete(i),n&&e.No.jo(i,n);e.ko.delete(t),e.isPrimaryClient&&e.Mo.cs(t).forEach(t=>{e.Mo.containsKey(t)||yf(e,t)})}function yf(e,t){e.$o.delete(t.path.canonicalString());const n=e.Oo.get(t);null!==n&&(Hp(e.remoteStore,n),e.Oo=e.Oo.remove(t),e.Fo.delete(n),xf(e))}function _f(e,t,n){for(const i of n)i instanceof jm?(e.Mo.addReference(i.key,t),Tf(e,i)):i instanceof Hm?(ba("SyncEngine","Document no longer in limbo: "+i.key),e.Mo.removeReference(i.key,t),e.Mo.containsKey(i.key)||yf(e,i.key)):Sa()}function Tf(e,t){const n=t.key,i=n.path.canonicalString();e.Oo.get(n)||e.$o.has(i)||(ba("SyncEngine","New document in limbo: "+n),e.$o.add(i),xf(e))}function xf(e){for(;e.$o.size>0&&e.Oo.size<e.maxConcurrentLimboResolutions;){const t=e.$o.values().next().value;e.$o.delete(t);const n=new hl(Wa.fromString(t)),i=e.Uo.next();e.Fo.set(i,new zm(n)),e.Oo=e.Oo.insert(n,i),jp(e.remoteStore,new Md(sc(Kl(n.path)),i,2,Fa.T))}}function wf(e,t,n){return bf.apply(this,arguments)}function bf(){return(bf=(0,s.Z)(function*(e,t,n){const i=qa(e),r=[],o=[],a=[];var l;i.xo.isEmpty()||(i.xo.forEach((e,s)=>{a.push(i.Ko(s,t,n).then(e=>{if(e){i.isPrimaryClient&&i.sharedClientState.updateQueryState(s.targetId,e.fromCache?"not-current":"current"),r.push(e);const t=Fh.kn(s.targetId,e);o.push(t)}}))}),yield Promise.all(a),i.No.Tr(r),yield(l=(0,s.Z)(function*(e,t){const n=qa(e);try{yield n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>wd.forEach(t,t=>wd.forEach(t.Nn,i=>n.persistence.referenceDelegate.addReference(e,t.targetId,i)).next(()=>wd.forEach(t.xn,i=>n.persistence.referenceDelegate.removeReference(e,t.targetId,i)))))}catch(e){if(!Sd(e))throw e;ba("LocalStore","Failed to update sequence numbers: "+e)}for(const i of t){const e=i.targetId;if(!i.fromCache){const t=n.Un.get(e),i=t.withLastLimboFreeSnapshotVersion(t.snapshotVersion);n.Un=n.Un.insert(e,i)}}}),function(e,t){return l.apply(this,arguments)})(i.localStore,o))})).apply(this,arguments)}function Zf(e,t){return Af.apply(this,arguments)}function Af(){return(Af=(0,s.Z)(function*(e,t){const n=qa(e);if(!n.currentUser.isEqual(t)){ba("SyncEngine","User change. New user:",t.toKey());const e=yield Qh(n.localStore,t);n.currentUser=t,function(e,t){e.Bo.forEach(e=>{e.forEach(e=>{e.reject(new Ca(Na.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Bo.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),yield wf(n,e.Wn)}})).apply(this,arguments)}function If(e,t){const n=qa(e),i=n.Fo.get(t);if(i&&i.Co)return lu().add(i.key);{let e=lu();const i=n.ko.get(t);if(!i)return e;for(const t of i){const i=n.xo.get(t);e=e.unionWith(i.view.To)}return e}}function Sf(e,t){return Ef.apply(this,arguments)}function Ef(){return(Ef=(0,s.Z)(function*(e,t){const n=qa(e),i=yield Xh(n.localStore,t.query,!0),r=t.view.So(i);return n.isPrimaryClient&&_f(n,t.targetId,r.vo),r})).apply(this,arguments)}function qf(e){return Nf.apply(this,arguments)}function Nf(){return(Nf=(0,s.Z)(function*(e){const t=qa(e);return tp(t.localStore).then(e=>wf(t,e))})).apply(this,arguments)}function Cf(e,t,n,i){return Df.apply(this,arguments)}function Df(){return(Df=(0,s.Z)(function*(e,t,n,i){const r=qa(e),s=yield function(e,t){const n=qa(e),i=qa(n.In);return n.persistence.runTransaction("Lookup mutation documents","readonly",e=>i.Xt(e,t).next(t=>t?n.Qn.bn(e,t):wd.resolve(null)))}(r.localStore,t);null!==s?("pending"===n?yield lm(r.remoteStore):"acknowledged"===n||"rejected"===n?(gf(r,t,i||null),ff(r,t),function(e,t){qa(qa(e).In).te(t)}(r.localStore,t)):Sa(),yield wf(r,s)):ba("SyncEngine","Cannot apply mutation batch with id: "+t)})).apply(this,arguments)}function Rf(){return(Rf=(0,s.Z)(function*(e,t){const n=qa(e);if(Yf(n),Qf(n),!0===t&&!0!==n.qo){const e=n.sharedClientState.getAllActiveQueryTargets(),t=yield Of(n,e.toArray());n.qo=!0,yield wm(n.remoteStore,!0);for(const i of t)jp(n.remoteStore,i)}else if(!1===t&&!1!==n.qo){const e=[];let t=Promise.resolve();n.ko.forEach((i,r)=>{n.sharedClientState.isLocalQueryTarget(r)?e.push(r):t=t.then(()=>(vf(n,r),Wh(n.localStore,r,!0))),Hp(n.remoteStore,r)}),yield t,yield Of(n,e),function(e){const t=qa(e);t.Fo.forEach((e,n)=>{Hp(t.remoteStore,n)}),t.Mo.us(),t.Fo=new Map,t.Oo=new Gc(hl.comparator)}(n),n.qo=!1,yield wm(n.remoteStore,!1)}})).apply(this,arguments)}function Of(e,t,n){return kf.apply(this,arguments)}function kf(){return(kf=(0,s.Z)(function*(e,t,n){const i=qa(e),r=[],s=[];for(const o of t){let e;const t=i.ko.get(o);if(t&&0!==t.length){e=yield Gh(i.localStore,sc(t[0]));for(const e of t){const t=i.xo.get(e),n=yield Sf(i,t);n.snapshot&&s.push(n.snapshot)}}else{const t=yield ep(i.localStore,o);e=yield Gh(i.localStore,t),yield Xm(i,Mf(t),o,!1)}r.push(e)}return i.No.Tr(s),r})).apply(this,arguments)}function Mf(e){return Wl(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Uf(e){const t=qa(e);return qa(qa(t.localStore).persistence).pn()}function Pf(e,t,n,i){return Ff.apply(this,arguments)}function Ff(){return(Ff=(0,s.Z)(function*(e,t,n,i){const r=qa(e);if(r.qo)ba("SyncEngine","Ignoring unexpected query state notification.");else if(r.ko.has(t))switch(n){case"current":case"not-current":{const e=yield tp(r.localStore),i=du.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);yield wf(r,e,i);break}case"rejected":yield Wh(r.localStore,t,!0),vf(r,t,i);break;default:Sa()}})).apply(this,arguments)}function Lf(e,t,n){return Jf.apply(this,arguments)}function Jf(){return(Jf=(0,s.Z)(function*(e,t,n){const i=Yf(e);if(i.qo){for(const e of t){if(i.ko.has(e)){ba("SyncEngine","Adding an already active target "+e);continue}const t=yield ep(i.localStore,e),n=yield Gh(i.localStore,t);yield Xm(i,Mf(t),n.targetId,!1),jp(i.remoteStore,n)}for(const e of n)i.ko.has(e)&&(yield Wh(i.localStore,e,!1).then(()=>{Hp(i.remoteStore,e),vf(i,e)}).catch(fh))}})).apply(this,arguments)}function Yf(e){const t=qa(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=sf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=If.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=lf.bind(null,t),t.No.Tr=Um.bind(null,t.eventManager),t.No.jo=Pm.bind(null,t.eventManager),t}function Qf(e){const t=qa(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=uf.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=hf.bind(null,t),t}class Vf{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,s.Z)(function*(){t.N=Rp(e.databaseInfo.databaseId),t.sharedClientState=t.Wo(e),t.persistence=t.Go(e),yield t.persistence.start(),t.gcScheduler=t.zo(e),t.localStore=t.Ho(e)})()}zo(e){return null}Ho(e){return Yh(this.persistence,new Lh,e.initialUser,this.N)}Go(e){return new pp(fp.Ns,this.N)}Wo(e){return new Ap}terminate(){var e=this;return(0,s.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class jf extends Vf{constructor(e,t,n){super(),this.Jo=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,n=this;return(0,s.Z)(function*(){yield t().call(n,e),yield function(e){return np.apply(this,arguments)}(n.localStore),yield n.Jo.initialize(n,e),yield Qf(n.Jo.syncEngine),yield lm(n.Jo.remoteStore),yield n.persistence.nn(()=>(n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(n.localStore),Promise.resolve()))})()}Ho(e){return Yh(this.persistence,new Lh,e.initialUser,this.N)}zo(e){return new _h(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue)}Go(e){const t=Mh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?nh.withCacheSize(this.cacheSizeBytes):nh.DEFAULT;return new Rh(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Cp(),Dp(),this.N,this.sharedClientState,!!this.forceOwnership)}Wo(e){return new Ap}}class Hf extends jf{constructor(e,t){super(e,t,!1),this.Jo=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,n=this;return(0,s.Z)(function*(){yield t().call(n,e);const i=n.Jo.syncEngine;n.sharedClientState instanceof Zp&&(n.sharedClientState.syncEngine={_i:Cf.bind(null,i),mi:Pf.bind(null,i),gi:Lf.bind(null,i),pn:Uf.bind(null,i),wi:qf.bind(null,i)},yield n.sharedClientState.start()),yield n.persistence.nn(function(){var e=(0,s.Z)(function*(e){yield function(e,t){return Rf.apply(this,arguments)}(n.Jo.syncEngine,e),n.gcScheduler&&(e&&!n.gcScheduler.started?n.gcScheduler.start(n.localStore):e||n.gcScheduler.stop())});return function(t){return e.apply(this,arguments)}}())})()}Wo(e){const t=Cp();if(!Zp.Pt(t))throw new Ca(Na.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Mh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Zp(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class $f{initialize(e,t){var n=this;return(0,s.Z)(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=e=>af(n.syncEngine,e,1),n.remoteStore.remoteSyncer.handleCredentialChange=Zf.bind(null,n.syncEngine),yield wm(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Dm}createDatastore(e){const t=Rp(e.databaseInfo.databaseId),n=new Np(e.databaseInfo);return function(e,t,n){return new Pp(e,t,n)}(e.credentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,i=e.asyncQueue,r=e=>af(this.syncEngine,e,0),s=Sp.Pt()?new Sp:new Ip,new Lp(t,n,i,r,s);var t,n,i,r,s}createSyncEngine(e,t){return function(e,t,n,i,r,s,o){const a=new Gm(e,t,n,i,r,s);return o&&(a.qo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,s.Z)(function*(e){const t=qa(e);ba("RemoteStore","RemoteStore shutting down."),t.Kr.add(5),yield Qp(t),t.Qr.shutdown(),t.Wr.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function Bf(e,t=10240){let n=0;return{read:()=>(0,s.Z)(function*(){if(n<e.byteLength){const i={value:e.slice(n,n+t),done:!1};return n+=t,i}return{done:!0}})(),cancel:()=>(0,s.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class zf{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Yo(this.observer.next,e)}error(e){this.observer.error?this.Yo(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Xo(){this.muted=!0}Yo(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Gf{constructor(e,t){this.Zo=e,this.N=t,this.metadata=new Da,this.buffer=new Uint8Array,this.ta=new TextDecoder("utf-8"),this.ea().then(e=>{e&&e.ho()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.Zo.cancel()}getMetadata(){var e=this;return(0,s.Z)(function*(){return e.metadata.promise})()}Qo(){var e=this;return(0,s.Z)(function*(){return yield e.getMetadata(),e.ea()})()}ea(){var e=this;return(0,s.Z)(function*(){const t=yield e.na();if(null===t)return null;const n=e.ta.decode(t),i=Number(n);isNaN(i)&&e.sa(`length string (${n}) is not valid number`);const r=yield e.ia(i);return new Jm(JSON.parse(r),t.length+i)})()}ra(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}na(){var e=this;return(0,s.Z)(function*(){for(;e.ra()<0&&!(yield e.oa()););if(0===e.buffer.length)return null;const t=e.ra();t<0&&e.sa("Reached the end of bundle when a length string is expected.");const n=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),n})()}ia(e){var t=this;return(0,s.Z)(function*(){for(;t.buffer.length<e;)(yield t.oa())&&t.sa("Reached the end of bundle when more is expected.");const n=t.ta.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),n})()}sa(e){throw this.Zo.cancel(),new Error(`Invalid bundle format: ${e}`)}oa(){var e=this;return(0,s.Z)(function*(){const t=yield e.Zo.read();if(!t.done){const n=new Uint8Array(e.buffer.length+t.value.length);n.set(e.buffer),n.set(t.value,e.buffer.length),e.buffer=n}return t.done})()}}class Wf{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,s.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new Ca(Na.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const n=yield(i=(0,s.Z)(function*(e,t){const n=qa(e),i=Ru(n.N)+"/documents",r={documents:t.map(e=>qu(n.N,e))},s=yield n.Ki("BatchGetDocuments",i,r),o=new Map;s.forEach(e=>{const t=function(e,t){return"found"in t?function(e,t){Ea(!!t.found);const n=Nu(e,t.found.name),i=Iu(t.found.updateTime),r=new Sl({mapValue:{fields:t.found.fields}});return ql.newFoundDocument(n,i,r)}(e,t):"missing"in t?function(e,t){Ea(!!t.missing),Ea(!!t.readTime);const n=Nu(e,t.missing),i=Iu(t.readTime);return ql.newNoDocument(n,i)}(e,t):Sa()}(n.N,e);o.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{const t=o.get(e.toString());Ea(!!t),a.push(t)}),a}),function(e,t){return i.apply(this,arguments)})(t.datastore,e);var i;return n.forEach(e=>t.recordVersion(e)),n})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Qc(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,s.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var n;e.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((t,n)=>{const i=hl.fromPath(n);e.mutations.push(new Vc(i,e.precondition(i)))}),yield(n=(0,s.Z)(function*(e,t){const n=qa(e),i=Ru(n.N)+"/documents",r={writes:t.map(e=>Uu(n.N,e))};yield n.Li("Commit",i,r)}),function(e,t){return n.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Sa();t=Ha.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Ca(Na.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?Nc.updateTime(t):Nc.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Ha.min()))throw new Ca(Na.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Nc.updateTime(t)}return Nc.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Kf{constructor(e,t,n,i){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=i,this.aa=5,this.rr=new Op(this.asyncQueue,"transaction_retry")}run(){this.aa-=1,this.ca()}ca(){var e=this;this.rr.Xi((0,s.Z)(function*(){const t=new Wf(e.datastore),n=e.ua(t);n&&n.then(n=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(n)}).catch(t=>{e.ha(t)}))}).catch(t=>{e.ha(t)})}))}ua(e){try{const t=this.updateFunction(e);return!cl(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}ha(e){this.aa>0&&this.la(e)?(this.aa-=1,this.asyncQueue.enqueueAndForget(()=>(this.ca(),Promise.resolve()))):this.deferred.reject(e)}la(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!Bc(t)}return!1}}class Xf{constructor(e,t,n){var i=this;this.credentials=e,this.asyncQueue=t,this.databaseInfo=n,this.user=_a.UNAUTHENTICATED,this.clientId=Ja.I(),this.credentialListener=()=>Promise.resolve(),this.credentials.start(t,function(){var e=(0,s.Z)(function*(e){ba("FirestoreClient","Received user=",e.uid),yield i.credentialListener(e),i.user=e});return function(t){return e.apply(this,arguments)}}())}getConfiguration(){var e=this;return(0,s.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,credentials:e.credentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.credentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Ca(Na.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Da;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,s.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.credentials.shutdown(),t.resolve()}catch(n){const e=Sm(n,"Failed to shutdown persistence");t.reject(e)}})),t.promise}}function eg(e,t){return tg.apply(this,arguments)}function tg(){return(tg=(0,s.Z)(function*(e,t){e.asyncQueue.verifyOperationInProgress(),ba("FirestoreClient","Initializing OfflineComponentProvider");const n=yield e.getConfiguration();yield t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener(function(){var e=(0,s.Z)(function*(e){i.isEqual(e)||(yield Qh(t.localStore,e),i=e)});return function(t){return e.apply(this,arguments)}}()),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t})).apply(this,arguments)}function ng(e,t){return ig.apply(this,arguments)}function ig(){return(ig=(0,s.Z)(function*(e,t){e.asyncQueue.verifyOperationInProgress();const n=yield rg(e);ba("FirestoreClient","Initializing OnlineComponentProvider");const i=yield e.getConfiguration();yield t.initialize(n,i),e.setCredentialChangeListener(e=>{return(n=(0,s.Z)(function*(e,t){const n=qa(e);n.asyncQueue.verifyOperationInProgress(),ba("RemoteStore","RemoteStore received new credentials");const i=Wp(n);n.Kr.add(3),yield Qp(n),i&&n.Wr.set("Unknown"),yield n.remoteSyncer.handleCredentialChange(t),n.Kr.delete(3),yield Jp(n)}),function(e,t){return n.apply(this,arguments)})(t.remoteStore,e);var n}),e.onlineComponents=t})).apply(this,arguments)}function rg(e){return sg.apply(this,arguments)}function sg(){return(sg=(0,s.Z)(function*(e){return e.offlineComponents||(ba("FirestoreClient","Using default OfflineComponentProvider"),yield eg(e,new Vf)),e.offlineComponents})).apply(this,arguments)}function og(e){return ag.apply(this,arguments)}function ag(){return(ag=(0,s.Z)(function*(e){return e.onlineComponents||(ba("FirestoreClient","Using default OnlineComponentProvider"),yield ng(e,new $f)),e.onlineComponents})).apply(this,arguments)}function lg(e){return rg(e).then(e=>e.persistence)}function cg(e){return rg(e).then(e=>e.localStore)}function ug(e){return og(e).then(e=>e.remoteStore)}function dg(e){return og(e).then(e=>e.syncEngine)}function hg(e){return pg.apply(this,arguments)}function pg(){return(pg=(0,s.Z)(function*(e){const t=yield og(e),n=t.eventManager;return n.onListen=Wm.bind(null,t.syncEngine),n.onUnlisten=tf.bind(null,t.syncEngine),n})).apply(this,arguments)}function mg(e,t,n={}){const i=new Da;return e.asyncQueue.enqueueAndForget((0,s.Z)(function*(){return function(e,t,n,i,r){const s=new zf({next:s=>{t.enqueueAndForget(()=>km(e,o));const a=s.docs.has(n);!a&&s.fromCache?r.reject(new Ca(Na.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&i&&"server"===i.source?r.reject(new Ca(Na.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(s)},error:e=>r.reject(e)}),o=new Lm(Kl(n.path),s,{includeMetadataChanges:!0,uo:!0});return Rm(e,o)}(yield hg(e),e.asyncQueue,t,n,i)})),i.promise}function fg(e,t,n={}){const i=new Da;return e.asyncQueue.enqueueAndForget((0,s.Z)(function*(){return function(e,t,n,i,r){const s=new zf({next:n=>{t.enqueueAndForget(()=>km(e,o)),n.fromCache&&"server"===i.source?r.reject(new Ca(Na.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:e=>r.reject(e)}),o=new Lm(n,s,{includeMetadataChanges:!0,uo:!0});return Rm(e,o)}(yield hg(e),e.asyncQueue,t,n,i)})),i.promise}class gg{constructor(e,t,n,i,r,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class vg{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof vg&&e.projectId===this.projectId&&e.database===this.database}}const yg=new Map;function _g(e,t,n){if(!n)throw new Ca(Na.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Tg(e,t,n,i){if(!0===t&&!0===i)throw new Ca(Na.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function xg(e){if(!hl.isDocumentKey(e))throw new Ca(Na.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function wg(e){if(hl.isDocumentKey(e))throw new Ca(Na.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function bg(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){if(e.constructor){const t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&t.length>1)return t[1]}return null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Sa()}function Zg(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Ca(Na.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=bg(e);throw new Ca(Na.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Ag(e,t){if(t<=0)throw new Ca(Na.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Ig{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new Ca(Na.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Ca(Na.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Tg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Sg{constructor(e,t){this._credentials=t,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ig({}),this._settingsFrozen=!1,e instanceof vg?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Ca(Na.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vg(e.options.projectId)}(e))}get app(){if(!this._app)throw new Ca(Na.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Ca(Na.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ig(e),void 0!==e.credentials&&(this._credentials=function(e){if(!e)return new Oa;switch(e.type){case"gapi":const t=e.client;return Ea(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new Pa(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new Ca(Na.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=yg.get(e);t&&(ba("ComponentProvider","Removing Datastore"),yg.delete(e),t.terminate())}(this),Promise.resolve()}}class Eg{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ng(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Eg(this.firestore,e,this._key)}}class qg{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new qg(this.firestore,e,this._query)}}class Ng extends qg{constructor(e,t,n){super(e,t,Kl(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Eg(this.firestore,null,new hl(e))}withConverter(e){return new Ng(this.firestore,e,this._path)}}function Cg(e,t,...n){if(e=(0,ui.m9)(e),_g("collection","path",t),e instanceof Sg){const i=Wa.fromString(t,...n);return wg(i),new Ng(e,null,i)}{if(!(e instanceof Eg||e instanceof Ng))throw new Ca(Na.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=Wa.fromString(e.path,...n).child(Wa.fromString(t));return wg(i),new Ng(e.firestore,null,i)}}function Dg(e,t,...n){if(e=(0,ui.m9)(e),1===arguments.length&&(t=Ja.I()),_g("doc","path",t),e instanceof Sg){const i=Wa.fromString(t,...n);return xg(i),new Eg(e,null,new hl(i))}{if(!(e instanceof Eg||e instanceof Ng))throw new Ca(Na.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=e._path.child(Wa.fromString(t,...n));return xg(i),new Eg(e.firestore,e instanceof Ng?e.converter:null,new hl(i))}}function Rg(e,t){return e=(0,ui.m9)(e),t=(0,ui.m9)(t),(e instanceof Eg||e instanceof Ng)&&(t instanceof Eg||t instanceof Ng)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Og(e,t){return e=(0,ui.m9)(e),t=(0,ui.m9)(t),e instanceof qg&&t instanceof qg&&e.firestore===t.firestore&&ac(e._query,t._query)&&e.converter===t.converter}class kg{constructor(){this.fa=Promise.resolve(),this.da=[],this.wa=!1,this._a=[],this.ma=null,this.ga=!1,this.ya=!1,this.pa=[],this.rr=new Op(this,"async_queue_retry"),this.Ea=()=>{const e=Dp();e&&ba("AsyncQueue","Visibility state changed to "+e.visibilityState),this.rr.tr()};const e=Dp();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ea)}get isShuttingDown(){return this.wa}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ta(),this.Ia(e)}enterRestrictedMode(e){if(!this.wa){this.wa=!0,this.ya=e||!1;const t=Dp();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ea)}}enqueue(e){if(this.Ta(),this.wa)return new Promise(()=>{});const t=new Da;return this.Ia(()=>this.wa&&this.ya?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.da.push(e),this.Aa()))}Aa(){var e=this;return(0,s.Z)(function*(){if(0!==e.da.length){try{yield e.da[0](),e.da.shift(),e.rr.reset()}catch(t){if(!Sd(t))throw t;ba("AsyncQueue","Operation failed with retryable error: "+t)}e.da.length>0&&e.rr.Xi(()=>e.Aa())}})()}Ia(e){const t=this.fa.then(()=>(this.ga=!0,e().catch(e=>{throw this.ma=e,this.ga=!1,Za("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.ga=!1,e))));return this.fa=t,t}enqueueAfterDelay(e,t,n){this.Ta(),this.pa.indexOf(e)>-1&&(t=0);const i=Im.createAndSchedule(this,e,t,n,e=>this.Ra(e));return this._a.push(i),i}Ta(){this.ma&&Sa()}verifyOperationInProgress(){}Pa(){var e=this;return(0,s.Z)(function*(){let t;do{t=e.fa,yield t}while(t!==e.fa)})()}ba(e){for(const t of this._a)if(t.timerId===e)return!0;return!1}va(e){return this.Pa().then(()=>{this._a.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this._a)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Pa()})}Va(e){this.pa.push(e)}Ra(e){const t=this._a.indexOf(e);this._a.splice(t,1)}}function Mg(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const i of["next","error","complete"])if(i in n&&"function"==typeof n[i])return!0;return!1}(e)}class Ug{constructor(){this._progressObserver={},this._taskCompletionResolver=new Da,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Pg extends Sg{constructor(e,t){super(e,t),this.type="firestore",this._queue=new kg,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Lg(this),this._firestoreClient.terminate()}}function Fg(e){return e._firestoreClient||Lg(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Lg(e){var t;const n=e._freezeSettings(),i=function(e,t,n,i){return new gg(e,t,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Xf(e._credentials,e._queue,i)}function Jg(e,t,n){const i=new Da;return e.asyncQueue.enqueue((0,s.Z)(function*(){try{yield eg(e,n),yield ng(e,t),i.resolve()}catch(e){if(!function(e){return"FirebaseError"===e.name?e.code===Na.FAILED_PRECONDITION||e.code===Na.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(e))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),i.reject(e)}})).then(()=>i.promise)}function Yg(e){if(e._initialized||e._terminated)throw new Ca(Na.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Qg{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Ca(Na.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Xa(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Vg{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Vg(tl.fromBase64String(e))}catch(e){throw new Ca(Na.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Vg(tl.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class jg{constructor(e){this._methodName=e}}class Hg{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ca(Na.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ca(Na.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ya(this._lat,e._lat)||Ya(this._long,e._long)}}const $g=/^__.*__$/;class Bg{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Fc(e,this.data,this.fieldMask,t,this.fieldTransforms):new Pc(e,this.data,t,this.fieldTransforms)}}class zg{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Fc(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Gg(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Sa()}}class Wg{constructor(e,t,n,i,r,s){this.settings=e,this.databaseId=t,this.N=n,this.ignoreUndefinedProperties=i,void 0===r&&this.Sa(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Da(){return this.settings.Da}Ca(e){return new Wg(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.N,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Na(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Ca({path:n,xa:!1});return i.ka(e),i}$a(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Ca({path:n,xa:!1});return i.Sa(),i}Oa(e){return this.Ca({path:void 0,xa:!0})}Fa(e){return vv(e,this.settings.methodName,this.settings.Ma||!1,this.path,this.settings.La)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Sa(){if(this.path)for(let e=0;e<this.path.length;e++)this.ka(this.path.get(e))}ka(e){if(0===e.length)throw this.Fa("Document fields must not be empty");if(Gg(this.Da)&&$g.test(e))throw this.Fa('Document fields cannot begin and end with "__"')}}class Kg{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.N=n||Rp(e)}Ba(e,t,n,i=!1){return new Wg({Da:e,methodName:t,La:n,path:Xa.emptyPath(),xa:!1,Ma:i},this.databaseId,this.N,this.ignoreUndefinedProperties)}}function Xg(e){const t=e._freezeSettings(),n=Rp(e._databaseId);return new Kg(e._databaseId,!!t.ignoreUndefinedProperties,n)}function ev(e,t,n,i,r,s={}){const o=e.Ba(s.merge||s.mergeFields?2:0,t,n,r);pv("Data must be an object, but it was:",o,i);const a=dv(i,o);let l,c;if(s.merge)l=new el(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const i of s.mergeFields){const r=mv(t,i,n);if(!o.contains(r))throw new Ca(Na.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);yv(e,r)||e.push(r)}l=new el(e),c=o.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,c=o.fieldTransforms;return new Bg(new Sl(a),l,c)}class tv extends jg{_toFieldTransform(e){if(2!==e.Da)throw e.Fa(1===e.Da?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof tv}}function nv(e,t,n){return new Wg({Da:3,La:t.settings.La,methodName:e._methodName,xa:n},t.databaseId,t.N,t.ignoreUndefinedProperties)}class iv extends jg{_toFieldTransform(e){return new Ec(e.path,new Tc)}isEqual(e){return e instanceof iv}}class rv extends jg{constructor(e,t){super(e),this.Ua=t}_toFieldTransform(e){const t=nv(this,e,!0),n=this.Ua.map(e=>uv(e,t)),i=new xc(n);return new Ec(e.path,i)}isEqual(e){return this===e}}class sv extends jg{constructor(e,t){super(e),this.Ua=t}_toFieldTransform(e){const t=nv(this,e,!0),n=this.Ua.map(e=>uv(e,t)),i=new bc(n);return new Ec(e.path,i)}isEqual(e){return this===e}}class ov extends jg{constructor(e,t){super(e),this.qa=t}_toFieldTransform(e){const t=new Ac(e.N,fc(e.N,this.qa));return new Ec(e.path,t)}isEqual(e){return this===e}}function av(e,t,n,i){const r=e.Ba(1,t,n);pv("Data must be an object, but it was:",r,i);const s=[],o=Sl.empty();Ba(i,(e,i)=>{const a=gv(t,e,n);i=(0,ui.m9)(i);const l=r.$a(a);if(i instanceof tv)s.push(a);else{const e=uv(i,l);null!=e&&(s.push(a),o.set(a,e))}});const a=new el(s);return new zg(o,a,r.fieldTransforms)}function lv(e,t,n,i,r,s){const o=e.Ba(1,t,n),a=[mv(t,i,n)],l=[r];if(s.length%2!=0)throw new Ca(Na.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<s.length;h+=2)a.push(mv(t,s[h])),l.push(s[h+1]);const c=[],u=Sl.empty();for(let h=a.length-1;h>=0;--h)if(!yv(c,a[h])){const e=a[h];let t=l[h];t=(0,ui.m9)(t);const n=o.$a(e);if(t instanceof tv)c.push(e);else{const i=uv(t,n);null!=i&&(c.push(e),u.set(e,i))}}const d=new el(c);return new zg(u,d,o.fieldTransforms)}function cv(e,t,n,i=!1){return uv(n,e.Ba(i?4:3,t))}function uv(e,t){if(hv(e=(0,ui.m9)(e)))return pv("Unsupported field value:",t,e),dv(e,t);if(e instanceof jg)return function(e,t){if(!Gg(t.Da))throw t.Fa(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Fa(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.xa&&4!==t.Da)throw t.Fa("Nested arrays are not supported");return function(e,t){const n=[];let i=0;for(const r of e){let e=uv(r,t.Oa(i));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),i++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,ui.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return fc(t.N,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=ja.fromDate(e);return{timestampValue:bu(t.N,n)}}if(e instanceof ja){const n=new ja(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:bu(t.N,n)}}if(e instanceof Hg)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Vg)return{bytesValue:Zu(t.N,e._byteString)};if(e instanceof Eg){const n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t.Fa(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Su(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Fa(`Unsupported field value: ${bg(e)}`)}(e,t)}function dv(e,t){const n={};return za(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ba(e,(e,i)=>{const r=uv(i,t.Na(e));null!=r&&(n[e]=r)}),{mapValue:{fields:n}}}function hv(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ja||e instanceof Hg||e instanceof Vg||e instanceof Eg||e instanceof jg)}function pv(e,t,n){if(!hv(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const i=bg(n);throw t.Fa("an object"===i?e+" a custom object":e+" "+i)}}function mv(e,t,n){if((t=(0,ui.m9)(t))instanceof Qg)return t._internalPath;if("string"==typeof t)return gv(e,t);throw vv("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}const fv=new RegExp("[~\\*/\\[\\]]");function gv(e,t,n){if(t.search(fv)>=0)throw vv(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Qg(...t.split("."))._internalPath}catch(i){throw vv(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function vv(e,t,n,i,r){const s=i&&!i.isEmpty(),o=void 0!==r;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${i}`),o&&(l+=` in document ${r}`),l+=")"),new Ca(Na.INVALID_ARGUMENT,a+e+l)}function yv(e,t){return e.some(e=>e.isEqual(t))}class _v{constructor(e,t,n,i,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Eg(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Tv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(xv("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Tv extends _v{data(){return super.data()}}function xv(e,t){return"string"==typeof t?gv(e,t):t instanceof Qg?t._internalPath:t._delegate._internalPath}class wv{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class bv extends _v{constructor(e,t,n,i,r,s){super(e,t,n,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Zv(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(xv("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Zv extends bv{data(e={}){return super.data(e)}}class Av{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new wv(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Zv(this._firestore,this._userDataWriter,n.key,n,new wv(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Ca(Na.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>({type:"added",doc:new Zv(e._firestore,e._userDataWriter,n.doc.key,n.doc,new wv(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:t++}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const i=new Zv(e._firestore,e._userDataWriter,t.doc.key,t.doc,new wv(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let r=-1,s=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Iv(t.type),doc:i,oldIndex:r,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Iv(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Sa()}}function Sv(e,t){return e instanceof bv&&t instanceof bv?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Av&&t instanceof Av&&e._firestore===t._firestore&&Og(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function Ev(e){if(ec(e)&&0===e.explicitOrderBy.length)throw new Ca(Na.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class qv{}function Nv(e,...t){for(const n of t)e=n._apply(e);return e}class Cv extends qv{constructor(e,t,n){super(),this.Ka=e,this.ja=t,this.Qa=n,this.type="where"}_apply(e){const t=Xg(e.firestore),n=function(e,t,n,i,r,s,o){let a;if(r.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Ca(Na.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on FieldPath.documentId().`);if("in"===s||"not-in"===s){Pv(o,s);const t=[];for(const n of o)t.push(Uv(i,e,n));a={arrayValue:{values:t}}}else a=Uv(i,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Pv(o,s),a=cv(n,"where",o,"in"===s||"not-in"===s);const l=kl.create(r,s,a);return function(e,t){if(t.v()){const n=nc(e);if(null!==n&&!n.isEqual(t.field))throw new Ca(Na.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${t.field.toString()}'`);const i=tc(e);null!==i&&Fv(0,t.field,i)}const n=function(e,t){for(const n of e.filters)if(t.indexOf(n.op)>=0)return n.op;return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw new Ca(Na.INVALID_ARGUMENT,n===t.op?`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`:`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}(e,l),l}(e._query,0,t,e.firestore._databaseId,this.Ka,this.ja,this.Qa);return new qg(e.firestore,e.converter,function(e,t){const n=e.filters.concat([t]);return new Gl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}class Dv extends qv{constructor(e,t){super(),this.Ka=e,this.Wa=t,this.type="orderBy"}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new Ca(Na.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Ca(Na.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const i=new Hl(t,n);return function(e,t){if(null===tc(e)){const n=nc(e);null!==n&&Fv(0,n,t.field)}}(e,i),i}(e._query,this.Ka,this.Wa);return new qg(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Gl(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class Rv extends qv{constructor(e,t,n){super(),this.type=e,this.Ga=t,this.za=n}_apply(e){return new qg(e.firestore,e.converter,oc(e._query,this.Ga,this.za))}}class Ov extends qv{constructor(e,t,n){super(),this.type=e,this.Ha=t,this.Ja=n}_apply(e){const t=Mv(e,this.type,this.Ha,this.Ja);return new qg(e.firestore,e.converter,function(e,t){return new Gl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class kv extends qv{constructor(e,t,n){super(),this.type=e,this.Ha=t,this.Ja=n}_apply(e){const t=Mv(e,this.type,this.Ha,this.Ja);return new qg(e.firestore,e.converter,function(e,t){return new Gl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function Mv(e,t,n,i){if(n[0]=(0,ui.m9)(n[0]),n[0]instanceof _v)return function(e,t,n,i,r){if(!i)throw new Ca(Na.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const o of rc(e))if(o.field.isKeyField())s.push(Tl(t,i.key));else{const e=i.data.field(o.field);if(ol(e))throw new Ca(Na.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=o.field.canonicalString();throw new Ca(Na.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new Vl(s,r)}(e._query,e.firestore._databaseId,t,n[0]._document,i);{const r=Xg(e.firestore);return function(e,t,n,i,r,s){const o=e.explicitOrderBy;if(r.length>o.length)throw new Ca(Na.INVALID_ARGUMENT,`Too many arguments provided to ${i}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let l=0;l<r.length;l++){const s=r[l];if(o[l].field.isKeyField()){if("string"!=typeof s)throw new Ca(Na.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${i}(), but got a ${typeof s}`);if(!ic(e)&&-1!==s.indexOf("/"))throw new Ca(Na.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${i}() must be a plain document ID, but '${s}' contains a slash.`);const n=e.path.child(Wa.fromString(s));if(!hl.isDocumentKey(n))throw new Ca(Na.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${i}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const r=new hl(n);a.push(Tl(t,r))}else{const e=cv(n,i,s);a.push(e)}}return new Vl(a,s)}(e._query,e.firestore._databaseId,r,t,n,i)}}function Uv(e,t,n){if("string"==typeof(n=(0,ui.m9)(n))){if(""===n)throw new Ca(Na.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!ic(t)&&-1!==n.indexOf("/"))throw new Ca(Na.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const i=t.path.child(Wa.fromString(n));if(!hl.isDocumentKey(i))throw new Ca(Na.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Tl(e,new hl(i))}if(n instanceof Eg)return Tl(e,n._key);throw new Ca(Na.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${bg(n)}.`)}function Pv(e,t){if(!Array.isArray(e)||0===e.length)throw new Ca(Na.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new Ca(Na.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function Fv(e,t,n){if(!n.isEqual(t))throw new Ca(Na.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Lv{convertValue(e,t="none"){switch(pl(e)){case 0:return null;case 1:return e.booleanValue;case 2:return rl(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(sl(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Sa()}}convertObject(e,t){const n={};return Ba(e.fields,(e,i)=>{n[e]=this.convertValue(i,t)}),n}convertGeoPoint(e){return new Hg(rl(e.latitude),rl(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=al(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ll(e));default:return null}}convertTimestamp(e){const t=il(e);return new ja(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Wa.fromString(e);Ea(Ku(n));const i=new vg(n.get(1),n.get(3)),r=new hl(n.popFirst(5));return i.isEqual(t)||Za(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}function Jv(e,t,n){let i;return i=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,i}class Yv extends Lv{constructor(e){super(),this.firestore=e}convertBytes(e){return new Vg(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Eg(this.firestore,null,t)}}class Qv{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Xg(e)}set(e,t,n){this._verifyNotCommitted();const i=Vv(e,this._firestore),r=Jv(i.converter,t,n),s=ev(this._dataReader,"WriteBatch.set",i._key,r,null!==i.converter,n);return this._mutations.push(s.toMutation(i._key,Nc.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const r=Vv(e,this._firestore);let s;return s="string"==typeof(t=(0,ui.m9)(t))||t instanceof Qg?lv(this._dataReader,"WriteBatch.update",r._key,t,n,i):av(this._dataReader,"WriteBatch.update",r._key,t),this._mutations.push(s.toMutation(r._key,Nc.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Vv(e,this._firestore);return this._mutations=this._mutations.concat(new Qc(t._key,Nc.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Ca(Na.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Vv(e,t){if((e=(0,ui.m9)(e)).firestore!==t)throw new Ca(Na.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class jv extends Lv{constructor(e){super(),this.firestore=e}convertBytes(e){return new Vg(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Eg(this.firestore,null,t)}}function Hv(e,t,n){e=Zg(e,Eg);const i=Zg(e.firestore,Pg),r=Jv(e.converter,t,n);return zv(i,[ev(Xg(i),"setDoc",e._key,r,null!==e.converter,n).toMutation(e._key,Nc.none())])}function $v(e,t,n,...i){e=Zg(e,Eg);const r=Zg(e.firestore,Pg),s=Xg(r);let o;return o="string"==typeof(t=(0,ui.m9)(t))||t instanceof Qg?lv(s,"updateDoc",e._key,t,n,i):av(s,"updateDoc",e._key,t),zv(r,[o.toMutation(e._key,Nc.exists(!0))])}function Bv(e,...t){var n,i,r;e=(0,ui.m9)(e);let o={includeMetadataChanges:!1},a=0;"object"!=typeof t[a]||Mg(t[a])||(o=t[a],a++);const l={includeMetadataChanges:o.includeMetadataChanges};if(Mg(t[a])){const e=t[a];t[a]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[a+1]=null===(i=e.error)||void 0===i?void 0:i.bind(e),t[a+2]=null===(r=e.complete)||void 0===r?void 0:r.bind(e)}let c,u,d;if(e instanceof Eg)u=Zg(e.firestore,Pg),d=Kl(e._key.path),c={next:n=>{t[a]&&t[a](Gv(u,e,n))},error:t[a+1],complete:t[a+2]};else{const n=Zg(e,qg);u=Zg(n.firestore,Pg),d=n._query;const i=new jv(u);c={next:e=>{t[a]&&t[a](new Av(u,i,n,e))},error:t[a+1],complete:t[a+2]},Ev(e._query)}return function(e,t,n,i){const r=new zf(i),o=new Lm(t,r,n);return e.asyncQueue.enqueueAndForget((0,s.Z)(function*(){return Rm(yield hg(e),o)})),()=>{r.Xo(),e.asyncQueue.enqueueAndForget((0,s.Z)(function*(){return km(yield hg(e),o)}))}}(Fg(u),d,l,c)}function zv(e,t){return function(e,t){const n=new Da;return e.asyncQueue.enqueueAndForget((0,s.Z)(function*(){return function(e,t,n){return rf.apply(this,arguments)}(yield dg(e),t,n)})),n.promise}(Fg(e),t)}function Gv(e,t,n){const i=n.docs.get(t._key),r=new jv(e);return new bv(e,r,t._key,i,new wv(n.hasPendingWrites,n.fromCache),t.converter)}class Wv extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Xg(e)}get(e){const t=Vv(e,this._firestore),n=new Yv(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return Sa();const i=e[0];if(i.isFoundDocument())return new _v(this._firestore,n,i.key,i,t.converter);if(i.isNoDocument())return new _v(this._firestore,n,t._key,null,t.converter);throw Sa()})}set(e,t,n){const i=Vv(e,this._firestore),r=Jv(i.converter,t,n),s=ev(this._dataReader,"Transaction.set",i._key,r,null!==i.converter,n);return this._transaction.set(i._key,s),this}update(e,t,n,...i){const r=Vv(e,this._firestore);let s;return s="string"==typeof(t=(0,ui.m9)(t))||t instanceof Qg?lv(this._dataReader,"Transaction.update",r._key,t,n,i):av(this._dataReader,"Transaction.update",r._key,t),this._transaction.update(r._key,s),this}delete(e){const t=Vv(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Vv(e,this._firestore),n=new jv(this._firestore);return super.get(e).then(e=>new bv(this._firestore,n,t._key,e._document,new wv(!1,!1),t.converter))}}function Kv(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Ca("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function Xv(){if("undefined"==typeof Uint8Array)throw new Ca("unimplemented","Uint8Arrays are not available in this environment.")}function ey(){if("undefined"==typeof atob)throw new Ca("unimplemented","Blobs are unavailable in Firestore in this environment.")}Ta=ai.SDK_VERSION,(0,ai._registerComponent)(new li.wA("firestore",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=new Pg(n,new Ma(e.getProvider("auth-internal")));return t=Object.assign({useFetchStreams:!0},t),i._setSettings(t),i},"PUBLIC")),(0,ai.registerVersion)("@firebase/firestore","3.0.0",void 0);class ty{constructor(e){this._delegate=e}static fromBase64String(e){return ey(),new ty(Vg.fromBase64String(e))}static fromUint8Array(e){return Xv(),new ty(Vg.fromUint8Array(e))}toBase64(){return ey(),this._delegate.toBase64()}toUint8Array(){return Xv(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function ny(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const i of["next","error","complete"])if(i in n&&"function"==typeof n[i])return!0;return!1}(e)}class iy{enableIndexedDbPersistence(e,t){return function(e,t){Yg(e=Zg(e,Pg));const n=Fg(e),i=e._freezeSettings(),r=new $f;return Jg(n,r,new jf(r,i.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){Yg(e=Zg(e,Pg));const t=Fg(e),n=e._freezeSettings(),i=new $f;return Jg(t,i,new Hf(i,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new Ca(Na.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Da;return e._queue.enqueueAndForgetEvenWhileRestricted((0,s.Z)(function*(){try{yield(n=(0,s.Z)(function*(e){if(!Zd.Pt())return Promise.resolve();const t=e+"main";yield Zd.delete(t)}),function(e){return n.apply(this,arguments)})(Mh(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}var n})),t.promise}(e._delegate)}}class ry{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof vg||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||Aa("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(e,t,n,i={}){var r;const s=(e=Zg(e,Sg))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&Aa("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),i.mockUserToken){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=_a.MOCK_USER;else{t=(0,ui.Sg)(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);const s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new Ca(Na.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new _a(s)}e._credentials=new ka(new Ra(t,n))}}(this._delegate,e,t,n)}enableNetwork(){return function(e){return e.asyncQueue.enqueue((0,s.Z)(function*(){const t=yield lg(e),n=yield ug(e);return t.setNetworkEnabled(!0),function(e){const t=qa(e);return t.Kr.delete(0),Jp(t)}(n)}))}(Fg(Zg(this._delegate,Pg)))}disableNetwork(){return function(e){return e.asyncQueue.enqueue((0,s.Z)(function*(){const t=yield lg(e),n=yield ug(e);return t.setNetworkEnabled(!1),(i=(0,s.Z)(function*(e){const t=qa(e);t.Kr.add(0),yield Qp(t),t.Wr.set("Offline")}),function(e){return i.apply(this,arguments)})(n);var i}))}(Fg(Zg(this._delegate,Pg)))}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Tg("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(e){const t=new Da;return e.asyncQueue.enqueueAndForget((0,s.Z)(function*(){return function(e,t){return mf.apply(this,arguments)}(yield dg(e),t)})),t.promise}(Fg(Zg(this._delegate,Pg)))}onSnapshotsInSync(e){return t=e,function(e,t){const n=new zf(t);return e.asyncQueue.enqueueAndForget((0,s.Z)(function*(){return function(e,t){qa(e).Zr.add(t),t.next()}(yield hg(e),n)})),()=>{n.Xo(),e.asyncQueue.enqueueAndForget((0,s.Z)(function*(){return function(e,t){qa(e).Zr.delete(t)}(yield hg(e),n)}))}}(Fg(Zg(this._delegate,Pg)),Mg(t)?t:{next:t});var t}get app(){if(!this._appCompat)throw new Ca("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new yy(this,Cg(this._delegate,e))}catch(t){throw uy(t,"collection()","Firestore.collection()")}}doc(e){try{return new cy(this,Dg(this._delegate,e))}catch(t){throw uy(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new fy(this,function(e,t){if(e=Zg(e,Sg),_g("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new Ca(Na.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new qg(e,null,function(e){return new Gl(Wa.emptyPath(),e)}(t))}(this._delegate,e))}catch(t){throw uy(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return n=t=>e(new oy(this,t)),function(e,t){const n=new Da;return e.asyncQueue.enqueueAndForget((0,s.Z)(function*(){const i=yield function(e){return og(e).then(e=>e.datastore)}(e);new Kf(e.asyncQueue,i,t,n).run()})),n.promise}(Fg(t=this._delegate),e=>n(new Wv(t,e)));var t,n}batch(){return Fg(this._delegate),new ay(new Qv(this._delegate,e=>zv(this._delegate,e)))}loadBundle(e){return function(e,t){const n=Fg(e=Zg(e,Pg)),i=new Ug;return function(e,t,n,i){const r=function(e,t){let n;return n="string"==typeof e?(new TextEncoder).encode(e):e,function(e,t){return new Gf(e,t)}(function(e,t){if(e instanceof Uint8Array)return Bf(e,t);if(e instanceof ArrayBuffer)return Bf(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,Rp(t));e.asyncQueue.enqueueAndForget((0,s.Z)(function*(){!function(e,t,n){const i=qa(e);var r;(r=(0,s.Z)(function*(e,t,n){try{const i=yield t.getMetadata();if(yield function(e,t){const n=qa(e),i=Iu(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Je.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(i)>=0)}(e.localStore,i))return yield t.close(),void n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(i));n._updateProgress(Vm(i));const r=new Qm(i,e.localStore,t.N);let s=yield t.Qo();for(;s;){const e=yield r.fo(s);e&&n._updateProgress(e),s=yield t.Qo()}const o=yield r.complete();yield wf(e,o.Tn,void 0),yield function(e,t){const n=qa(e);return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Je.saveBundleMetadata(e,t))}(e.localStore,i),n._completeWith(o.progress)}catch(e){Aa("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e)}}),function(e,t,n){return r.apply(this,arguments)})(i,t,n).then(()=>{i.sharedClientState.notifyBundleLoaded()})}(yield dg(e),r,i)}))}(n,e._databaseId,t,i),i}(this._delegate,e)}namedQuery(e){return(t=this._delegate,n=e,function(e,t){return e.asyncQueue.enqueue((0,s.Z)(function*(){return function(e,t){const n=qa(e);return n.persistence.runTransaction("Get named query","readonly",e=>n.Je.getNamedQuery(e,t))}(yield cg(e),t)}))}(Fg(t=Zg(t,Pg)),n).then(e=>e?new qg(t,null,e.query):null)).then(e=>e?new fy(this,e):null);var t,n}}class sy extends Lv{constructor(e){super(),this.firestore=e}convertBytes(e){return new ty(new Vg(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return cy.forKey(t,this.firestore,null)}}class oy{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new sy(e)}get(e){const t=_y(e);return this._delegate.get(t).then(e=>new py(this._firestore,new bv(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){const i=_y(e);return n?(Kv("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const r=_y(e);return 2===arguments.length?this._delegate.update(r,t):this._delegate.update(r,t,n,...i),this}delete(e){const t=_y(e);return this._delegate.delete(t),this}}class ay{constructor(e){this._delegate=e}set(e,t,n){const i=_y(e);return n?(Kv("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const r=_y(e);return 2===arguments.length?this._delegate.update(r,t):this._delegate.update(r,t,n,...i),this}delete(e){const t=_y(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class ly{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new Zv(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new my(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=ly.INSTANCES;let i=n.get(e);i||(i=new WeakMap,n.set(e,i));let r=i.get(t);return r||(r=new ly(e,new sy(e),t),i.set(t,r)),r}}ly.INSTANCES=new WeakMap;class cy{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new sy(e)}static forPath(e,t,n){if(e.length%2!=0)throw new Ca("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new cy(t,new Eg(t._delegate,n,new hl(e)))}static forKey(e,t,n){return new cy(t,new Eg(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new yy(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new yy(this.firestore,Cg(this._delegate,e))}catch(t){throw uy(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,ui.m9)(e))instanceof Eg&&Rg(this._delegate,e)}set(e,t){t=Kv("DocumentReference.set",t);try{return t?Hv(this._delegate,e,t):Hv(this._delegate,e)}catch(n){throw uy(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?$v(this._delegate,e):$v(this._delegate,e,t,...n)}catch(i){throw uy(i,"updateDoc()","DocumentReference.update()")}}delete(){return zv(Zg((e=this._delegate).firestore,Pg),[new Qc(e._key,Nc.none())]);var e}onSnapshot(...e){const t=dy(e),n=hy(e,e=>new py(this.firestore,new bv(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return Bv(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=Zg(e,Eg);const t=Zg(e.firestore,Pg),n=Fg(t),i=new jv(t);return function(e,t){const n=new Da;return e.asyncQueue.enqueueAndForget((0,s.Z)(function*(){return(i=(0,s.Z)(function*(e,t,n){try{const i=yield function(e,t){const n=qa(e);return n.persistence.runTransaction("read document","readonly",e=>n.Qn.An(e,t))}(e,t);i.isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new Ca(Na.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const i=Sm(e,`Failed to get document '${t} from cache`);n.reject(i)}}),function(e,t,n){return i.apply(this,arguments)})(yield cg(e),t,n);var i})),n.promise}(n,e._key).then(n=>new bv(t,i,e._key,n,new wv(null!==n&&n.hasLocalMutations,!0),e.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Zg(e,Eg);const t=Zg(e.firestore,Pg);return mg(Fg(t),e._key,{source:"server"}).then(n=>Gv(t,e,n))}(this._delegate):function(e){e=Zg(e,Eg);const t=Zg(e.firestore,Pg);return mg(Fg(t),e._key).then(n=>Gv(t,e,n))}(this._delegate),t.then(e=>new py(this.firestore,new bv(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new cy(this.firestore,this._delegate.withConverter(e?ly.getInstance(this.firestore,e):null))}}function uy(e,t,n){return e.message=e.message.replace(t,n),e}function dy(e){for(const t of e)if("object"==typeof t&&!ny(t))return t;return{}}function hy(e,t){var n,i;let r;return r=ny(e[0])?e[0]:ny(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{r.next&&r.next(t(e))},error:null===(n=r.error)||void 0===n?void 0:n.bind(r),complete:null===(i=r.complete)||void 0===i?void 0:i.bind(r)}}class py{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new cy(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Sv(this._delegate,e._delegate)}}class my extends py{data(e){const t=this._delegate.data(e);return void 0!==t||Sa(),t}}class fy{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new sy(e)}where(e,t,n){try{return new fy(this.firestore,Nv(this._delegate,function(e,t,n){const i=t,r=xv("where",e);return new Cv(r,i,n)}(e,t,n)))}catch(i){throw uy(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new fy(this.firestore,Nv(this._delegate,function(e,t="asc"){const n=t,i=xv("orderBy",e);return new Dv(i,n)}(e,t)))}catch(n){throw uy(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new fy(this.firestore,Nv(this._delegate,(Ag("limit",t=e),new Rv("limit",t,"F"))))}catch(n){throw uy(n,"limit()","Query.limit()")}var t}limitToLast(e){try{return new fy(this.firestore,Nv(this._delegate,(Ag("limitToLast",t=e),new Rv("limitToLast",t,"L"))))}catch(n){throw uy(n,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new fy(this.firestore,Nv(this._delegate,function(...e){return new Ov("startAt",e,!0)}(...e)))}catch(t){throw uy(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new fy(this.firestore,Nv(this._delegate,function(...e){return new Ov("startAfter",e,!1)}(...e)))}catch(t){throw uy(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new fy(this.firestore,Nv(this._delegate,function(...e){return new kv("endBefore",e,!0)}(...e)))}catch(t){throw uy(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new fy(this.firestore,Nv(this._delegate,function(...e){return new kv("endAt",e,!1)}(...e)))}catch(t){throw uy(t,"endAt()","Query.endAt()")}}isEqual(e){return Og(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=Zg(e,qg);const t=Zg(e.firestore,Pg),n=Fg(t),i=new jv(t);return function(e,t){const n=new Da;return e.asyncQueue.enqueueAndForget((0,s.Z)(function*(){return(i=(0,s.Z)(function*(e,t,n){try{const i=yield Xh(e,t,!0),r=new $m(t,i.Gn),s=r.Io(i.documents),o=r.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const i=Sm(e,`Failed to execute query '${t} against cache`);n.reject(i)}}),function(e,t,n){return i.apply(this,arguments)})(yield cg(e),t,n);var i})),n.promise}(n,e._query).then(n=>new Av(t,i,e,n))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Zg(e,qg);const t=Zg(e.firestore,Pg),n=Fg(t),i=new jv(t);return fg(n,e._query,{source:"server"}).then(n=>new Av(t,i,e,n))}(this._delegate):function(e){e=Zg(e,qg);const t=Zg(e.firestore,Pg),n=Fg(t),i=new jv(t);return Ev(e._query),fg(n,e._query).then(n=>new Av(t,i,e,n))}(this._delegate),t.then(e=>new vy(this.firestore,new Av(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){const t=dy(e),n=hy(e,e=>new vy(this.firestore,new Av(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return Bv(this._delegate,t,n)}withConverter(e){return new fy(this.firestore,this._delegate.withConverter(e?ly.getInstance(this.firestore,e):null))}}class gy{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new my(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class vy{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new fy(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new my(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new gy(this._firestore,e))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new my(this._firestore,n))})}isEqual(e){return Sv(this._delegate,e._delegate)}}class yy extends fy{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new cy(this.firestore,e):null}doc(e){try{return new cy(this.firestore,void 0===e?Dg(this._delegate):Dg(this._delegate,e))}catch(t){throw uy(t,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Zg(e.firestore,Pg),i=Dg(e),r=Jv(e.converter,t);return zv(n,[ev(Xg(e.firestore),"addDoc",i._key,r,null!==e.converter,{}).toMutation(i._key,Nc.exists(!1))]).then(()=>i)}(this._delegate,e).then(e=>new cy(this.firestore,e))}isEqual(e){return Rg(this._delegate,e._delegate)}withConverter(e){return new yy(this.firestore,this._delegate.withConverter(e?ly.getInstance(this.firestore,e):null))}}function _y(e){return Zg(e,Eg)}class Ty{constructor(...e){this._delegate=new Qg(...e)}static documentId(){return new Ty(Xa.keyField().canonicalString())}isEqual(e){return(e=(0,ui.m9)(e))instanceof Qg&&this._delegate._internalPath.isEqual(e._internalPath)}}class xy{constructor(e){this._delegate=e}static serverTimestamp(){const e=new iv("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new xy(e)}static delete(){const e=new tv("deleteField");return e._methodName="FieldValue.delete",new xy(e)}static arrayUnion(...e){const t=function(...e){return new rv("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new xy(t)}static arrayRemove(...e){const t=function(...e){return new sv("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new xy(t)}static increment(e){const t=new ov("increment",e);return t._methodName="FieldValue.increment",new xy(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const wy={Firestore:ry,GeoPoint:Hg,Timestamp:ja,Blob:ty,Transaction:oy,WriteBatch:ay,DocumentReference:cy,DocumentSnapshot:py,Query:fy,QueryDocumentSnapshot:my,QuerySnapshot:vy,CollectionReference:yy,FieldPath:Ty,FieldValue:xy,setLogLevel:function(e){xa.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};var by,Zy;Zy=(e,t)=>new ry(e,t,new iy),(by=oi.Z).INTERNAL.registerComponent(new li.wA("firestore-compat",e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return Zy(t,n)},"PUBLIC").setServiceProps(Object.assign({},wy))),by.registerVersion("@firebase/firestore-compat","0.1.0");var Ay=n(66682),Iy=n(43190),Sy=n(47349),Ey=n(28049);function qy(e,t){return t?(0,Iy.w)(()=>e,t):(0,Iy.w)(()=>e)}var Ny=n(49673);const Cy=new p.OlP("angularfire2.auth.use-emulator"),Dy=new p.OlP("angularfire2.auth.settings"),Ry=new p.OlP("angularfire2.auth.tenant-id"),Oy=new p.OlP("angularfire2.auth.langugage-code"),ky=new p.OlP("angularfire2.auth.use-device-language"),My=new p.OlP("angularfire.auth.persistence");let Uy=(()=>{class e{constructor(e,t,r,s,o,a,l,c,d,h,p){const m=new wn.xQ,f=(0,u.of)(void 0).pipe((0,ri.QV)(o.outsideAngular),(0,Iy.w)(()=>s.runOutsideAngular(()=>Promise.resolve().then(n.bind(n,26300)))),(0,ei.U)(()=>(0,si.on)(e,s,t)),(0,ei.U)(e=>s.runOutsideAngular(()=>{const t=a,n=l;return(0,Wn.cc)(`${e.name}.auth`,"AngularFireAuth",e.name,()=>{const i=s.runOutsideAngular(()=>e.auth());if(t&&i.useEmulator(...t),c&&(i.tenantId=c),i.languageCode=d,h&&i.useDeviceLanguage(),n)for(const[e,t]of Object.entries(n))i.settings[e]=t;return p&&i.setPersistence(p),i},[t,c,d,h,n,p])})),(0,Sy.d)({bufferSize:1,refCount:!1}));if((0,i.PM)(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,u.of)(null);else{f.pipe((0,Ey.P)()).subscribe();const e=f.pipe((0,Iy.w)(e=>e.getRedirectResult().then(e=>e,()=>null)),Wn.iC,(0,Sy.d)({bufferSize:1,refCount:!1})),t=f.pipe((0,Iy.w)(e=>new zn.y(t=>({unsubscribe:s.runOutsideAngular(()=>e.onAuthStateChanged(e=>t.next(e),e=>t.error(e),()=>t.complete()))})))),n=f.pipe((0,Iy.w)(e=>new zn.y(t=>({unsubscribe:s.runOutsideAngular(()=>e.onIdTokenChanged(e=>t.next(e),e=>t.error(e),()=>t.complete()))}))));this.authState=e.pipe(qy(t),(0,Ny.R)(o.outsideAngular),(0,ri.QV)(o.insideAngular)),this.user=e.pipe(qy(n),(0,Ny.R)(o.outsideAngular),(0,ri.QV)(o.insideAngular)),this.idToken=this.user.pipe((0,Iy.w)(e=>e?(0,Gn.D)(e.getIdToken()):(0,u.of)(null))),this.idTokenResult=this.user.pipe((0,Iy.w)(e=>e?(0,Gn.D)(e.getIdTokenResult()):(0,u.of)(null))),this.credential=(0,Ay.T)(e,m,this.authState.pipe((0,ii.h)(e=>!e))).pipe((0,ei.U)(e=>(null==e?void 0:e.user)?e:null),(0,Ny.R)(o.outsideAngular),(0,ri.QV)(o.insideAngular))}return(0,si.pX)(this,f,s,{spy:{apply:(e,t,n)=>{(e.startsWith("signIn")||e.startsWith("createUser"))&&n.then(e=>m.next(e))}}})}}return e.\u0275fac=function(t){return new(t||e)(p.LFG(si.Dh),p.LFG(si.xv,8),p.LFG(p.Lbi),p.LFG(p.R0b),p.LFG(Wn.HU),p.LFG(Cy,8),p.LFG(Dy,8),p.LFG(Ry,8),p.LFG(Oy,8),p.LFG(ky,8),p.LFG(My,8))},e.\u0275prov=p.Yz7({token:e,factory:e.\u0275fac,providedIn:"any"}),e})(),Py=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=p.oAB({type:e}),e.\u0275inj=p.cJS({providers:[Uy]}),e})();function Fy(e,t){return function(e,t=Bn.z){return new zn.y(n=>{let i;return null!=t?t.schedule(()=>{i=e.onSnapshot({includeMetadataChanges:!0},n)}):i=e.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=i&&i()}})}(e,t)}function Ly(e,t){return Fy(e,t).pipe((0,ei.U)(e=>({payload:e,type:"query"})))}function Jy(e,t){return Ly(e,t).pipe((0,Kn.O)(void 0),(0,Xn.G)(),(0,ei.U)(([e,t])=>{const n=t.payload.docChanges(),i=n.map(e=>({type:e.type,payload:e}));return e&&JSON.stringify(e.payload.metadata)!==JSON.stringify(t.payload.metadata)&&t.payload.docs.forEach((t,r)=>{const s=n.find(e=>e.doc.ref.isEqual(t.ref)),o=null==e?void 0:e.payload.docs.find(e=>e.ref.isEqual(t.ref));s&&JSON.stringify(s.doc.metadata)===JSON.stringify(t.metadata)||!s&&o&&JSON.stringify(o.metadata)===JSON.stringify(t.metadata)||i.push({type:"modified",payload:{oldIndex:r,newIndex:r,type:"modified",doc:t}})}),i}))}function Yy(e,t,n){return Jy(e,n).pipe((0,ti.R)((e,n)=>function(e,t,n){return t.forEach(t=>{n.indexOf(t.type)>-1&&(e=function(e,t){switch(t.type){case"added":if(!e[t.newIndex]||!e[t.newIndex].doc.ref.isEqual(t.doc.ref))return Qy(e,t.newIndex,0,t);break;case"modified":if(null==e[t.oldIndex]||e[t.oldIndex].doc.ref.isEqual(t.doc.ref)){if(t.oldIndex!==t.newIndex){const n=e.slice();return n.splice(t.oldIndex,1),n.splice(t.newIndex,0,t),n}return Qy(e,t.newIndex,1,t)}break;case"removed":if(e[t.oldIndex]&&e[t.oldIndex].doc.ref.isEqual(t.doc.ref))return Qy(e,t.oldIndex,1)}return e}(e,t))}),e}(e,n.map(e=>e.payload),t),[]),(0,ni.x)(),(0,ei.U)(e=>e.map(e=>({type:e.type,payload:e}))))}function Qy(e,t,n,...i){const r=e.slice();return r.splice(t,n,...i),r}function Vy(e){return e&&0!==e.length||(e=["added","removed","modified"]),e}class jy{constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=Jy(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,ei.U)(t=>t.filter(t=>e.indexOf(t.type)>-1)))),t.pipe((0,Kn.O)(void 0),(0,Xn.G)(),(0,ii.h)(([e,t])=>t.length>0||!e),(0,ei.U)(([e,t])=>t),Wn.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,ti.R)((e,t)=>[...e,...t],[]))}snapshotChanges(e){const t=Vy(e);return Yy(this.query,t,this.afs.schedulers.outsideAngular).pipe(Wn.iC)}valueChanges(e={}){return Ly(this.query,this.afs.schedulers.outsideAngular).pipe((0,ei.U)(t=>t.payload.docs.map(t=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data())),Wn.iC)}get(e){return(0,Gn.D)(this.query.get(e)).pipe(Wn.f6)}add(e){return this.ref.add(e)}doc(e){return new Hy(this.ref.doc(e),this.afs)}}class Hy{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const n=this.ref.collection(e),{ref:i,query:r}=Ky(n,t);return new jy(i,r,this.afs)}snapshotChanges(){return Fy(this.ref,this.afs.schedulers.outsideAngular).pipe((0,Kn.O)(void 0),(0,Xn.G)(),(0,ei.U)(([e,t])=>t.exists?(null==e?void 0:e.exists)?{payload:t,type:"modified"}:{payload:t,type:"added"}:{payload:t,type:"removed"})).pipe(Wn.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,ei.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,Gn.D)(this.ref.get(e)).pipe((0,ri.QV)(this.afs.schedulers.insideAngular))}}class $y{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?Jy(this.query,this.afs.schedulers.outsideAngular).pipe((0,ei.U)(t=>t.filter(t=>e.indexOf(t.type)>-1)),(0,ii.h)(e=>e.length>0),Wn.iC):Jy(this.query,this.afs.schedulers.outsideAngular).pipe(Wn.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,ti.R)((e,t)=>[...e,...t],[]))}snapshotChanges(e){const t=Vy(e);return Yy(this.query,t,this.afs.schedulers.outsideAngular).pipe(Wn.iC)}valueChanges(e={}){return Ly(this.query,this.afs.schedulers.outsideAngular).pipe((0,ei.U)(t=>t.payload.docs.map(t=>e.idField?Object.assign({[e.idField]:t.id},t.data()):t.data())),Wn.iC)}get(e){return(0,Gn.D)(this.query.get(e)).pipe(Wn.f6)}}const By=new p.OlP("angularfire2.enableFirestorePersistence"),zy=new p.OlP("angularfire2.firestore.persistenceSettings"),Gy=new p.OlP("angularfire2.firestore.settings"),Wy=new p.OlP("angularfire2.firestore.use-emulator");function Ky(e,t=(e=>e)){return{query:t(e),ref:e}}let Xy=(()=>{class e{constructor(e,t,n,r,s,o,a,l,c,d,h,p,m,f,g,v){this.schedulers=a;const y=(0,si.on)(e,o,t),_=c;if(d){const e=p;(0,Wn.cc)(`${y.name}.auth`,"AngularFireAuth",y.name,()=>{const t=o.runOutsideAngular(()=>y.auth());if(h&&t.useEmulator(...h),m&&(t.tenantId=m),t.languageCode=f,g&&t.useDeviceLanguage(),e)for(const[n,i]of Object.entries(e))t.settings[n]=i;return v&&t.setPersistence(v),t},[h,m,f,g,e,v])}[this.firestore,this.persistenceEnabled$]=(0,Wn.cc)(`${y.name}.firestore`,"AngularFirestore",y.name,()=>{const e=o.runOutsideAngular(()=>y.firestore());if(r&&e.settings(r),_&&e.useEmulator(..._),n&&!(0,i.PM)(s)){const t=()=>{try{return(0,Gn.D)(e.enablePersistence(l||void 0).then(()=>!0,()=>!1))}catch(t){return"undefined"!=typeof console&&console.warn(t),(0,u.of)(!1)}};return[e,o.runOutsideAngular(t)]}return[e,(0,u.of)(!1)]},[r,_,n])}collection(e,t){let n;n="string"==typeof e?this.firestore.collection(e):e;const{ref:i,query:r}=Ky(n,t),s=this.schedulers.ngZone.run(()=>i);return new jy(s,r,this)}collectionGroup(e,t){const n=t||(e=>e),i=this.firestore.collectionGroup(e);return new $y(n(i),this)}doc(e){let t;t="string"==typeof e?this.firestore.doc(e):e;const n=this.schedulers.ngZone.run(()=>t);return new Hy(n,this)}createId(){return this.firestore.collection("_").doc().id}}return e.\u0275fac=function(t){return new(t||e)(p.LFG(si.Dh),p.LFG(si.xv,8),p.LFG(By,8),p.LFG(Gy,8),p.LFG(p.Lbi),p.LFG(p.R0b),p.LFG(Wn.HU),p.LFG(zy,8),p.LFG(Wy,8),p.LFG(Uy,8),p.LFG(Cy,8),p.LFG(Dy,8),p.LFG(Ry,8),p.LFG(Oy,8),p.LFG(ky,8),p.LFG(My,8))},e.\u0275prov=p.Yz7({token:e,factory:e.\u0275fac,providedIn:"any"}),e})(),e_=(()=>{class e{static enablePersistence(t){return{ngModule:e,providers:[{provide:By,useValue:!0},{provide:zy,useValue:t}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=p.oAB({type:e}),e.\u0275inj=p.cJS({providers:[Xy]}),e})();var t_=n(42120),n_=n(19602),i_=n(77526);let r_=(()=>{class e{constructor(e){this.el=e,this.permissionsCanShow=[],this.el.nativeElement.style.visibility="hidden",this.el.nativeElement.style.display="none"}set PermissionsShow(e){this.permissionsCanShow=e}set CurrentPermisson(e){this.currentPermission=e,this.setShow()}ngOnInit(){this.setShow()}setShow(){this.permissionsCanShow.includes(this.currentPermission)?(this.el.nativeElement.style.visibility="visible",this.el.nativeElement.style.display="block"):(this.el.nativeElement.style.visibility="hidden",this.el.nativeElement.style.display="none")}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(p.SBq))},e.\u0275dir=p.lG2({type:e,selectors:[["","appPermission",""]],inputs:{PermissionsShow:["appPermission","PermissionsShow"],CurrentPermisson:["currentPermission","CurrentPermisson"]}}),e})();function s_(e,t){1&e&&p._UZ(0,"mat-progress-bar",29)}function o_(e,t){1&e&&p._UZ(0,"mat-progress-bar",29)}function a_(e,t){if(1&e&&(p.TgZ(0,"mat-option",30),p.TgZ(1,"b"),p._uU(2),p.qZA(),p._uU(3),p.qZA()),2&e){const e=t.$implicit;p.Q6J("value",e.id),p.xp6(2),p.Oqu(e.name),p.xp6(1),p.hij(" | ",e.fullname," ")}}function l_(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"button",31),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).onSave()}),p._uU(1),p.qZA()}if(2&e){const e=p.oxw().$implicit,t=p.oxw();p.Q6J("disabled",t.form.invalid),p.xp6(1),p.hij(" ",e("SAVE")," ")}}function c_(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"span",3),p._uU(4),p.ALo(5,"date"),p.qZA(),p.TgZ(6,"button",4),p._UZ(7,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(8,"div",6),p.YNc(9,s_,1,0,"mat-progress-bar",7),p.YNc(10,o_,1,0,"mat-progress-bar",7),p.TgZ(11,"div",8),p.TgZ(12,"b"),p._uU(13),p.qZA(),p.qZA(),p.TgZ(14,"div",9),p.TgZ(15,"mat-form-field",10),p.TgZ(16,"mat-label"),p._uU(17),p.qZA(),p.TgZ(18,"input",11),p.NdJ("keyup",function(t){return p.CHM(e),p.oxw().onChange(t,"size")}),p.qZA(),p.qZA(),p.TgZ(19,"mat-form-field",12),p.TgZ(20,"mat-label"),p._uU(21),p.qZA(),p.TgZ(22,"mat-select",13),p.NdJ("selectionChange",function(t){return p.CHM(e),p.oxw().onChange(t,"unit")}),p.TgZ(23,"mat-option",14),p._uU(24),p.qZA(),p.TgZ(25,"mat-option",15),p._uU(26,"g/con"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(27,"div",16),p.TgZ(28,"mat-form-field",12),p.TgZ(29,"mat-label"),p._uU(30),p.qZA(),p.TgZ(31,"input",17),p.NdJ("keyup",function(t){return p.CHM(e),p.oxw().onChange(t,"quantity")})("input",function(t){return p.CHM(e),p.oxw().numberFormatQuantity.setValue(t.target.value)}),p.qZA(),p.qZA(),p.TgZ(32,"mat-form-field",12),p.TgZ(33,"mat-label"),p._uU(34),p.qZA(),p.TgZ(35,"input",18),p.NdJ("keyup",function(t){return p.CHM(e),p.oxw().onChange(t,"ratio")})("keypress",function(t){return p.CHM(e),p.oxw().validRatio(t)}),p.qZA(),p.qZA(),p.TgZ(36,"mat-form-field",12),p.TgZ(37,"mat-label"),p._uU(38),p.qZA(),p.TgZ(39,"input",19),p.NdJ("input",function(t){return p.CHM(e),p.oxw().numberFormatPrice.setValue(t.target.value)}),p.qZA(),p.qZA(),p.TgZ(40,"mat-form-field",12),p.TgZ(41,"mat-label"),p._uU(42),p.qZA(),p.TgZ(43,"input",20),p.NdJ("input",function(t){return p.CHM(e),p.oxw().numberFormatCost.setValue(t.target.value)}),p.qZA(),p.qZA(),p.TgZ(44,"mat-form-field",12),p.TgZ(45,"mat-label"),p._uU(46),p.qZA(),p._UZ(47,"input",21),p.TgZ(48,"mat-autocomplete",22,23),p.NdJ("optionSelected",function(t){return p.CHM(e),p.oxw().onSelect(t.option.value)}),p.YNc(50,a_,4,3,"mat-option",24),p.ALo(51,"async"),p.qZA(),p.qZA(),p.TgZ(52,"mat-form-field",12),p.TgZ(53,"mat-label"),p._uU(54),p.qZA(),p._UZ(55,"textarea",25),p.qZA(),p.qZA(),p.qZA(),p.TgZ(56,"div",26),p.YNc(57,l_,2,2,"button",27),p.TgZ(58,"button",28),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(59),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(49),i=p.oxw();p.xp6(4),p.AsE("",e("UPDATE_TITLE")," ",p.xi3(5,32,1e3*i.item.harvest_date,"dd-MM-YYYY"),""),p.xp6(2),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(1),p.Q6J("formGroup",i.form),p.xp6(1),p.Q6J("ngIf",i.loadingFlag.pending),p.xp6(1),p.Q6J("ngIf",i.savingFlag.pending),p.xp6(3),p.hij("T\u1ed5ng l\u01b0\u1ee3ng con gi\u1ed1ng ",i.totalSeed,""),p.xp6(4),p.Oqu(e("SIZE")),p.xp6(1),p.Q6J("placeholder",e("ENTER_SIZE")),p.xp6(3),p.Oqu(e("UNIT")),p.xp6(1),p.Q6J("placeholder",e("SELECT_UNIT")),p.xp6(2),p.hij("",e("PIECE"),"/kg"),p.xp6(6),p.hij("",e("QUANTITY")," (kg)"),p.xp6(1),p.Q6J("placeholder",e("ENTER_QUANTITY"))("value",i.numberFormatQuantity.fakeView),p.xp6(3),p.hij("",e("RATIO")," (%)"),p.xp6(1),p.Q6J("placeholder",e("ENTER_RATIO")),p.xp6(3),p.hij("",e("PRICE")," (\u0111)"),p.xp6(1),p.Q6J("placeholder",e("ENTER_PRICE"))("value",i.numberFormatPrice.fakeView),p.xp6(3),p.hij("",e("HARVEST_COST")," (\u0111)"),p.xp6(1),p.Q6J("placeholder",e("ENTER_COST"))("value",i.numberFormatCost.fakeView),p.xp6(3),p.Oqu(e("CUSTOMER")),p.xp6(1),p.Q6J("placeholder",e("ENTER_CUSTOMER"))("matAutocomplete",n),p.xp6(3),p.Q6J("ngForOf",p.lcZ(51,35,i.manufacturer$)),p.xp6(4),p.Oqu(e("NOTE")),p.xp6(1),p.Q6J("placeholder",e("NOTE")),p.xp6(2),p.Q6J("ngIf",i.data.index!=i.hehe),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let u_=(()=>{class e{constructor(e,t,n,i,r,s,l){this.alerService=e,this._formBuilder=t,this.pondService=n,this.dialogRef=i,this.data=r,this._translate=s,this.cd=l,this.loadingFlag=new a.E,this.savingFlag=new a.E,this.numberFormatPrice=new xn.y(""),this.numberFormatQuantity=new xn.y(""),this.numberFormatCost=new xn.y(""),this.convert=0,this.valueFromRatio=0,this.minDate=c()().subtract(180,"days"),this.maxDate=c()(),this.message="",this.form=new o.cw({method:new o.NI(""),harvest_quantity:new o.NI("",[o.kI.required]),harvest_price:new o.NI("",[o.kI.required]),harvest_size:new o.NI("",[o.kI.required]),buyer:new o.NI(""),buyer_id:new o.NI(0),harvest_cost:new o.NI(""),note:new o.NI(""),unit:new o.NI("con",[o.kI.required]),harvest_ratio:new o.NI("",[o.kI.min(1),o.kI.max(100),o.kI.required])})}ngOnInit(){var e=this;return(0,s.Z)(function*(){e.item=e.data.item,console.log(e.data.index),yield e.getInfomation(),e.minDate<e.pondService.seasonStartTime&&(e.minDate=e.pondService.seasonStartTime),e.form.controls.buyer.valueChanges.pipe((0,h.b)(300)).subscribe(t=>{e.form.controls.buyer_id.setValue(0),e.getListManufacturer(t)})})()}getInfomation(){var e=this;return(0,s.Z)(function*(){const t=yield e.pondService.reqSeasonCollectInfo(e.item.id).toPromise().catch(t=>{e.alerService.error(e._translate.translate("CONNECT_ERROR"))});t.data&&(e.item=t.data,e.buildForm()),console.log(e.item),e.totalQuantity=Math.round(e.item.harvest_quantity/(e.item.ratio/100)),e.totalSeed=Math.round(e.item.harvest_quantity/e.item.harvest_size*1e3*100/e.item.ratio)})()}getListManufacturer(e){e.length>=2&&(this.loadingFlag.setPending(!0),this.manufacturer$=this.pondService.searchManufacturer(e).pipe(e=>(this.message=0==e.length?this._translate.translate("SEASON.HARVEST_MOD.NO_INFO"):"",this.loadingFlag.setResult(!0),e)))}onSelect(e){this.manufacturer$.subscribe(t=>{t.forEach(t=>{t.id==e&&(this.buyerSelected=t,this.form.controls.buyer.setValue(t.fullname),this.form.controls.buyer_id.setValue(t.id))})})}buildForm(){this.numberFormatQuantity.setValue(this.item.harvest_quantity),this.numberFormatPrice.setValue(this.item.harvest_price),this.numberFormatCost.setValue(this.item.harvest_cost),this.form.patchValue({method:this.item.method,harvest_quantity:this.item.harvest_quantity,harvest_price:this.item.harvest_price,harvest_size:this.item.harvest_size,buyer:this.item.buyer,buyer_id:this.item.buyer_id,harvest_cost:this.item.harvest_cost,note:this.item.note,unit:"con",harvest_ratio:this.item.ratio})}onSave(){if(this.validateAllFormFields(this.form),this.form.invalid)return!1;"kg"==this.form.value.unit&&(this.form.value.harvest_size=(1e3/this.form.value.harvest_size).toFixed(2),this.form.value.unit="con"),this.savingFlag.setPending(!0),this.pondService.reqSeasonCollectEdit({method:this.form.value.method,quantity:this.form.value.harvest_quantity,price:this.form.value.harvest_price,buyer:this.form.value.buyer,buyer_id:this.form.value.buyer_id,harvest_cost:this.form.value.harvest_cost,note:this.form.value.note,unit:this.form.value.unit,harvest_ratio:this.form.value.harvest_ratio,size:this.form.value.harvest_size},this.item.id).subscribe(e=>{1==e.status?(this.alerService.success(e.message),this.dialogRef.close(this.form.value),this.savingFlag.setResult(!0)):(this.alerService.error(e.message),this.savingFlag.setResult(!1))},()=>{this.savingFlag.setResult(!1),this.alerService.error(this._translate.translate("CONNECT_ERROR"))})}validateAllFormFields(e){Object.keys(e.controls).forEach(t=>{const n=e.get(t);n instanceof o.NI?n.markAsTouched({onlySelf:!0}):n instanceof o.cw&&this.validateAllFormFields(n)})}onChange(e,t){switch(t){case"size":null!=e.target.value&&(this.totalQuantity=1e3/+this.form.controls.harvest_size.value*+this.totalSeed/1e3,console.log("kg"),"con"==this.form.value.unit&&(console.log("con"),this.totalQuantity=+this.totalSeed*+this.form.controls.harvest_size.value/1e3),this.form.patchValue({harvest_quantity:this.totalQuantity*(this.form.controls.harvest_ratio.value/100)}));break;case"ratio":let t=Math.round(this.totalQuantity*(e.target.value/100));this.numberFormatQuantity.setValue(t),this.valueFromRatio=t;break;case"quantity":this.ratioChange=Math.round(this.numberFormatQuantity.realValue/this.totalQuantity*100),this.form.controls.harvest_ratio.setValue(this.ratioChange),this.valueFromRatio=this.numberFormatQuantity.realValue;break;case"unit":console.log("size thay doi tu unit",e.value),this.form.patchValue("kg"==e.value?{harvest_size:(1/(this.form.controls.harvest_size.value/1e3)).toFixed(2)}:{harvest_size:1e3*Number(1/this.form.controls.harvest_size.value)})}}validRatio(e){const t=e.which;return!(t>58&&t<47)}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(f.c),p.Y36(o.qu),p.Y36(m.p),p.Y36(d.so),p.Y36(d.WI),p.Y36(g.Vn),p.Y36(p.sBO))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-season-harvest-edit"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"title","dialog-title"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto",3,"formGroup"],["mode","indeterminate",4,"ngIf"],[1,"flex","justify-center","mb-4","text-lg"],[1,"grid","grid-cols-2"],[1,"w-full","md:pr-2"],["matInput","","formControlName","harvest_size",3,"placeholder","keyup"],[1,"w-full"],["formControlName","unit",3,"placeholder","selectionChange"],["value","kg"],["value","con"],[1,"grid","grid-cols-1"],["matInput","","formControlName","harvest_quantity","required","",3,"placeholder","value","keyup","input"],["matInput","","formControlName","harvest_ratio","required","",3,"placeholder","keyup","keypress"],["matInput","","formControlName","harvest_price","required","",3,"placeholder","value","input"],["matInput","","formControlName","harvest_cost","required","",3,"placeholder","value","input"],["type","text","matInput","","formControlName","buyer",3,"placeholder","matAutocomplete"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","note",3,"placeholder"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary","class","mr-3",3,"disabled","click",4,"ngIf"],["mat-stroked-button","",3,"click"],["mode","indeterminate"],[3,"value"],["mat-flat-button","","color","primary",1,"mr-3",3,"disabled","click"]],template:function(e,t){1&e&&p.YNc(0,c_,60,37,"ng-container",0),2&e&&p.Q6J("translocoRead","SEASON.HARVEST_MOD")},directives:[g.KI,v.lW,d.ZT,y.Hw,o.JL,o.sg,i.O5,_.KE,_.hX,T.Nt,o.Fj,o.JJ,o.u,Z.gD,A.ey,o.Q7,w.ZL,w.XC,i.sg,I.pW],pipes:[i.uU,i.Ov],styles:[""]}),e})();function d_(e,t){1&e&&p._UZ(0,"mat-progress-bar",30)}function h_(e,t){1&e&&p._UZ(0,"mat-progress-bar",30)}function p_(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"mat-form-field",13),p.TgZ(1,"mat-label"),p._uU(2),p.qZA(),p.TgZ(3,"input",31),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw(2).validNo(t)}),p.qZA(),p.qZA()}if(2&e){const e=p.oxw().$implicit;p.xp6(2),p.Oqu(e("PRICE_PIECE")),p.xp6(1),p.Q6J("placeholder",e("ENTER_PRICE_PIECE"))}}function m_(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"mat-form-field",13),p.TgZ(1,"mat-label"),p._uU(2),p.qZA(),p.TgZ(3,"input",32),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw(2).validNo(t)}),p.qZA(),p.qZA()}if(2&e){const e=p.oxw().$implicit;p.xp6(2),p.Oqu(e("PRICE_KG")),p.xp6(1),p.Q6J("placeholder",e("ENTER_PRICE_KG"))}}function f_(e,t){if(1&e&&(p.TgZ(0,"mat-option",33),p.TgZ(1,"b"),p._uU(2),p.qZA(),p._uU(3),p.qZA()),2&e){const e=t.$implicit;p.Q6J("value",e.id),p.xp6(2),p.Oqu(e.name),p.xp6(1),p.hij(" | ",e.fullname," ")}}function g_(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.YNc(8,d_,1,0,"mat-progress-bar",7),p.YNc(9,h_,1,0,"mat-progress-bar",7),p.TgZ(10,"div",8),p.TgZ(11,"mat-form-field",9),p.TgZ(12,"mat-label"),p._uU(13),p.qZA(),p._UZ(14,"input",10),p._UZ(15,"mat-datepicker-toggle",11),p._UZ(16,"mat-datepicker",null,12),p.qZA(),p.TgZ(18,"mat-form-field",13),p.TgZ(19,"mat-label"),p._uU(20),p.qZA(),p.TgZ(21,"mat-select",14),p.TgZ(22,"mat-option",15),p._uU(23),p.qZA(),p.TgZ(24,"mat-option",16),p._uU(25,"Kg"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(26,"mat-form-field",9),p.TgZ(27,"mat-label"),p._uU(28),p.qZA(),p.TgZ(29,"input",17),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw().validNo(t)})("input",function(t){return p.CHM(e),p.oxw().numberFormatQuantity.setValue(t.target.value)}),p.qZA(),p.qZA(),p.YNc(30,p_,4,2,"mat-form-field",18),p.YNc(31,m_,4,2,"mat-form-field",18),p.TgZ(32,"mat-form-field",9),p.TgZ(33,"mat-label"),p._uU(34),p.qZA(),p._UZ(35,"input",19),p.qZA(),p.TgZ(36,"mat-form-field",13),p.TgZ(37,"mat-label"),p._uU(38),p.qZA(),p.TgZ(39,"input",20),p.NdJ("keypress",function(t){return p.CHM(e),p.oxw().validNo(t)}),p.qZA(),p.qZA(),p.qZA(),p.TgZ(40,"div",21),p.TgZ(41,"mat-form-field",13),p.TgZ(42,"mat-label"),p._uU(43),p.qZA(),p._UZ(44,"input",22),p.TgZ(45,"mat-autocomplete",23,24),p.NdJ("optionSelected",function(t){return p.CHM(e),p.oxw().onSelect(t.option.value)}),p.YNc(47,f_,4,3,"mat-option",25),p.ALo(48,"async"),p.qZA(),p.qZA(),p.TgZ(49,"mat-form-field",13),p.TgZ(50,"mat-label"),p._uU(51),p.qZA(),p._UZ(52,"textarea",26),p.qZA(),p.qZA(),p.qZA(),p.TgZ(53,"div",27),p.TgZ(54,"button",28),p.NdJ("click",function(){return p.CHM(e),p.oxw().onSave()}),p._uU(55),p.qZA(),p.TgZ(56,"button",29),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(57),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(17),i=p.MAs(46),r=p.oxw();p.xp6(4),p.Oqu(e("EDIT_TITLE")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(1),p.Q6J("formGroup",r.form),p.xp6(1),p.Q6J("ngIf",r.loadingFlag.pending),p.xp6(1),p.Q6J("ngIf",r.savingFlag.pending),p.xp6(4),p.Oqu(e("DATE")),p.xp6(1),p.Q6J("min",r.minDate)("max",r.maxDate.toDate())("matDatepicker",n),p.xp6(1),p.Q6J("for",n),p.xp6(5),p.Oqu(e("UNIT")),p.xp6(1),p.Q6J("placeholder",e("SELECT_UNIT")),p.xp6(2),p.Oqu(e("PIECES")),p.xp6(5),p.Oqu(e("QUANTITY")),p.xp6(1),p.Q6J("placeholder",e("ENTER_QUANTITY"))("value",r.numberFormatQuantity.fakeView),p.xp6(1),p.Q6J("ngIf","con"==r.form.controls.unit.value),p.xp6(1),p.Q6J("ngIf","kg"==r.form.controls.unit.value),p.xp6(3),p.Oqu(e("WEIGHT")),p.xp6(1),p.Q6J("placeholder",e("ENTER_WEIGHT")),p.xp6(3),p.Oqu(e("AGE")),p.xp6(1),p.Q6J("placeholder",e("ENTER_AGE")),p.xp6(4),p.Oqu(e("SUPPLIER")),p.xp6(1),p.Q6J("placeholder",e("ENTER_SUPPLIER"))("matAutocomplete",i),p.xp6(3),p.Q6J("ngForOf",p.lcZ(48,32,r.manufacturer$)),p.xp6(4),p.Oqu(e("NOTE")),p.xp6(1),p.Q6J("placeholder",e("NOTE")),p.xp6(2),p.Q6J("disabled",r.form.invalid),p.xp6(1),p.hij(" ",e("SAVE")," "),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let v_=(()=>{class e{constructor(e,t,n,i,r,s){this._formBuilder=e,this.pondService=t,this.dialogRef=n,this.data=i,this.alertService=r,this._translate=s,this.loadingFlag=new a.E,this.savingFlag=new a.E,this.numberFormatPrice=new xn.y(""),this.numberFormatQuantity=new xn.y(""),this.maxDate=c()(),this.searchTerms=new wn.xQ,this.message=""}ngOnInit(){this.item=this.data.item,console.log(this.item),this.item.seed_cost=parseFloat(this.item.seed_cost.toString().replace(",",".")),this.numberFormatQuantity.setValue(this.item.seed_quantity),this.numberFormatPrice.setValue(this.item.seed_cost),this.createForm(),this.form.controls.seed_supplier.valueChanges.pipe((0,h.b)(300)).subscribe(e=>{this.getListManufacturer(e)}),this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.pondService.getHistory().pipe().subscribe(e=>{0==e.status||(this.minDate=new Date(1e3*e.data[0].start_time))},e=>{})}search(e){this.searchTerms.next(e)}getListManufacturer(e){e.length>=2&&(this.loadingFlag.setPending(!0),this.manufacturer$=this.pondService.searchManufacturer(e).pipe(e=>(this.message=0==e.length?this._translate.translate("SEASON.HARVEST_MOD.NO_INFO"):"",this.loadingFlag.setResult(!0),e)))}createForm(){this.form=this._formBuilder.group({seed_quantity:[this.item.seed_quantity,o.kI.required],seed_quantity_individuals:[this.item.seed_quantity_individuals],seed_supplier:[this.item.supplier],seed_supplier_id:[this.item.supplier_id],seed_old:[this.item.seed_old],seed_cost:[this.item.seed_cost],seed_cost_individuals:[+this.item.seed_cost],seed_cost_kg:[""],seed_weight:[this.item.seed_weight],note:[this.item.note],seed_date:c()(1e3*this.item.seed_date).format("YYYY-MM-DD"),unit:["con"]})}onSave(){let e=!1,t={id:this.item.id,seed_quantity:this.numberFormatQuantity.realValue,seed_quantity_individuals:this.form.value.seed_quantity_individuals,seed_supplier:this.form.value.seed_supplier,seed_supplier_id:this.form.value.seed_supplier_id,seed_old:this.form.value.seed_old,seed_cost:this.form.value.seed_cost,seed_cost_individuals:this.form.value.seed_cost_individuals.toString().replace(",","."),seed_cost_kg:this.form.value.seed_cost_kg.toString().replace(",","."),seed_weight:this.form.value.seed_weight,note:this.form.value.note,seed_date:c()(this.form.value.seed_date).valueOf()/1e3,unit:this.form.value.unit};console.log(t.seed_quantity),console.log(this.form.controls.unit.value),"kg"==this.form.controls.unit.value?(console.log(this.form.controls.seed_weight.value),""!=this.form.controls.seed_weight.value?(t.seed_quantity_individuals=1e3*this.numberFormatQuantity.realValue/this.form.controls.seed_weight.value,t.seed_cost=parseFloat(this.form.controls.seed_cost_kg.value.toString())*this.form.controls.seed_weight.value/1e3):(this.form.controls.seed_weight.setValidators(o.kI.required),this.alertService.error(this._translate.translate("SEASON.SEED_MOD.UNIT_ERROR")),e=!0),this.form.controls.seed_cost_kg.setValidators(o.kI.required)):(t.seed_quantity_individuals=this.numberFormatQuantity.realValue,this.form.controls.seed_cost_individuals.setValidators(o.kI.required),t.seed_cost=this.form.value.seed_cost_individuals),0==e&&(this.savingFlag.setPending(!0),this.pondService.reqSeasonSeedEdit(t,this.item.id).subscribe(e=>{1==e.status?(this.alertService.success(e.message),this.savingFlag.setResult(!0),this.dialogRef.close(t),this.supplier=t):(this.alertService.error(e.error),console.log("error heheh"),this.savingFlag.setResult(!1))},()=>{this.savingFlag.setResult(!1),this.alertService.error(this._translate.translate("CONNECT_ERROR"))}))}onSelect(e){this.manufacturer$.subscribe(t=>{t.forEach(t=>{t.id==e&&(this.manufacturerSelected=t,this.form.controls.seed_supplier.setValue(t.fullname),this.form.controls.seed_supplier_id.setValue(t.id))})})}validNo(e){const t=e.which?e.which:e.keycode;return!(t>31&&(t<47||t>58))}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(o.qu),p.Y36(m.p),p.Y36(d.so),p.Y36(d.WI),p.Y36(f.c),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-season-seed-edit"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto",3,"formGroup"],["mode","indeterminate",4,"ngIf"],[1,"grid","grid-cols-2"],[1,"w-full","md:pr-2"],["matInput","","formControlName","seed_date",3,"min","max","matDatepicker"],["matSuffix","",3,"for"],["picker",""],[1,"w-full"],["formControlName","unit",3,"placeholder"],["value","con"],["value","kg"],["min","0","matInput","",3,"placeholder","value","keypress","input"],["class","w-full",4,"ngIf"],["min","0","matInput","","type","number","formControlName","seed_weight",3,"placeholder"],["min","0","matInput","","type","number","formControlName","seed_old",3,"placeholder","keypress"],[1,"grid","grid-cols-1"],["type","text","matInput","","formControlName","seed_supplier",3,"placeholder","matAutocomplete"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","note",3,"placeholder"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",3,"click"],["mode","indeterminate"],["min","0","matInput","","type","number","formControlName","seed_cost_individuals",3,"placeholder","keypress"],["min","0","matInput","","type","number","formControlName","seed_cost_kg",3,"placeholder","keypress"],[3,"value"]],template:function(e,t){1&e&&p.YNc(0,g_,58,34,"ng-container",0),2&e&&p.Q6J("translocoRead","SEASON.SEED_MOD")},directives:[g.KI,v.lW,d.ZT,y.Hw,o.JL,o.sg,i.O5,_.KE,_.hX,T.Nt,o.Fj,x.hl,o.JJ,o.u,x.nW,_.R9,x.Mq,Z.gD,A.ey,o.qQ,o.wV,w.ZL,w.XC,i.sg,I.pW],pipes:[i.Ov],styles:[""]}),e})();function y_(e,t){if(1&e&&(p.TgZ(0,"div",8),p.TgZ(1,"p"),p.TgZ(2,"small"),p.TgZ(3,"b"),p._uU(4),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&e){const e=p.oxw().$implicit;p.xp6(4),p.Oqu(e("STOCKING"))}}const __=function(){return["company_manager","farm_manager","pond_operator","pond_manager"]};function T_(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div",8),p.TgZ(1,"p"),p._uU(2),p.ALo(3,"date"),p.qZA(),p.TgZ(4,"p"),p._uU(5),p.ALo(6,"number"),p.qZA(),p.TgZ(7,"button",9),p.NdJ("click",function(){const t=p.CHM(e),n=t.$implicit,i=t.index;return p.oxw(2).presentSeedEdit(n,i)}),p._UZ(8,"mat-icon",4),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.oxw(2);p.xp6(2),p.Oqu(p.xi3(3,6,1e3*e.seed_date,"dd-MM")),p.xp6(3),p.Oqu(p.xi3(6,9,e.seed_quantity,"1.0-0")),p.xp6(2),p.Q6J("appPermission",p.DdM(12,__))("currentPermission",n.pondService.permission)("disabled",!e.id),p.xp6(1),p.Q6J("svgIcon","mat_solid:add_circle_outline")}}function x_(e,t){if(1&e&&(p.TgZ(0,"div",8),p.TgZ(1,"p"),p.TgZ(2,"b"),p.TgZ(3,"small"),p._uU(4),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&e){const e=p.oxw().$implicit;p.xp6(4),p.Oqu(e("HARVEST"))}}function w_(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"button",12),p.NdJ("click",function(){p.CHM(e);const t=p.oxw().$implicit,n=p.oxw(2);return n.presentHarvestEdit(t,n.hehe)}),p._UZ(1,"mat-icon",13),p.qZA()}if(2&e){const e=p.oxw(3);p.Q6J("currentPermission",e.pondService.permission)}}const b_=function(){return["company_manager","farm_manager","pond_manager"]};function Z_(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"button",14),p.NdJ("click",function(){p.CHM(e);const t=p.oxw(),n=t.$implicit,i=t.index;return p.oxw(2).presentHarvestEdit(n,i)}),p._UZ(1,"mat-icon",4),p.qZA()}if(2&e){const e=p.oxw(3);p.Q6J("appPermission",p.DdM(3,b_))("currentPermission",e.pondService.permission),p.xp6(1),p.Q6J("svgIcon","mat_solid:add_circle_outline")}}function A_(e,t){if(1&e&&(p.TgZ(0,"div",8),p.TgZ(1,"p"),p._uU(2),p.ALo(3,"date"),p.qZA(),p.TgZ(4,"p"),p._uU(5),p.ALo(6,"number"),p.qZA(),p.YNc(7,w_,2,1,"button",10),p.YNc(8,Z_,2,4,"button",11),p.qZA()),2&e){const e=t.$implicit;p.xp6(2),p.Oqu(p.xi3(3,4,1e3*e.harvest_date,"dd-MM")),p.xp6(3),p.Oqu(p.xi3(6,7,e.harvest_quantity,"1.0-0")),p.xp6(2),p.Q6J("ngIf",0!=e.disabledItem),p.xp6(1),p.Q6J("ngIf",0==e.disabledItem)}}function I_(e,t){if(1&e&&(p.TgZ(0,"div",8),p.TgZ(1,"p"),p.TgZ(2,"b"),p.TgZ(3,"small"),p._uU(4),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&e){const e=p.oxw().$implicit;p.xp6(4),p.Oqu(e("MOVE_POND"))}}function S_(e,t){1&e&&p._UZ(0,"mat-icon",16),2&e&&p.Q6J("svgIcon","iconsmind:arrow_insidegap45")}function E_(e,t){1&e&&p._UZ(0,"mat-icon",16),2&e&&p.Q6J("svgIcon","iconsmind:arrow_outsidegap45")}function q_(e,t){if(1&e&&(p.TgZ(0,"div",8),p.TgZ(1,"p"),p.YNc(2,S_,1,1,"mat-icon",15),p.YNc(3,E_,1,1,"mat-icon",15),p._uU(4),p.ALo(5,"date"),p.qZA(),p.TgZ(6,"p"),p._uU(7),p.ALo(8,"number"),p.qZA(),p.qZA()),2&e){const e=t.$implicit,n=p.oxw(2);p.xp6(2),p.Q6J("ngIf",e.from_season_code!==n.pondService.pond.current_season),p.xp6(1),p.Q6J("ngIf",e.from_season_code==n.pondService.pond.current_season),p.xp6(1),p.hij(" ",p.xi3(5,4,1e3*e.add_time,"dd-MM")," "),p.xp6(3),p.Oqu(p.xi3(8,7,e.quantity_individual,"1.0-0"))}}function N_(e,t){if(1&e&&(p.ynx(0),p.TgZ(1,"fuse-card",1),p.TgZ(2,"div",2),p.TgZ(3,"p",3),p._UZ(4,"mat-icon",4),p._uU(5),p.qZA(),p.qZA(),p.TgZ(6,"div",5),p.YNc(7,y_,5,1,"div",6),p.YNc(8,T_,9,13,"div",7),p.YNc(9,x_,5,1,"div",6),p.YNc(10,A_,9,10,"div",7),p.YNc(11,I_,5,1,"div",6),p.YNc(12,q_,9,10,"div",7),p.qZA(),p.qZA(),p.BQk()),2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Q6J("svgIcon","iconsmind:fish_food"),p.xp6(1),p.hij(" ",e("TITLE")," "),p.xp6(2),p.Q6J("ngIf",n.seedTimes.length>0),p.xp6(1),p.Q6J("ngForOf",n.seedTimes),p.xp6(1),p.Q6J("ngIf",n.harvestTimes.length>0),p.xp6(1),p.Q6J("ngForOf",n.harvestTimes),p.xp6(1),p.Q6J("ngIf",n.moveTimes.length>0),p.xp6(1),p.Q6J("ngForOf",n.moveTimes)}}let C_=(()=>{class e{constructor(e,t,n,i){this.pondService=e,this.alertService=t,this._matDialog=n,this._translate=i,this.loadingFlag=new a.E,this.message="",this.seedTimes=[],this.moveTimes=[],this.harvestTimes=[]}ngOnInit(){this.getData()}getData(){this.loadingFlag.setStart(!0),this.pondService.loadDependency().subscribe(e=>{var t;0==e.status?this.message=e.error:(this.harvestTimes=null===(t=e.data)||void 0===t?void 0:t.harvest,this.seedTimes=e.data.seed,this.moveTimes=e.data.move,this.harvestTimes.length>1?this.harvestTimes[this.harvestTimes.length-1].disabledItem="0":this.harvestTimes[0].disabledItem="0",console.log(this.harvestTimes[this.harvestTimes.length-1])),this.loadingFlag.setResult(!0)},()=>{this.message=this._translate.translate("CONNECT_ERROR"),this.loadingFlag.setResult(!1)})}presentSeedEdit(e,t){this._matDialog.open(v_,{width:"500px",data:{item:e,index:t}}).afterClosed().subscribe(e=>{e&&("kg"==e.unit&&(e.seed_quantity=e.seed_quantity_individuals),e.supplier=e.seed_supplier,e.supplier_id=e.seed_supplier_id,this.seedTimes[t]=e,console.log(this.seedTimes[t]),console.log(e))})}presentHarvestEdit(e,t){var n=this;return(0,s.Z)(function*(){n._matDialog.open(u_,{width:"500px",data:{item:e,index:t}}).afterClosed().subscribe(e=>{e&&(n.harvestTimes[t].harvest_quantity=new xn.y(e.harvest_quantity).realValue)})})()}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(f.c),p.Y36(d.uw),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-season-dashboard"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"grid","grid-cols-1","md:mr-2"],[1,"headerBox","season","p-3","flex","justify-between"],[1,"text-base","text-white","flex","items-center"],[1,"text-white","icon-size-5","mr-1",3,"svgIcon"],[1,"m-8","mb-4"],["class","flex items-center justify-between",4,"ngIf"],["class","flex items-center justify-between",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between"],["mat-icon-button","","color","primary",3,"appPermission","currentPermission","disabled","click"],["color","primary","mat-icon-button","",3,"currentPermission","click",4,"ngIf"],["mat-icon-button","","color","primary",3,"appPermission","currentPermission","click",4,"ngIf"],["color","primary","mat-icon-button","",3,"currentPermission","click"],["svgIcon","mat_outline:remove_red_eye",1,"text-white","icon-size-5","mr-1"],["mat-icon-button","","color","primary",3,"appPermission","currentPermission","click"],["class","icon-size-5",3,"svgIcon",4,"ngIf"],[1,"icon-size-5",3,"svgIcon"]],template:function(e,t){1&e&&p.YNc(0,N_,13,8,"ng-container",0),2&e&&p.Q6J("translocoRead","SEASON.DASHBOARD")},directives:[g.KI,n_.y,y.Hw,i.O5,i.sg,v.lW,i_.l,r_],pipes:[i.uU,i.JJ],styles:["[_nghost-%COMP%]   .headerBox[_ngcontent-%COMP%]{max-height:45px;height:100%}[_nghost-%COMP%]   .season[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,#0078d7,#3dc2ff)}[_nghost-%COMP%]   .demoChart[_ngcontent-%COMP%]{max-height:250px}[_nghost-%COMP%]   fuse-card[_ngcontent-%COMP%]{height:100%}"]}),e})();function D_(e,t){1&e&&p._UZ(0,"mat-progress-bar",21)}function R_(e,t){if(1&e&&(p.TgZ(0,"mat-option",22),p._uU(1),p.qZA()),2&e){const e=t.$implicit;p.Q6J("value",e),p.xp6(1),p.Oqu(e)}}function O_(e,t){if(1&e&&(p.TgZ(0,"mat-option",22),p._uU(1),p.qZA()),2&e){const e=t.$implicit;p.Q6J("value",e),p.xp6(1),p.Oqu(e)}}function k_(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.YNc(8,D_,1,0,"mat-progress-bar",7),p.TgZ(9,"div",8),p.TgZ(10,"mat-form-field",9),p._UZ(11,"input",10),p._UZ(12,"mat-datepicker-toggle",11),p._UZ(13,"mat-datepicker",null,12),p.qZA(),p.TgZ(15,"mat-form-field",13),p.TgZ(16,"mat-select",14),p.YNc(17,R_,2,2,"mat-option",15),p.qZA(),p.qZA(),p.TgZ(18,"mat-form-field",13),p.TgZ(19,"mat-select",16),p.YNc(20,O_,2,2,"mat-option",15),p.qZA(),p.qZA(),p.qZA(),p.TgZ(21,"div"),p.TgZ(22,"mat-form-field",9),p._UZ(23,"textarea",17),p.qZA(),p.qZA(),p.qZA(),p.TgZ(24,"div",18),p.TgZ(25,"button",19),p.NdJ("click",function(){return p.CHM(e),p.oxw().save()}),p._uU(26),p.qZA(),p.TgZ(27,"button",20),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(28),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(14),i=p.oxw();p.xp6(4),p.Oqu(e("ADD_TODO")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(1),p.Q6J("formGroup",i.form),p.xp6(1),p.Q6J("ngIf",i.savingFlag.pending),p.xp6(3),p.Q6J("min",i.minDate.toDate())("max",i.maxDate.toDate())("matDatepicker",n),p.xp6(1),p.Q6J("for",n),p.xp6(4),p.Q6J("placeholder",e("HOUR")),p.xp6(1),p.Q6J("ngForOf",i.hours),p.xp6(2),p.Q6J("placeholder",e("MINUTE")),p.xp6(1),p.Q6J("ngForOf",i.timeMinutes),p.xp6(3),p.Q6J("placeholder","Ghi ch\xfa"),p.xp6(2),p.Q6J("disabled",!i.form.valid),p.xp6(1),p.hij(" ",e("SAVE")," "),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let M_=(()=>{class e{constructor(e,t,n,i,r,s){this.pondService=e,this.calendarService=t,this.alertService=n,this.dialogRef=i,this._translate=r,this._formBuilder=s,this.savingFlag=new a.E,this.minDate=c()(),this.maxDate=c()().add(30,"days"),this.hours=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],this.timeMinutes=[0,5,10,15,20,25,30,35,40,45,50,55],this.today=new Date,this.form=new o.cw({})}ngOnInit(){this.validatorsForm()}validatorsForm(){this.form=this._formBuilder.group({date:[new Date,[o.kI.required]],timeHour:[this.today.getHours(),[o.kI.required]],timeMinute:[this.today.getMinutes()-this.today.getMinutes()%5+(this.today.getMinutes()%5==0?0:5),[o.kI.required]],content:new o.NI("",[o.kI.required])})}save(){let e=c()(this.form.value.date);if(e.set({hour:this.form.value.timeHour,minute:this.form.value.timeMinute}),this.form.value.date<this.minDate.format("YYYY-MM-DD"))return this.alertService.error(this._translate.translate("TODO_PASSED_TIME")),!1;let t={content:this.form.value.content,date:e.format("YYYY-MM-DD"),time:e,pond_id:this.pondService.pcode,done:!1};this.savingFlag.setPending(!0),this.calendarService.insertCalendar(t).subscribe(n=>{n.error||1!=n.status?this.alertService.error(n.error):(this.alertService.success(this._translate.translate("TODO.ADD_SUCCESS")),e.format("YYYY-MM-DD")==this.minDate.format("YYYY-MM-DD")?this.dialogRef.close(t):this.dialogRef.close()),this.savingFlag.setResult(!0)},e=>{this.savingFlag.setResult(!1),this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(Ne.o),p.Y36(f.c),p.Y36(d.so),p.Y36(g.Vn),p.Y36(o.qu))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-todo-add"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto",3,"formGroup"],["mode","indeterminate",4,"ngIf"],[1,"grid","md:grid-cols-3","sm:grid-cols-1"],[1,"w-full"],["matInput","","formControlName","date",3,"min","max","matDatepicker"],["matSuffix","",3,"for"],["picker",""],[1,"w-full","md:pr-1"],["formControlName","timeHour","required","",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["formControlName","timeMinute","required","",3,"placeholder"],["matInput","","required","","formControlName","content",3,"placeholder"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",3,"click"],["mode","indeterminate"],[3,"value"]],template:function(e,t){1&e&&p.YNc(0,k_,29,17,"ng-container",0),2&e&&p.Q6J("translocoRead","TODO")},directives:[g.KI,v.lW,d.ZT,y.Hw,o.JL,o.sg,i.O5,_.KE,T.Nt,o.Fj,x.hl,o.JJ,o.u,x.nW,_.R9,x.Mq,Z.gD,o.Q7,i.sg,I.pW,A.ey],styles:[""]}),e})();function U_(e,t){1&e&&p._UZ(0,"mat-progress-bar",21)}function P_(e,t){if(1&e&&(p.TgZ(0,"mat-option",22),p._uU(1),p.qZA()),2&e){const e=t.$implicit;p.Q6J("value",e),p.xp6(1),p.Oqu(e)}}function F_(e,t){if(1&e&&(p.TgZ(0,"mat-option",22),p._uU(1),p.qZA()),2&e){const e=t.$implicit;p.Q6J("value",e),p.xp6(1),p.Oqu(e)}}function L_(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.YNc(8,U_,1,0,"mat-progress-bar",7),p.TgZ(9,"div",8),p.TgZ(10,"mat-form-field",9),p._UZ(11,"input",10),p._UZ(12,"mat-datepicker-toggle",11),p._UZ(13,"mat-datepicker",null,12),p.qZA(),p.TgZ(15,"mat-form-field",13),p.TgZ(16,"mat-select",14),p.YNc(17,P_,2,2,"mat-option",15),p.qZA(),p.qZA(),p.TgZ(18,"mat-form-field",13),p.TgZ(19,"mat-select",16),p.YNc(20,F_,2,2,"mat-option",15),p.qZA(),p.qZA(),p.qZA(),p.TgZ(21,"div"),p.TgZ(22,"mat-form-field",9),p._UZ(23,"textarea",17),p.qZA(),p.qZA(),p.qZA(),p.TgZ(24,"div",18),p.TgZ(25,"button",19),p.NdJ("click",function(){return p.CHM(e),p.oxw().save()}),p._uU(26),p.qZA(),p.TgZ(27,"button",20),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(28),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(14),i=p.oxw();p.xp6(4),p.Oqu(e("UPDATE_TODO")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(1),p.Q6J("formGroup",i.form),p.xp6(1),p.Q6J("ngIf",i.savingFlag.pending),p.xp6(3),p.Q6J("min",i.minDate.toDate())("max",i.maxDate.toDate())("matDatepicker",n),p.xp6(1),p.Q6J("for",n),p.xp6(4),p.Q6J("placeholder",e("HOUR")),p.xp6(1),p.Q6J("ngForOf",i.timeHours),p.xp6(2),p.Q6J("placeholder",e("MINUTE")),p.xp6(1),p.Q6J("ngForOf",i.timeMinutes),p.xp6(3),p.Q6J("placeholder","Ghi ch\xfa"),p.xp6(2),p.Q6J("disabled",!i.form.valid),p.xp6(1),p.hij(" ",e("SAVE")," "),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let J_=(()=>{class e{constructor(e,t,n,i,r,s){this.pondService=e,this.calendarService=t,this.alertService=n,this.dialogRef=i,this.data=r,this._translate=s,this.savingFlag=new a.E,this.minDate=c()(),this.maxDate=c()().add(10,"days"),this.timeMinutes=[0,5,10,15,20,25,30,35,40,45,50,55],this.timeHours=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],this.form=new o.cw({date:new o.NI(c()().format("YYYY-MM-DD"),o.kI.required),hour:new o.NI(c()().format("HH"),o.kI.required),minute:new o.NI(c()().format("mm"),o.kI.required),content:new o.NI("",[o.kI.required])})}ngOnInit(){this.validatorList()}validatorList(){this.form.setValue({date:c()(this.data.time._d).format("YYYY-MM-DD"),hour:parseInt(c()(this.data.time._d).format("HH")),minute:parseInt(c()(this.data.time._d).format("mm")),content:this.data.content})}save(){let e=c()(this.form.value.date);if(e.set({hour:this.form.value.hour,minute:this.form.value.minute}),this.form.value.date<this.minDate.format("YYYY-MM-DD"))return this.alertService.error(this._translate.translate("TODO_PASSED_TIME")),!1;let t={content:this.form.value.content,date:e.format("YYYY-MM-DD"),time:e,pond_id:this.pondService.pcode,done:!1,edit_time:e};this.calendarService.updateCalendar(this.data.id,t).subscribe(n=>{n.error||1!=n.status?this.alertService.error(n.error):(this.alertService.success(this._translate.translate("UPDATE_SUCCESS")),e.format("YYYY-MM-DD")>=this.minDate.format("YYYY-MM-DD")?this.dialogRef.close(t):this.dialogRef.close()),this.savingFlag.setResult(!0)},e=>{this.savingFlag.setResult(!1),this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(Ne.o),p.Y36(f.c),p.Y36(d.so),p.Y36(d.WI),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-todo-update"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-260","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary","mb-5"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto",3,"formGroup"],["mode","indeterminate",4,"ngIf"],[1,"grid","md:grid-cols-3","sm:grid-cols-1"],[1,"w-full"],["matInput","","formControlName","date",3,"min","max","matDatepicker"],["matSuffix","",3,"for"],["picker",""],[1,"w-full","md:pr-1"],["formControlName","hour","required","",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["formControlName","minute","required","",3,"placeholder"],["matInput","","required","","formControlName","content",3,"placeholder"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",3,"click"],["mode","indeterminate"],[3,"value"]],template:function(e,t){1&e&&p.YNc(0,L_,29,17,"ng-container",0),2&e&&p.Q6J("translocoRead","TODO")},directives:[g.KI,v.lW,d.ZT,y.Hw,o.JL,o.sg,i.O5,_.KE,T.Nt,o.Fj,x.hl,o.JJ,o.u,x.nW,_.R9,x.Mq,Z.gD,o.Q7,i.sg,I.pW,A.ey],styles:[""]}),e})();function Y_(e,t){1&e&&p._UZ(0,"mat-progress-bar",15)}function Q_(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div",16),p.TgZ(1,"mat-checkbox",17),p.NdJ("ngModelChange",function(t){return p.CHM(e).$implicit.checked=t})("change",function(){const t=p.CHM(e),n=t.$implicit,i=t.index;return p.oxw(2).setDone(n,i)}),p._uU(2),p.ALo(3,"date"),p.qZA(),p.TgZ(4,"p"),p._uU(5),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit;p.xp6(1),p.Q6J("ngModel",e.checked),p.xp6(1),p.hij(" ",p.xi3(3,3,1e3*e.time,"HH:mm a")," "),p.xp6(3),p.Oqu(e.content)}}function V_(e,t){if(1&e&&(p.TgZ(0,"div",16),p.TgZ(1,"p"),p._uU(2),p.qZA(),p.qZA()),2&e){const e=p.oxw().$implicit;p.xp6(2),p.Oqu(e("TODO_EMPTY"))}}function j_(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.YNc(8,Y_,1,0,"mat-progress-bar",7),p.TgZ(9,"div",8),p.TgZ(10,"mat-form-field",9),p.TgZ(11,"input",10),p.NdJ("dateChange",function(t){return p.CHM(e),p.oxw().onChangeDate(t)}),p.qZA(),p._UZ(12,"mat-datepicker-toggle",11),p._UZ(13,"mat-datepicker",null,12),p.qZA(),p.qZA(),p.YNc(15,Q_,6,6,"div",13),p.YNc(16,V_,3,1,"div",14),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.MAs(14),i=p.oxw();p.xp6(4),p.Oqu(e("TITLE")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(2),p.Q6J("ngIf",i.loadingFlag.pending),p.xp6(3),p.Q6J("min",i.minDate)("value",i.dateRangeSelected.format("YYYY-MM-DD"))("matDatepicker",n),p.xp6(1),p.Q6J("for",n),p.xp6(3),p.Q6J("ngForOf",i.itemSelected),p.xp6(1),p.Q6J("ngIf",0==(null==i.itemSelected?null:i.itemSelected.length))}}let H_=(()=>{class e{constructor(e,t,n,i,r,s){this.pondService=e,this.dialogRef=t,this.alertService=n,this.calendarService=i,this.reData=r,this._translate=s,this.loadingFlag=new a.E,this.data=[],this.dataRaw=[],this.dateRangeSelectedOld=c()(),this.dateRangeSelected=c()(),this.maxDate=c()().add(180,"days"),this.minDateTamp=c()(),this.maxDateTamp=c()()}ngOnInit(){this.setDate=c()().startOf("day")._d/1e3,this.getData(),this.itemSelected=this.reData.item,this.minDate<this.pondService.seasonStartTime&&(this.minDate=this.pondService.seasonStartTime),this.pondService.getHistory().pipe().subscribe(e=>{0==e.status||(this.minDate=new Date(1e3*e.data[0].start_time))},e=>{})}getData(){this.loadingFlag.setPending(!0),console.log(this.setDate),this.calendarService.getListByPond(this.pondService.pcode,this.setDate).pipe().subscribe(e=>{if(e.error)this.itemSelected=[];else{this.dataRaw=e.data;for(let e=0;e<this.dataRaw.length;e++)this.dataRaw[e].checked=0!=this.dataRaw[e].done;this.itemSelected=this.dataRaw,this.procesData()}this.loadingFlag.setResult(!0)},e=>{this.loadingFlag.setResult(!1),this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}onChangeDate(e){this.setDate=c()(e.value/1e3)._i,this.getData()}procesData(){}changeDate(e){this.dateRangeSelected=c()(this.dateRangeSelected).add(e,"days")}setDone(e,t){this.pondService.doneTodo(e.id).subscribe(e=>{1==e.status?this.itemSelected[t].checked?(this.itemSelected[t].done=1,this.alertService.success(this._translate.translate("TODO.DONE"))):(this.itemSelected[t].done=0,this.alertService.warn(this._translate.translate("TODO.UNDONE"))):1==this.itemSelected[t].checked?(this.itemSelected[t].done=0,this.itemSelected[t].checked=!1):(this.itemSelected[t].done=1,this.itemSelected[t].checked=!0,this.alertService.error(e.error))},()=>{this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(d.so),p.Y36(f.c),p.Y36(Ne.o),p.Y36(d.WI),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-todo-view"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","overflow-y-auto"],["mode","indeterminate",4,"ngIf"],[1,"grid","md:grid-cols-2","sm:grid-cols-1"],[1,"w-full"],["matInput","",3,"min","value","matDatepicker","dateChange"],["matSuffix","",3,"for"],["picker",""],["class","flex items-center justify-between",4,"ngFor","ngForOf"],["class","flex items-center justify-between",4,"ngIf"],["mode","indeterminate"],[1,"flex","items-center","justify-between"],[3,"ngModel","ngModelChange","change"]],template:function(e,t){1&e&&p.YNc(0,j_,17,10,"ng-container",0),2&e&&p.Q6J("translocoRead","TODO")},directives:[g.KI,v.lW,d.ZT,y.Hw,i.O5,_.KE,T.Nt,x.hl,x.nW,_.R9,x.Mq,i.sg,I.pW,Cn.oG,o.JJ,o.On],pipes:[i.uU],styles:[""]}),e})();function $_(e,t){1&e&&p._UZ(0,"mat-icon",19),2&e&&p.Q6J("svgIcon","mat_solid:check_circle")}function B_(e,t){1&e&&p._UZ(0,"mat-icon",20),2&e&&p.Q6J("svgIcon","mat_solid:check_circle_outline")}const z_=function(){return["company_manager","farm_manager","pond_operator","pond_manager"]};function G_(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div",13),p.TgZ(1,"div",14),p.YNc(2,$_,1,1,"mat-icon",15),p.YNc(3,B_,1,1,"mat-icon",16),p.TgZ(4,"p",17),p.TgZ(5,"span",18),p._uU(6),p.ALo(7,"date"),p.qZA(),p._uU(8),p.qZA(),p.qZA(),p.TgZ(9,"button",11),p.NdJ("click",function(){const t=p.CHM(e),n=t.$implicit,i=t.index;return p.oxw(2).presentEditTodo(n,i)}),p._UZ(10,"mat-icon",3),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.oxw(2);p.xp6(2),p.Q6J("ngIf","1"==e.done),p.xp6(1),p.Q6J("ngIf","0"==e.done||!e.done),p.xp6(3),p.Oqu(p.xi3(7,7,e.time,"HH:mm")),p.xp6(2),p.hij(" ",e.content," "),p.xp6(1),p.Q6J("appPermission",p.DdM(10,z_))("currentPermission",n.pondService.permission),p.xp6(1),p.Q6J("svgIcon","edit_calendar")}}function W_(e,t){if(1&e&&(p.TgZ(0,"p"),p._uU(1),p.qZA()),2&e){const e=p.oxw().$implicit;p.xp6(1),p.hij(" ",e("EMPTY")," ")}}function K_(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"p",2),p._UZ(3,"mat-icon",3),p._uU(4),p.qZA(),p.TgZ(5,"mat-icon",4),p.NdJ("click",function(){return p.CHM(e),p.oxw().presentTodo()}),p.qZA(),p.qZA(),p.TgZ(6,"div",5),p.TgZ(7,"div",6),p.TgZ(8,"h1",7),p._uU(9),p.qZA(),p.qZA(),p.YNc(10,G_,11,11,"div",8),p.TgZ(11,"div",9),p.YNc(12,W_,2,1,"p",10),p.TgZ(13,"button",11),p.NdJ("click",function(){return p.CHM(e),p.oxw().presentAdd()}),p._UZ(14,"mat-icon",12),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.oxw();p.xp6(3),p.Q6J("svgIcon","heroicons_outline:clipboard-check"),p.xp6(1),p.hij(" ",e("TITLE")," "),p.xp6(1),p.Q6J("svgIcon","mat_outline:arrow_forward_ios"),p.xp6(4),p.hij("",n.items.length," c\xf4ng vi\u1ec7c "),p.xp6(1),p.Q6J("ngForOf",n.itemsChange),p.xp6(1),p.Q6J("ngClass",0==(null==n.items?null:n.items.length)?"justify-between":"justify-around"),p.xp6(1),p.Q6J("ngIf",0==(null==n.items?null:n.items.length)),p.xp6(1),p.Q6J("appPermission",p.DdM(10,z_))("currentPermission",n.pondService.permission),p.xp6(1),p.Q6J("svgIcon","mat_solid:add_circle_outline")}}let X_=(()=>{class e{constructor(e,t,n,i){this.pondService=e,this.alertService=t,this._matDialog=n,this._translate=i,this.loadingFlag=new a.E,this.items=[],this.dateRangeSelected=c()()}ngOnInit(){this.loadList(),console.log("array",this.items)}presentTodo(){for(let e=0;e<this.items.length;e++)this.items[e].checked=0!=this.items[e].done;this._matDialog.open(H_,{width:"500px",data:{item:this.items}}).afterClosed().subscribe(e=>{})}presentAdd(){this._matDialog.open(M_,{width:"500px"}).afterClosed().subscribe(e=>{e&&(this.items.push(e),this.loadList())})}presentEditTodo(e,t){this._matDialog.open(J_,{width:"500px",data:e}).afterClosed().subscribe(e=>{e&&(this.items[t].content=e.content,this.items[t].edit_time=new Date(e.edit_time),this.loadList())})}loadList(){let e=c()().startOf("day").valueOf()/1e3;this.loadingFlag.setPending(!0),this.pondService.getCalendarList(e).pipe().subscribe(t=>{console.log(t),console.log(e),!t.error&&t.data.length>=0?(this.items=t.data.map(e=>(e.time=c()(1e3*e.time),e)),this.itemsChange=this.items.length>3?this.items.slice(this.items.length-3,this.items.length):this.items.slice(0,3)):this.items=[],this.loadingFlag.setResult(!0)},e=>{this.loadingFlag.setResult(!1),this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(f.c),p.Y36(d.uw),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-todo-dashboard"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"headerBox","todo","p-3","flex","justify-between"],[1,"text-base","text-white","flex","items-center"],[1,"text-white","icon-size-5","mr-1",3,"svgIcon"],[1,"text-white","icon-size-5","mr-1","cursor-pointer",3,"svgIcon","click"],[1,"m-8","mb-4"],["title","Xem th\xeam b\u1ea5m n\xfat >",1,"flex","justify-center"],[1,"text-lg","font-bold"],["class","flex items-center justify-between ",4,"ngFor","ngForOf"],[1,"flex","items-center",3,"ngClass"],[4,"ngIf"],["mat-icon-button","","color","primary",3,"appPermission","currentPermission","click"],[1,"text-white","icon-size-5",3,"svgIcon"],[1,"flex","items-center","justify-between"],[1,"flex","items-center"],["class","icon-size-5 text-green-400",3,"svgIcon",4,"ngIf"],["class","icon-size-5",3,"svgIcon",4,"ngIf"],[1,"items-center"],[1,"font-bold"],[1,"icon-size-5","text-green-400",3,"svgIcon"],[1,"icon-size-5",3,"svgIcon"]],template:function(e,t){1&e&&p.YNc(0,K_,15,11,"ng-container",0),2&e&&p.Q6J("translocoRead","TODO")},directives:[g.KI,y.Hw,i.sg,i.mk,i.O5,v.lW,i_.l,r_],pipes:[i.uU],styles:["[_nghost-%COMP%]   .headerBox[_ngcontent-%COMP%]{max-height:45px;height:100%}[_nghost-%COMP%]   .todo[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,#567c73,#3dc2ff)}[_nghost-%COMP%]   fuse-card[_ngcontent-%COMP%]{height:100%}"]}),e})(),eT=(()=>{class e{transform(e,t,n=""){const i=t.split(",");let r="",s=i[0],o=1;if(e<1e3)return new Intl.NumberFormat("en-US",{maximumFractionDigits:1}).format(e)+" "+n;for(let a=1;a+2<e.toString().length&&a-3<i.length;a+=3)o*=1e3,r=new Intl.NumberFormat("en-US",{maximumFractionDigits:1}).format(e/o),s=i[(a-1)/3];return r+" "+s}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=p.Yjl({name:"countNumerPipe",type:e,pure:!0}),e.\u0275prov=p.Yz7({token:e,factory:e.\u0275fac}),e})();function tT(e,t){if(1&e&&(p.ynx(0),p.TgZ(1,"fuse-card",1),p.TgZ(2,"div",2),p.TgZ(3,"p",3),p._UZ(4,"mat-icon",4),p._uU(5),p.qZA(),p.qZA(),p.TgZ(6,"div",5),p.TgZ(7,"h2",6),p.TgZ(8,"b"),p._uU(9),p.ALo(10,"countNumerPipe"),p.qZA(),p.qZA(),p.TgZ(11,"p",7),p._uU(12),p.qZA(),p.TgZ(13,"div"),p._UZ(14,"div",8),p.qZA(),p.qZA(),p.qZA(),p.BQk()),2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Q6J("svgIcon","iconsmind:money_2"),p.xp6(1),p.hij(" ",e("TITLE")," "),p.xp6(4),p.Oqu(p.xi3(10,6,n.totalCost,"N,Tr,T\u1ec9")),p.xp6(3),p.hij(" ",n.message," "),p.xp6(2),p.Q6J("options",n.options)("merge",n.dataUpdate)}}let nT=(()=>{class e{constructor(e,t){this.pondService=e,this._translate=t,this.loadingFlag=new a.E,this.show=!1,this.options={tooltip:{trigger:"item",formatter:function(e){return`${e.seriesName}<br />\n                ${e.name}: ${(new Intl.NumberFormat).format(e.data.value)} (${e.percent}%)<br />`}},series:[{name:"Chi ph\xed",type:"pie",radius:"55%",data:[],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},this.totalCost=0}ngOnInit(){this.loadCost()}loadCost(){this.loadingFlag.setStart(!0),this.pondService.getTotalCost().subscribe(e=>{var t,n,i,r,s;1==e.status?(this.totalCost=(null===(t=e.data.cost)||void 0===t?void 0:t.feed)+(null===(n=e.data.cost)||void 0===n?void 0:n.blend)+(null===(i=e.data.cost)||void 0===i?void 0:i.enviroment)+(null===(r=e.data.cost)||void 0===r?void 0:r.seed)+(null===(s=e.data.cost)||void 0===s?void 0:s.other),this.dataUpdate={series:[{data:[{name:this._translate.translate("POND.COST_INFO.FEED"),value:e.data.cost.feed},{name:this._translate.translate("POND.COST_INFO.BLEND"),value:e.data.cost.blend},{name:this._translate.translate("POND.COST_INFO.TREATMENT"),value:e.data.cost.enviroment},{name:this._translate.translate("POND.COST_INFO.SEED"),value:e.data.cost.seed},{name:this._translate.translate("POND.COST_INFO.OTHER"),value:e.data.cost.other}]}]}):this.message=e.error,this.loadingFlag.setResult(!0)})}ngAfterViewInit(){this.show=!0}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-daily-cost-infor"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"grid","grid-cols-1","md:mr-2"],[1,"cost","p-3","flex","justify-between"],[1,"text-base","text-white","flex","items-center"],[1,"text-white","icon-size-5","mr-1",3,"svgIcon"],[1,"m-8","mb-4"],[1,"text-xl","text-center","text-red-400"],[1,"text-center"],["echarts","",3,"options","merge"]],template:function(e,t){1&e&&p.YNc(0,tT,15,9,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.COST_INFO")},directives:[g.KI,n_.y,y.Hw,Le.w],pipes:[eT],styles:[".box[_ngcontent-%COMP%]{height:100%;margin-bottom:1em}.cost[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,#d13438,#3dc2ff)}.headerBox[_ngcontent-%COMP%], fuse-card[_ngcontent-%COMP%]{height:100%}.headerBox[_ngcontent-%COMP%]{max-height:45px}"]}),e})();var iT=n(66373);function rT(e,t){1&e&&p._UZ(0,"mat-progress-bar",11)}function sT(e,t){if(1&e&&(p.ynx(0),p.TgZ(1,"mat-list-item"),p._uU(2),p.qZA(),p._UZ(3,"mat-divider"),p.BQk()),2&e){const e=t.$implicit;p.xp6(2),p.Oqu(e.todo)}}function oT(e,t){if(1&e&&(p.TgZ(0,"mat-list-item"),p._uU(1),p.qZA()),2&e){const e=p.oxw().$implicit;p.xp6(1),p.Oqu(e("EMPTY"))}}function aT(e,t){if(1&e&&(p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.qZA(),p.TgZ(5,"div",4),p.YNc(6,rT,1,0,"mat-progress-bar",5),p.TgZ(7,"div",6),p.TgZ(8,"div",7),p.TgZ(9,"h3"),p._uU(10),p.qZA(),p.qZA(),p.TgZ(11,"div",7),p.TgZ(12,"p"),p._uU(13),p.qZA(),p.TgZ(14,"b"),p._uU(15),p.TgZ(16,"sup"),p._uU(17,"2"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(18,"div"),p.TgZ(19,"p"),p._uU(20),p.qZA(),p.qZA(),p.TgZ(21,"div",6),p.TgZ(22,"p"),p.TgZ(23,"small"),p.TgZ(24,"b"),p._uU(25),p.qZA(),p.qZA(),p.qZA(),p.TgZ(26,"mat-list"),p.YNc(27,sT,4,1,"ng-container",8),p.YNc(28,oT,2,1,"mat-list-item",9),p.qZA(),p._UZ(29,"div",10),p.qZA(),p.qZA(),p.qZA(),p.BQk()),2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Oqu(e("DETAILS")),p.xp6(2),p.Q6J("ngIf",n.loadingFlag.pending),p.xp6(4),p.Oqu(n.data.procedure_info.name),p.xp6(3),p.Oqu(e("DENSITY")),p.xp6(2),p.AsE("",n.data.procedure_info.density,"\xa0",e("DENSITY_UNIT"),""),p.xp6(5),p.Oqu(n.data.procedure_info.description),p.xp6(5),p.Oqu(e("TO_DO")),p.xp6(2),p.Q6J("ngForOf",n.data.procedure_todo),p.xp6(1),p.Q6J("ngIf",0==n.data.procedure_todo.length),p.xp6(1),p.Q6J("options",n.optionChart)("merge",n.dataUpdate)}}let lT=(()=>{class e{constructor(e,t,n,i,r){this.pondService=e,this.procedureService=t,this.dialogRef=n,this.reData=i,this._translate=r,this.loadingFlag=new a.E,this.dataRaw=[],this.dataChart=[],this.feedData=[],this.weightData=[],this.show=!1,this.optionChart={tooltip:{trigger:"axis",formatter:e=>{console.log(e);let t=this._translate.translate("DATE")+": "+e[0].axisValue+"<br/>";return e.forEach(e=>{t+=e.marker+e.seriesName+" : "+(new Intl.NumberFormat).format(e.value[1])+"<br>"}),t},axisPointer:{animation:!0}},xAxis:{type:"value",splitLine:{show:!1}},yAxis:[{type:"value",show:!1,splitLine:{show:!1}},{type:"value",show:!1,position:"right",splitLine:{show:!1}}],series:[{type:"bar",smooth:!0,name:this._translate.translate("WEIGHT"),itemStyle:{color:"#FBC02D"}},{type:"line",name:this._translate.translate("FEED"),barWidth:"10%",yAxisIndex:1},{type:"bar",smooth:!0,name:this._translate.translate("ACTUAL_WEIGHT"),itemStyle:{color:"#F57F17"}},{type:"line",name:this._translate.translate("ACTUAL_FEED"),barWidth:"10%",yAxisIndex:1}]}}ngOnInit(){this.data=this.reData.data,this.dateOld=this.reData.dateOld,this.getDetail(),this.getDaily()}getDetail(){this.loadingFlag.setStart(!0),this.procedureService.getProcedureRawDetail(this.data.procedure_info.id).subscribe(e=>{e.data?(this.dataRaw=e.data.curves,this.prepareData(this.dataRaw),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},e=>{this.loadingFlag.setResult(!1),console.log(e)})}prepareData(e){this.dataChart=[],e.forEach(e=>{e.weight>0&&this.weightData.push([e.day,e.weight]),e.feed>0&&this.feedData.push([e.day,e.feed])}),this.dataUpdate={series:[{data:this.weightData},{data:this.feedData}]}}prepareDailyData(e){let t=[],n=[];e.forEach((e,i)=>{let r=Math.abs(c()().diff(c()(e.date),"days")-this.dateOld);n.push([r,e.weight]),t.push([r,e.feed_today])}),this.dataUpdate={series:[{data:this.weightData},{data:this.feedData},{data:n},{data:t}]}}getDaily(){this.loadingFlag.setStart(!0),this.pondService.loadDailyPaging({pageIndex:0,pageSize:30},c()().format("YYYY-MM-DD")).subscribe(e=>{e.data?(this.prepareDailyData(e.data),this.loadingFlag.setResult(!0)):this.loadingFlag.setResult(!1)},e=>{this.loadingFlag.setResult(!1),console.log(e)})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(iT.d),p.Y36(d.so),p.Y36(d.WI),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-procedure-view"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto"],["mode","indeterminate",4,"ngIf"],[1,"p-2"],[1,"flex","items-center","justify-between"],[4,"ngFor","ngForOf"],[4,"ngIf"],["echarts","",1,"demoChart",3,"options","merge"],["mode","indeterminate"]],template:function(e,t){1&e&&p.YNc(0,aT,30,12,"ng-container",0),2&e&&p.Q6J("translocoRead","PROCEDURE_MOD")},directives:[g.KI,i.O5,J.i$,i.sg,Le.w,I.pW,J.Tg,dn.d],styles:[""]}),e})();function cT(e,t){if(1&e&&(p.TgZ(0,"div",8),p.TgZ(1,"p"),p._uU(2),p.qZA(),p.qZA()),2&e){const e=p.oxw(2).$implicit;p.xp6(2),p.Oqu(e("NO_INFO"))}}function uT(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"fuse-card",2),p.TgZ(1,"div",3),p.TgZ(2,"p",4),p._UZ(3,"mat-icon",5),p._uU(4),p.qZA(),p.TgZ(5,"mat-icon",6),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).openProcedure()}),p.qZA(),p.qZA(),p.TgZ(6,"div",7),p.TgZ(7,"div",8),p.TgZ(8,"p"),p.TgZ(9,"b"),p._uU(10),p.qZA(),p.qZA(),p.qZA(),p.TgZ(11,"div",8),p.TgZ(12,"p"),p._uU(13),p.qZA(),p.TgZ(14,"p"),p.TgZ(15,"b"),p._uU(16),p.TgZ(17,"small"),p._uU(18,"g"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(19,"div",8),p.TgZ(20,"p"),p._uU(21),p.qZA(),p.TgZ(22,"p"),p.TgZ(23,"b"),p._uU(24),p.TgZ(25,"small"),p._uU(26,"kg"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.YNc(27,cT,3,1,"div",9),p.qZA(),p.qZA()}if(2&e){const e=p.oxw().$implicit,t=p.oxw();p.xp6(3),p.Q6J("svgIcon","iconsmind:usb_cable"),p.xp6(1),p.hij(" ",e("PROCEDURE")," "),p.xp6(1),p.Q6J("svgIcon","mat_outline:arrow_forward_ios"),p.xp6(5),p.Oqu(t.dailyProcedure.procedure_info.name),p.xp6(3),p.Oqu(e("WEIGHT")),p.xp6(3),p.hij("",null==t.dailyProcedure||null==t.dailyProcedure.procedure_curve?null:t.dailyProcedure.procedure_curve.weight," "),p.xp6(5),p.Oqu(e("FEED")),p.xp6(3),p.hij("",null==t.dailyProcedure||null==t.dailyProcedure.procedure_curve?null:t.dailyProcedure.procedure_curve.feed," "),p.xp6(3),p.Q6J("ngIf",t.loadingFlag.result&&!(null!=t.dailyProcedure&&t.dailyProcedure.procedure_info))}}function dT(e,t){if(1&e&&(p.ynx(0),p.YNc(1,uT,28,9,"fuse-card",1),p.BQk()),2&e){const e=p.oxw();p.xp6(1),p.Q6J("ngIf",e.dailyProcedure)}}let hT=(()=>{class e{constructor(e,t,n,i){this.pondService=e,this.alertService=t,this._matDialog=n,this._translate=i,this.loadingFlag=new a.E,this.dateOld=0,console.log("onload procerdure")}ngOnInit(){this.loadProcedure()}openProcedure(){this._matDialog.open(lT,{width:"800px",data:{data:this.dailyProcedure,dateOld:this.dateOld}})}loadProcedure(){console.log("load procedure"),this.loadingFlag.setPending(!0),this.pondService.getProcedure().pipe().subscribe(e=>{console.log(e),e.error||1!=e.status?this.alertService.error(e.error):(this.dailyProcedure=e.data,this.dateOld=e.old),this.loadingFlag.setResult(!0)},e=>{this.loadingFlag.setResult(!1),this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(f.c),p.Y36(d.uw),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-procedure-dashboard"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],["class","grid grid-cols-1 h-full",4,"ngIf"],[1,"grid","grid-cols-1","h-full"],[1,"headerBox","procedure","p-3","flex","justify-between"],[1,"text-base","text-white","flex","items-center"],[1,"text-white","icon-size-5","mr-1",3,"svgIcon"],[1,"text-white","icon-size-5","mr-1","cursor-pointer",3,"svgIcon","click"],[1,"m-8","mb-4"],[1,"flex","items-center","justify-between"],["class","flex items-center justify-between",4,"ngIf"]],template:function(e,t){1&e&&p.YNc(0,dT,2,1,"ng-container",0),2&e&&p.Q6J("translocoRead","PROCEDURE_MOD")},directives:[g.KI,i.O5,n_.y,y.Hw],styles:["[_nghost-%COMP%]   .headerBox[_ngcontent-%COMP%]{max-height:45px;height:100%}[_nghost-%COMP%]   .procedure[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,#68768a,#3dc2ff)}[_nghost-%COMP%]   fuse-card[_ngcontent-%COMP%]{height:100%}"]}),e})();function pT(e,t){1&e&&p._UZ(0,"mat-progress-bar",5)}function mT(e,t){if(1&e&&(p.TgZ(0,"div",6),p.TgZ(1,"p",7),p._uU(2),p.qZA(),p.TgZ(3,"button",8),p._uU(4),p.qZA(),p.qZA()),2&e){const e=p.oxw().$implicit;p.xp6(2),p.Oqu(e("NO_CROP")),p.xp6(1),p.Q6J("routerLink","season/start"),p.xp6(1),p.Oqu(e("CREATE_CROP"))}}function fT(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"button",55),p.NdJ("click",function(){return p.CHM(e),p.oxw(3).showSuggestAdd()}),p._UZ(1,"mat-icon",56),p._uU(2),p.qZA()}if(2&e){const e=p.oxw(2).$implicit;p.xp6(2),p.hij(" ",e("SUGGEST")," ")}}function gT(e,t){if(1&e&&(p.TgZ(0,"fuse-alert",57),p._uU(1),p.qZA()),2&e){const e=p.oxw(2).$implicit;p.Q6J("type","warning"),p.xp6(1),p.hij(" ",e("NO_ITEM")," ")}}function vT(e,t){if(1&e&&(p.TgZ(0,"fuse-alert",57),p._uU(1),p.qZA()),2&e){const e=p.oxw(2).$implicit,t=p.oxw();p.Q6J("type","success"),p.xp6(1),p.AsE(" ",e("LAST_UPDATE")," ",t.lastTimeUpdate.fromNow()," ")}}function yT(e,t){if(1&e&&(p.TgZ(0,"div",65),p.TgZ(1,"div",66),p._UZ(2,"mat-icon",67),p.TgZ(3,"b",68),p._uU(4),p.qZA(),p.TgZ(5,"em"),p._uU(6),p.ALo(7,"date"),p.qZA(),p.qZA(),p.TgZ(8,"p"),p._uU(9),p.qZA(),p.qZA()),2&e){const e=t.$implicit;p.xp6(4),p.Oqu(e.vendor_name),p.xp6(2),p.Oqu(p.xi3(7,3,1e3*e.add_time,"hh:mm a, dd/MM")),p.xp6(3),p.hij(" ",e.message,"")}}const _T=function(e,t){return{"col-span-1 md:mr-2":e,"sm:col-span-1 md:col-span-2":t}};function TT(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"fuse-card",58),p.TgZ(1,"div",59),p.TgZ(2,"p",19),p._UZ(3,"mat-icon",20),p._uU(4),p.qZA(),p.TgZ(5,"mat-icon",21),p.NdJ("click",function(){return p.CHM(e),p.oxw(3).showSuggestList()}),p.qZA(),p.qZA(),p.TgZ(6,"div",60),p.TgZ(7,"div",61),p.TgZ(8,"div",62),p.YNc(9,yT,10,6,"div",63),p.TgZ(10,"em",64),p._uU(11),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=p.oxw(2).$implicit,t=p.oxw();p.Q6J("ngClass",p.WLB(7,_T,t.disease.length>0,!t.disease.length>0)),p.xp6(3),p.Q6J("svgIcon","mat_solid:warning"),p.xp6(1),p.hij(" ",e("SUGGESTIONS")," "),p.xp6(1),p.Q6J("matTooltip",e("SUGGEST_LIST"))("svgIcon","mat_outline:arrow_forward_ios"),p.xp6(4),p.Q6J("ngForOf",t.suggestItems),p.xp6(2),p.Oqu(e("REMOVE_SUGGESTION_TIME"))}}function xT(e,t){1&e&&p._UZ(0,"mat-icon",77),2&e&&p.Q6J("svgIcon","mat_outline:check_circle")}function wT(e,t){1&e&&p._UZ(0,"mat-icon",78)}function bT(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div",73),p.TgZ(1,"div",74),p.NdJ("click",function(){const t=p.CHM(e),n=t.index,i=t.$implicit;return p.oxw(4).processDisease(n,i)}),p.YNc(2,xT,1,1,"mat-icon",75),p.YNc(3,wT,1,0,"mat-icon",76),p._uU(4),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit;p.Q6J("matTooltip",e.note)("ngClass",1==e.processed?"bg-green-100 text-green-500 border-green-400":"bg-red-100 text-red-500 border-red-500 hover:opacity-80"),p.xp6(1),p.Q6J("ngClass",1!=e.processed?"cursor-pointer":"cursor-default"),p.xp6(1),p.Q6J("ngIf",1==e.processed),p.xp6(1),p.Q6J("ngIf",1!=e.processed),p.xp6(1),p.hij(" ",e.disease_name," ")}}const ZT=function(e,t){return{"col-span-1 md:ml-2":e,"sm:col-span-1 md:col-span-2":t}};function AT(e,t){if(1&e&&(p.TgZ(0,"fuse-card",58),p.TgZ(1,"div",69),p.TgZ(2,"p",19),p._UZ(3,"mat-icon",20),p._uU(4),p.qZA(),p.qZA(),p.TgZ(5,"div",70),p.TgZ(6,"div",61),p.TgZ(7,"div",71),p.YNc(8,bT,5,6,"div",72),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&e){const e=p.oxw(2).$implicit,t=p.oxw();p.Q6J("ngClass",p.WLB(4,ZT,(null==t.suggestItems?null:t.suggestItems.length)>0,!(null!=t.suggestItems&&t.suggestItems.length)>0)),p.xp6(3),p.Q6J("svgIcon","iconsmind:bee"),p.xp6(1),p.hij(" ",e("DISEASE")," "),p.xp6(4),p.Q6J("ngForOf",t.disease)}}function IT(e,t){if(1&e&&(p.TgZ(0,"div",81),p.TgZ(1,"p"),p.TgZ(2,"b"),p._uU(3),p.qZA(),p._uU(4),p.qZA(),p.qZA()),2&e){const e=t.$implicit;p.xp6(3),p.Oqu(e.time),p.xp6(1),p.hij(" | ",e.message,"")}}function ST(e,t){if(1&e&&(p.TgZ(0,"fuse-card",58),p.TgZ(1,"div",79),p.TgZ(2,"p",19),p._UZ(3,"mat-icon",20),p._uU(4),p.qZA(),p.qZA(),p.TgZ(5,"div",60),p.TgZ(6,"div",61),p.TgZ(7,"div",62),p.YNc(8,IT,5,2,"div",80),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&e){const e=p.oxw(2).$implicit,t=p.oxw();p.Q6J("ngClass",p.WLB(4,_T,t.showDevice,!t.showDevice)),p.xp6(3),p.Q6J("svgIcon","mat_solid:warning"),p.xp6(1),p.hij(" ",e("WARNING")," "),p.xp6(4),p.Q6J("ngForOf",t.alertItems)}}const ET=function(e){return{color:e}};function qT(e,t){if(1&e&&(p.TgZ(0,"div",94),p.TgZ(1,"span",96),p._uU(2),p.qZA(),p.qZA()),2&e){const e=p.oxw().$implicit,t=p.oxw().$implicit,n=p.oxw(4);p.Q6J("ngStyle",p.VKq(2,ET,n.calculateColor(null==t.value.indexs[e]||null==t.value.indexs[e].ui?null:t.value.indexs[e].ui.color))),p.xp6(2),p.hij(" ",null==t.value.indexs[e].ui?null:t.value.indexs[e].ui.label," ")}}function NT(e,t){if(1&e&&(p.TgZ(0,"div",92),p.YNc(1,qT,3,4,"div",93),p.TgZ(2,"div",94),p.TgZ(3,"b",95),p._uU(4),p.qZA(),p.qZA(),p.qZA()),2&e){const e=t.$implicit,n=p.oxw().$implicit,i=p.oxw(4);p.xp6(1),p.Q6J("ngIf",n.value.indexs[e].ui),p.xp6(1),p.Q6J("ngStyle",p.VKq(3,ET,i.calculateColor(null==n.value.indexs[e]||null==n.value.indexs[e].ui?null:n.value.indexs[e].ui.color))),p.xp6(2),p.Oqu(null==n||null==n.value||null==n.value.indexs[e]||null==n.value.indexs[e].last?null:n.value.indexs[e].last.value)}}function CT(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div",87),p.NdJ("click",function(){const t=p.CHM(e).$implicit;return p.oxw(4).presentPubDetail(t.value)}),p.TgZ(1,"p",88),p.TgZ(2,"b"),p._UZ(3,"img",89),p._uU(4),p.qZA(),p.qZA(),p.TgZ(5,"div",90),p.YNc(6,NT,5,5,"div",91),p.qZA(),p._UZ(7,"mat-divider"),p.qZA()}if(2&e){const e=t.$implicit;p.xp6(4),p.Oqu(e.value.name),p.xp6(2),p.Q6J("ngForOf",e.value.listIndexLabel)}}function DT(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"mat-slide-toggle",100),p.NdJ("change",function(){const t=p.CHM(e).$implicit,n=p.oxw().$implicit;return p.oxw(4).deviceStatusChange(n.value,t.value)}),p._uU(1),p.qZA()}if(2&e){const e=t.$implicit;p.Q6J("checked",1==e.value.data.value),p.xp6(1),p.hij(" ",e.value.data.name," ")}}function RT(e,t){if(1&e&&(p.TgZ(0,"div",97),p.TgZ(1,"p"),p._uU(2),p.qZA(),p.TgZ(3,"div",98),p.YNc(4,DT,2,2,"mat-slide-toggle",99),p.ALo(5,"keyvalue"),p.qZA(),p.qZA()),2&e){const e=t.$implicit;p.xp6(2),p.Oqu(e.value.name),p.xp6(2),p.Q6J("ngForOf",p.lcZ(5,2,e.value.contactor))}}const OT=function(){return["company_manager","farm_manager","farm_operation","pond_operator","pond_manager"]};function kT(e,t){if(1&e&&(p.TgZ(0,"fuse-card",82),p.TgZ(1,"div",83),p.TgZ(2,"p",19),p._UZ(3,"mat-icon",20),p._uU(4),p.qZA(),p.qZA(),p.TgZ(5,"div",60),p.TgZ(6,"div",61),p.YNc(7,CT,8,2,"div",84),p.ALo(8,"keyvalue"),p.qZA(),p.TgZ(9,"div",85),p.YNc(10,RT,6,4,"div",86),p.ALo(11,"keyvalue"),p.qZA(),p.qZA(),p.qZA()),2&e){const e=p.oxw(2).$implicit,t=p.oxw();p.Q6J("ngClass",p.WLB(11,ZT,(null==t.alertItems?null:t.alertItems.length)>0,!(null!=t.alertItems&&t.alertItems.length)>0))("appPermission",p.DdM(14,OT))("currentPermission",t.pondService.permission),p.xp6(3),p.Q6J("svgIcon","iconsmind:safe_box"),p.xp6(1),p.hij(" ",e("DEVICES")," "),p.xp6(3),p.Q6J("ngForOf",p.lcZ(8,7,t.pubs)),p.xp6(3),p.Q6J("ngForOf",p.lcZ(11,9,t.subs))}}function MT(e,t){1&e&&p._UZ(0,"mat-progress-bar",101),2&e&&p.Q6J("mode","indeterminate")}function UT(e,t){if(1&e&&(p.TgZ(0,"div"),p._uU(1),p.qZA()),2&e){const e=p.oxw(2).$implicit;p.xp6(1),p.hij(" ",e("NO_WEATHER")," ")}}function PT(e,t){if(1&e&&(p.TgZ(0,"div"),p.TgZ(1,"div"),p.TgZ(2,"p"),p._uU(3),p.TgZ(4,"span",102),p._uU(5),p.TgZ(6,"sup"),p.TgZ(7,"small"),p._uU(8,"o"),p.qZA(),p.qZA(),p._uU(9,"C"),p.qZA(),p._uU(10),p.TgZ(11,"span",54),p._uU(12),p.TgZ(13,"sup"),p.TgZ(14,"small"),p._uU(15,"o"),p.qZA(),p.qZA(),p._uU(16,"C"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(17,"div"),p.TgZ(18,"p"),p._uU(19),p.qZA(),p.qZA(),p.qZA()),2&e){const e=p.oxw(2).$implicit,t=p.oxw();p.xp6(3),p.hij("",e("WEATHER_TODAY")," "),p.xp6(1),p.Q6J("ngClass",t.weatherData.temp>28?"text-red-500":"text-green-500"),p.xp6(1),p.hij(" ",t.weatherData.temp,""),p.xp6(5),p.hij(", ",e("WEATHER_TODAY_MAX")," "),p.xp6(1),p.Q6J("ngClass",t.weatherData.temp_max>28?"text-red-500":"text-green-500"),p.xp6(1),p.hij(" ",t.weatherData.temp_max," "),p.xp6(7),p.lnq(" ",e("WEATHER_TODAY_MES")," ",t.weatherData.weather," ",e("WEATHER_TODAY_MES_END")," ")}}function FT(e,t){if(1&e&&(p.TgZ(0,"p"),p._uU(1),p.qZA()),2&e){const e=p.oxw(2).$implicit;p.xp6(1),p.Oqu(e("NOT_UPDATE_PHOTO"))}}function LT(e,t){if(1&e&&p._UZ(0,"img",103),2&e){const e=p.oxw(3);p.Q6J("src",e.SITE_IMAGE+e.todayItem.image,p.LSH)("alt",e.todayItem.description)}}function JT(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"fuse-card",104),p.TgZ(1,"div",105),p.TgZ(2,"p",19),p._UZ(3,"mat-icon",20),p._uU(4),p.qZA(),p.TgZ(5,"mat-icon",21),p.NdJ("click",function(){return p.CHM(e),p.oxw(3).presentEstimate()}),p.qZA(),p.qZA(),p.TgZ(6,"div",37),p.TgZ(7,"div",40),p.TgZ(8,"p",106),p._uU(9),p.qZA(),p.TgZ(10,"p",106),p.TgZ(11,"b"),p._uU(12),p.ALo(13,"number"),p.TgZ(14,"small"),p._uU(15),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(16,"div",40),p.TgZ(17,"p",106),p._uU(18),p.TgZ(19,"small"),p._uU(20),p.ALo(21,"number"),p.qZA(),p.qZA(),p.TgZ(22,"p",106),p.TgZ(23,"b"),p._uU(24),p.ALo(25,"number"),p.TgZ(26,"small"),p._uU(27,"g"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(28,"div",40),p.TgZ(29,"p",106),p._uU(30),p.qZA(),p.TgZ(31,"p",106),p.TgZ(32,"b"),p._uU(33),p.ALo(34,"number"),p.TgZ(35,"small"),p._uU(36),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(37,"div",40),p.TgZ(38,"p",106),p._uU(39),p.qZA(),p.TgZ(40,"p",106),p.TgZ(41,"b"),p._uU(42),p.ALo(43,"number"),p.TgZ(44,"small"),p._uU(45),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(46,"div",40),p.TgZ(47,"p",106),p._uU(48),p.qZA(),p.TgZ(49,"p",106),p.TgZ(50,"b"),p._uU(51),p.ALo(52,"number"),p.TgZ(53,"small"),p._uU(54),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(55,"div",40),p.TgZ(56,"p",106),p._uU(57,"FCR"),p.qZA(),p.TgZ(58,"p",106),p.TgZ(59,"b"),p._uU(60),p.ALo(61,"number"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=p.oxw(2).$implicit,t=p.oxw();p.xp6(3),p.Q6J("svgIcon","iconsmind:robot"),p.xp6(1),p.hij(" ",e("ESTIMATES")," "),p.xp6(1),p.Q6J("matTooltip",e("CHART"))("svgIcon","mat_outline:arrow_forward_ios"),p.xp6(4),p.Oqu(e("AGE")),p.xp6(3),p.hij("",p.xi3(13,21,t.estimate.old,"0.0-1")," "),p.xp6(3),p.Oqu(e("DAY")),p.xp6(3),p.hij("",e("SIZE")," "),p.xp6(2),p.AsE("(",p.xi3(21,24,1e3/t.estimate.weight,"1.0-1"),"",e("PIECE"),")"),p.xp6(4),p.hij("",p.xi3(25,27,t.estimate.weight,"1.0-1")," "),p.xp6(6),p.Oqu(e("QUANTITY")),p.xp6(3),p.hij("",p.xi3(34,30,t.estimate.quantity_pcs,"1.0-2")," "),p.xp6(3),p.Oqu(e("ANIMALS")),p.xp6(3),p.Oqu(e("MASS")),p.xp6(3),p.hij("",p.xi3(43,33,t.estimate.quantity/1e3,"1.0-2")," "),p.xp6(3),p.Oqu(e("TONES")),p.xp6(3),p.Oqu(e("FEED")),p.xp6(3),p.hij("",p.xi3(52,36,t.estimate.feed/1e3,"1.0-2")," "),p.xp6(3),p.Oqu(e("TONES")),p.xp6(6),p.Oqu(p.xi3(61,39,t.estimate.FCR,"1.0-2"))}}function YT(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div",110),p.TgZ(1,"div",111),p.TgZ(2,"div",112),p.TgZ(3,"div"),p._uU(4),p.qZA(),p.TgZ(5,"div"),p._uU(6),p.qZA(),p.qZA(),p.TgZ(7,"button",32),p.NdJ("click",function(){const t=p.CHM(e),n=t.$implicit,i=t.index;return p.oxw(4).openUpdateParameter(n,i)}),p._UZ(8,"mat-icon",20),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.oxw(4);p.xp6(1),p.Q6J("appPermission",p.DdM(6,OT))("currentPermission",n.pondService.permission),p.xp6(1),p.Q6J("ngStyle",p.VKq(7,ET,e.colorStr)),p.xp6(2),p.Oqu(n.convertNameParam(e.name)),p.xp6(2),p.Oqu(e.values.length>0&&null!==e.values[0]?e.values[0]:0),p.xp6(2),p.Q6J("svgIcon","mat_solid:add_circle_outline")}}function QT(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"fuse-card",17),p.TgZ(1,"div",107),p.TgZ(2,"p",19),p._UZ(3,"mat-icon",20),p._uU(4),p.qZA(),p.TgZ(5,"div",45),p.TgZ(6,"mat-icon",46),p.NdJ("click",function(){return p.CHM(e),p.oxw(3).openEnvironmentSetting()}),p.qZA(),p.TgZ(7,"mat-icon",21),p.NdJ("click",function(){return p.CHM(e),p.oxw(3).openChartParameter()}),p.qZA(),p.qZA(),p.qZA(),p.TgZ(8,"div",22),p.TgZ(9,"div",47),p.TgZ(10,"div",108),p.YNc(11,YT,9,9,"div",109),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=p.oxw(2).$implicit,t=p.oxw();p.xp6(3),p.Q6J("svgIcon","iconsmind:environmental_2"),p.xp6(1),p.hij(" ",e("ENVIRONMENT")," "),p.xp6(2),p.Q6J("matTooltip",e("SETTING"))("appPermission",p.DdM(9,OT))("currentPermission",t.pondService.permission)("svgIcon","heroicons_outline:cog"),p.xp6(1),p.Q6J("matTooltip",e("CHART"))("svgIcon","mat_outline:arrow_forward_ios"),p.xp6(4),p.Q6J("ngForOf",t.pondService.trackingObjects)}}function VT(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div"),p.TgZ(1,"div",40),p.TgZ(2,"div",41),p.TgZ(3,"div"),p._uU(4),p.qZA(),p.TgZ(5,"div"),p._uU(6),p.ALo(7,"number"),p.qZA(),p.qZA(),p.TgZ(8,"button",52),p.NdJ("click",function(){return p.CHM(e),p.oxw(3).presentEnviromentUpdate()}),p._UZ(9,"mat-icon",20),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.oxw(3);p.xp6(4),p.Oqu(e.product_name),p.xp6(2),p.hij("",p.xi3(7,5,e.quantity,"1.0-3")," kg"),p.xp6(2),p.Q6J("appPermission",p.DdM(8,OT))("currentPermission",n.pondService.permission),p.xp6(1),p.Q6J("svgIcon","mat_solid:add_circle_outline")}}function jT(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div",40),p.TgZ(1,"p"),p._uU(2),p.qZA(),p.TgZ(3,"button",52),p.NdJ("click",function(){return p.CHM(e),p.oxw(3).presentEnviromentUpdate()}),p._UZ(4,"mat-icon",20),p.qZA(),p.qZA()}if(2&e){const e=p.oxw(2).$implicit,t=p.oxw();p.xp6(2),p.hij(" ",e("NOTHING")," "),p.xp6(1),p.Q6J("appPermission",p.DdM(4,OT))("currentPermission",t.pondService.permission),p.xp6(1),p.Q6J("svgIcon","mat_solid:add_circle_outline")}}function HT(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div"),p.TgZ(1,"div",40),p.TgZ(2,"div",41),p.TgZ(3,"div"),p._uU(4),p.qZA(),p.TgZ(5,"div"),p._uU(6),p.ALo(7,"number"),p.qZA(),p.qZA(),p.TgZ(8,"button",52),p.NdJ("click",function(){const t=p.CHM(e),n=t.index,i=t.$implicit;return p.oxw(3).presentFeedUpdate(n,i)}),p._UZ(9,"mat-icon",20),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=t.index,i=p.oxw(2).$implicit,r=p.oxw();p.xp6(4),p.AsE("",i("REPAST")," ",n+1,""),p.xp6(2),p.hij("",p.xi3(7,6,e.quantity,"1.0-1")," "),p.xp6(2),p.Q6J("appPermission",p.DdM(9,OT))("currentPermission",r.pondService.permission),p.xp6(1),p.Q6J("svgIcon","mat_solid:add_circle_outline")}}const $T=function(){return["company_manager","farm_manager","farm_operation","pond_operator"]};function BT(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div"),p.TgZ(1,"div",9),p.YNc(2,fT,3,1,"button",10),p.TgZ(3,"button",11),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).doRefresh()}),p._UZ(4,"mat-icon",12),p._uU(5),p.qZA(),p.qZA(),p.YNc(6,gT,2,2,"fuse-alert",13),p.YNc(7,vT,2,3,"fuse-alert",13),p.TgZ(8,"div",14),p.YNc(9,TT,12,10,"fuse-card",15),p.YNc(10,AT,9,7,"fuse-card",15),p.qZA(),p.TgZ(11,"div",14),p.YNc(12,ST,9,7,"fuse-card",15),p.YNc(13,kT,12,15,"fuse-card",16),p.qZA(),p.TgZ(14,"div",14),p.TgZ(15,"fuse-card",17),p.TgZ(16,"div",18),p.TgZ(17,"p",19),p._UZ(18,"mat-icon",20),p._uU(19),p.qZA(),p.TgZ(20,"mat-icon",21),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).presentWeatherPredict()}),p.qZA(),p.qZA(),p.TgZ(21,"div",22),p.TgZ(22,"div",23),p.YNc(23,MT,1,1,"mat-progress-bar",24),p.TgZ(24,"div",25),p.YNc(25,UT,2,1,"div",4),p.YNc(26,PT,20,9,"div",4),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(27,"fuse-card",26),p.TgZ(28,"div",27),p.TgZ(29,"p",19),p._UZ(30,"mat-icon",20),p._uU(31),p.qZA(),p.TgZ(32,"mat-icon",21),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).openDailyPhoto()}),p.qZA(),p.qZA(),p.TgZ(33,"div",22),p.TgZ(34,"div",28),p.YNc(35,FT,2,1,"p",4),p.YNc(36,LT,1,2,"img",29),p.TgZ(37,"div",30),p.TgZ(38,"p",31),p._uU(39),p.qZA(),p.TgZ(40,"button",32),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).openUploadImage()}),p.TgZ(41,"mat-icon",33),p._uU(42,"add"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.YNc(43,JT,62,42,"fuse-card",34),p.TgZ(44,"div",14),p.YNc(45,QT,12,10,"fuse-card",35),p.TgZ(46,"fuse-card",26),p.TgZ(47,"div",36),p.TgZ(48,"p",19),p._UZ(49,"mat-icon",20),p._uU(50),p.qZA(),p.TgZ(51,"mat-icon",21),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).presentEnviroment()}),p.qZA(),p.qZA(),p.TgZ(52,"div",37),p.YNc(53,VT,10,9,"div",38),p.YNc(54,jT,5,5,"div",39),p.qZA(),p.qZA(),p.qZA(),p.TgZ(55,"div",14),p.TgZ(56,"fuse-card",17),p.TgZ(57,"div",36),p.TgZ(58,"p",19),p._UZ(59,"mat-icon",20),p._uU(60),p.qZA(),p.TgZ(61,"mat-icon",21),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).presentHealth()}),p.qZA(),p.qZA(),p.TgZ(62,"div",37),p.TgZ(63,"div",40),p.TgZ(64,"div",41),p.TgZ(65,"div"),p._uU(66),p.qZA(),p.TgZ(67,"div",42),p._uU(68),p.ALo(69,"number"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(70,"div",40),p.TgZ(71,"div",41),p.TgZ(72,"div"),p._uU(73),p.qZA(),p.TgZ(74,"div",42),p._uU(75),p.ALo(76,"number"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(77,"div",40),p.TgZ(78,"button",43),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).presentHealthUpdate()}),p._UZ(79,"mat-icon",20),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(80,"fuse-card",26),p.TgZ(81,"div",44),p.TgZ(82,"p",19),p._UZ(83,"mat-icon",20),p._uU(84),p.qZA(),p.TgZ(85,"div",45),p.TgZ(86,"mat-icon",46),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).openFeedSetting()}),p.qZA(),p.TgZ(87,"mat-icon",21),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).presentFeed()}),p.qZA(),p.qZA(),p.qZA(),p.TgZ(88,"div",22),p.TgZ(89,"div",47),p.TgZ(90,"div",48),p.TgZ(91,"h2",49),p.TgZ(92,"b"),p._uU(93),p.ALo(94,"number"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(95,"div",50),p.YNc(96,HT,10,10,"div",38),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(97,"div",14),p._UZ(98,"app-season-dashboard"),p.TgZ(99,"fuse-card",26),p._UZ(100,"app-todo-dashboard"),p.TgZ(101,"div",51),p.TgZ(102,"p",19),p._UZ(103,"mat-icon",20),p._uU(104),p.qZA(),p.TgZ(105,"mat-icon",21),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).presentNote()}),p.qZA(),p.qZA(),p.TgZ(106,"div",37),p.TgZ(107,"div",40),p.TgZ(108,"p"),p._uU(109),p.qZA(),p.TgZ(110,"p"),p._uU(111),p.qZA(),p.TgZ(112,"button",52),p.NdJ("click",function(){return p.CHM(e),p.oxw(2).presentNoteUpdate()}),p._UZ(113,"mat-icon",20),p.qZA(),p.qZA(),p.TgZ(114,"div",40),p.TgZ(115,"p"),p._uU(116),p.qZA(),p.TgZ(117,"b"),p._uU(118),p.ALo(119,"number"),p.qZA(),p.qZA(),p.TgZ(120,"div",40),p.TgZ(121,"p"),p._uU(122),p.qZA(),p.TgZ(123,"b"),p._uU(124),p.ALo(125,"number"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(126,"div",14),p._UZ(127,"app-daily-cost-infor",53),p._UZ(128,"app-procedure-dashboard",54),p.qZA(),p.qZA()}if(2&e){const e=p.oxw().$implicit,t=p.oxw();p.xp6(2),p.Q6J("ngIf","pond_expert"===t.pondService.permission),p.xp6(3),p.hij(" ",e("REFRESH")," "),p.xp6(1),p.Q6J("ngIf",t.noItem),p.xp6(1),p.Q6J("ngIf",!t.noItem&&t.pondService.seasonStart),p.xp6(2),p.Q6J("ngIf",(null==t.suggestItems?null:t.suggestItems.length)>0),p.xp6(1),p.Q6J("ngIf",t.disease.length>0),p.xp6(2),p.Q6J("ngIf",(null==t.alertItems?null:t.alertItems.length)>0),p.xp6(1),p.Q6J("ngIf",t.showDevice),p.xp6(5),p.Q6J("svgIcon","iconsmind:cloud_sun"),p.xp6(1),p.hij(" ",e("WEATHER")," "),p.xp6(1),p.Q6J("matTooltip",e("CHART"))("svgIcon","mat_outline:arrow_forward_ios"),p.xp6(3),p.Q6J("ngIf",t.loadingWeatherFlag.pending),p.xp6(2),p.Q6J("ngIf",!t.weatherData),p.xp6(1),p.Q6J("ngIf",t.weatherData),p.xp6(4),p.Q6J("svgIcon","heroicons_outline:photograph"),p.xp6(1),p.hij(" ",e("DAILY_PHOTO")," "),p.xp6(1),p.Q6J("matTooltip",e("CHART"))("svgIcon","mat_outline:arrow_forward_ios"),p.xp6(3),p.Q6J("ngIf",!(null!=t.todayItem&&t.todayItem.image)),p.xp6(1),p.Q6J("ngIf",null==t.todayItem?null:t.todayItem.image),p.xp6(3),p.Oqu(null==t.todayItem?null:t.todayItem.description),p.xp6(2),p.Q6J("svgIcon","mat_solid:add_circle_outline"),p.xp6(2),p.Q6J("ngIf",t.estimate),p.xp6(2),p.Q6J("ngIf",t.view),p.xp6(4),p.Q6J("svgIcon","iconsmind:chemical"),p.xp6(1),p.hij(" ",e("CHEMICAL")," "),p.xp6(1),p.Q6J("matTooltip",e("CHART"))("svgIcon","mat_outline:arrow_forward_ios"),p.xp6(2),p.Q6J("ngForOf",null==t.todayItem?null:t.todayItem.enviroment),p.xp6(1),p.Q6J("ngIf",!t.todayItem||!t.todayItem.enviroment||0==(null==t.todayItem.enviroment?null:t.todayItem.enviroment.length)),p.xp6(5),p.Q6J("svgIcon","mat_solid:health_and_safety"),p.xp6(1),p.hij(" ",e("HEALTH")," "),p.xp6(1),p.Q6J("matTooltip",e("CHART"))("svgIcon","mat_outline:arrow_forward_ios"),p.xp6(5),p.Oqu(e("WEIGHT")),p.xp6(2),p.hij("",p.xi3(69,68,null==t.todayItem?null:t.todayItem.weight,"1.0-1")," g"),p.xp6(5),p.Oqu(e("LOSS")),p.xp6(2),p.hij("",p.xi3(76,71,(null==t.todayItem?null:t.todayItem.loss)*(null==t.todayItem?null:t.todayItem.weight)/1e3,"1.0-1")," kg "),p.xp6(3),p.Q6J("appPermission",p.DdM(83,OT))("currentPermission",t.pondService.permission),p.xp6(1),p.Q6J("svgIcon","mat_solid:add_circle_outline"),p.xp6(4),p.Q6J("svgIcon","mat_solid:food_bank"),p.xp6(1),p.hij(" ",e("FEED")," "),p.xp6(2),p.Q6J("matTooltip",e("SETTING"))("appPermission",p.DdM(84,OT))("currentPermission",t.pondService.permission)("svgIcon","heroicons_outline:cog"),p.xp6(1),p.Q6J("matTooltip",e("CHART"))("svgIcon","mat_outline:arrow_forward_ios"),p.xp6(6),p.hij("",p.xi3(94,74,t.totalFeed,"1.0-1")," Kg"),p.xp6(3),p.Q6J("ngForOf",t.feed),p.xp6(7),p.Q6J("svgIcon","mat_solid:edit_note"),p.xp6(1),p.hij(" ",e("NOTE")," "),p.xp6(1),p.Q6J("matTooltip",e("CHART"))("svgIcon","mat_outline:arrow_forward_ios"),p.xp6(4),p.Oqu(e("NOTE")),p.xp6(2),p.Oqu(null==t.todayItem?null:t.todayItem.note_general),p.xp6(1),p.Q6J("appPermission",p.DdM(85,OT))("currentPermission",t.pondService.permission),p.xp6(1),p.Q6J("svgIcon","mat_solid:add_circle_outline"),p.xp6(3),p.Oqu(e("OTHER_INCOME")),p.xp6(2),p.hij("",p.xi3(119,77,null==t.todayItem?null:t.todayItem.income,"1.0-1")," \u0111"),p.xp6(4),p.Oqu(e("OTHER_COSTS")),p.xp6(2),p.hij("",p.xi3(125,80,null==t.todayItem?null:t.todayItem.cost_other,"1.0-1")," \u0111"),p.xp6(3),p.Q6J("appPermission",p.DdM(86,$T))("currentPermission",t.pondService.permission),p.xp6(1),p.Q6J("ngClass","company_manager"===t.pondService.permission||"farm_manager"===t.pondService.permission?"md:pl-2":"md:pr-2")}}function zT(e,t){if(1&e&&(p.ynx(0),p.TgZ(1,"div",1),p.YNc(2,pT,1,0,"mat-progress-bar",2),p.YNc(3,mT,5,3,"div",3),p.YNc(4,BT,129,87,"div",4),p.qZA(),p.BQk()),2&e){const e=p.oxw();p.xp6(2),p.Q6J("ngIf",e.loadingFlag.pending),p.xp6(1),p.Q6J("ngIf",!e.pondService.seasonStart),p.xp6(1),p.Q6J("ngIf",!e.noItem&&e.pondService.seasonStart)}}let GT=(()=>{class e{constructor(e,t,n,i,r,s,o,l,u,d,h,p){this.pondService=e,this.dashboardService=t,this._alertService=n,this.route=i,this._accountService=r,this.afs=s,this.router=o,this.cd=l,this.dblocalService=u,this._matDialog=d,this._fuseConfirmationService=h,this._translate=p,this.loadingFlag=new a.E,this.loadingDevice=new a.E,this.loadingWeatherFlag=new a.E,this.componentLoaded=[],this.favorited=!1,this.feed=[],this.totalFeed=0,this.lastTimeUpdate=c()(),this.noItem=!1,this.dateRangeSelected=c()(),this.view=!1,this.now=(new Date).valueOf()/1e3,this.subs=!1,this.pubs=!1,this.showDevice=!1,this.devices=[],this.farmLocation={lng:0,lat:0},this.disease=[],this.SITE_IMAGE=Se.bl.FILE_PATH,this.pondService.reloadSeason$=new Ee.X(0)}ngOnInit(){var e=this;return(0,s.Z)(function*(){e.sub$=e.route.params.subscribe(t=>{e.pcode=t.code,e.pondService.setCode(e.pcode),e.checkDBLocal(),e.loadAlerNow(),e.loadSuggestNow(),e.loadSeasonData()}),console.log(e.pondService),e.getUnit()})()}doRefresh(){this.loadDevice(),this.loadAlerNow(),this.loadSuggestNow(),this.loadSeasonData()}checkDBLocal(){var e;if(this.pondLocalIndex=this.dblocalService.ponds.findIndex(e=>e.infor.code===this.pcode),this.pondLocalIndex>=0){const t=this.dblocalService.farms.findIndex(e=>e.infor.id===this.dblocalService.ponds[this.pondLocalIndex].infor.farm_id);t>=0&&(this.farmLocation={lng:this.dblocalService.farms[t].infor.longitude,lat:this.dblocalService.farms[t].infor.latitude}),this.loadWeather(),this.pondService.setPond(this.dblocalService.ponds[this.pondLocalIndex].infor),this.pondService.setPermission(this.dblocalService.ponds[this.pondLocalIndex].infor.permission),this.favorited=this.dblocalService.ponds[this.pondLocalIndex].favorite,this.devices=null===(e=this.dblocalService.ponds[this.pondLocalIndex])||void 0===e?void 0:e.devices;let n=[],i=[];this.pubs={},this.subs={},this.devices.forEach(e=>{"envisor"==e.type?(this.pubs[e.device_id_fb]={},n.push(e.device_id_fb),this.pubs[e.device_id_fb]=e):(this.subs[e.device_id_fb]={},i.push(e.device_id_fb),this.subs[e.device_id_fb]=e)}),0==n.length&&0==i.length?this.loadDevice():(this.showDevice=!0,this.loadDataPubsDevice(n),this.loadDataSubsDevice(i))}else this.favorited=!1}loadDevice(){var e=this;return(0,s.Z)(function*(){let t=yield e.pondService.getListDevice().catch(()=>{e._alertService.error(e._translate.translate("CONNECT_ERROR"))});if(t&&1==t.status){let n=[],i=[];e.pubs={},e.subs={},console.log(t.data),e.devices=[],t.data.forEach(t=>{e.devices.push(t),"envisor"==t.type?(e.pubs[t.device_id_fb]={},n.push(t.device_id_fb),e.pubs[t.device_id_fb]=t):(e.subs[t.device_id_fb]={},i.push(t.device_id_fb),e.subs[t.device_id_fb]=t)}),e.showDevice=0!=n.length||0!=i.length,e.pondLocalIndex>=0&&e.dblocalService.updateItem("ponds",{infor:e.pondService.pond,favorite:e.favorited,devices:e.devices},e.pondLocalIndex),e.loadDataPubsDevice(n),e.loadDataSubsDevice(i)}else t&&0==t.status&&e._alertService.error(t.error)})()}deviceStatusChange(e,t){this.pondService.changeStatusContactor({contactorId:t.data.id,value:0==t.data.value?1:0,name:t.data.name},e.device_id_fb).subscribe(e=>{if(1==e.status){let e=this._translate.translate(0==t.data.value?"DEVICE.TURN_ON":"DEVICE.TURN_OFF");this._alertService.success(this._translate.translate("DEVICE.HAS")+" "+e+" "+this._translate.translate("DEVICE.DEVICE"))}else this._alertService.error(this._translate.translate("DEVICE.FAILED"))},()=>{this._alertService.error(this._translate.translate("DEVICE.FAILED"))})}loadDataSubsDevice(e){var t=this;return(0,s.Z)(function*(){if(e.length>0){const n=yield t.afs.collection("sub",t=>t.where("__name__","in",e)).get().toPromise();for(const e of n.docs)t.subs[e.id].contactor={},t.afs.collection("sub").doc(e.id).collection("contactors").snapshotChanges().subscribe(n=>{n.map(n=>{t.subs[e.id].contactor[n.payload.doc.id]={id:n.payload.doc.id,data:n.payload.doc.data()}})})}})()}loadDataPubsDevice(e){var t=this;return(0,s.Z)(function*(){t.loadingDevice.setPending(!0);let n=0;if(e.length>0){const i=yield t.afs.collection("pub",t=>t.where("__name__","in",e)).get().toPromise();for(const r of i.docs){let i=r.id,s=yield r.ref.collection("factors").get();t.pubs[i].indexs={},t.pubs[i].listIndexLabel=[],t.pubs[i].last=0;for(const e of s.docs)t.pubs[i].indexs[e.data().name]={},t.pubs[i].listIndexLabel.push(e.data().name);t.pubs[i].listIndexLabel.sort(),r.ref.collection("factors").onSnapshot(e=>{e.forEach(e=>{let n=e.data();e.ref.collection("data").limit(1).orderBy("time","desc").onSnapshot(e=>{e.forEach(e=>{let r=e.data().time.toMillis();parseInt(r)>parseInt(t.pubs[i].last)&&(t.pubs[i].last=r),t.pubs[i].indexs[n.name].ui=n.ui,t.pubs[i].indexs[n.name].last=e.data()})})})}),n+=1,n==e.length&&(t.cd.detectChanges(),t.loadingDevice.setResult(!0))}}})()}presentPubDetail(e){this.router.navigateByUrl("pond/"+this.pondService.pcode+"/pub/"+e.device_id_fb)}presentSubDetail(e){this.router.navigateByUrl("pond/"+this.pondService.pcode+"/sub/"+e.device_id_fb)}calculateColor(e){return e||"#244988"}ngAfterViewInit(){this.view=!0,this.cd.detectChanges()}loadSeasonData(){this.loadingFlag.setPending(!0),this.pondService.loadToday().subscribe(e=>{if(e.start_season){this.pondService.seasonStart=!0,this.pondService.seasonStartTime=c()(1e3*e.season.start_time),this.pondService.setTracking(e.season.tracking_factor,e.season.feed_no),this.seasonInfo=e.season,this.pondService.seasonInfo.seedQuantity=e.season.seed_quantity,e.lastday.length>0?(this.readValueParamOfDay(e.lastday[0]),this.todayItem=e.lastday[0],this.SITE_IMAGE=Se.bl.FILE_PATH,console.log(e.lastday[0].feed),this.SITE_IMAGE+="/upload/season/"+this.seasonInfo.code+"/thumb_image/",this.lastTimeUpdate=this.todayItem.edit_time>0?c()(new Date(1e3*this.todayItem.edit_time)):c()(new Date(1e3*this.todayItem.time))):(this.todayItem=this.pondService.createNotExistDay(),this.noItem=!0),e.estimate&&(this.processEstimate(e.estimate),this.estimateProcedure=e.estimate.procedure);let t=this.dblocalService.ponds.findIndex(e=>e.infor.code===this.pondService.pcode),n=this.pondService.pond;n.permission=this.pondService.permission,"undefined"!==this.seasonInfo?(n.seed_date=this.seasonInfo.seed_date,n.current_season=this.seasonInfo.code,n.start_time=this.seasonInfo.start_time):(n.seed_date=0,n.current_season="",n.start_time=0),t<0?(this.dblocalService.addItem("ponds",{infor:n,devices:this.devices}),this.pondLocalIndex=this.dblocalService.ponds.length):(this.pondLocalIndex=t,this.dblocalService.updateItem("ponds",{infor:n,favorite:this.favorited,devices:this.devices},t)),this.processFeed(),e.disease.length>0&&(this.disease=e.disease,this.pondService.dailyDisease=e.disease,this.pondService.dailyDisease.forEach(e=>{"0"===e.processed&&(this.pondService.currentDiseaseCount+=1)}))}else this.pondService.seasonStart=!1;this.loadingFlag.setResult(!0)},e=>{this.loadingFlag.setResult(!1),this._alertService.error(this._translate.translate("CONNECT_ERROR"))})}readValueParamOfDay(e){this.pondService.trackingObjects.forEach((t,n)=>{this.pondService.trackingObjects[n].values.push(e[t.key])})}processFeed(){this.feed=[],this.totalFeed=0;for(let e=1;e<=this.pondService.numRepast;e++)this.feed.push([]);this.pondService.loadDailyPaging({pageIndex:0,pageSize:90},c()(this.dateRangeSelected).format("YYYY-MM-DD")).subscribe(e=>{e.data?(console.log("data render when page present",e.data),this.totalFeed=e.data[0].feed_today):this.loadingFlag.setResult(!1)},e=>{this.loadingFlag.setResult(!1)}),this.todayItem.feed&&this.todayItem.feed.forEach(e=>{let t=0;this.feed[e.times-1].quantity&&(t=this.feed[e.times-1].quantity),this.feed[e.times-1]={quantity:t+Number(e.quantity*e.packing)},this.totalFeed+=+e.quantity})}processEstimate(e){this.estimate={},this.estimate.old=Math.round((this.now-this.seasonInfo.seed_date)/86400);let t=0;if(this.estimate.totalSeedWeight=e.sum.total_seed_weight>0?e.sum.total_seed_weight:+this.seasonInfo.seed_weight*(parseInt(this.seasonInfo.seed_quantity)-parseInt(e.sum.loss))/1e3,e.sum.feed_today=e.sum.feed_today?e.sum.feed_today:0,e.weight.length>0){if(t=c()(this.lastTimeUpdate).diff(c()(e.weight[0].date),"days"),0==t)this.estimate.weight=null!=e.weight[0].weight?e.weight[0].weight:this.seasonInfo.seed_weight,this.estimate.grow_speed=null!=e.procedure?e.procedure.grow_speed:0,console.log("jo:"+this.estimate.weight);else if(e.weight.length<2)this.estimate.grow_speed=(e.weight[0].weight-this.seasonInfo.seed_weight)/this.estimate.old,this.estimate.weight=this.estimate.grow_speed*t+parseInt(e.weight[0].weight),console.log(this.estimate.weight);else{let n=c()(e.weight[0].date).diff(c()(e.weight[1].date),"days");console.log(n),this.estimate.grow_speed=(e.weight[0].weight-e.weight[1].weight)/n,this.estimate.weight=this.estimate.grow_speed*t+parseInt(e.weight[0].weight)}this.estimate.quantity_pcs=parseInt(this.seasonInfo.seed_quantity)-parseInt(e.sum.loss),this.estimate.quantity=parseInt(this.estimate.weight)*parseInt(this.estimate.quantity_pcs)/1e3,this.estimate.FCR=e.sum.feed_today/(this.estimate.weight*this.estimate.quantity_pcs/1e3-this.estimate.totalSeedWeight),this.estimate.feed=parseInt(e.sum.feed_today),0==+this.estimate.grow_speed&&(this.estimate.grow_speed=(e.weight[0].weight-this.seasonInfo.seed_weight)/this.estimate.old)}else e.procedure?(this.estimate.grow_speed=e.procedure.grow_speed,this.estimate.weight=this.estimate.old<e.procedure.culture_day?this.estimate.grow_speed*this.estimate.old+parseFloat(this.seasonInfo.seed_weight):this.estimate.grow_speed*e.procedure.culture_day+parseFloat(this.seasonInfo.seed_weight)):(this.estimate.grow_speed=0,this.estimate.weight=this.seasonInfo.seed_weight),this.estimate.quantity_pcs=parseInt(this.seasonInfo.seed_quantity),this.estimate.quantity=parseFloat(this.estimate.weight)*parseInt(this.estimate.quantity_pcs)/1e3,this.estimate.FCR=e.sum.feed_today/(this.estimate.quantity-this.estimate.totalSeedWeight),this.estimate.feed=e.sum.feed_today;console.log(this.estimate)}presentEstimate(){this._matDialog.open(vn,{data:{data:this.estimate,procedure:this.estimateProcedure,season:this.seasonInfo}})}loadAlerNow(){this.pondService.getAlertNow().pipe().subscribe(e=>{e.error||(this.alertItems=e.data.map(e=>(e.time=c()(1e3*e.add_time).fromNow(),e)),this.alertItems=this.alertItems.slice(0,3))},e=>{this._alertService.error(this._translate.translate("CONNECT_ERROR"))})}showSuggestAdd(){this._matDialog.open(Tn,{width:"800px",data:{expert:this._accountService}}).afterClosed().subscribe(e=>{e&&this.loadSuggestNow()})}getUnit(){}loadSuggestNow(){this.pondService.getSuggestNow().pipe().subscribe(e=>{e.error||(this.suggestItems=e.data.map(e=>(e.time=c()(1e3*e.add_time).fromNow(),e)),this.suggestItems=this.suggestItems.slice(0,3))},e=>{this._alertService.error(this._translate.translate("CONNECT_ERROR"))})}showSuggestList(){this._matDialog.open(jn,{width:"600px"})}presentParameter(){this._matDialog.open(tn,{width:"800px"})}presentDisease(e,t){this._matDialog.open(qe,{width:"800px",data:{timeStartStamp:this.seasonInfo.add_time,timeEndStamp:this.todayItem.time,item:t}}).afterClosed().subscribe(t=>{t&&this.disease.splice(e,1)})}presentParameterUpdate(e,t){e.target&&e.stopPropagation(),this._matDialog.open(Bt,{width:"800px",data:t}).afterClosed().subscribe(e=>{if(e){this.todayItem[t.key]=e.value;let n=this.pondService.trackingObjects.findIndex(e=>e.key==t.key);this.pondService.trackingObjects[n].values[0]=parseFloat(e.value.replace(",",".")),this.lastTimeUpdate=c()()}})}openFeedSetting(){this._matDialog.open(Yn,{width:"400px"}).afterClosed().subscribe(e=>{e&&this.loadSeasonData()})}presentFeed(){this._matDialog.open(yt,{width:"800px"})}presentFeedUpdate(e,t){console.log(t),this._matDialog.open(at,{width:"800px",data:{repast:e,item:this.todayItem}}).afterClosed().subscribe(e=>{e&&(console.log(e),e.repast.forEach((t,n)=>{let i=0;t.feeds.forEach(e=>{i+=Number(e.quantity),this.feed[n].quantity=i}),this.converRepastToItem(e)}),this.lastTimeUpdate=c()(),this.processFeed())})}converRepastToItem(e){let t=[],n=[];e.repast.forEach((e,i)=>{e.feeds.forEach(e=>{t.push({times:i+1,product_id:e.kind,quantity:e.quantity,wcode:e.wcode,type:1,unit:e.unit})}),e.blends.forEach(e=>{n.push({times:i+1,product_id:e.kind,quantity:e.quantity,wcode:e.wcode,type:2,unit:e.unit})})}),this.todayItem.feed=t,this.todayItem.blend=n,this.todayItem.date=e.date}openEnvironmentSetting(){this._matDialog.open(Un,{width:"600px"}).afterClosed().subscribe(e=>{e&&this.loadSeasonData()})}presentEnviroment(){this._matDialog.open(je,{width:"800px"})}presentEnviromentUpdate(){this._matDialog.open(Fe,{width:"800px",data:{item:this.todayItem}}).afterClosed().subscribe(e=>{e&&(Object.assign(this.todayItem,{enviroment:e}),this.lastTimeUpdate=c()())})}presentHealth(){this._matDialog.open(Ct,{width:"800px"})}presentHealthUpdate(){this._matDialog.open(Et,{width:"800px",data:{item:this.todayItem,disease:this.disease}}).afterClosed().subscribe(e=>{e&&(this.todayItem.loss=e.loss,this.todayItem.weight=e.weight,this.todayItem.note_health=e.desease,e.disease.length>0?(e.disease.forEach(e=>{0==this.disease.filter(t=>t.disease_name==e.name).length&&this.disease.push({id:0,disease_id:e.id,disease_name:e.name,processed:0})}),this.pondService.pond.warning=1):this.pondService.pond.warning=0,this.lastTimeUpdate=c()())})}presentNote(){this._matDialog.open(Qt,{width:"500px"})}presentNoteUpdate(){var e=this;return(0,s.Z)(function*(){e._matDialog.open(kt,{width:"500px",data:{item:e.todayItem}}).afterClosed().subscribe(t=>{t&&(e.todayItem.cost_other=t.cost,e.todayItem.income=t.income,e.todayItem.note_general=t.note,e.lastTimeUpdate=c()())})})()}presentSuggestAdd(){return(0,s.Z)(function*(){})()}loadComponent(e){}presentToast(e){return(0,s.Z)(function*(){})()}addFavorite(){}ngOnDestroy(){this.sub$.unsubscribe(),this.pondService.reloadSeason$.unsubscribe()}openSeasonSeed(){console.log("opened season seed"),this._matDialog.open(qn,{autoFocus:!1})}chartOption(e){return{series:[{type:"gauge",min:this.convertValue(e.min),max:this.convertValue(e.max),itemStyle:{color:e.colorStr},progress:{show:!0,width:2},axisLine:{lineStyle:{width:2}},pointer:{width:5,length:"50%",offsetCenter:[0,"8%"]},axisTick:{show:!1},splitLine:{length:5,lineStyle:{width:1,color:e.colorStr}},axisLabel:{distance:10,color:e.colorStr,fontSize:12},detail:{valueAnimation:!0,fontSize:20,offsetCenter:[0,"50%"],formatter:"{value}"+(e.values.length>0&&e.values[0]>1e3?"K":"")},radius:"90%",data:[{value:e.values.length>0&&null!==e.values[0]?this.convertValue(e.values[0]):0,name:this.convertNameParam(e.name)}]}]}}convertValue(e){return e>1e3?e/1e3:e}convertNameParam(e){let t="";switch(e.toUpperCase()){case"PH_AM":t=this._translate.translate("POND.MORNING_PH");break;case"PH_PM":t=this._translate.translate("POND.NOON_PH");break;case"OXYGEN":t="DO";break;case"TEMPERATURE":t=this._translate.translate("POND.TEMP");break;case"NH3":t="NH3";break;case"NO2":t="NO2";break;case"SALINITY":t=this._translate.translate("POND.SALINITY");break;case"KH":t=this._translate.translate("POND.ALKALINITY");break;case"CLARITY":t=this._translate.translate("POND.CLARITY");break;case"VIBRIO":t="Vibrio";break;case"MAGIESIUM":t=this._translate.translate("POND.MAGNESIUM");break;case"CALCIUM":t=this._translate.translate("POND.CALCIUM");break;case"HYDRO_SULFUA":t="H2S";break;case"ORP":t="ORP";break;case"ALGAE":t=this._translate.translate("POND.ALGAE")}return t}processDisease(e,t){1!=t.processed&&this._matDialog.open(M,{width:"40rem ",data:{disease_id:t.disease_id,name:t.disease_name,bigData:this.todayItem}}).afterClosed().subscribe(e=>{e&&this.pondService.saveProcessDisease(e).subscribe(e=>{1==e.status?(this._alertService.success(this._translate.translate("PROCESS_SUCCESS")),this.loadSeasonData()):this._alertService.error(e.error)},()=>{this._alertService.error(this._translate.translate("CONNECT_ERROR"))})})}deleteDisease(e,t){this._fuseConfirmationService.open({title:this._translate.translate("WARNING"),message:this._translate.translate("POND.UPDATE.CONFIRM_DISEASE_DELETE"),actions:{confirm:{label:this._translate.translate("CONFIRM")},cancel:{label:this._translate.translate("CANCEL")}}}).afterClosed().subscribe(n=>{n&&"confirmed"==n&&this.pondService.saveProcessDisease({type_action:0,action_del:"all",disease_id:t.disease_id}).subscribe(t=>{1==t.status?(this._alertService.success(this._translate.translate("POND.UPDATE.DISEASE_DELETED")),this.disease.splice(e,1)):this._alertService.error(t.error)},()=>{this._alertService.error(this._translate.translate("CONNECT_ERROR"))})})}openChartParameter(){this._matDialog.open(tn,{panelClass:"chart-parameter-dialog",width:"600px"}).afterClosed().subscribe(e=>{console.log("The dialog was closed")})}openUpdateParameter(e,t){this._matDialog.open(Bt,{width:"300px",data:{param:e,index:t,label:this.convertNameParam(e.name)}}).afterClosed().subscribe(n=>{n&&0!=n&&(this.todayItem[e.key]=n,this.pondService.trackingObjects[t].values[0]=parseFloat(n.value.toString().replace(",",".")),this.lastTimeUpdate=c()())})}loadWeather(){this.loadingWeatherFlag.setPending(!0),this.dashboardService.getWeatherToday(this.farmLocation.lat,this.farmLocation.lng).pipe().subscribe(e=>{this.processWeatherData(e),this.loadingWeatherFlag.setResult(!0)},e=>{this.loadingWeatherFlag.setResult(!1),this._alertService.error(this._translate.translate("CONNECT_ERROR"))})}processWeatherData(e){this.weatherWeekData=e.daily;let t=e.daily[0];this.weatherData={temp:(t.temp.day-273.15).toFixed(2),temp_max:(t.temp.max-273.15).toFixed(2),weather:t.weather[0].description,icon:`http://openweathermap.org/img/w/${t.weather[0].icon}.png`}}presentWeatherPredict(){this.weatherWeekData&&this._matDialog.open(Ie.J,{autoFocus:!1,data:this.weatherWeekData})}openUploadImage(){this._matDialog.open(on,{width:"500px",data:{inforDaily:this.todayItem,scode:this.seasonInfo.code}}).afterClosed().subscribe(e=>{e&&0!=e&&e.date==this.todayItem.date&&(this.todayItem.image=e.image,this.todayItem.description=e.description,this.lastTimeUpdate=c()())})}openDailyPhoto(){this._matDialog.open(un,{width:"500px",data:{inforDaily:this.todayItem,scode:this.seasonInfo.code}})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(Hn.s),p.Y36(f.c),p.Y36(r.gz),p.Y36($n.B),p.Y36(Xy),p.Y36(r.F0),p.Y36(p.sBO),p.Y36(t_.T),p.Y36(d.uw),p.Y36(P.R),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-pond-dashboard"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"grid","grid-cols-1","gap-4","w-full"],["class","w-full","mode","indeterminate",4,"ngIf"],["class","text-center w-full",4,"ngIf"],[4,"ngIf"],["mode","indeterminate",1,"w-full"],[1,"text-center","w-full"],[1,"py-2"],["mat-stroked-button","","color","primary",3,"routerLink"],[1,"flex","justify-end","mb-4"],["mat-button","","class","w-max mr-2",3,"click",4,"ngIf"],["mat-button","",1,"w-max",3,"click"],["svgIcon","heroicons_outline:refresh",1,"icon-size-5","mr-1"],[3,"type",4,"ngIf"],[1,"grid","sm:grid-cols-1","md:grid-cols-2"],["class","grid",3,"ngClass",4,"ngIf"],["class","grid",3,"ngClass","appPermission","currentPermission",4,"ngIf"],[1,"grid","grid-cols-1","md:mr-2"],[1,"headerBox","forcast","p-3","flex","justify-between"],[1,"text-base","text-white","flex","items-center"],[1,"text-white","icon-size-5",3,"svgIcon"],[1,"text-white","icon-size-5","cursor-pointer",3,"matTooltip","svgIcon","click"],[1,"m-8"],[1,"md:flex","md:justify-between"],[3,"mode",4,"ngIf"],[1,"flex","flex-col"],[1,"grid","grid-cols-1","md:ml-2"],[1,"headerBox","photo","p-3","flex","justify-between"],[1,"md:flex","md:justify-between","items-center","leading-none"],["class","imgForecast",3,"src","alt",4,"ngIf"],[1,"flex","flex-col","justify-between","items-center"],[1,"pt-2"],["mat-icon-button","","color","primary",3,"click"],["aria-label","Add",1,"text-white","icon-size-5",3,"svgIcon"],["class","w-full grid grid-cols-1",4,"ngIf"],["class","grid grid-cols-1 md:mr-2",4,"ngIf"],[1,"headerBox","health","p-3","flex","justify-between"],[1,"m-8","mb-4"],[4,"ngFor","ngForOf"],["class","flex items-center justify-between",4,"ngIf"],[1,"flex","items-center","justify-between"],[1,"w-5/6","flex","justify-between","items-center"],[1,"font-bold"],["mat-icon-button","","color","primary",1,"my-0","mx-auto",3,"appPermission","currentPermission","click"],[1,"headerBox","feed","p-3","flex","justify-between"],[1,"flex","items-center"],[1,"text-white","icon-size-5","cursor-pointer","mr-3",3,"matTooltip","appPermission","currentPermission","svgIcon","click"],[1,"items-center","leading-none","-ml-1"],[1,"m-4"],[1,"text-xl","text-center"],[1,"grid","md:grid-cols-1","sm:grid-cols-1"],[1,"headerBox","note","p-3","flex","justify-between"],["mat-icon-button","","color","primary",3,"appPermission","currentPermission","click"],[3,"appPermission","currentPermission"],[3,"ngClass"],["mat-button","",1,"w-max","mr-2",3,"click"],["svgIcon","mat_outline:add_comment",1,"icon-size-5","mr-1"],[3,"type"],[1,"grid",3,"ngClass"],[1,"headerBox","bg-green-400","p-3","flex","justify-between"],[1,"m-8","mt-2","mb-4"],[1,"flex","items-center","leading-none"],[1,"mt-2","w-full"],["class","my-3 flex flex-col items-start",4,"ngFor","ngForOf"],[1,"mt-1","flex","justify-end","text-sm","text-red-500"],[1,"my-3","flex","flex-col","items-start"],[1,"flex","items-center","mb-1"],["svgIcon","heroicons_outline:user"],[1,"mx-2"],[1,"headerBox","bg-amber-400","p-3","flex","justify-start"],[1,"mx-8","my-4"],[1,"w-full","flex","flex-wrap","justify-start","items-center"],["class","px-2 py-1 mr-4 flex justify-between items-center border-solid border-2 rounded-full",3,"matTooltip","ngClass",4,"ngFor","ngForOf"],[1,"px-2","py-1","mr-4","flex","justify-between","items-center","border-solid","border-2","rounded-full",3,"matTooltip","ngClass"],[1,"flex","items-center","font-semibold",3,"ngClass","click"],["class","mr-2 text-green-400 icon-size-5",3,"svgIcon",4,"ngIf"],["class","mr-2 text-red-500 icon-size-5","svgIcon","heroicons_outline:exclamation-circle",4,"ngIf"],[1,"mr-2","text-green-400","icon-size-5",3,"svgIcon"],["svgIcon","heroicons_outline:exclamation-circle",1,"mr-2","text-red-500","icon-size-5"],[1,"headerBox","bg-red-400","p-3","flex","justify-start"],["class","flex justify-start items-center",4,"ngFor","ngForOf"],[1,"flex","justify-start","items-center"],[1,"grid",3,"ngClass","appPermission","currentPermission"],[1,"headerBox","device","p-3","flex","justify-start"],["class","mt-2 w-full",3,"click",4,"ngFor","ngForOf"],[1,"grid","sm:grid-cols-1"],["class","boxCabinet",4,"ngFor","ngForOf"],[1,"mt-2","w-full",3,"click"],[1,"text-center"],["src","assets/icons/icon/envisor.svg",2,"width","32px"],[1,"flex","justify-between","items-center","pt-2","pb-2"],["class","p-2",4,"ngFor","ngForOf"],[1,"p-2"],[3,"ngStyle",4,"ngIf"],[3,"ngStyle"],[1,"value"],[1,"item-device"],[1,"boxCabinet"],[1,"pt-2","flex","flex-wrap","justify-between","items-center"],["class","my-2","color","primary",3,"checked","change",4,"ngFor","ngForOf"],["color","primary",1,"my-2",3,"checked","change"],[3,"mode"],[1,"text-red-500",3,"ngClass"],[1,"imgForecast",3,"src","alt"],[1,"w-full","grid","grid-cols-1"],[1,"headerBox","estimate","p-3","flex","justify-between"],[1,"mb-2"],[1,"headerBox","param","p-3","flex","justify-between"],[1,"grid","grid-rows-1"],["class","text-secondary",4,"ngFor","ngForOf"],[1,"text-secondary"],[1,"flex","justify-between","items-center",3,"appPermission","currentPermission"],[1,"w-5/6","flex","justify-between","items-center",3,"ngStyle"]],template:function(e,t){1&e&&p.YNc(0,zT,5,3,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.DASHBOARD")},directives:[g.KI,i.O5,I.pW,v.lW,r.rH,y.Hw,n_.y,Y.gM,i.sg,i_.l,r_,C_,X_,nT,hT,i.mk,Ce.W,dn.d,i.PC,hn.Rr],pipes:[i.JJ,i.uU,i.Nd],styles:["[_nghost-%COMP%]   .headerBox[_ngcontent-%COMP%]{max-height:45px;height:100%}[_nghost-%COMP%]   .item-device[_ngcontent-%COMP%]{font-size:small;text-transform:uppercase}[_nghost-%COMP%]   .unit-device[_ngcontent-%COMP%]{font-size:65%;font-family:Atomic}[_nghost-%COMP%]   .box[_ngcontent-%COMP%]{height:100%;margin-bottom:1em}[_nghost-%COMP%]   .value[_ngcontent-%COMP%]{font-family:Atomic}[_nghost-%COMP%]   .device[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,#ff8c00,#3dc2ff)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,#498205,#3dc2ff)}[_nghost-%COMP%]   .note[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,#ffb900,#3dc2ff)}[_nghost-%COMP%]   .feed[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,#ca5010,#3dc2ff)}[_nghost-%COMP%]   .cost[_ngcontent-%COMP%]{background-color:#ffcdd2!important}[_nghost-%COMP%]   .param[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,#00cc6a,#3dc2ff)}[_nghost-%COMP%]   .enviro[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,#00b294,#3dc2ff)}[_nghost-%COMP%]   .estimate[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,#767676,#3dc2ff)}[_nghost-%COMP%]   .season[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,#0078d7,#3dc2ff)}[_nghost-%COMP%]   .photo[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,#0042cc,#75afe9)}[_nghost-%COMP%]   .forcast[_ngcontent-%COMP%]{background-image:linear-gradient(90deg,#ec2727,#f0de0a)}[_nghost-%COMP%]   .boxCabinet[_ngcontent-%COMP%]{margin:.5rem;padding:.5rem;background-image:linear-gradient(90deg,#e7f3ba,#ecee67);border-radius:5px}[_nghost-%COMP%]   .demoChart[_ngcontent-%COMP%]{max-height:250px}[_nghost-%COMP%]   .imgForecast[_ngcontent-%COMP%]{max-width:160px;width:100%}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]   .mat-slide-toggle-label[_ngcontent-%COMP%]{justify-content:space-between!important}[_nghost-%COMP%]   app-daily-cost-infor[_ngcontent-%COMP%], [_nghost-%COMP%]   app-procedure-dashboard[_ngcontent-%COMP%], [_nghost-%COMP%]   app-season-dashboard[_ngcontent-%COMP%], [_nghost-%COMP%]   fuse-card[_ngcontent-%COMP%]{margin-top:15px}"]}),e})();var WT=n(12522),KT=n(82613);function XT(e,t){1&e&&p._UZ(0,"mat-progress-bar",11)}function ex(e,t){if(1&e&&(p.TgZ(0,"mat-radio-button",12),p._uU(1),p.qZA()),2&e){const e=t.$implicit;p.Q6J("value",e.infor.code),p.xp6(1),p.hij("",e.infor.name," ")}}function tx(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"mat-toolbar",1),p.TgZ(2,"mat-toolbar-row",2),p.TgZ(3,"span",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p.TgZ(6,"mat-icon"),p._uU(7,"close"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(8,"mat-dialog-content"),p.YNc(9,XT,1,0,"mat-progress-bar",5),p.TgZ(10,"div",6),p.TgZ(11,"mat-radio-group",7),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw().pondSeleted=t}),p.YNc(12,ex,2,2,"mat-radio-button",8),p.qZA(),p.qZA(),p.qZA(),p.TgZ(13,"mat-dialog-actions"),p.TgZ(14,"button",9),p.NdJ("click",function(){return p.CHM(e),p.oxw().save()}),p._uU(15),p.qZA(),p.TgZ(16,"button",10),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(17),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Oqu(e("MOVE_DEVICE")),p.xp6(5),p.Q6J("ngIf",n.savingFlag.pending),p.xp6(2),p.Q6J("ngModel",n.pondSeleted),p.xp6(1),p.Q6J("ngForOf",n.ponds),p.xp6(3),p.hij(" ",e("SAVE")," "),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let nx=(()=>{class e{constructor(e,t,n,i,r,s){this.dialogRef=e,this.alertService=t,this.pondService=n,this.dbLocalService=i,this.data=r,this._translate=s,this.savingFlag=new a.E}ngOnInit(){this.ponds=this.dbLocalService.ponds,this.pondSeleted=this.ponds[0].infor.code,this.item=this.data.item}save(){var e=this;return(0,s.Z)(function*(){if(e.pondSeleted==e.pondService.pond.code)return void e.alertService.warn(e._translate.translate("DEVICE.SAME_LOCATION"));e.savingFlag.setPending(!0);const t=yield e.pondService.moveDevice(e.item.name,e.pondSeleted,e.item.id).catch(()=>{e.alertService.error(e._translate.translate("CONNECT_ERROR")),e.savingFlag.setResult(!1)});t&&1==t.status?(e.alertService.success(e._translate.translate("DEVICE.MOVE_DEVICE_SUCCESS")),e.dialogRef.close(!0),e.savingFlag.setResult(!0)):t&&0==t.status&&(e.alertService.error(t.error),e.savingFlag.setResult(!1))})()}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(d.so),p.Y36(f.c),p.Y36(m.p),p.Y36(t_.T),p.Y36(d.WI),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-move-device"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"m-0"],[1,"flex","justify-between","items-center"],[1,"title","dialog-title"],["mat-icon-button","","aria-label","Close dialog",3,"click"],["mode","indeterminate",4,"ngIf"],[1,"p-3"],["aria-labelledby","example-radio-group-label",1,"w-full",3,"ngModel","ngModelChange"],["class","w-full py-1",3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"],["mode","indeterminate"],[1,"w-full","py-1",3,"value"]],template:function(e,t){1&e&&p.YNc(0,tx,18,6,"ng-container",0),2&e&&p.Q6J("translocoRead","DEVICE")},directives:[g.KI,WT.Ye,WT.rD,v.lW,y.Hw,d.xY,i.O5,KT.VQ,o.JJ,o.On,i.sg,d.H8,I.pW,KT.U0],styles:[""]}),e})();function ix(e,t){1&e&&p._UZ(0,"mat-progress-bar",18)}function rx(e,t){if(1&e&&(p.TgZ(0,"mat-option",19),p._uU(1),p.qZA()),2&e){const e=t.$implicit;p.Q6J("value",e.infor.code),p.xp6(1),p.Oqu(e.infor.name)}}function sx(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._UZ(4,"span",4),p.qZA(),p.TgZ(5,"button",5),p._UZ(6,"mat-icon",6),p.qZA(),p.qZA(),p.TgZ(7,"div",7),p.YNc(8,ix,1,0,"mat-progress-bar",8),p.TgZ(9,"mat-form-field",9),p.TgZ(10,"mat-label"),p._uU(11),p.qZA(),p.TgZ(12,"input",10),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw().code=t})("focusout",function(){return p.CHM(e),p.oxw().checkDevice()}),p.qZA(),p.qZA(),p.TgZ(13,"p"),p._uU(14),p.qZA(),p.TgZ(15,"div",11),p.TgZ(16,"mat-form-field",9),p.TgZ(17,"mat-label"),p._uU(18),p.qZA(),p._UZ(19,"input",12),p.qZA(),p.TgZ(20,"mat-form-field",9),p.TgZ(21,"mat-label"),p._uU(22),p.qZA(),p.TgZ(23,"mat-select",13),p.YNc(24,rx,2,2,"mat-option",14),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(25,"div",15),p.TgZ(26,"button",16),p.NdJ("click",function(){return p.CHM(e),p.oxw().save()}),p._uU(27),p.qZA(),p.TgZ(28,"button",17),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(29),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Q6J("innerHTML",e("CHANGE_PASSWORD"),p.oJD),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(2),p.Q6J("ngIf",n.loadingFlag.pending),p.xp6(3),p.Oqu(e("DEVICE_CODE")),p.xp6(1),p.Q6J("placeholder",e("DEVICE_CODE"))("ngModel",n.code),p.xp6(2),p.AsE("",e("DEVICE_TYPE")," : ",n.type,""),p.xp6(1),p.Q6J("formGroup",n.form),p.xp6(3),p.Oqu(e("NAME")),p.xp6(1),p.Q6J("placeholder",e("NAME")),p.xp6(3),p.Oqu(e("SELECT_POND")),p.xp6(1),p.Q6J("placeholder",e("SELECT_POND")),p.xp6(1),p.Q6J("ngForOf",n.ponds),p.xp6(2),p.Q6J("disabled",n.form.invalid||!n.canAdd),p.xp6(1),p.hij(" ",e("SAVE")," "),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let ox=(()=>{class e{constructor(e,t,n,i,r){this.alertService=e,this.dbLocalService=t,this.pondService=n,this.dialogRef=i,this._translate=r,this.ponds=[],this.type="",this.loadingFlag=new a.E,this.form=new o.cw({name:new o.NI("",o.kI.required),pcode:new o.NI("",o.kI.required)}),this.canAdd=!1}ngOnInit(){this.ponds=this.dbLocalService.ponds}checkActive(){var e=this;return(0,s.Z)(function*(){1==(yield e.pondService.activeDevice(e.code).catch(()=>{e.alertService.error(e._translate.translate("CONNECT_ERROR"))})).status&&(e.canAdd=!0)})()}checkDevice(){var e=this;return(0,s.Z)(function*(){const t=yield e.pondService.checkDevice(e.code).catch(t=>{e.alertService.error(e._translate.translate("DEVICE.ACTIVATED"))});t&&1==t.status?0!==parseInt(t.data.activate_guarantee)?(e.alertService.error(e._translate.translate("DEVICE.ACTIVATED")),e.canAdd=!1):(e.device_id=t.data.device_id,e.type=t.data.type,e.dialogRef.close()):t&&0==t.status&&e.alertService.error(t.messages)})()}save(){var e=this;return(0,s.Z)(function*(){e.loadingFlag.setPending(!0);const t={device_id_fb:e.device_id,name:e.form.value.name,type:e.type,pond_code:e.form.value.pcode},n=yield e.pondService.addDevice(t).catch(()=>{e.alertService.error(e._translate.translate("CONNECT_ERROR"))});n&&1==n.status?(e.alertService.success(e._translate.translate("DEVICE.ADD_SUCCESS")),e.dialogRef.close(!0)):(e.alertService.error(e._translate.translate("DEVICE.ADD_FAIL")),e.dialogRef.close()),e.loadingFlag.setResult(!0)})()}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(f.c),p.Y36(t_.T),p.Y36(m.p),p.Y36(d.so),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-add-device"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","md:min-w-120","sm:max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],[1,"title","dialog-title",3,"innerHTML"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto"],["mode","indeterminate",4,"ngIf"],[1,"w-full"],["matInput","","required","",3,"placeholder","ngModel","ngModelChange","focusout"],[1,"p-2",3,"formGroup"],["matInput","","required","","formControlName","name",3,"placeholder"],["formControlName","pcode",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",3,"click"],["mode","indeterminate"],[3,"value"]],template:function(e,t){1&e&&p.YNc(0,sx,30,18,"ng-container",0),2&e&&p.Q6J("translocoRead","DEVICE")},directives:[g.KI,v.lW,d.ZT,y.Hw,i.O5,_.KE,_.hX,T.Nt,o.Fj,o.Q7,o.JJ,o.On,o.JL,o.sg,o.u,Z.gD,i.sg,I.pW,A.ey],styles:[""]}),e})();var ax=n(33935);function lx(e,t){1&e&&p._UZ(0,"mat-progress-bar",7)}function cx(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div",10),p.TgZ(1,"div",11),p.TgZ(2,"div"),p.TgZ(3,"div",12),p._uU(4),p.qZA(),p.TgZ(5,"div",13),p._uU(6,"Envisor"),p.qZA(),p.qZA(),p.TgZ(7,"div",14),p.TgZ(8,"button",15),p._UZ(9,"mat-icon",16),p.qZA(),p.TgZ(10,"mat-menu",null,17),p.TgZ(12,"button",18),p.NdJ("click",function(){const t=p.CHM(e).index;return p.oxw(3).openMoveDevice(t,"pubs")}),p._uU(13),p.qZA(),p.TgZ(14,"button",18),p.NdJ("click",function(){const t=p.CHM(e).index;return p.oxw(3).openRemoveDevice(t,"pubs")}),p._uU(15),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.MAs(11),i=p.oxw(2).$implicit;p.xp6(4),p.Oqu(e.name),p.xp6(4),p.Q6J("matMenuTriggerFor",n),p.xp6(5),p.Oqu(i("MOVE")),p.xp6(2),p.Oqu(i("DELETE"))}}function ux(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div",10),p.TgZ(1,"div",11),p.TgZ(2,"div"),p.TgZ(3,"div",19),p._uU(4),p.qZA(),p.TgZ(5,"div",13),p._uU(6,"Cabinext"),p.qZA(),p.qZA(),p.TgZ(7,"div",14),p.TgZ(8,"button",15),p._UZ(9,"mat-icon",16),p.qZA(),p.TgZ(10,"mat-menu",null,17),p.TgZ(12,"button",18),p.NdJ("click",function(){const t=p.CHM(e).index;return p.oxw(3).openMoveDevice(t,"subs")}),p._uU(13),p.qZA(),p.TgZ(14,"button",18),p.NdJ("click",function(){const t=p.CHM(e).index;return p.oxw(3).openRemoveDevice(t,"subs")}),p._uU(15),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.MAs(11),i=p.oxw(2).$implicit;p.xp6(4),p.Oqu(e.name),p.xp6(4),p.Q6J("matMenuTriggerFor",n),p.xp6(5),p.Oqu(i("MOVE")),p.xp6(2),p.Oqu(i("DELETE"))}}function dx(e,t){if(1&e&&(p.TgZ(0,"div",8),p.YNc(1,cx,16,4,"div",9),p.YNc(2,ux,16,4,"div",9),p.qZA()),2&e){const e=p.oxw(2);p.xp6(1),p.Q6J("ngForOf",e.pubs),p.xp6(1),p.Q6J("ngForOf",e.subs)}}function hx(e,t){if(1&e&&(p.TgZ(0,"div",5),p.TgZ(1,"p"),p._uU(2),p.qZA(),p.qZA()),2&e){const e=p.oxw().$implicit;p.xp6(2),p.Oqu(e("NO_DEVICES"))}}function px(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.YNc(2,lx,1,0,"mat-progress-bar",2),p.YNc(3,dx,3,2,"div",3),p.YNc(4,hx,3,1,"div",4),p.TgZ(5,"div",5),p.TgZ(6,"button",6),p.NdJ("click",function(){return p.CHM(e),p.oxw().openAddDevice()}),p._uU(7),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.oxw();p.xp6(2),p.Q6J("ngIf",n.loadingFlag.pending),p.xp6(1),p.Q6J("ngIf",n.subs.length>0||n.pubs.length>0),p.xp6(1),p.Q6J("ngIf",0==n.subs.length&&0==n.pubs.length),p.xp6(3),p.Oqu(e("ADD"))}}let mx=(()=>{class e{constructor(e,t,n,i,r){this.pondService=e,this._alertService=t,this._matDialog=n,this._fuseConfirmationService=i,this._translate=r,this.pubs=[],this.subs=[],this.loadingFlag=new a.E}ngOnInit(){this.loadDevices()}loadDevices(){var e=this;return(0,s.Z)(function*(){e.loadingFlag.setPending(!0);let t=yield e.pondService.getListDevice().catch(()=>{e._alertService.error(e._translate.translate("CONNECT_ERROR")),e.loadingFlag.setResult(!1)});t&&1==t.status?(e.pubs=[],e.subs=[],t.data.forEach(t=>{"envisor"==t.type?e.pubs.push(t):e.subs.push(t)}),e.loadingFlag.setResult(!1)):t&&0==t.status&&(e._alertService.error(t.error),e.loadingFlag.setResult(!1))})()}openMoveDevice(e,t){this._matDialog.open(nx,{width:"500px",data:{item:this[t][e]}}).afterClosed().subscribe(n=>{n&&this[t].splice(e,1)})}openRemoveDevice(e,t){this._fuseConfirmationService.open({title:this._translate.translate("CONFIRM"),message:this._translate.translate("DEVICE.DELETE_CONFIRM")}).afterClosed().subscribe(n=>{n&&"confirmed"==n&&this.removeDevice(e,t)})}removeDevice(e,t){var n=this;return(0,s.Z)(function*(){const i=yield n.pondService.removeDevice(n[t][e].id).catch(()=>{n._alertService.error(n._translate.translate("CONNECT_ERROR"))});i&&1==i.status?(n._alertService.success(n._translate.translate("DEVICE.MOVE_SUCCESS")),n[t].splice(e,1)):i&&0==i.status&&n._alertService.error(i.error)})()}openAddDevice(){this._matDialog.open(ox,{width:"500px"}).afterClosed().subscribe(e=>{e&&this.loadDevices()})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(f.c),p.Y36(d.uw),p.Y36(P.R),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-pond-device"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"grid","grid-cols-1","gap-4","w-full"],["class","w-full","mode","indeterminate",4,"ngIf"],["class","grid  sm:grid-cols-1 md:grid-cols-4 gap-8 w-full mt-6 md:mt-8",4,"ngIf"],["class","flex justify-center",4,"ngIf"],[1,"flex","justify-center"],["mat-raised-button","","color","primary",3,"click"],["mode","indeterminate",1,"w-full"],[1,"grid","sm:grid-cols-1","md:grid-cols-4","gap-8","w-full","mt-6","md:mt-8"],["class","flex flex-col flex-auto bg-card shadow rounded-2xl overflow-hidden p-6",4,"ngFor","ngForOf"],[1,"flex","flex-col","flex-auto","bg-card","shadow","rounded-2xl","overflow-hidden","p-6"],[1,"flex","items-center","justify-between"],[1,"text-lg","font-medium","tracking-tight","leading-6","truncate"],[1,"text-sm","truncate"],[1,"ml-2"],["mat-icon-button","",3,"matMenuTriggerFor"],["svgIcon","mat_outline:more_vert"],["conversionMenu","matMenu"],["mat-menu-item","",3,"click"],[1,"text-lg"]],template:function(e,t){1&e&&p.YNc(0,px,8,4,"ng-container",0),2&e&&p.Q6J("translocoRead","DEVICE")},directives:[g.KI,i.O5,v.lW,I.pW,i.sg,ax.p6,y.Hw,ax.VK,ax.OP],styles:[""]}),e})();var fx=n(46782);function gx(e,t){1&e&&p._UZ(0,"mat-progress-bar",20)}function vx(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._UZ(4,"span",4),p.qZA(),p.TgZ(5,"button",5),p._UZ(6,"mat-icon",6),p.qZA(),p.qZA(),p.TgZ(7,"div",7),p.YNc(8,gx,1,0,"mat-progress-bar",8),p.TgZ(9,"mat-form-field",9),p.TgZ(10,"mat-label"),p._uU(11),p.qZA(),p._UZ(12,"input",10),p.qZA(),p.TgZ(13,"mat-form-field",9),p.TgZ(14,"mat-label"),p._uU(15),p.qZA(),p._UZ(16,"input",11),p.qZA(),p.TgZ(17,"mat-form-field",9),p.TgZ(18,"mat-label"),p._uU(19),p.qZA(),p._UZ(20,"input",12),p.qZA(),p.TgZ(21,"mat-form-field",9),p.TgZ(22,"mat-label"),p._uU(23),p.qZA(),p.TgZ(24,"input",13),p.NdJ("input",function(t){return p.CHM(e),p.oxw().numberFormatCost.setValue(t.target.value)}),p.qZA(),p.qZA(),p.TgZ(25,"mat-form-field",9),p.TgZ(26,"mat-label"),p._uU(27),p.qZA(),p._UZ(28,"input",14),p.qZA(),p.TgZ(29,"div",15),p.TgZ(30,"p"),p._uU(31),p.qZA(),p.TgZ(32,"p",16),p._uU(33),p.ALo(34,"number"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(35,"div",17),p.TgZ(36,"button",18),p.NdJ("click",function(){return p.CHM(e),p.oxw().save()}),p._uU(37),p.qZA(),p.TgZ(38,"button",19),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(39),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Q6J("innerHTML",e("TITLE"),p.oJD),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(1),p.Q6J("formGroup",n.form),p.xp6(1),p.Q6J("ngIf",n.savingFlag.pending),p.xp6(3),p.Oqu(e("NAME")),p.xp6(1),p.Q6J("placeholder",e("NAME")),p.xp6(3),p.Oqu(e("AREA")),p.xp6(1),p.Q6J("placeholder",e("AREA")),p.xp6(3),p.Oqu(e("DEPTH")),p.xp6(1),p.Q6J("placeholder",e("DEPTH")),p.xp6(3),p.Oqu(e("COST")),p.xp6(1),p.Q6J("placeholder",e("COST"))("value",n.numberFormatCost.fakeView),p.xp6(3),p.Oqu(e("CROP_NUMBER")),p.xp6(1),p.Q6J("placeholder",e("CROP_NUMBER")),p.xp6(3),p.hij(" ",e("CROP_NUMBER")," "),p.xp6(2),p.hij(" ",p.xi3(34,21,n.numberFormatCost.realValue/n.form.value.expire_date,"1.0-0")," "),p.xp6(3),p.Q6J("disabled",n.form.invalid),p.xp6(1),p.hij(" ",e("SAVE")," "),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let yx=(()=>{class e{constructor(e,t,n,i,r,s,o){this.pondService=e,this._formBuilder=t,this.dblocalSerive=n,this.alertService=i,this.dialogRef=r,this.resData=s,this._translate=o,this.savingFlag=new a.E,this.numberFormatCost=new xn.y("")}ngOnInit(){var e=this;return(0,s.Z)(function*(){e.pondLocalIndex=e.resData.pondLocalIndex,e.data=e.pondService.pond,e.createForm()})()}createForm(){console.log(this.data),console.log(this.dblocalSerive.ponds[this.pondLocalIndex]),this.numberFormatCost.setValue(this.data.create_cost),this.form=this._formBuilder.group({name:[this.data.name,o.kI.required],area:[this.data.area,o.kI.required],deep:[this.data.deep,o.kI.required],create_cost:[this.numberFormatCost.fakeView],expire_date:[this.data.expire_date]})}formatCost(e){this.numberFormatCost.setValue(e.detail.value)}save(){if(this.form.invalid||this.savingFlag.pending)return console.log(this.form.value),!1;this.savingFlag.setPending(!0);let e={name:this.form.value.name,area:this.form.value.area,deep:this.form.value.deep,create_cost:this.numberFormatCost.realValue,expire_date:this.form.value.expire_date};this.pondService.updateInfo(this.form.value).subscribe(t=>{t.error||1!=t.status?this.alertService.error(t.error):(this.alertService.success(t.message),this.pondService.pond.name=e.name,this.pondService.pond.area=e.area,this.pondService.pond.deep=e.deep,this.pondService.pond.create_cost=e.create_cost,this.pondService.pond.expire_date=e.expire_date,-1!=this.pondLocalIndex&&(this.dblocalSerive.ponds[this.pondLocalIndex].infor=this.pondService.pond,this.dblocalSerive.setLocalData("ponds",this.dblocalSerive.ponds),this.pondService.onLoaded$.next(1)),this.dialogRef.close()),this.savingFlag.setResult(!0)},e=>{this.alertService.error(this._translate.translate("CONNECT_ERROR")),this.savingFlag.setResult(!1)})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(o.qu),p.Y36(t_.T),p.Y36(f.c),p.Y36(d.so),p.Y36(d.WI),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-pond-info"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","md:min-w-120","sm:max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],[1,"title","dialog-title",3,"innerHTML"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto",3,"formGroup"],["mode","indeterminate",4,"ngIf"],["appearance","legacy",1,"w-full"],["matInput","","formControlName","name",3,"placeholder"],["matInput","","type","number","formControlName","area",3,"placeholder"],["matInput","","type","number","formControlName","deep",3,"placeholder"],["matInput","","formControlName","create_cost",3,"placeholder","value","input"],["matInput","","type","number","formControlName","expire_date",3,"placeholder"],[1,"flex","justify-between"],[1,"text-green-400"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",3,"click"],["mode","indeterminate"]],template:function(e,t){1&e&&p.YNc(0,vx,40,24,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.INFO_MOD")},directives:[g.KI,v.lW,d.ZT,y.Hw,o.JL,o.sg,i.O5,_.KE,_.hX,T.Nt,o.Fj,o.JJ,o.u,o.wV,I.pW],pipes:[i.JJ],styles:[""]}),e})();function _x(e,t){if(1&e&&(p.TgZ(0,"mat-radio-button",14),p._uU(1),p.qZA()),2&e){const e=t.$implicit;p.Q6J("value",e.value),p.xp6(1),p.hij(" ",e.label," ")}}function Tx(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._UZ(4,"span",4),p.qZA(),p.TgZ(5,"button",5),p._UZ(6,"mat-icon",6),p.qZA(),p.qZA(),p.TgZ(7,"div",7),p.TgZ(8,"label"),p._uU(9),p.TgZ(10,"span",8),p._uU(11),p.qZA(),p.qZA(),p.TgZ(12,"mat-radio-group",9),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw().pondRole=t})("ngModelChange",function(t){return p.CHM(e),p.oxw().valueChange(t)}),p.YNc(13,_x,2,2,"mat-radio-button",10),p.qZA(),p.qZA(),p.TgZ(14,"div",11),p.TgZ(15,"button",12),p.NdJ("click",function(){return p.CHM(e),p.oxw().sendForm()}),p._uU(16),p.qZA(),p.TgZ(17,"button",13),p.NdJ("click",function(){return p.CHM(e),p.oxw().onCancel()}),p._uU(18),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Q6J("innerHTML",e("CONFIRM_ADD"),p.oJD),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(3),p.hij("",e("CHOOSE_ROLE")," "),p.xp6(2),p.Oqu(n.data.member.username),p.xp6(1),p.Q6J("ngModel",n.pondRole),p.xp6(1),p.Q6J("ngForOf",n.data.roleList),p.xp6(3),p.Oqu(e("CONFIRM")),p.xp6(2),p.Oqu(e("CANCEL"))}}let xx=(()=>{class e{constructor(e,t){this.dialogRef=e,this.data=t}valueChange(e){this.role=e}onCancel(){this.dialogRef.close()}sendForm(){this.dialogRef.close(this.role)}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(d.so),p.Y36(d.WI))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-add-role-dialog"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],[1,"title","dialog-title",3,"innerHTML"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","overflow-y-auto","sm:pb-0"],[1,"font-bold"],[1,"flex","flex-col","my-4",3,"ngModel","ngModelChange"],["class","my-1",3,"value",4,"ngFor","ngForOf"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary","cdkFocusInitial","",1,"mr-3",3,"click"],["mat-stroked-button","",3,"click"],[1,"my-1",3,"value"]],template:function(e,t){1&e&&p.YNc(0,Tx,19,9,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.MEMBER")},directives:[g.KI,v.lW,d.ZT,y.Hw,KT.VQ,o.JJ,o.On,i.sg,KT.U0],styles:[""]}),e})();var wx=n(5653);function bx(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div",15),p.TgZ(1,"div",16),p._UZ(2,"img",17),p.TgZ(3,"p"),p._uU(4),p.qZA(),p.qZA(),p.TgZ(5,"div",18),p.TgZ(6,"div",19),p._uU(7),p.qZA(),p.TgZ(8,"button",20),p.NdJ("click",function(){const t=p.CHM(e).index;return p.oxw(2).presentRemoveUser(t)}),p._UZ(9,"mat-icon",21),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.oxw().$implicit,i=p.oxw();p.xp6(2),p.Q6J("src",i.memberService.getSitePath()+"/upload/users/avatars/medium/"+e.photo,p.LSH),p.xp6(2),p.Oqu(e.user_name),p.xp6(3),p.Oqu("pond_manager"===e.permission&&n("POND_MANAGER")||"pond_expert"===e.permission&&n("POND_EXPERT")||"pond_operator"===e.permission&&n("POND_OPERATOR"))}}function Zx(e,t){1&e&&p._UZ(0,"mat-progress-bar",22)}function Ax(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div"),p.TgZ(1,"div",23),p.TgZ(2,"div",16),p._UZ(3,"img",17),p.TgZ(4,"p"),p._uU(5),p.qZA(),p.qZA(),p.TgZ(6,"button",24),p.NdJ("click",function(){const t=p.CHM(e).$implicit;return p.oxw(2).presentAddUser(t)}),p._UZ(7,"mat-icon",25),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.oxw(2);p.xp6(3),p.Q6J("src",n.memberService.getSitePath()+"/upload/users/avatars/medium/"+e.photo,p.LSH),p.xp6(2),p.Oqu(e.username),p.xp6(1),p.Q6J("disabled",n.disableAddBtn(e))}}function Ix(e,t){if(1&e&&(p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._UZ(4,"span",4),p.qZA(),p.TgZ(5,"button",5),p._UZ(6,"mat-icon",6),p.qZA(),p.qZA(),p.TgZ(7,"div",7),p.YNc(8,bx,10,3,"div",8),p.YNc(9,Zx,1,0,"mat-progress-bar",9),p.TgZ(10,"mat-form-field",10),p.TgZ(11,"mat-label"),p._uU(12),p.qZA(),p._UZ(13,"input",11),p.qZA(),p.TgZ(14,"div"),p.YNc(15,Ax,8,3,"div",12),p.ALo(16,"async"),p.qZA(),p.qZA(),p.TgZ(17,"div",13),p.TgZ(18,"button",14),p.TgZ(19,"span"),p._uU(20),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.BQk()),2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Q6J("innerHTML",e("MEMBER"),p.oJD),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(2),p.Q6J("ngForOf",n.oldManager),p.xp6(1),p.Q6J("ngIf",n.savingFlag.pending),p.xp6(3),p.Oqu(e("SEARCH")),p.xp6(1),p.Q6J("placeholder",e("ENTER_ACCOUNT"))("formControl",n.searchWord),p.xp6(2),p.Q6J("ngForOf",p.lcZ(16,11,n.members$)),p.xp6(3),p.Q6J("color","primary"),p.xp6(2),p.hij(" ",e("DONE")," ")}}let Sx=(()=>{class e{constructor(e,t,n,i,r,s,l,c){this.pondService=e,this.memberService=t,this.alertService=n,this.dialogRef=i,this.reData=r,this._fuseConfirmationService=s,this._translate=l,this.dialog=c,this.savingFlag=new a.E,this.loadingFlag=new a.E,this.searchWord=new o.NI,this.roleList=[{value:"pond_manager",label:this._translate.translate("POND.MEMBER.POND_MANAGER")},{value:"pond_expert",label:this._translate.translate("POND.MEMBER.POND_EXPERT")},{value:"pond_operator",label:this._translate.translate("POND.MEMBER.POND_OPERATOR")}]}ngOnInit(){this.oldManager=this.reData.manager,console.log("\ud83d\ude80\ud83d\ude80\ud83c\udf89 >>>  this.oldManager",this.oldManager),this.searchWord.valueChanges.pipe((0,h.b)(300)).subscribe(e=>{this.getListMember(e)})}getListMember(e){e.length>=2&&(this.loadingFlag.setPending(!0),this.members$=this.memberService.searchMember(e).pipe(e=>(this.message=0==e.length?this._translate.translate("POND.MEMBER.NO_INFO"):"",this.loadingFlag.setResult(!0),e)))}disableAddBtn(e){return this.oldManager.findIndex(t=>t.user_name===e.username)>=0}onSelect(e){this.memberSelected=e}addPermission(e,t){this.pondService.updatePrivate({user_manager:e.user_id,position:t}).pipe().subscribe(n=>{0==n.status?this.alertService.error(n.error):(this.pondService.manager.push({user_name:e.username,user_id:e.user_id,permission:t}),this.alertService.success(this._translate.translate("POND.MEMBER.ADD_SUCCESS")),this.pondService.onLoaded$.next(1)),this.savingFlag.setResult(!0)},e=>{this.savingFlag.setResult(!1),this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}removePermission(e){this.pondService.removePermission(this.oldManager[e].user_id,this.oldManager[e].permission).pipe().subscribe(t=>{0==t.status?this.alertService.error(t.error):(this.alertService.success(this._translate.translate("POND.MEMBER.DELETED")),this.pondService.manager.splice(e,1),this.pondService.onLoaded$.next(1)),this.savingFlag.setResult(!0)},e=>{this.savingFlag.setResult(!1),this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}presentRemoveUser(e){this._fuseConfirmationService.open({title:this._translate.translate("WARNING"),message:this._translate.translate("POND.MEMBER.DELETE_CONFIRM")}).afterClosed().subscribe(t=>{t&&"confirmed"==t&&this.removePermission(e)})}presentAddUser(e){var t=this;return(0,s.Z)(function*(){t.dialog.open(xx,{width:"350px",data:{member:e,roleList:t.roleList}}).afterClosed().subscribe(n=>{n&&t.addPermission(e,n)})})()}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(wx.n),p.Y36(f.c),p.Y36(d.so),p.Y36(d.WI),p.Y36(P.R),p.Y36(g.Vn),p.Y36(d.uw))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-pond-member"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","md:min-w-120","sm:max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],[1,"title","dialog-title",3,"innerHTML"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto"],["class","flex justify-between items-center py-1",4,"ngFor","ngForOf"],["mode","indeterminate",4,"ngIf"],["appearance","legacy",1,"w-full"],["matInput","",3,"placeholder","formControl"],[4,"ngFor","ngForOf"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","mat-dialog-close","",1,"fuse-mat-button",3,"color"],[1,"flex","justify-between","items-center","py-1"],[1,"flex","justify-start","items-center"],["onError","this.src='assets/images/avatars/default-profile.jpg'",2,"border-radius","50%","width","32px","margin-right","5px",3,"src"],[1,"flex","justify-end","items-center"],[1,"font-bold","mr-1"],["mat-icon-button","","color","warn",3,"click"],["svgIcon","mat_solid:delete"],["mode","indeterminate"],[1,"flex","justify-between","items-center","py-1","w-full"],["mat-icon-button","","color","primary",3,"disabled","click"],["svgIcon","mat_solid:add"]],template:function(e,t){1&e&&p.YNc(0,Ix,21,13,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.MEMBER")},directives:[g.KI,v.lW,d.ZT,y.Hw,i.sg,i.O5,_.KE,_.hX,T.Nt,o.Fj,o.JJ,o.oH,I.pW],pipes:[i.Ov],styles:[""]}),e})();function Ex(e,t){1&e&&p._UZ(0,"mat-progress-bar",17)}function qx(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._UZ(4,"span",4),p.qZA(),p.TgZ(5,"button",5),p._UZ(6,"mat-icon",6),p.qZA(),p.qZA(),p.TgZ(7,"div",7),p.YNc(8,Ex,1,0,"mat-progress-bar",8),p.TgZ(9,"div",9),p.TgZ(10,"mat-radio-group",10),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw().pondService.pond.public=t}),p.TgZ(11,"mat-radio-button",11),p._uU(12),p.qZA(),p.TgZ(13,"mat-radio-button",12),p._uU(14),p.qZA(),p.TgZ(15,"mat-radio-button",13),p._uU(16),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(17,"div",14),p.TgZ(18,"button",15),p.NdJ("click",function(){return p.CHM(e),p.oxw().save()}),p._uU(19),p.qZA(),p.TgZ(20,"button",16),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(21),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Q6J("innerHTML",e("TITLE"),p.oJD),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(2),p.Q6J("ngIf",n.savingFlag.pending),p.xp6(2),p.Q6J("ngModel",n.pondService.pond.public),p.xp6(2),p.Oqu(e("PUBLIC")),p.xp6(2),p.Oqu(e("FOLLOWED")),p.xp6(2),p.Oqu(e("PRIVATE")),p.xp6(3),p.hij(" ",e("SAVE")," "),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let Nx=(()=>{class e{constructor(e,t,n,i,r,s){this.pondService=e,this.dblocalSerive=t,this.alertService=n,this.dialogRef=i,this.data=r,this._translate=s,this.savingFlag=new a.E}ngOnInit(){this.pondLocalIndex=this.data.pondLocalIndex}save(){this.savingFlag.setPending(!0),this.pondService.updatePrivate({public:this.pondService.pond.public}).pipe().subscribe(e=>{0==e.status?this.alertService.error(e.error):(-1!=this.pondLocalIndex&&(this.dblocalSerive.ponds[this.pondLocalIndex].infor=this.pondService.pond,this.dblocalSerive.setLocalData("ponds",this.dblocalSerive.ponds)),this.pondService.onLoaded$.next(1),this.dialogRef.close(),this.alertService.success(e.message)),this.savingFlag.setResult(!0),this.dialogRef.close()},e=>{this.savingFlag.setResult(!1),this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(t_.T),p.Y36(f.c),p.Y36(d.so),p.Y36(d.WI),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-pond-private"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","md:min-w-120","sm:max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],[1,"title","dialog-title",3,"innerHTML"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto"],["mode","indeterminate",4,"ngIf"],[1,"p-3"],["aria-labelledby","example-radio-group-label",1,"w-full",3,"ngModel","ngModelChange"],["value","3",1,"w-full","py-1"],["value","2",1,"w-full","py-1"],["value","1",1,"w-full","py-1"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"click"],["mat-stroked-button","",3,"click"],["mode","indeterminate"]],template:function(e,t){1&e&&p.YNc(0,qx,22,10,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.PRIVATE")},directives:[g.KI,v.lW,d.ZT,y.Hw,i.O5,KT.VQ,o.JJ,o.On,KT.U0,I.pW],styles:[""]}),e})();function Cx(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._UZ(4,"span",4),p.qZA(),p.TgZ(5,"button",5),p._UZ(6,"mat-icon",6),p.qZA(),p.qZA(),p.TgZ(7,"div",7),p.TgZ(8,"div",8),p.TgZ(9,"p",9),p._uU(10),p.qZA(),p.TgZ(11,"p",10),p._uU(12),p.qZA(),p.TgZ(13,"mat-form-field"),p.TgZ(14,"input",11),p.NdJ("ngModelChange",function(t){return p.CHM(e),p.oxw().confirm=t}),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(15,"div",12),p.TgZ(16,"button",13),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close("XOA")}),p._uU(17),p.qZA(),p.TgZ(18,"button",14),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(19),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Q6J("innerHTML",e("TITLE"),p.oJD),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(4),p.Oqu(e("WARNING")),p.xp6(2),p.Oqu(e("CONFIRM_DELETE")),p.xp6(2),p.Q6J("ngModel",n.confirm)("placeholder",e("CONFIRM_HINT")),p.xp6(2),p.Q6J("disabled","XOA"!=n.confirm),p.xp6(1),p.hij(" ",e("DELETE")," "),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let Dx=(()=>{class e{constructor(e){this.dialogRef=e,this.confirm=""}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(d.so))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-pond-remove"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","md:min-w-120","sm:max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],[1,"title","dialog-title",3,"innerHTML"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto"],[1,"text-center"],[1,"text-xl","text-red-400","py-2"],[1,"text-sm","py-2"],["matInput","",3,"ngModel","placeholder","ngModelChange"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","warn",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",3,"click"]],template:function(e,t){1&e&&p.YNc(0,Cx,20,10,"ng-container",0),2&e&&p.Q6J("translocoRead","POND.REMOVE")},directives:[g.KI,v.lW,d.ZT,y.Hw,_.KE,T.Nt,o.Fj,o.JJ,o.On],styles:[""]}),e})();function Rx(e,t){1&e&&p._UZ(0,"mat-progress-bar",15)}function Ox(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._UZ(4,"span",4),p.qZA(),p.TgZ(5,"button",5),p._UZ(6,"mat-icon",6),p.qZA(),p.qZA(),p.TgZ(7,"div",7),p.YNc(8,Rx,1,0,"mat-progress-bar",8),p.TgZ(9,"mat-form-field",9),p.TgZ(10,"mat-label"),p._uU(11),p.qZA(),p.TgZ(12,"input",10),p.NdJ("input",function(t){return p.CHM(e),p.oxw().numberFormatCost.setValue(t.target.value)}),p.qZA(),p.qZA(),p.TgZ(13,"mat-form-field",9),p.TgZ(14,"mat-label"),p._uU(15),p.qZA(),p._UZ(16,"textarea",11),p.qZA(),p.qZA(),p.TgZ(17,"div",12),p.TgZ(18,"button",13),p.NdJ("click",function(){return p.CHM(e),p.oxw().onSubmit()}),p._uU(19),p.qZA(),p.TgZ(20,"button",14),p.NdJ("click",function(){return p.CHM(e),p.oxw().dialogRef.close()}),p._uU(21),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Q6J("innerHTML",e("TITLE"),p.oJD),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(1),p.Q6J("formGroup",n.form),p.xp6(1),p.Q6J("ngIf",n.saveLoading.pending),p.xp6(3),p.Oqu(e("COST")),p.xp6(1),p.Q6J("placeholder",e("COST"))("value",n.numberFormatCost.fakeView),p.xp6(3),p.Oqu(e("NOTES")),p.xp6(1),p.Q6J("placeholder",e("NOTES")),p.xp6(2),p.Q6J("disabled",n.form.invalid),p.xp6(1),p.hij(" ",e("SAVE")," "),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let kx=(()=>{class e{constructor(e,t,n,i,r,s){this._formBuilder=e,this.pondService=t,this.dbLocalService=n,this.alertService=i,this.dialogRef=r,this._translate=s,this.saveLoading=new a.E,this.numberFormatCost=new xn.y("")}ngOnInit(){this.form=this._formBuilder.group({cost:["",o.kI.required],note:["",o.kI.required]})}onSubmit(){let e={cost:this.numberFormatCost.realValue,note:this.form.value.note};this.saveLoading.setPending(!0),this.pondService.reqSeasonCancel(e).subscribe(e=>{if(1!=e.error){this.alertService.success(e.message),this.pondService.pond.current_season="",this.pondService.onLoaded$.next(1);let t=this.dbLocalService.ponds.findIndex(e=>e.infor.code===this.pondService.pcode);if(t>=0){let e={infor:this.pondService.pond,devices:[]};e.infor.current_season="",e.infor.species_id=null,e.infor.species=null,e.infor.start_time=null,this.dbLocalService.updateItem("ponds",e,t)}this.pondService.seasonStart=!1,this.pondService.reloadSeason$.next(1),this.saveLoading.setResult(!0),this.dialogRef.close()}else this.alertService.error(e.message),this.saveLoading.setResult(!1)},()=>{this.saveLoading.setResult(!1),this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}formatCost(e){this.numberFormatCost.setValue(e.detail.value)}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(o.qu),p.Y36(m.p),p.Y36(t_.T),p.Y36(f.c),p.Y36(d.so),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-season-cancel"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","md:min-w-120","sm:max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],[1,"title","dialog-title",3,"innerHTML"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto",3,"formGroup"],["mode","indeterminate",4,"ngIf"],[1,"w-full"],["matInput","","formControlName","cost",3,"placeholder","value","input"],["matInput","","formControlName","note","required","",3,"placeholder"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",3,"click"],["mode","indeterminate"]],template:function(e,t){1&e&&p.YNc(0,Ox,22,13,"ng-container",0),2&e&&p.Q6J("translocoRead","SEASON.CANCEL_MOD")},directives:[g.KI,v.lW,d.ZT,y.Hw,o.JL,o.sg,i.O5,_.KE,_.hX,T.Nt,o.Fj,o.JJ,o.u,o.Q7,I.pW],styles:[""]}),e})();var Mx=n(95585),Ux=n(67813);function Px(e,t){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._uU(4),p.qZA(),p.TgZ(5,"button",4),p._UZ(6,"mat-icon",5),p.qZA(),p.qZA(),p.TgZ(7,"div",6),p.TgZ(8,"div",7),p.TgZ(9,"div",8),p.TgZ(10,"div",9),p.TgZ(11,"p",10),p._uU(12),p.qZA(),p.qZA(),p.TgZ(13,"div",11),p.TgZ(14,"mat-form-field",12),p.TgZ(15,"mat-label"),p._uU(16),p.qZA(),p._UZ(17,"input",13),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(18,"div",14),p.TgZ(19,"button",15),p.NdJ("click",function(){return p.CHM(e),p.oxw().save()}),p.TgZ(20,"span"),p._uU(21),p.qZA(),p.qZA(),p.TgZ(22,"button",16),p.TgZ(23,"span"),p._uU(24),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=t.$implicit,n=p.oxw();p.xp6(4),p.Oqu(e("TITLE")),p.xp6(1),p.Q6J("tabIndex",-1),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:x"),p.xp6(1),p.Q6J("formGroup",n.form),p.xp6(5),p.Oqu(e("NOTE")),p.xp6(4),p.Oqu(e("DESCRIPTION")),p.xp6(1),p.Q6J("placeholder",e("DESCRIPTION")),p.xp6(2),p.Q6J("color","primary"),p.xp6(2),p.hij(" ",e("SAVE")," "),p.xp6(1),p.Q6J("color","secondary"),p.xp6(2),p.hij(" ",e("CANCEL")," ")}}let Fx=(()=>{class e{constructor(e,t,n,i){this.dialogRef=e,this._pondService=t,this._alertService=n,this._translate=i,this.form=new o.cw({description:new o.NI("",o.kI.required)})}ngOnInit(){}save(){this._pondService.publishSeason(this._pondService.pond.current_season,{description:this.form.value.description}).subscribe(e=>{1==e.status?(this._alertService.success(this._translate.translate("SEASON.CREATE_SEASON.PUBLISH_SUCCESS")),this.dialogRef.close()):this._alertService.error(e.error)},e=>{this._alertService.error(this._translate.translate("CONNECT_ERROR"))})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(d.so),p.Y36(m.p),p.Y36(f.c),p.Y36(g.Vn))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-season-publish"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","md:min-w-160","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto",3,"formGroup"],[1,"w-full"],[1,"flex","flex-col","w-full"],[1,"flex","mb-6"],[1,"text-green-500","text-lg","font-medium"],[1,"flex"],[1,"flex-auto"],["matInput","","formControlName","description",3,"placeholder"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","",1,"fuse-mat-button","mr-3",3,"color","click"],["mat-stroked-button","","mat-dialog-close","",1,"fuse-mat-button",3,"color"]],template:function(e,t){1&e&&p.YNc(0,Px,25,11,"ng-container",0),2&e&&p.Q6J("translocoRead","SEASON.PUBLISH_MOD")},directives:[g.KI,v.lW,d.ZT,y.Hw,o.JL,o.sg,_.KE,_.hX,T.Nt,o.Fj,o.JJ,o.u],styles:[""]}),e})();var Lx=n(25578),Jx=n(76891),Yx=n(23017),Qx=n(29551);function Vx(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"button",35),p.NdJ("click",function(){return p.CHM(e),p.oxw(),p.MAs(50).toggle()}),p._UZ(1,"mat-icon",36),p.qZA()}2&e&&(p.xp6(1),p.Q6J("svgIcon","heroicons_outline:menu"))}function jx(e,t){if(1&e&&p._UZ(0,"fuse-vertical-navigation",37),2&e){const e=p.oxw(3);p.Q6J("navigation",e.menuData)("inner",!0)("mode","side")("name","company-components-navigation")("opened",!0)}}function Hx(e,t){1&e&&p._UZ(0,"router-outlet")}function $x(e,t){if(1&e&&(p.TgZ(0,"div",2),p.TgZ(1,"div",3),p.TgZ(2,"div",4),p.TgZ(3,"div"),p.TgZ(4,"a",5),p._uU(5),p.qZA(),p.qZA(),p.TgZ(6,"div",6),p._UZ(7,"mat-icon",7),p.TgZ(8,"a",5),p._uU(9),p.qZA(),p.qZA(),p.TgZ(10,"div",6),p._UZ(11,"mat-icon",7),p.qZA(),p.qZA(),p.TgZ(12,"div",8),p.TgZ(13,"a",9),p._UZ(14,"mat-icon",7),p.TgZ(15,"span",10),p._uU(16),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(17,"div",11),p.TgZ(18,"div",12),p.TgZ(19,"div",13),p.TgZ(20,"h2",14),p._uU(21),p.qZA(),p.TgZ(22,"div",15),p.TgZ(23,"span",16),p._UZ(24,"mat-icon",17),p._uU(25),p.TgZ(26,"sup"),p._uU(27,"2"),p.qZA(),p.qZA(),p.TgZ(28,"span",16),p._UZ(29,"mat-icon",18),p._uU(30),p.qZA(),p.TgZ(31,"span",16),p._UZ(32,"mat-icon",19),p._uU(33),p.ALo(34,"number"),p.qZA(),p.TgZ(35,"span",16),p._UZ(36,"mat-icon",20),p._uU(37),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(38,"div",21),p.TgZ(39,"button",22),p._UZ(40,"mat-icon",23),p.TgZ(41,"span",24),p._uU(42),p.qZA(),p.qZA(),p.TgZ(43,"button",25),p._UZ(44,"mat-icon",23),p.TgZ(45,"span",24),p._uU(46),p.qZA(),p.qZA(),p.YNc(47,Vx,2,1,"button",26),p.qZA(),p.qZA(),p.TgZ(48,"mat-drawer-container",27),p.TgZ(49,"mat-drawer",28,29),p.YNc(51,jx,1,5,"fuse-vertical-navigation",30),p.qZA(),p.TgZ(52,"mat-drawer-content",31),p.TgZ(53,"div",32),p.TgZ(54,"div",33),p.YNc(55,Hx,1,0,"router-outlet",34),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&e){const e=p.oxw().$implicit,t=p.oxw();p.xp6(4),p.Q6J("routerLink","/farm/"+(null==t.farm||null==t.farm.infor?null:t.farm.infor.code)),p.xp6(1),p.Oqu(t.pondService.pond.farm_name),p.xp6(2),p.Q6J("svgIcon","heroicons_solid:chevron-right"),p.xp6(1),p.Q6J("routerLink","/pond/"+t.pondService.pond.code),p.xp6(1),p.Oqu(t.pondService.pond.name),p.xp6(2),p.Q6J("svgIcon","heroicons_solid:chevron-right"),p.xp6(2),p.Q6J("routerLink","./../../"),p.xp6(1),p.Q6J("svgIcon","heroicons_solid:chevron-left"),p.xp6(2),p.Oqu(e("BACK")),p.xp6(5),p.hij(" ",t.pondService.pond.name," "),p.xp6(4),p.AsE(" ",e("AREA")," ",t.pondService.pond.area,"m"),p.xp6(5),p.AsE(" ",e("DEPTH")," ",t.pondService.pond.deep,"m "),p.xp6(3),p.AsE(" ",e("CREATE_COST")," ",p.lcZ(34,33,t.pondService.pond.create_cost),"\u0111 "),p.xp6(4),p.AsE(" ",e("CROP_NUMBER")," ",t.pondService.pond.expire_date," "),p.xp6(2),p.Q6J("routerLink","record")("color","primary"),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:pencil"),p.xp6(2),p.Oqu(e("ADD_LOG")),p.xp6(1),p.Q6J("routerLink","season")("color","primary"),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:archive"),p.xp6(2),p.Oqu(e("CROP")),p.xp6(1),p.Q6J("ngIf",t.menuData),p.xp6(2),p.Q6J("autoFocus",!1)("mode",t.drawerMode)("opened",t.drawerOpened)("position","end"),p.xp6(2),p.Q6J("ngIf",t.show),p.xp6(4),p.Q6J("ngIf",t.pondService.pond)}}function Bx(e,t){if(1&e&&(p.ynx(0),p.YNc(1,$x,56,35,"div",1),p.BQk()),2&e){const e=p.oxw();p.xp6(1),p.Q6J("ngIf",e.pondService.pond)}}let zx=(()=>{class e{constructor(e,t,n,i,r,s,o,a,l,c){this._fuseMediaWatcherService=e,this._matDialog=t,this.route=n,this.router=i,this._router=r,this.pondService=s,this._alertService=o,this.dbLocalService=a,this._translate=l,this._farmService=c,this.drawerMode="side",this.drawerOpened=!0,this.show=!1,this.pondLocalIndex=-1,this._unsubscribeAll=new wn.xQ,this.farm={}}ngOnInit(){this.pondService.setCode(this.route.snapshot.paramMap.get("code")),this.getPond(),this._fuseMediaWatcherService.onMediaChange$.pipe((0,fx.R)(this._unsubscribeAll)).subscribe(({matchingAliases:e})=>{e.includes("lg")?(this.drawerMode="side",this.drawerOpened=!0):(this.drawerMode="over",this.drawerOpened=!1)}),this.pondService.onLoaded$.subscribe(e=>{1==e&&this.filterSideBar()}),this.farm=this.dbLocalService.farms.find(e=>{var t,n;return e.infor.id===(null===(n=null===(t=this.pondService)||void 0===t?void 0:t.pond)||void 0===n?void 0:n.farm_id)}),this.getLocalUnit()}getLocalUnit(){var e;null!==(e=null==localStorage.getItem("unit"))&&void 0!==e||localStorage.setItem("unit","g")}initSiteBar(){this.menuData=[{title:this._translate.translate("POND.SEASON"),type:"group",children:[{title:this._translate.translate("POND.SEED"),icon:"iconsmind:inbox_into",type:"basic",function:()=>this.openSeasonSeed()},{title:this._translate.translate("POND.HARVEST"),icon:"iconsmind:inbox_out",type:"basic",function:()=>this.openHarvest()},{title:this._translate.translate("POND.MOVE"),icon:"iconsmind:arrow_from",type:"basic",link:"season/move"},{title:this._translate.translate("POND.LOG"),icon:"iconsmind:timer",type:"basic",link:"season/list"},{title:this._translate.translate("POND.SEASON_PUBLISH"),icon:"iconsmind:shop",type:"basic",function:()=>this.presentPublish()},{title:this._translate.translate("POND.SEASON_DEAL"),icon:"iconsmind:tag_3",type:"basic",function:()=>this.routeToSeasonDeal()},{title:this._translate.translate("POND.CANCEL_SEASON"),icon:"iconsmind:remove",type:"basic",function:()=>this.openCancelSeason(),classes:{icon:"text-red-500",title:"text-red-500"}}]},{title:this._translate.translate("POND.SETTINGS"),type:"group",children:[{title:this._translate.translate("POND.INFO"),icon:"mat_outline:info",type:"basic",function:()=>this.openPondInfor()},{title:this._translate.translate("POND.PRIVACY"),icon:"mat_outline:vpn_lock",subtitle:"",type:"basic",function:()=>this.openPondPrivate()},{title:this._translate.translate("POND.DEVICES"),icon:"heroicons_solid:farmext-envisor",type:"basic",link:"device"},{title:this._translate.translate("POND.MANAGER"),badge:{title:"0",classes:"px-2 bg-primary text-on-primary rounded-full"},icon:"mat_outline:group_add",type:"basic",function:()=>this.openPondMember()},{title:this._translate.translate("POND.DELETE"),icon:"iconsmind:remove",type:"basic",classes:{icon:"text-red-500",title:"text-red-500"},function:()=>this.openConfirmRemovePond()}]}]}loadSetting(){this.pondService.getSeting().pipe().subscribe(e=>{if(1==e.status){const{pond_manager:t=[],pond_expert:n=[],pond_operator:i=[]}=e.data.manager;this.pondService.manager=[...t,...n,...i],this.pondService.pond.public=e.data.public,this.filterSideBar(),this.show=!0}})}getPond(){let e=this.dbLocalService.ponds.findIndex(e=>e.infor.code===this.pondService.pcode);console.log(this.pondLocalIndex),e>=0?(this.pondService.setPond(this.dbLocalService.ponds[e].infor),this.pondLocalIndex=e,this.loadSetting()):this.pondService.loadPond().pipe().subscribe(e=>{0==e.status?this._alertService.error(e.error):(this.pondService.setPond(e.data),this.loadSetting(),this.pondService.setPermission(e.permission))},()=>{this._alertService.error(this._translate.translate("CONNECT_ERROR"))})}filterSideBar(){this.initSiteBar(),console.log(this.pondService.permission),this.pondService.pond&&(""==this.pondService.pond.current_season&&this.menuData.splice(0,1),0==this.pondService.pond.seed_date&&""!=this.pondService.pond.current_season&&(this.menuData[0].children.splice(1,2),this.menuData[0].children.splice(4,1)),this.menuData[this.menuData.length-1].children[1].subtitle=this._translate.translate(3==this.pondService.pond.public?"FARM.PRIVATE.PUBLIC":2==this.pondService.pond.public?"FARM.PRIVATE.FOLLOWED":"FARM.PRIVATE.PRIVATE"),this.menuData[this.menuData.length-1].children[3].badge.title=this.pondService.manager.length.toString())}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}openSeasonSeed(){console.log("opened season seed"),this._matDialog.open(qn,{autoFocus:!1,width:"500px"})}openHarvest(){this._matDialog.open(Mx.U,{autoFocus:!1,width:"500px"})}openMoveSeed(){this._matDialog.open(Ux.J,{autoFocus:!1,width:"500px"})}openCancelSeason(){this._matDialog.open(kx,{autoFocus:!1,width:"500px"})}openPondInfor(){this._matDialog.open(yx,{autoFocus:!1,width:"500px",data:{pondLocalIndex:this.pondLocalIndex}})}openPondPrivate(){this._matDialog.open(Nx,{autoFocus:!1,width:"500px",data:{pondLocalIndex:this.pondLocalIndex}})}openPondMember(){this._matDialog.open(Sx,{autoFocus:!1,width:"500px",data:{manager:this.pondService.manager}})}openConfirmRemovePond(){this._matDialog.open(Dx,{autoFocus:!1,width:"500px"}).afterClosed().subscribe(e=>{e&&"XOA"==e&&this.pondService.deletePond({confirm:"XOA"}).pipe().subscribe(e=>{1==e.status?(this._alertService.success(this._translate.translate("POND.DELETE_SUCCESSFUL")),this.pondService.setPond(null),-1!=this.pondLocalIndex&&this.dbLocalService.ponds.splice(this.pondLocalIndex,1),this.router.navigateByUrl("/farm/61d53da9700dc"),this._router.navigate(["farm/"+this._farmService.fcode])):this._alertService.error(e.error)})})}setCode(e){this.fcode=e}presentPublish(){this._matDialog.open(Fx,{autoFocus:!1})}routeToSeasonDeal(){this.pondService.pond.current_season?this.router.navigate(["season-deal"],{relativeTo:this.route}):this._alertService.error(this._translate.translate("POND.SEASON_NULL"))}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(Lx.T),p.Y36(d.uw),p.Y36(r.gz),p.Y36(r.F0),p.Y36(r.F0),p.Y36(m.p),p.Y36(f.c),p.Y36(t_.T),p.Y36(g.Vn),p.Y36(Jx.D))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-pond"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],["class","flex flex-col flex-auto min-w-0",4,"ngIf"],[1,"flex","flex-col","flex-auto","min-w-0"],[1,"px-6","pt-6","sm:pt-6","sm:px-10","bg-card","dark:bg-transparent"],[1,"hidden","sm:flex","flex-wrap","items-center","font-medium"],[1,"whitespace-nowrap","text-primary-500",3,"routerLink"],[1,"flex","items-center","ml-1","whitespace-nowrap"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"flex","sm:hidden"],[1,"inline-flex","items-center","-ml-1.5","text-secondary","font-medium",3,"routerLink"],[1,"ml-1"],[1,"flex","flex-col","sm:flex-row","flex-0","sm:items-center","sm:justify-between","p-6","pb-22","sm:pt-6","sm:pb-28","sm:px-10","bg-card","dark:bg-transparent"],[1,"flex-1","min-w-0"],[1,"mt-2"],[1,"text-3xl","md:text-4xl","font-extrabold","tracking-tight","leading-7","sm:leading-10","truncate"],[1,"flex","justify-around"],[1,"text-sm"],["svgIcon","area_chart",1,"icon-size-5","subIcon"],["svgIcon","iconsmind:down_3",1,"icon-size-5","subIcon"],["svgIcon","iconsmind:money_bag",1,"icon-size-5","subIcon"],["svgIcon","iconsmind:basket_coins",1,"icon-size-5","subIcon"],[1,"flex","flex-shrink-0","items-center","mt-6","sm:mt-0","sm:ml-4"],["mat-flat-button","",1,"mr-2",3,"routerLink","color"],[1,"icon-size-5",3,"svgIcon"],[1,"ml-2"],["mat-stroked-button","",1,"mr-2",3,"routerLink","color"],["mat-icon-button","",3,"click",4,"ngIf"],[1,"flex-auto","-mt-16","rounded-t-2xl","shadow","bg-default"],[1,"w-72","dark:bg-gray-900",3,"autoFocus","mode","opened","position"],["matDrawer",""],[3,"navigation","inner","mode","name","opened",4,"ngIf"],[1,"flex","flex-col"],[1,"flex-auto","p-6","sm:p-10"],[1,"min-h-200"],[4,"ngIf"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[3,"navigation","inner","mode","name","opened"]],template:function(e,t){1&e&&p.YNc(0,Bx,2,1,"ng-container",0),2&e&&p.Q6J("translocoRead","POND")},directives:[g.KI,i.O5,r.yS,y.Hw,v.lW,r.rH,Yx.kh,Yx.jA,Yx.LW,Qx.j,r.lC],pipes:[i.JJ],styles:[".subIcon[_ngcontent-%COMP%]{vertical-align:sub}"]}),e})();var Gx=n(88642),Wx=n(73868);function Kx(e,t){1&e&&p._UZ(0,"mat-progress-bar",19),2&e&&p.Q6J("mode","indeterminate")}function Xx(e,t){1&e&&p._UZ(0,"mat-progress-bar",19),2&e&&p.Q6J("mode","indeterminate")}function ew(e,t){if(1&e&&(p.TgZ(0,"div",20),p.TgZ(1,"p"),p._uU(2),p.qZA(),p.qZA()),2&e){const e=p.oxw().$implicit;p.xp6(2),p.Oqu(e("NO_DEAL"))}}function tw(e,t){if(1&e){const e=p.EpF();p.TgZ(0,"div",21),p.TgZ(1,"div",10),p._uU(2),p.ALo(3,"date"),p.qZA(),p.TgZ(4,"div",11),p.TgZ(5,"div",22),p.TgZ(6,"p",23),p._uU(7),p.qZA(),p.TgZ(8,"p",24),p._uU(9),p.qZA(),p.qZA(),p.TgZ(10,"div",22),p.TgZ(11,"p",23),p._uU(12),p.qZA(),p.TgZ(13,"p",24),p._uU(14),p.qZA(),p.qZA(),p.TgZ(15,"div",22),p.TgZ(16,"p",23),p._uU(17),p.qZA(),p.TgZ(18,"p",24),p._uU(19),p.qZA(),p.qZA(),p.TgZ(20,"div",22),p.TgZ(21,"p",23),p._uU(22),p.qZA(),p.TgZ(23,"p",24),p._uU(24),p.ALo(25,"date"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(26,"div",10),p._uU(27),p.ALo(28,"number"),p.qZA(),p.TgZ(29,"div",11),p._uU(30),p.qZA(),p.TgZ(31,"div",10),p.TgZ(32,"button",25),p._UZ(33,"mat-icon",26),p.qZA(),p.TgZ(34,"mat-menu",null,27),p.TgZ(36,"button",28),p.NdJ("click",function(){const t=p.CHM(e).$implicit;return p.oxw(2).presentConfirmDeal(t)}),p._UZ(37,"mat-icon",29),p.TgZ(38,"span"),p._uU(39),p.qZA(),p.qZA(),p.TgZ(40,"button",28),p.NdJ("click",function(){const t=p.CHM(e).$implicit;return p.oxw(2).presentCancelDeal(t)}),p._UZ(41,"mat-icon",30),p.TgZ(42,"span"),p._uU(43),p.qZA(),p.qZA(),p.TgZ(44,"button",31),p.NdJ("click",function(){const t=p.CHM(e).$implicit;return p.oxw(2).presentRateOrder(t)}),p._UZ(45,"mat-icon",32),p.TgZ(46,"span"),p._uU(47),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=t.$implicit,n=p.MAs(35),i=p.oxw().$implicit,r=p.oxw();p.xp6(2),p.hij(" ",p.xi3(3,16,1e3*e.add_time,"dd/MM/yyyy")," "),p.xp6(5),p.hij(" ",i("SPECIES")," "),p.xp6(2),p.hij(" ",e.species_name," "),p.xp6(3),p.hij(" ",i("SIZE")," "),p.xp6(2),p.hij(" ",e.require_size," "),p.xp6(3),p.hij(" ",i("PRICE")," "),p.xp6(2),p.hij(" ",e.require_price," "),p.xp6(3),p.hij(" ",i("REQ_DATE")," "),p.xp6(2),p.hij(" ",p.xi3(25,19,1e3*e.require_time,"dd/MM/yyyy")," "),p.xp6(3),p.hij(" ",p.xi3(28,22,e.deposit,"0.0-0")," \u0111 "),p.xp6(3),p.hij(" ",r.listOrderStatus[e.status]," "),p.xp6(2),p.Q6J("matMenuTriggerFor",n),p.xp6(7),p.Oqu(i("CONFIRM")),p.xp6(4),p.Oqu(i("CANCEL")),p.xp6(1),p.Q6J("disabled","order"==e.status||"confirm"==e.status||"cancel"==e.status),p.xp6(3),p.Oqu(i("RATE"))}}function nw(e,t){if(1&e&&(p.ynx(0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p.TgZ(4,"div",4),p.TgZ(5,"div",5),p.TgZ(6,"div"),p.TgZ(7,"div",6),p._uU(8),p.qZA(),p.qZA(),p.qZA(),p.TgZ(9,"div",7),p.TgZ(10,"div",8),p.TgZ(11,"div",9),p.TgZ(12,"div",10),p._uU(13),p.qZA(),p.TgZ(14,"div",11),p._uU(15),p.qZA(),p.TgZ(16,"div",12),p._uU(17),p.TgZ(18,"button",13),p._UZ(19,"mat-icon",14),p.qZA(),p.qZA(),p.TgZ(20,"div",11),p._uU(21),p.qZA(),p.TgZ(22,"div",10),p._uU(23),p.qZA(),p.qZA(),p.TgZ(24,"div"),p.YNc(25,Kx,1,1,"mat-progress-bar",15),p.qZA(),p.TgZ(26,"div"),p.YNc(27,Xx,1,1,"mat-progress-bar",15),p.qZA(),p.YNc(28,ew,3,1,"div",16),p.TgZ(29,"div",17),p.YNc(30,tw,48,25,"div",18),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.BQk()),2&e){const e=t.$implicit,n=p.oxw();p.xp6(8),p.Oqu(e("TITLE")),p.xp6(5),p.hij(" ",e("DAY")," "),p.xp6(2),p.hij(" ",e("REQUIREMENTS")," "),p.xp6(2),p.hij(" ",e("DEPOSIT")," "),p.xp6(1),p.Q6J("matTooltip",e("DEPOSIT_NOTE")),p.xp6(1),p.Q6J("svgIcon","heroicons_outline:question-mark-circle"),p.xp6(2),p.hij(" ",e("STATUS")," "),p.xp6(2),p.hij(" ",e("ACTIONS")," "),p.xp6(2),p.Q6J("ngIf",n.loadingFlag.pending),p.xp6(2),p.Q6J("ngIf",n.savingFlag.pending),p.xp6(1),p.Q6J("ngIf",n.loadingFlag.result&&!n.dealList.length),p.xp6(2),p.Q6J("ngForOf",n.dealList)}}const iw=[{path:"",component:zx,children:[{path:"",component:GT},{path:"season",loadChildren:()=>n.e(757).then(n.bind(n,42757)).then(e=>e.SeasonModule)},{path:"record",component:Ae},{path:"device",component:mx},{path:"season-deal",component:(()=>{class e{constructor(e,t,n,i,r,s){this._pondService=e,this._marketService=t,this._alertService=n,this._translateService=i,this._fuseConfirmationService=r,this._matDialog=s,this.loadingFlag=new a.E,this.savingFlag=new a.E,this.listOrderStatus={order:this._translateService.translate("MARKET.SELLER_DEAL.ORDERED"),confirm:this._translateService.translate("MARKET.SELLER_DEAL.CONFIRMED"),deposit_reveived:this._translateService.translate("MARKET.SELLER_DEAL.DEPOSIT_RECEIVED"),success:this._translateService.translate("MARKET.SELLER_DEAL.SUCCESS"),deposit_paid:this._translateService.translate("MARKET.SELLER_DEAL.RETURNED_DEPOSIT"),cancel:this._translateService.translate("MARKET.SELLER_DEAL.CANCELED")}}ngOnInit(){this.listSeasonDeal()}listSeasonDeal(){this.loadingFlag.setPending(!0),this._marketService.listDealBySeason(this._pondService.pond.current_season).pipe().subscribe(e=>{0==e.status?(this._alertService.error(e.error),this.loadingFlag.setResult(!1)):(this.dealList=e.data,this.loadingFlag.setResult(!0))},e=>{this._alertService.error(this._translateService.translate("CONNECT_ERROR")),this.loadingFlag.setResult(!1)})}presentConfirmDeal(e){this._fuseConfirmationService.open({title:this._translateService.translate("MARKET.SELLER_DEAL.CONFIRM_TITLE"),message:this._translateService.translate("MARKET.SELLER_DEAL.CONFIRM_NOTE"),actions:{confirm:{label:this._translateService.translate("CONFIRM")},cancel:{label:this._translateService.translate("CANCEL")}}}).afterClosed().subscribe(t=>{t&&"confirmed"==t&&this.dealAction(e,!0)})}presentCancelDeal(e){this._fuseConfirmationService.open({title:this._translateService.translate("FARM.MANAGER.WARN"),message:this._translateService.translate("MARKET.SELLER_DEAL.CANCEL_NOTE"),actions:{confirm:{label:this._translateService.translate("CONFIRM")},cancel:{label:this._translateService.translate("CANCEL")}}}).afterClosed().subscribe(t=>{t&&"confirmed"==t&&this.dealAction(e,!1)})}dealAction(e,t){this.savingFlag.setPending(!0),this._marketService.dealAction(e.season_code,{bill_item:e.item_offer_id,action:t?"confirm":"cancel"}).pipe().subscribe(e=>{0==e.status?this._alertService.error(e.error):(this._alertService.success(this._translateService.translate(t?"MARKET.SELLER_DEAL.CONFIRM_SUCCESS":"MARKET.SELLER_DEAL.CANCEL_SUCCESS")),this.listSeasonDeal()),this.savingFlag.setResult(!0)},e=>{this.savingFlag.setResult(!1),this._alertService.error(this._translateService.translate("CONNECT_ERROR"))})}presentRateOrder(e){this._matDialog.open(Gx.r,{autoFocus:!1,data:{isSeller:!0,id:e.id}}).afterClosed().subscribe(e=>{e&&this.listSeasonDeal()})}}return e.\u0275fac=function(t){return new(t||e)(p.Y36(m.p),p.Y36(Wx.j),p.Y36(f.c),p.Y36(g.Vn),p.Y36(P.R),p.Y36(d.uw))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-season-deal"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","flex-auto","min-w-0"],[1,"flex-auto"],[1,"flex","flex-col","flex-auto","w-full"],[1,"flex","flex-wrap","w-full","max-w-screen-xl"],[1,"flex","items-center","justify-between","w-full"],[1,"text-3xl","font-semibold","tracking-tight","leading-8"],[1,"bg-card","shadow","rounded-2xl","overflow-hidden","w-full","mt-8"],[1,"grid"],[1,"grid-cols-12","z-10","sticky","top-0","grid","gap-4","py-4","px-8","shadow","text-md","font-semibold","bg-gray-50","items-center"],[1,"col-span-2"],[1,"col-span-3"],[1,"col-span-2","flex","flex-row","items-center"],["mat-icon-button","","matTooltipPosition","above","matTooltipClass","text-base",3,"matTooltip"],[1,"icon-size-5","text-current",3,"svgIcon"],[3,"mode",4,"ngIf"],["class","mt-3 p-6 bg-card shadow rounded-2xl overflow-hidden text-lg font-medium",4,"ngIf"],[1,"max-h-160","overflow-y-auto"],["class","grid-cols-12 grid items-center gap-4 py-3 px-8 border-b",4,"ngFor","ngForOf"],[3,"mode"],[1,"mt-3","p-6","bg-card","shadow","rounded-2xl","overflow-hidden","text-lg","font-medium"],[1,"grid-cols-12","grid","items-center","gap-4","py-3","px-8","border-b"],[1,"grid-cols-12","grid","items-center"],[1,"col-span-4"],[1,"col-span-8"],["mat-icon-button","",3,"matMenuTriggerFor"],["svgIcon","heroicons_outline:dots-vertical"],["menu","matMenu"],["mat-menu-item","",3,"click"],["svgIcon","heroicons_outline:check"],["svgIcon","heroicons_outline:x",1,"text-red-500"],["mat-menu-item","",3,"disabled","click"],["svgIcon","heroicons_outline:star"]],template:function(e,t){1&e&&p.YNc(0,nw,31,12,"ng-container",0),2&e&&p.Q6J("translocoRead","MARKET.SELLER_DEAL")},directives:[g.KI,v.lW,Y.gM,y.Hw,i.O5,i.sg,I.pW,ax.p6,ax.VK,ax.OP],pipes:[i.uU,i.JJ],styles:[""]}),e})()}]}];let rw=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=p.oAB({type:e}),e.\u0275inj=p.cJS({imports:[[r.Bz.forChild(iw)],r.Bz]}),e})();var sw=n(44466),ow=n(82808),aw=n(4083),lw=n(84900);let cw=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=p.oAB({type:e}),e.\u0275inj=p.cJS({imports:[[i.ez,sw.m,aw.q,lw.Z,_.lN,T.c,rw,ow.PU,Le.N,si.hO.initializeApp(Se.pq),e_.enablePersistence(),Py,g.y4]]}),e})()},95585:(e,t,n)=>{"use strict";n.d(t,{U:()=>D});var i=n(21611),r=n(3679),s=n(22238),o=n(53040),a=n(5396),l=n(16738),c=n.n(l),u=n(54395),d=n(37716),h=n(40704),p=n(48682),m=n(42120),f=n(95987),g=n(8394),v=n(51095),y=n(76627),_=n(38583),T=n(7539),x=n(98295),w=n(67441),b=n(72458),Z=n(49983),A=n(21554),I=n(12178);function S(e,t){1&e&&d._UZ(0,"mat-progress-bar",37)}function E(e,t){1&e&&d._UZ(0,"mat-progress-bar",37)}function q(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"mat-form-field",13),d.TgZ(1,"mat-label"),d._uU(2),d.qZA(),d.TgZ(3,"input",38),d.NdJ("keypress",function(t){return d.CHM(e),d.oxw(2).validNo(t)})("keyup",function(t){return d.CHM(e),d.oxw(2).onChangeQuantity(t.target.value)}),d.qZA(),d.qZA()}if(2&e){const e=d.oxw().$implicit;d.xp6(2),d.hij("",e("HARVEST_PERCENTAGE")," (%)"),d.xp6(1),d.Q6J("placeholder",e("ENTER_RATIO"))}}function N(e,t){if(1&e&&(d.TgZ(0,"mat-option",39),d.TgZ(1,"b"),d._uU(2),d.qZA(),d._uU(3),d.qZA()),2&e){const e=t.$implicit;d.Q6J("value",e.id),d.xp6(2),d.Oqu(e.name),d.xp6(1),d.hij(" | ",e.fullname," ")}}function C(e,t){if(1&e){const e=d.EpF();d.ynx(0),d.TgZ(1,"div",1),d.TgZ(2,"div",2),d.TgZ(3,"div",3),d._UZ(4,"span",4),d.qZA(),d.TgZ(5,"button",5),d._UZ(6,"mat-icon",6),d.qZA(),d.qZA(),d.TgZ(7,"div",7),d.YNc(8,S,1,0,"mat-progress-bar",8),d.YNc(9,E,1,0,"mat-progress-bar",8),d.TgZ(10,"div",9),d.TgZ(11,"p",10),d._uU(12),d.TgZ(13,"mat-checkbox",11),d.NdJ("click",function(){return d.CHM(e),d.oxw().checkDefault()}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(14,"div",12),d.TgZ(15,"mat-form-field",13),d.TgZ(16,"mat-label"),d._uU(17),d.qZA(),d.TgZ(18,"mat-select",14),d.NdJ("selectionChange",function(t){return d.CHM(e),d.oxw().onChangeType(t.value)}),d.TgZ(19,"mat-option",15),d._uU(20),d.qZA(),d.TgZ(21,"mat-option",16),d._uU(22),d.qZA(),d.qZA(),d.qZA(),d.YNc(23,q,4,2,"mat-form-field",17),d.qZA(),d.TgZ(24,"div",18),d.TgZ(25,"mat-form-field",19),d.TgZ(26,"mat-label"),d._uU(27),d.qZA(),d.TgZ(28,"input",20),d.NdJ("keyup",function(t){return d.CHM(e),d.oxw().onChangeSize(t.target.value)})("keypress",function(t){return d.CHM(e),d.oxw().validNo(t)}),d.qZA(),d.qZA(),d.TgZ(29,"mat-form-field",13),d.TgZ(30,"mat-label"),d._uU(31),d.qZA(),d.TgZ(32,"mat-select",21),d.NdJ("selectionChange",function(t){return d.CHM(e),d.oxw().onChangeUnit(t)}),d.TgZ(33,"mat-option",22),d._uU(34),d.qZA(),d.TgZ(35,"mat-option",23),d._uU(36,"g/con"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(37,"div",12),d.TgZ(38,"mat-form-field",13),d.TgZ(39,"mat-label"),d._uU(40),d.qZA(),d.TgZ(41,"input",24),d.NdJ("keypress",function(t){return d.CHM(e),d.oxw().validNo(t)})("keyup",function(t){return d.CHM(e),d.oxw().onChangePercent(t.target.value)})("input",function(t){return d.CHM(e),d.oxw().numberFormatQuantity.setValue(t.target.value)}),d.qZA(),d.qZA(),d.TgZ(42,"mat-form-field",13),d.TgZ(43,"mat-label"),d._uU(44),d.qZA(),d.TgZ(45,"input",25),d.NdJ("keypress",function(t){return d.CHM(e),d.oxw().validNo(t)})("input",function(t){return d.CHM(e),d.oxw().numberFormatPrice.setValue(t.target.value)}),d.qZA(),d.qZA(),d.TgZ(46,"mat-form-field",13),d.TgZ(47,"mat-label"),d._uU(48),d.qZA(),d.TgZ(49,"input",26),d.NdJ("keypress",function(t){return d.CHM(e),d.oxw().validNo(t)})("input",function(t){return d.CHM(e),d.oxw().numberFormatCost.setValue(t.target.value)}),d.qZA(),d.qZA(),d.TgZ(50,"mat-form-field",13),d.TgZ(51,"mat-label"),d._uU(52),d.qZA(),d._UZ(53,"input",27),d.TgZ(54,"mat-autocomplete",28,29),d.NdJ("optionSelected",function(t){return d.CHM(e),d.oxw().onSelect(t.option.value)}),d.YNc(56,N,4,3,"mat-option",30),d.ALo(57,"async"),d.qZA(),d.qZA(),d.TgZ(58,"mat-form-field",13),d.TgZ(59,"mat-label"),d._uU(60),d.qZA(),d._UZ(61,"textarea",31),d.qZA(),d.qZA(),d.TgZ(62,"div",32),d.TgZ(63,"p"),d._uU(64),d.qZA(),d.TgZ(65,"p",33),d._uU(66),d.ALo(67,"number"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(68,"div",34),d.TgZ(69,"button",35),d.NdJ("click",function(){return d.CHM(e),d.oxw().onSave()}),d._uU(70),d.qZA(),d.TgZ(71,"button",36),d.NdJ("click",function(){return d.CHM(e),d.oxw().dialogRef.close()}),d._uU(72),d.qZA(),d.qZA(),d.qZA(),d.BQk()}if(2&e){const e=t.$implicit,n=d.MAs(55),i=d.oxw();d.xp6(4),d.Q6J("innerHTML",e("TITLE"),d.oJD),d.xp6(1),d.Q6J("tabIndex",-1),d.xp6(1),d.Q6J("svgIcon","heroicons_outline:x"),d.xp6(1),d.Q6J("formGroup",i.form),d.xp6(1),d.Q6J("ngIf",i.loadingFlag.pending),d.xp6(1),d.Q6J("ngIf",i.savingFlag.pending),d.xp6(3),d.hij("",e("CHECK")," "),d.xp6(5),d.Oqu(e("HARVEST_TYPE")),d.xp6(1),d.Q6J("placeholder",e("CHOOSE_HARVEST_TYPE")),d.xp6(2),d.Oqu(e("TOTAL_HARVEST")),d.xp6(2),d.Oqu(e("PARTIAL_HARVEST")),d.xp6(1),d.Q6J("ngIf","keep"==i.form.controls.method.value),d.xp6(4),d.Oqu(e("SIZE")),d.xp6(1),d.Q6J("placeholder",e("ENTER_SIZE")),d.xp6(3),d.Oqu(e("UNIT")),d.xp6(1),d.Q6J("placeholder",e("SELECT_UNIT")),d.xp6(2),d.hij("",e("PIECE"),"/kg"),d.xp6(6),d.hij("",e("QUANTITY")," (kg)"),d.xp6(1),d.Q6J("placeholder",e("ENTER_QUANTITY")),d.xp6(3),d.hij("",e("PRICE")," (\u0111)"),d.xp6(1),d.Q6J("placeholder",e("ENTER_PRICE")),d.xp6(3),d.hij("",e("HARVEST_COST")," (\u0111)"),d.xp6(1),d.Q6J("placeholder",e("ENTER_COST"))("value",i.numberFormatCost.fakeView),d.xp6(3),d.Oqu(e("CUSTOMER")),d.xp6(1),d.Q6J("placeholder",e("ENTER_CUSTOMER"))("matAutocomplete",n),d.xp6(3),d.Q6J("ngForOf",d.lcZ(57,35,i.manufacturer$)),d.xp6(4),d.Oqu(e("NOTE")),d.xp6(1),d.Q6J("placeholder",e("NOTE")),d.xp6(3),d.Oqu(e("REVENUE")),d.xp6(2),d.hij("",d.xi3(67,37,i.proceeds,"0.0-0"),"\u0111"),d.xp6(3),d.Q6J("disabled",i.form.invalid),d.xp6(1),d.hij(" ",e("SAVE")," "),d.xp6(2),d.hij(" ",e("CANCEL")," ")}}let D=(()=>{class e{constructor(e,t,n,i,s,l,u,d){this.alerService=e,this._formBuilder=t,this.pondService=n,this.dialogRef=i,this.data=s,this.dbLocalService=l,this.router=u,this._translate=d,this.loadingFlag=new a.E,this.savingFlag=new a.E,this.numberFormatPrice=new o.y(""),this.numberFormatQuantity=new o.y(""),this.numberFormatCost=new o.y(""),this.minDate=c()().subtract(180,"days"),this.maxDate=c()(),this.percentage=100,this.proceeds=0,this.seed_quantity=0,this.booleanCheck=!0,this.message="",this.form=new r.cw({method:new r.NI("end",[r.kI.required]),harvest_quantity:new r.NI("",[r.kI.required]),harvest_price:new r.NI("",[r.kI.required]),harvest_size:new r.NI("",[r.kI.required]),buyer:new r.NI(""),buyer_id:new r.NI(0),harvest_cost:new r.NI(""),note:new r.NI(""),unit:new r.NI("con",[r.kI.required]),harvest_ratio:new r.NI(100,[r.kI.min(1),r.kI.max(100)]),check:new r.NI(!0)}),this.quantityConvert=0}ngOnInit(){var e=this;return(0,i.Z)(function*(){e.minDate<e.pondService.seasonStartTime&&(e.minDate=e.pondService.seasonStartTime),e.form.controls.buyer.valueChanges.pipe((0,u.b)(300)).subscribe(t=>{e.form.controls.buyer_id.setValue(0),e.getListManufacturer(t)}),yield e.getLoadToday(),yield e.getAllActionsInPond(),yield e.getWeightPresent()})()}getListManufacturer(e){e.length>=2&&(this.loadingFlag.setPending(!0),this.manufacturer$=this.pondService.searchManufacturer(e).pipe(e=>(this.message=0==e.length?this._translate.translate("SEASON.HARVEST_MOD.NO_INFO"):"",this.loadingFlag.setResult(!0),e)))}validNo(e){this.form.valueChanges.subscribe(e=>{this.proceeds=e.harvest_price*e.harvest_quantity});const t=e.which?e.which:e.keyCode;return!(t>31&&(t<47||t>58))}getLoadToday(){var e=this;return(0,i.Z)(function*(){var t,n;const i=yield e.pondService.loadToday().toPromise().catch(e=>{});console.log("loadToday",i),i&&(e.season_code_present=i.season.code,e.weight=(null===(t=i.estimate)||void 0===t?void 0:t.weight.length)>0?null===(n=i.estimate)||void 0===n?void 0:n.weight[0].weight:i.season.seed_weight,console.log(e.totalLoss))})()}getAllActionsInPond(){var e=this;return(0,i.Z)(function*(){const t=yield e.pondService.loadDependency().toPromise().catch(e=>{});if(t.data){let n=t.data.move,i=t.data.seed;e.totalHarvest=t.data.harvest.reduce((e,t)=>e+t.harvest_quantity/t.harvest_size*1e3,0),e.totalSeed=e.CalTotal(i,"seed_quantity");let r=n.filter(t=>t.from_season_code!=e.season_code_present),s=n.filter(t=>t.from_season_code==e.season_code_present);e.totalMoveIn=e.CalTotal(r,"quantity_individual"),e.totalMoveOut=e.CalTotal(s,"quantity_individual"),console.log(r,"duoc chuyen den"),console.log(s,"chuyen di")}})()}CalTotal(e,t){return e.reduce((e,n)=>(console.log(n[t]),e+Number(n[t])),0)}onSelect(e){this.manufacturer$.subscribe(t=>{t.forEach(t=>{t.id==e&&(this.buyerSelected=t,this.form.controls.buyer.setValue(t.fullname),this.form.controls.buyer_id.setValue(t.id))})})}onSave(){if(this.validateAllFormFields(this.form),this.form.invalid)return!1;"kg"==this.form.value.unit&&(this.form.value.harvest_size=(1e3/this.form.value.harvest_size).toFixed(2),this.form.value.unit="con");const e={method:this.form.value.method,quantity:this.form.value.harvest_quantity,price:this.numberFormatPrice.realValue,size:this.form.value.harvest_size,buyer:this.form.value.buyer,buyer_id:this.form.value.buyer_id,harvest_cost:this.numberFormatCost.realValue,note:this.form.value.note,unit:this.form.value.unit,harvest_ratio:this.form.value.harvest_ratio};"end"==e.method&&(e.harvest_ratio=100),this.savingFlag.setPending(!0),console.log(e),this.pondService.reqSeasonCollect(e).subscribe(e=>{if(1==e.status){if(this.alerService.success(e.message),"end"==this.form.value.method){let e=this.dbLocalService.ponds.findIndex(e=>e.infor.code===this.pondService.pcode);if(e>=0){let t={infor:this.pondService.pond,devices:[]};t.infor.current_season="",t.infor.species_id=null,t.infor.species=null,t.infor.start_time=null,this.dbLocalService.updateItem("ponds",t,e)}this.pondService.seasonStart=!1,this.pondService.pond.seed_date=0,this.pondService.pond.current_season="",this.pondService.onLoaded$.next(1),this.router.navigateByUrl("pond/"+this.pondService.pcode+"/season/list")}this.dialogRef.close(this.form.value),this.savingFlag.setResult(!0)}else this.alerService.error(e.message),this.savingFlag.setResult(!1)},()=>{this.savingFlag.setResult(!1),this.alerService.error(this._translate.translate("CONNECT_ERROR"))})}validateAllFormFields(e){Object.keys(e.controls).forEach(t=>{const n=e.get(t);n instanceof r.NI?n.markAsTouched({onlySelf:!0}):n instanceof r.cw&&this.validateAllFormFields(n)})}getWeightPresent(){var e=this;return(0,i.Z)(function*(){console.log("scode",e.season_code_present);const t=yield e.pondService.getWeightPresent(e.season_code_present).toPromise().catch(t=>{e.alerService.error(e._translate.translate("CONNECT_ERROR"))});console.log(t.data),t.data&&(e.weightDetail=t.data.weight,console.log(t.data.total_loss),e.totalLoss=t.data.total_loss,e.form.patchValue({harvest_size:e.weightDetail}),e.seed_quantity=+e.totalSeed+ +e.totalMoveIn-e.totalLoss-+e.totalMoveOut-+e.totalHarvest,console.log(e.seed_quantity),setTimeout(()=>{console.log(+e.totalSeed+ +e.totalMoveIn,e.totalLoss,e.totalHarvest,e.totalMoveOut,e.weightDetail)},1e3),e.quantityKg=e.seed_quantity*+e.weightDetail/1e3,console.log(e.quantityKg),e.form.controls.harvest_quantity.setValue(e.quantityKg))})()}checkDefault(){1==this.form.value.check?(this.booleanCheck=!1,console.log("false")):(this.booleanCheck=!0,console.log("true"))}onChangeSize(e){this.booleanCheck&&null!=e&&(this.quantityKg=this.seed_quantity*(1e3/+this.form.controls.harvest_size.value)/1e3,console.log("kg"),"con"==this.form.value.unit&&(console.log("con"),this.quantityKg=this.seed_quantity*+this.form.controls.harvest_size.value/1e3),this.form.patchValue({harvest_quantity:this.quantityKg*(this.form.controls.harvest_ratio.value/100)}))}onChangeQuantity(e){if(this.booleanCheck){let t=this.quantityKg*e/100;this.quantityConvert=t,this.form.patchValue({harvest_quantity:Math.round(t)})}}onChangePercent(e){if(this.booleanCheck){let t=e/this.quantityKg*100;this.quantityConvert=this.form.controls.harvest_quantity.value,this.form.patchValue({harvest_ratio:Math.round(t)})}}onChangeUnit(e){this.form.patchValue("kg"==e.value?{harvest_size:(1/(this.form.controls.harvest_size.value/1e3)).toFixed(2)}:{harvest_size:1e3*Number(1/this.form.controls.harvest_size.value)})}onChangeType(e){this.form.patchValue({harvest_ratio:100,harvest_quantity:this.seed_quantity*+this.weightDetail/1e3})}}return e.\u0275fac=function(t){return new(t||e)(d.Y36(h.c),d.Y36(r.qu),d.Y36(p.p),d.Y36(s.so),d.Y36(s.WI),d.Y36(m.T),d.Y36(f.F0),d.Y36(g.Vn))},e.\u0275cmp=d.Xpm({type:e,selectors:[["app-season-harvest"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"flex","flex-col","max-w-240","md:min-w-120","sm:max-h-screen","-m-6"],[1,"flex","flex-0","items-center","justify-between","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8","bg-primary","text-on-primary"],[1,"text-lg","font-medium"],[1,"title","dialog-title",3,"innerHTML"],["mat-icon-button","","mat-dialog-close","",3,"tabIndex"],[1,"text-current",3,"svgIcon"],[1,"flex","flex-col","flex-auto","p-6","sm:p-8","sm:pb-0","overflow-y-auto",3,"formGroup"],["mode","indeterminate",4,"ngIf"],[1,"flex","justify-end"],[1,"flex","justify-around","w-56","h-6","rounded-2xl",2,"color","white","background-color","rgb(173 173 173)"],["color","primary","formControlName","check",3,"click"],[1,"grid","grid-cols-1"],[1,"w-full"],["formControlName","method",3,"placeholder","selectionChange"],["value","end"],["value","keep"],["class","w-full",4,"ngIf"],[1,"grid","grid-cols-2"],[1,"w-full","md:pr-2"],["matInput","","min","0","type","number","formControlName","harvest_size",3,"placeholder","keyup","keypress"],["formControlName","unit",3,"placeholder","selectionChange"],["value","kg"],["value","con"],["matInput","","formControlName","harvest_quantity","required","",3,"placeholder","keypress","keyup","input"],["matInput","","formControlName","harvest_price","required","",3,"placeholder","keypress","input"],["matInput","","formControlName","harvest_cost","required","",3,"placeholder","value","keypress","input"],["type","text","matInput","","formControlName","buyer",3,"placeholder","matAutocomplete"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","note",3,"placeholder"],[1,"flex","justify-between"],[1,"text-green-400"],[1,"flex","flex-0","items-center","justify-end","h-16","pr-3","sm:pr-5","pl-6","sm:pl-8"],["mat-flat-button","","color","primary",1,"mr-3",3,"disabled","click"],["mat-stroked-button","",3,"click"],["mode","indeterminate"],["matInput","","formControlName","harvest_ratio","required","",3,"placeholder","keypress","keyup"],[3,"value"]],template:function(e,t){1&e&&d.YNc(0,C,73,40,"ng-container",0),2&e&&d.Q6J("translocoRead","SEASON.HARVEST_MOD")},directives:[g.KI,v.lW,s.ZT,y.Hw,r.JL,r.sg,_.O5,T.oG,r.JJ,r.u,x.KE,x.hX,w.gD,b.ey,Z.Nt,r.qQ,r.wV,r.Fj,r.Q7,A.ZL,A.XC,_.sg,I.pW],pipes:[_.Ov,_.JJ],styles:[""]}),e})()},67813:(e,t,n)=>{"use strict";n.d(t,{J:()=>D});var i=n(3679),r=n(53040),s=n(5396),o=n(37716),a=n(48682),l=n(40704),c=n(95987),u=n(8394),d=n(13994),h=n(97832),p=n(38583),m=n(98295),f=n(49983),g=n(67441),v=n(72458),y=n(51095),_=n(1769),T=n(58341),x=n(12178);function w(e,t){if(1&e&&(o._uU(0),o.TgZ(1,"span"),o._uU(2),o.qZA()),2&e){const e=o.oxw().$implicit,t=o.oxw();o.hij("",e("CURRENT_POND")," "),o.xp6(2),o.AsE(": ",e("SURVIVAL_RATE")," (",t.form1.controls.ratio.value,"%)")}}function b(e,t){if(1&e&&(o.TgZ(0,"div",11),o._uU(1),o.TgZ(2,"p"),o._uU(3),o.ALo(4,"number"),o.qZA(),o.qZA()),2&e){const e=o.oxw().$implicit,t=o.oxw();o.xp6(1),o.hij(" ",e("MOVED")," "),o.xp6(2),o.AsE("",o.xi3(4,3,t.total_move,"1.0-1")," ",e("PIECES")," ")}}function Z(e,t){if(1&e&&o._uU(0),2&e){const e=o.oxw().$implicit;o.hij("",e("TRANSFER_DETAILS")," ")}}function A(e,t){if(1&e&&(o.TgZ(0,"mat-option",41),o._uU(1),o.qZA()),2&e){const e=t.$implicit,n=o.oxw().$implicit;o.Q6J("value",e.id),o.xp6(1),o.HOy("",e.name," (",n("STARTED")," ",e.moment_day," ",n("DAY_AGO"),") ")}}function I(e,t){1&e&&o._UZ(0,"mat-progress-bar",42)}function S(e,t){if(1&e&&o._uU(0),2&e){const e=o.oxw().$implicit;o.hij("",e("TRANSFER_CONFIRM")," ")}}function E(e,t){if(1&e&&(o.TgZ(0,"mat-chip",43),o._uU(1),o.qZA()),2&e){const e=t.$implicit;o.xp6(1),o.hij(" ",e," ")}}function q(e,t){1&e&&o._UZ(0,"mat-progress-bar",42)}const N=function(){return{"text-green-500":!0}};function C(e,t){if(1&e){const e=o.EpF();o.ynx(0),o.TgZ(1,"div",1),o.TgZ(2,"div",2),o.TgZ(3,"fuse-alert",3),o.TgZ(4,"span",4),o._uU(5),o.qZA(),o._uU(6),o.qZA(),o.qZA(),o.TgZ(7,"mat-vertical-stepper",5),o.TgZ(8,"mat-step",6),o.TgZ(9,"form",7),o.YNc(10,w,3,3,"ng-template",8),o.TgZ(11,"div"),o.TgZ(12,"div",9),o.TgZ(13,"div",10),o.TgZ(14,"b"),o._uU(15),o.qZA(),o.qZA(),o.TgZ(16,"div",11),o._uU(17),o.TgZ(18,"p",12),o._uU(19),o.ALo(20,"number"),o.TgZ(21,"b"),o._uU(22,"\u0111"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(23,"div",11),o._uU(24),o.TgZ(25,"p"),o._uU(26),o.ALo(27,"number"),o.qZA(),o.qZA(),o.YNc(28,b,5,6,"div",13),o.qZA(),o.TgZ(29,"div",14),o.TgZ(30,"div",15),o.TgZ(31,"mat-form-field",16),o.TgZ(32,"mat-label"),o._uU(33),o.qZA(),o._UZ(34,"input",17),o.qZA(),o.qZA(),o.TgZ(35,"div",15),o.TgZ(36,"mat-form-field",16),o.TgZ(37,"mat-label"),o._uU(38),o.qZA(),o.TgZ(39,"mat-select",18),o.NdJ("selectionChange",function(t){return o.CHM(e),o.oxw().onChangeUnit(t.value)}),o.TgZ(40,"mat-option",19),o._uU(41),o.qZA(),o.TgZ(42,"mat-option",20),o._uU(43,"con/kg"),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(44,"div",15),o.TgZ(45,"mat-form-field",16),o.TgZ(46,"mat-label"),o._uU(47),o.qZA(),o.TgZ(48,"input",21),o.NdJ("keyup",function(t){return o.CHM(e),o.oxw().onChangeRatio(t)})("input",function(t){return o.CHM(e),o.oxw().numberFormatQuantityLive.setValue(t.target.value)}),o.qZA(),o.TgZ(49,"span",22),o._uU(50),o.qZA(),o.qZA(),o.qZA(),o.TgZ(51,"div",15),o.TgZ(52,"mat-form-field",16),o.TgZ(53,"mat-label"),o._uU(54),o.qZA(),o.TgZ(55,"input",23),o.NdJ("keyup",function(){return o.CHM(e),o.oxw().onChangeRate()}),o.qZA(),o.TgZ(56,"span",22),o._uU(57,"%"),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(58,"div",24),o.TgZ(59,"button",25),o.NdJ("click",function(){return o.CHM(e),o.oxw().onNext()}),o._uU(60),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(61,"mat-step",6),o.TgZ(62,"form",7),o.YNc(63,Z,1,1,"ng-template",8),o.TgZ(64,"div"),o.TgZ(65,"div",26),o.TgZ(66,"mat-form-field",16),o.TgZ(67,"mat-label"),o._uU(68),o.qZA(),o.TgZ(69,"mat-select",27),o.YNc(70,A,2,5,"mat-option",28),o.qZA(),o.qZA(),o.TgZ(71,"mat-form-field",16),o.TgZ(72,"mat-label"),o._uU(73),o.qZA(),o.TgZ(74,"input",29),o.NdJ("input",function(t){return o.CHM(e),o.oxw().numberFormatQuantity.setValue(t.target.value)}),o.qZA(),o.qZA(),o.TgZ(75,"mat-form-field",16),o.TgZ(76,"mat-label"),o._uU(77),o.qZA(),o.TgZ(78,"input",30),o.NdJ("input",function(t){return o.CHM(e),o.oxw().numberFormatCost.setValue(t.target.value)}),o.qZA(),o.qZA(),o.TgZ(79,"mat-form-field",16),o.TgZ(80,"mat-label"),o._uU(81),o.qZA(),o._UZ(82,"textarea",31),o.qZA(),o.qZA(),o.YNc(83,I,1,0,"mat-progress-bar",32),o.TgZ(84,"div",33),o.TgZ(85,"button",34),o._uU(86),o.qZA(),o.TgZ(87,"button",25),o.NdJ("click",function(){return o.CHM(e),o.oxw().onNext2()}),o._uU(88),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(89,"mat-step",6),o.TgZ(90,"form"),o.YNc(91,S,1,1,"ng-template",8),o.TgZ(92,"div"),o.TgZ(93,"div",26),o.TgZ(94,"div",35),o.TgZ(95,"h3"),o._uU(96),o.qZA(),o.TgZ(97,"p"),o._uU(98),o.qZA(),o.qZA(),o._UZ(99,"mat-divider",36),o.TgZ(100,"div",35),o.TgZ(101,"h3"),o._uU(102),o.qZA(),o.TgZ(103,"mat-chip-list"),o.YNc(104,E,2,1,"mat-chip",37),o.qZA(),o.qZA(),o._UZ(105,"mat-divider",36),o.TgZ(106,"div",38),o.TgZ(107,"h3"),o._uU(108),o.qZA(),o.TgZ(109,"p",12),o._uU(110),o.ALo(111,"number"),o.qZA(),o.qZA(),o._UZ(112,"mat-divider",36),o.TgZ(113,"div",35),o.TgZ(114,"h3"),o._uU(115),o.qZA(),o.TgZ(116,"p",39),o._uU(117),o.qZA(),o.qZA(),o._UZ(118,"mat-divider",36),o.TgZ(119,"div",35),o.TgZ(120,"h3"),o._uU(121),o.qZA(),o.TgZ(122,"p"),o._uU(123),o.qZA(),o.qZA(),o._UZ(124,"mat-divider",36),o.TgZ(125,"div",35),o.TgZ(126,"h3"),o._uU(127),o.qZA(),o.TgZ(128,"p"),o.TgZ(129,"b",12),o._uU(130),o.qZA(),o._uU(131),o.qZA(),o.qZA(),o._UZ(132,"mat-divider",36),o.qZA(),o.YNc(133,q,1,0,"mat-progress-bar",32),o.TgZ(134,"div",33),o.TgZ(135,"button",34),o._uU(136),o.qZA(),o.TgZ(137,"button",40),o.NdJ("click",function(){return o.CHM(e),o.oxw().onSave()}),o._uU(138),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.BQk()}if(2&e){const e=t.$implicit,n=o.oxw();o.xp6(3),o.Q6J("type","warning"),o.xp6(2),o.Oqu(e("WARNING")),o.xp6(1),o.hij(" ",e("WARNING_NOTE")," "),o.xp6(1),o.Q6J("linear",!0),o.xp6(1),o.Q6J("stepControl",n.form1),o.xp6(1),o.Q6J("formGroup",n.form1),o.xp6(6),o.Oqu(null==n.seasonInfo?null:n.seasonInfo.code),o.xp6(2),o.hij(" ",e("TOTAL_COST")," "),o.xp6(2),o.hij("",o.xi3(20,63,null==n.seasonInfo?null:n.seasonInfo.total,"1.0-1")," "),o.xp6(5),o.hij(" ",e("HARVESTED")," "),o.xp6(2),o.AsE("",o.xi3(27,66,n.harvested,"1.0-1")," ",e("PIECES")," "),o.xp6(2),o.Q6J("ngIf",n.total_move>0),o.xp6(5),o.Oqu(e("SIZE")),o.xp6(1),o.Q6J("placeholder",e("SIZE")),o.xp6(4),o.Oqu(e("UNIT")),o.xp6(1),o.Q6J("placeholder",e("SELECT_UNIT")),o.xp6(2),o.hij("gr/",e("PIECES"),""),o.xp6(6),o.Oqu(e("QUANTITY")),o.xp6(1),o.Q6J("placeholder",e("QUANTITY"))("value",n.numberFormatQuantityLive.fakeView),o.xp6(2),o.Oqu(e("PIECES")),o.xp6(4),o.Oqu(e("SURVIVAL_RATE")),o.xp6(1),o.Q6J("placeholder",e("SURVIVAL_RATE")),o.xp6(5),o.Oqu(e("NEXT")),o.xp6(1),o.Q6J("stepControl",n.form2),o.xp6(1),o.Q6J("formGroup",n.form2),o.xp6(6),o.Oqu(e("TARGET")),o.xp6(1),o.Q6J("placeholder","Ao \u0111\xedch"),o.xp6(1),o.Q6J("ngForOf",n.targetPonds),o.xp6(3),o.hij("",e("QUANTITY")," (kg)"),o.xp6(1),o.Q6J("placeholder",e("QUANTITY"))("value",n.numberFormatQuantity.fakeView),o.xp6(3),o.Oqu(e("COST")),o.xp6(1),o.Q6J("placeholder",e("COST"))("value",n.numberFormatCost.fakeView),o.xp6(3),o.Oqu(e("NOTE")),o.xp6(1),o.Q6J("placeholder",e("NOTE")),o.xp6(1),o.Q6J("ngIf",n.savingFlag.pending),o.xp6(3),o.hij(" ",e("BACK")," "),o.xp6(2),o.Oqu(e("NEXT")),o.xp6(1),o.Q6J("stepControl",n.form3),o.xp6(7),o.Oqu(e("SIZE")),o.xp6(2),o.AsE("",n.sizeCal,"g/Con (",1/(n.sizeCal/1e3)," con/Kg)"),o.xp6(4),o.Oqu(e("QUANTITY")),o.xp6(2),o.Q6J("ngForOf",n.quantityTotal),o.xp6(4),o.Oqu(e("TRANSFER_PRICE")),o.xp6(2),o.hij("",o.xi3(111,69,n.price/1e6,"1.0-1")," tri\u1ec7u \u0111"),o.xp6(5),o.Oqu(e("COST")),o.xp6(1),o.Q6J("ngClass",o.DdM(72,N)),o.xp6(1),o.hij("",n.transfer_price,"\u0111"),o.xp6(4),o.Oqu(e("NOTE")),o.xp6(2),o.Oqu(n.confirm_note),o.xp6(4),o.Oqu(e("TRANSFER_TO")),o.xp6(3),o.Oqu(null==n.transfer_to?null:n.transfer_to.name),o.xp6(1),o.lnq(" (",e("STARTED")," ",null==n.transfer_to?null:n.transfer_to.moment_day," ",e("DAY_AGO"),") "),o.xp6(2),o.Q6J("ngIf",n.savingFlag.pending),o.xp6(3),o.hij(" ",e("BACK")," "),o.xp6(1),o.Q6J("disabled",n.isDisable),o.xp6(1),o.hij(" ",e("SUBMIT")," ")}}let D=(()=>{class e{constructor(e,t,n,o,a){this._formBuilder=e,this.pondService=t,this.alertService=n,this.router=o,this._translate=a,this.form1=new i.cw({quantityLive:new i.NI("",[i.kI.required]),ratio:new i.NI(100,[i.kI.min(1),i.kI.max(100),i.kI.required]),unit:new i.NI("con",[i.kI.required]),size:new i.NI("",[i.kI.required])}),this.pondsLoading=new s.E,this.savingFlag=new s.E,this.numberFormatQuantity=new r.y(""),this.numberFormatQuantityLive=new r.y(""),this.numberFormatCost=new r.y(""),this.seedQuantity=0,this.quantityTotal=[],this.total_seed=0,this.total_move=0,this.total_harvest=0,this.isDisable=!1,this.post={date:Math.ceil((new Date).getTime()/1e3),pond_target:0,from_season_code:"",ratio_move:0,quantity:0,quantity_individual:0,size:0,weight:0,date_old:0,total_cost:0,move_cost:0,note:"",seed_cost:0}}ngOnInit(){this.getTargetPonds(),this.numberFormatQuantityLive.setValue(this.seedQuantity),this.form1.patchValue({quantityLive:this.seedQuantity}),this.form2=this._formBuilder.group({quantity:["",i.kI.required],pond_target:["",i.kI.required],move_cost:[""],note:["Chuy\u1ec3n giai \u0111o\u1ea1n "]})}onSave(){this.post.pond_target=this.form2.value.pond_target,this.post.from_season_code=this.seasonInfo.code,this.post.ratio_move=this.form1.controls.ratio.value,this.post.quantity=this.numberFormatQuantity.realValue,this.post.quantity_individual=this.numberFormatQuantityLive.realValue,this.post.size=1/(this.sizeCal/1e3),this.post.weight=this.sizeCal,this.post.date_old=this.seasonInfo.old,this.post.total_cost=this.price,this.post.move_cost=this.numberFormatCost.realValue,this.post.note=this.form2.value.note,this.endView(),this.savingFlag.setPending(!0),this.pondService.reqSeasonMove(this.post).subscribe(e=>{1==e.status?(this.alertService.success(e.message),100==this.post.ratio_move&&(this.pondService.seasonStart=!1),this.pondService.pond.seed_date=0,this.pondService.onLoaded$.next(1),this.router.navigate(["/pond/"+this.pondService.pcode]),this.savingFlag.setResult(!0)):(this.alertService.error(e.message),this.savingFlag.setResult(!1))},()=>{this.savingFlag.setResult(!1),this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}endView(){this.post.seed_cost=this.post.total_cost/this.post.quantity_individual}selectPond(e){let t=this.targetPonds.findIndex(t=>t.id==e.target.value);this.pondSelected=this.targetPonds[t]}quantityLiveChange(){0!=this.seedQuantity&&this.form1.patchValue({ratio:(100*this.numberFormatQuantityLive.realValue/this.seedQuantity).toFixed(1)})}ratioChange(e){let t=Math.round(this.seasonInfo.now_individual*e.target.value/100);t>0&&this.numberFormatQuantityLive.setValue(t)}getTargetPonds(){this.pondsLoading.setPending(!0),this.pondService.getTargetPonds().subscribe(e=>{1==e.status?(this.targetPonds=e.data,this.seasonInfo=e.season,this.calHori(this.seasonInfo),this.harvested=this.seasonInfo.harvest_list.reduce((e,t)=>e+t.harvest_quantity/t.harvest_size*1e3,0),this.total_harvest=this.seasonInfo.harvest_list.reduce((e,t)=>e+1e3*t.harvest_quantity/t.harvest_size,0),this.total_move=this.seasonInfo.moved_list.reduce((e,t)=>t.from_season_code==this.seasonInfo.code?e+parseInt(t.quantity_individual):e,0),this.quantityTrs=e.season.now_individual-e.season.total_loss-this.harvested-this.total_move,console.log(this.harvested),console.log(this.quantityTrs),this.numberFormatQuantityLive.setValue("0"!=e.season.harvest_quantity?e.season.now_individual-e.season.total_loss-this.harvested-this.total_move:e.season.now_individual-e.season.total_loss),this.pondService.getWeightPresent(this.seasonInfo.code).pipe().subscribe(e=>{this.weight=e.data.weight,this.form1.controls.size.setValue(this.weight)}),this.pondsLoading.setResult(!0)):(this.alertService.error(e.error),this.pondsLoading.setResult(!1))},()=>{this.alertService.error(this._translate.translate("CONNECT_ERROR"))})}calHori(e){this.total=e.total,this.totalHarvest=e.harvest_list.reduce((e,t)=>e+Number(t.cost),0),this.totalMove=e.moved_list.reduce((e,t)=>t.from_season_code==this.seasonInfo.code?e+Number(t.cost):e,0)}onChangeRatio(e){let t=this.numberFormatQuantityLive.realValue/Number(this.quantityTrs)*100;this.form1.patchValue({ratio:t})}onChangeRate(){let e=Number(this.quantityTrs)*this.form1.controls.ratio.value/100;this.numberFormatQuantityLive.setValue(e)}onNext(){let e;e="con"==this.form1.value.unit?this.form1.value.size:1e3/this.form1.value.size,console.log(e,"Weight Change"),this.quantityKg=this.numberFormatQuantityLive.realValue*(e/1e3),this.form2.controls.quantity.setValue(Number(this.quantityKg.toFixed(1))),this.numberFormatQuantity.setValue(this.quantityKg.toFixed(1)),this.sizeCal=+e,this.confirm_note=this.form2.controls.note.value}priceHori(){this.price=this.form1.value.ratio<=100?(this.total-this.totalHarvest-this.totalMove)*this.form1.value.ratio/100:this.total-this.totalHarvest-this.totalMove}onNext2(){let e=this.targetPonds.filter(e=>e.id==this.form2.value.pond_target);this.transfer_to=e[0],this.transfer_price=this.numberFormatCost.fakeView;let t=this.numberFormatQuantity.realValue/(this.sizeCal/1e3);if(console.log(t,this.numberFormatQuantity.realValue,this.form2.value.quantity,this.sizeCal),t<=this.quantityTrs){let e=t/+this.quantityTrs*100;this.numberFormatQuantityLive.setValue(t),this.form1.controls.ratio.setValue(e.toFixed(1)),this.isDisable=!1}else this.alertService.error(this._translate.translate("PLEASE")),this.numberFormatQuantityLive.setValue(this.quantityTrs),this.form1.controls.ratio.setValue(100),this.isDisable=!0;this.quantityTotal=[this.numberFormatQuantityLive.fakeView+" con",this.form2.value.quantity+" kg",this.form1.controls.ratio.value+" %"],this.priceHori()}onChangeUnit(e){this.form1.controls.size.setValue(1e3/this.form1.controls.size.value)}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(i.qu),o.Y36(a.p),o.Y36(l.c),o.Y36(c.F0),o.Y36(u.Vn))},e.\u0275cmp=o.Xpm({type:e,selectors:[["app-season-move"]],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"p-2","w-full"],[1,"mb-2"],[3,"type"],["fuseAlertTitle",""],[1,"mat-elevation-z4",3,"linear"],[3,"stepControl"],[3,"formGroup"],["matStepLabel",""],[1,"py-3","shadow","rounded-2xl","overflow-hidden","w-full","mt-6","flex","flex-col","bg-gray-50"],[1,"flex","justify-center","text-base"],[1,"flex","justify-evenly","text-base"],["ngClass","text-red-500"],["class","flex justify-evenly text-base",4,"ngIf"],[1,"grid","md:grid-cols-2","sm:grid-cols-1"],[1,"p-2"],[1,"w-full"],["matInput","","formControlName","size","required","",3,"placeholder"],["formControlName","unit",3,"placeholder","selectionChange"],["value","con"],["value","kg"],["matInput","","formControlName","quantityLive","required","",3,"placeholder","value","keyup","input"],["matSuffix",""],["matInput","","formControlName","ratio","required","",3,"placeholder","keyup"],[1,"flex","justify-end"],["mat-stroked-button","","matStepperNext","",3,"click"],[1,"grid","grid-cols-1"],["formControlName","pond_target",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","quantity","required","",3,"placeholder","value","input"],["matInput","","formControlName","move_cost",3,"placeholder","value","input"],["matInput","","formControlName","note",3,"placeholder"],["mode","indeterminate",4,"ngIf"],["fxLayout","row","fxLayoutAlign","end center",1,"pt-24"],["mat-stroked-button","","matStepperPrevious","","type","button",1,"mr-8"],[1,"flex","flex-col","items-left"],[1,"my-2"],["color","accent","class","example-box","cdkDrag","",4,"ngFor","ngForOf"],[1,"flex","items-left","flex-col"],[3,"ngClass"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],[3,"value"],["mode","indeterminate"],["color","accent","cdkDrag","",1,"example-box"]],template:function(e,t){1&e&&o.YNc(0,C,139,73,"ng-container",0),2&e&&o.Q6J("translocoRead","SAESON.MOVE_MOD")},directives:[u.KI,d.W,h.Vq,h.C0,i._Y,i.JL,i.sg,h.VY,p.mk,p.O5,m.KE,m.hX,f.Nt,i.Fj,i.JJ,i.u,i.Q7,g.gD,v.ey,m.R9,y.lW,h.Ic,p.sg,h.fd,i.F,_.d,T.qn,x.pW,T.HS],pipes:[p.JJ],styles:[""]}),e})()}}]);